/*

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2017 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(n,e,c){n!=Array.prototype&&n!=Object.prototype&&(n[e]=c.value)};$jscomp.getGlobal=function(n){return"undefined"!=typeof window&&window===n?n:"undefined"!=typeof global&&null!=global?global:n};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(n){return $jscomp.SYMBOL_PREFIX+(n||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var n=$jscomp.global.Symbol.iterator;n||(n=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[n]&&$jscomp.defineProperty(Array.prototype,n,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(n){var e=0;return $jscomp.iteratorPrototype(function(){return e<n.length?{done:!1,value:n[e++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(n){$jscomp.initSymbolIterator();n={next:n};n[$jscomp.global.Symbol.iterator]=function(){return this};return n};$jscomp.makeIterator=function(n){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var e=n[Symbol.iterator];return e?e.call(n):$jscomp.arrayIterator(n)};$jscomp.arrayFromIterator=function(n){for(var e,c=[];!(e=n.next()).done;)c.push(e.value);return c};$jscomp.arrayFromIterable=function(n){return n instanceof Array?n:$jscomp.arrayFromIterator($jscomp.makeIterator(n))};
$jscomp.polyfill=function(n,e,c,q){if(e){c=$jscomp.global;n=n.split(".");for(q=0;q<n.length-1;q++){var m=n[q];m in c||(c[m]={});c=c[m]}n=n[n.length-1];q=c[n];e=e(q);e!=q&&null!=e&&$jscomp.defineProperty(c,n,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Number.isNaN",function(n){return n?n:function(e){return"number"===typeof e&&isNaN(e)}},"es6","es3");
$jscomp.polyfill("Number.isFinite",function(n){return n?n:function(e){return"number"!==typeof e?!1:!isNaN(e)&&Infinity!==e&&-Infinity!==e}},"es6","es3");$jscomp.iteratorFromArray=function(n,e){$jscomp.initSymbolIterator();n instanceof String&&(n+="");var c=0,q={next:function(){if(c<n.length){var m=c++;return{value:e(m,n[m]),done:!1}}q.next=function(){return{done:!0,value:void 0}};return q.next()}};q[Symbol.iterator]=function(){return q};return q};
$jscomp.polyfill("Array.prototype.keys",function(n){return n?n:function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6","es3");$jscomp.polyfill("Number.isInteger",function(n){return n?n:function(e){return Number.isFinite(e)?e===Math.floor(e):!1}},"es6","es3");
$jscomp.polyfill("Array.from",function(n){return n?n:function(e,c,q){$jscomp.initSymbolIterator();c=null!=c?c:function(a){return a};var m=[],r=e[Symbol.iterator];if("function"==typeof r)for(e=r.call(e);!(r=e.next()).done;)m.push(c.call(q,r.value));else{r=e.length;for(var a=0;a<r;a++)m.push(c.call(q,e[a]))}return m}},"es6","es3");$jscomp.owns=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)};
$jscomp.polyfill("WeakMap",function(n){function e(a){$jscomp.owns(a,q)||$jscomp.defineProperty(a,q,{value:{}})}function c(a){var b=Object[a];b&&(Object[a]=function(a){e(a);return b(a)})}if(function(){if(!n||!Object.seal)return!1;try{var a=Object.seal({}),b=Object.seal({}),c=new n([[a,2],[b,3]]);if(2!=c.get(a)||3!=c.get(b))return!1;c.delete(a);c.set(b,4);return!c.has(a)&&4==c.get(b)}catch(w){return!1}}())return n;var q="$jscomp_hidden_"+Math.random().toString().substring(2);c("freeze");c("preventExtensions");
c("seal");var m=0,r=function(a){this.id_=(m+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};r.prototype.set=function(a,b){e(a);if(!$jscomp.owns(a,q))throw Error("WeakMap key fail: "+a);a[q][this.id_]=b;return this};r.prototype.get=function(a){return $jscomp.owns(a,q)?a[q][this.id_]:void 0};r.prototype.has=function(a){return $jscomp.owns(a,q)&&$jscomp.owns(a[q],this.id_)};r.prototype.delete=
function(a){return $jscomp.owns(a,q)&&$jscomp.owns(a[q],this.id_)?delete a[q][this.id_]:!1};return r},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(n){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!n||!n.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),c=new n($jscomp.makeIterator([[a,"s"]]));if("s"!=c.get(a)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var w=c.entries(),u=w.next();if(u.done||u.value[0]!=a||"s"!=u.value[1])return!1;u=w.next();return u.done||4!=u.value[0].x||"t"!=u.value[1]||!w.next().done?!1:!0}catch(p){return!1}}())return n;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var e=new WeakMap,c=function(a){this.data_={};this.head_=r();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};c.prototype.set=function(a,c){var b=q(this,a);b.list||(b.list=this.data_[b.id]=[]);b.entry?b.entry.value=c:(b.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:c},b.list.push(b.entry),this.head_.previous.next=b.entry,this.head_.previous=b.entry,this.size++);return this};c.prototype.delete=
function(a){a=q(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};c.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=r();this.size=0};c.prototype.has=function(a){return!!q(this,a).entry};c.prototype.get=function(a){return(a=q(this,a).entry)&&a.value};c.prototype.entries=function(){return m(this,function(a){return[a.key,
a.value]})};c.prototype.keys=function(){return m(this,function(a){return a.key})};c.prototype.values=function(){return m(this,function(a){return a.value})};c.prototype.forEach=function(a,c){for(var b=this.entries(),l;!(l=b.next()).done;)l=l.value,a.call(c,l[1],l[0],this)};c.prototype[Symbol.iterator]=c.prototype.entries;var q=function(b,c){var l=c&&typeof c;"object"==l||"function"==l?e.has(c)?l=e.get(c):(l=""+ ++a,e.set(c,l)):l="p_"+c;var u=b.data_[l];if(u&&$jscomp.owns(b.data_,l))for(b=0;b<u.length;b++){var p=
u[b];if(c!==c&&p.key!==p.key||c===p.key)return{id:l,list:u,index:b,entry:p}}return{id:l,list:u,index:-1,entry:void 0}},m=function(a,c){var b=a.head_;return $jscomp.iteratorPrototype(function(){if(b){for(;b.head!=a.head_;)b=b.previous;for(;b.next!=b.head;)return b=b.next,{done:!1,value:c(b)};b=null}return{done:!0,value:void 0}})},r=function(){var a={};return a.previous=a.next=a.head=a},a=0;return c},"es6","es3");
$jscomp.checkStringArgs=function(n,e,c){if(null==n)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return n+""};
$jscomp.polyfill("String.prototype.startsWith",function(n){return n?n:function(e,c){var q=$jscomp.checkStringArgs(this,e,"startsWith");e+="";var m=q.length,r=e.length;c=Math.max(0,Math.min(c|0,q.length));for(var a=0;a<r&&c<m;)if(q[c++]!=e[a++])return!1;return a>=r}},"es6","es3");
$jscomp.polyfill("Set",function(n){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!n||!n.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),e=new n($jscomp.makeIterator([c]));if(!e.has(c)||1!=e.size||e.add(c)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var m=e.entries(),r=m.next();if(r.done||r.value[0]!=c||r.value[1]!=c)return!1;r=m.next();return r.done||r.value[0]==c||4!=r.value[0].x||r.value[1]!=r.value[0]?!1:m.next().done}catch(a){return!1}}())return n;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var e=function(c){this.map_=new Map;if(c){c=$jscomp.makeIterator(c);for(var e;!(e=c.next()).done;)this.add(e.value)}this.size=this.map_.size};e.prototype.add=function(c){this.map_.set(c,c);this.size=this.map_.size;return this};e.prototype.delete=function(c){c=this.map_.delete(c);this.size=this.map_.size;return c};e.prototype.clear=function(){this.map_.clear();this.size=0};e.prototype.has=function(c){return this.map_.has(c)};e.prototype.entries=function(){return this.map_.entries()};
e.prototype.values=function(){return this.map_.values()};e.prototype.keys=e.prototype.values;e.prototype[Symbol.iterator]=e.prototype.values;e.prototype.forEach=function(c,e){var m=this;this.map_.forEach(function(r){return c.call(e,r,r,m)})};return e},"es6","es3");$jscomp.polyfill("Object.assign",function(n){return n?n:function(e,c){for(var q=1;q<arguments.length;q++){var m=arguments[q];if(m)for(var r in m)$jscomp.owns(m,r)&&(e[r]=m[r])}return e}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(n){function e(){this.batch_=null}function c(a){return a instanceof m?a:new m(function(b,c){b(a)})}if(n&&!$jscomp.FORCE_POLYFILL_PROMISE)return n;e.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};e.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var q=$jscomp.global.setTimeout;e.prototype.asyncExecuteFunction=function(a){q(a,
0)};e.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(w){this.asyncThrow_(w)}}}this.batch_=null};e.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var m=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(l){b.reject(l)}};m.prototype.createResolveAndReject_=
function(){function a(a){return function(l){c||(c=!0,a.call(b,l))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};m.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof m)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};m.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(l){this.reject_(l);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};m.prototype.reject_=function(a){this.settle_(2,a)};m.prototype.fulfill_=function(a){this.settle_(1,a)};m.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};m.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var r=new e;m.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};m.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(w){c.reject(w)}};m.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{e(a(b))}catch(d){u(d)}}:b}var e,u,p=new m(function(a,
b){e=a;u=b});this.callWhenSettled_(c(a,e),c(b,u));return p};m.prototype.catch=function(a){return this.then(void 0,a)};m.prototype.callWhenSettled_=function(a,b){function c(){switch(e.state_){case 1:a(e.result_);break;case 2:b(e.result_);break;default:throw Error("Unexpected state: "+e.state_);}}var e=this;null==this.onSettledCallbacks_?r.asyncExecute(c):this.onSettledCallbacks_.push(function(){r.asyncExecute(c)})};m.resolve=c;m.reject=function(a){return new m(function(b,c){c(a)})};m.race=function(a){return new m(function(b,
l){for(var e=$jscomp.makeIterator(a),u=e.next();!u.done;u=e.next())c(u.value).callWhenSettled_(b,l)})};m.all=function(a){var b=$jscomp.makeIterator(a),l=b.next();return l.done?c([]):new m(function(a,u){function p(b){return function(d){k[b]=d;h--;0==h&&a(k)}}var k=[],h=0;do k.push(void 0),h++,c(l.value).callWhenSettled_(p(k.length-1),u),l=b.next();while(!l.done)})};return m},"es6","es3");$jscomp.polyfill("Math.log2",function(n){return n?n:function(e){return Math.log(e)/Math.LN2}},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(n){return n?n:function(e){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>e||1342177279<e)throw new RangeError("Invalid count value");e|=0;for(var q="";e;)if(e&1&&(q+=c),e>>>=1)c+=c;return q}},"es6","es3");
$jscomp.polyfill("WeakSet",function(n){if(function(){if(!n||!Object.seal)return!1;try{var c=Object.seal({}),e=Object.seal({}),m=new n([c]);if(!m.has(c)||m.has(e))return!1;m.delete(c);m.add(e);return!m.has(c)&&m.has(e)}catch(r){return!1}}())return n;var e=function(c){this.map_=new WeakMap;if(c){$jscomp.initSymbol();$jscomp.initSymbolIterator();c=$jscomp.makeIterator(c);for(var e;!(e=c.next()).done;)this.add(e.value)}};e.prototype.add=function(c){this.map_.set(c,!0);return this};e.prototype.has=function(c){return this.map_.has(c)};
e.prototype.delete=function(c){return this.map_.delete(c)};return e},"es6","es3");$jscomp.findInternal=function(n,e,c){n instanceof String&&(n=String(n));for(var q=n.length,m=0;m<q;m++){var r=n[m];if(e.call(c,r,m,n))return{i:m,v:r}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(n){return n?n:function(e,c){return $jscomp.findInternal(this,e,c).v}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(n){return n?n:function(){return $jscomp.iteratorFromArray(this,function(e,c){return c})}},"es6","es3");$jscomp.polyfill("Math.sign",function(n){return n?n:function(e){e=Number(e);return 0===e||isNaN(e)?e:0<e?1:-1}},"es6","es3");$jscomp.polyfill("Array.prototype.entries",function(n){return n?n:function(){return $jscomp.iteratorFromArray(this,function(e,c){return[e,c]})}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(n){return n?n:function(e,c,q){var m=this.length||0;0>c&&(c=Math.max(0,m+c));if(null==q||q>m)q=m;q=Number(q);0>q&&(q=Math.max(0,m+q));for(c=Number(c||0);c<q;c++)this[c]=e;return this}},"es6","es3");
$jscomp.polyfill("Array.prototype.copyWithin",function(n){return n?n:function(e,c,q){var m=this.length;e=Number(e);c=Number(c);q=Number(null!=q?q:m);if(e<c)for(q=Math.min(q,m);c<q;)c in this?this[e++]=this[c++]:(delete this[e++],c++);else for(q=Math.min(q,m+c-e),e+=q-c;q>c;)--q in this?this[--e]=this[q]:delete this[e];return this}},"es6","es3");
(function(n){function e(q){if(c[q])return c[q].exports;var m=c[q]={i:q,l:!1,exports:{}};n[q].call(m.exports,m,m.exports,e);m.l=!0;return m.exports}var c={};e.m=n;e.c=c;e.d=function(c,m,r){e.o(c,m)||Object.defineProperty(c,m,{configurable:!1,enumerable:!0,get:r})};e.n=function(c){var m=c&&c.__esModule?function(){return c["default"]}:function(){return c};e.d(m,"a",m);return m};e.o=function(c,e){return Object.prototype.hasOwnProperty.call(c,e)};e.p="";return e(e.s=112)})([function(n,e,c){function q(a,
b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function r(a,b,c,k){a.addEventListener(b,c,k);return function(){return a.removeEventListener(b,c,k)}}c.d(e,
"c",function(){return r});c.d(e,"a",function(){return b});c.d(e,"b",function(){return l});var a=function(){function a(a,b){for(var k=0;k<b.length;k++){var h=b[k];h.enumerable=h.enumerable||!1;h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(a,h.key,h)}}return function(b,c,k){c&&a(b.prototype,c);k&&a(b,k);return b}}(),b=function(){function b(){m(this,b);this.refCount=1}a(b,[{key:"addRef",value:function(){++this.refCount;return this}},{key:"dispose",value:function(){0===--this.refCount&&
this.refCountReachedZero()}},{key:"refCountReachedZero",value:function(){this.disposed();var a=this.disposers;if(null!=a){for(var b=a.length;0<b;--b){var k=a[b-1];"object"===typeof k?k.dispose():k.call(this)}this.disposers=void 0}this.wasDisposed=!0}},{key:"disposed",value:function(){}},{key:"registerDisposer",value:function(a){var b=this.disposers;null==b?this.disposers=[a]:b.push(a);return a}},{key:"unregisterDisposer",value:function(a){var b=this.disposers;if(null!=b){var k=b.indexOf(a);-1!==k&&
b.splice(k,1)}return a}},{key:"registerEventListener",value:function(a,b,k,h){this.registerDisposer(r(a,b,k,h))}},{key:"registerCancellable",value:function(a){this.registerDisposer(function(){a.cancel()});return a}}]);return b}(),l=function(a){function b(a){m(this,b);var k=(b.__proto__||Object.getPrototypeOf(b)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");k=!k||"object"!==typeof k&&"function"!==typeof k?this:k;k.value=a;return k}q(b,a);
return b}(b)},function(n,e,c){function q(a,b){var c=Math.abs(a[b]),e=Math.abs(a[b+1]),u=Math.abs(a[b+2]),p=Math.max(c,e,u);1E-4>c/p&&(a[b]=0);1E-4>e/p&&(a[b+1]=0);1E-4>u/p&&(a[b+2]=0)}c.d(e,"b",function(){return r});e.k=function(a){return a[0]*a[1]*a[2]};e.q=function(a){return a[0]+","+a[1]+","+a[2]};e.m=function(a){q(a,0);q(a,4);q(a,8)};e.n=function(a,b,c){var l=b[0],e=b[1];b=b[2];a[0]=c[0]*l+c[4]*e+c[8]*b;a[1]=c[1]*l+c[5]*e+c[9]*b;a[2]=c[2]*l+c[6]*e+c[10]*b;return a};e.c=function(a,b){var c=b[0],
e=b[1],u=b[2],p=b[4],k=b[5],h=b[6],g=b[8],d=b[9];b=b[10];a[0]=Math.sqrt(c*c+e*e+u*u);a[1]=Math.sqrt(p*p+k*k+h*h);a[2]=Math.sqrt(g*g+d*d+b*b);return a};e.o=function(a,b,c,e,u){a[0]=e[0];a[1]=e[1];a[2]=e[2]*u;return m.b.fromRotationTranslationScale(a,c,b,a)};var m=c(69);n=c(11);c.d(e,"i",function(){return m.a});c.d(e,"j",function(){return m.b});c.d(e,"l",function(){return m.c});c.d(e,"p",function(){return m.d});c.d(e,"r",function(){return m.e});c=m.b.create();e.d=c;e.a=["x","y","z"];var r=function b(c,
e){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.lower=c;this.upper=e};c=[m.d.fromValues(1,0,0),m.d.fromValues(0,1,0),m.d.fromValues(0,0,1)];e.e=c;c=m.d.fromValues(0,0,0);e.h=c;c=m.d.fromValues(1,1,1);e.g=c;c=m.d.fromValues(Infinity,Infinity,Infinity);e.f=c;m.c.create();new n.a(1227133513,306783378);new n.a(3272356035,818089008);new n.a(251719695,4027515120);new n.a(4278190335,16711680);new n.a(65535,16711680);new n.a(2097151,0)},function(n,e,c){function q(a){var d=
typeof a;if("number"===d||"string"===d)if(d=parseFloat(""+a),!Number.isNaN(d))return d;throw Error("Expected floating-point number, but received: "+JSON.stringify(a)+".");}function m(a){a=q(a);if(Number.isFinite(a))return a;throw Error("Expected finite floating-point number, but received: "+a+".");}function r(a){a=m(a);if(0<a)return a;throw Error("Expected positive finite floating-point number, but received: "+a+".");}function a(d){if("object"===typeof d){if(null===d)return"null";if(Array.isArray(d)){var b=
"[",f=d.length,g=0;if(g<f)for(b+=a(d[g]);++g<f;)b+=",",b+=a(d[g]);return b+"]"}b="{";f=Object.keys(d).sort();g=0;var k=f.length;if(g<k){var h=f[g];b+=JSON.stringify(h);for(b=b+":"+a(d[h]);++g<k;)b+=",",h=f[g],b+=JSON.stringify(h),b+=":",b+=a(d[h])}return b+"}"}return JSON.stringify(d)}function b(a){return a.replace(/['"]/g,function(a){return'"'===a?"'":'"'})}function l(a){if("object"===typeof a){if(null===a)return"null";var d=a.toJSON;if("function"===typeof d)return l(d.call(a));if(Array.isArray(a)){d=
"[";var f=a.length,g=0;if(g<f)for(d+=l(a[g]);++g<f;)d+="_",d+=l(a[g]);return d+"]"}d="{";g=Object.keys(a);f=!0;g=$jscomp.makeIterator(g);for(var h=g.next();!h.done;h=g.next()){h=h.value;var k=a[h];void 0!==k&&(k=l(k))&&(f?f=!1:d+="_",d+=b(JSON.stringify(b(h))),d+=":",d+=k)}return d+"}"}return"string"===typeof a?b(JSON.stringify(b(a))):JSON.stringify(a)}function w(a,d,b){var f=/[&_,]/g;if('"'===b){var g="'";var h=G;var k=v}else g='"',h=E,k=y;for(var c="";0<a.length;){var p=a.match(k);if(null===p){var z=
a;p=a=""}else{z=a.substr(0,p.index);a=a.substr(p.index+p[0].length);var l=p[1];if(void 0!==l){var e=l,D=g;p=b;l=h;if(2<=e.length&&e.charAt(0)===D&&e.charAt(e.length-1)===D){e=e.substr(1,e.length-2);for(D=p;0<e.length;){var u=e.match(l);if(null===u){D+=e;break}D+=u[1];D+="\\";D+=p;e=e.substr(u.index+u[0].length)}p=D+p}else p=e}else p=p[2]}c+=z.replace(f,d);c+=p}return c}function u(a){return JSON.parse(w(a,",",'"'))}function p(a,d,b){var f=a.length;if(!Array.isArray(d)||d.length!==f)throw Error("Expected length "+
f+" array, but received: "+JSON.stringify(d)+".");for(var g=0;g<f;++g)a[g]=b(d[g],g);return a}function k(a){if("object"!==typeof a||null==a||Array.isArray(a))throw Error("Expected JSON object, but received: "+JSON.stringify(a)+".");return a}function h(a){var d=parseInt(a,10);if(!Number.isInteger(d))throw Error("Expected integer, but received: "+JSON.stringify(a)+".");return d}function g(a){a=h(a);if(0>=a)throw Error("Expected positive integer, but received: "+a+".");return a}function d(a){if("string"!==
typeof a)throw Error("Expected string, but received: "+JSON.stringify(a)+".");return a}e.q=q;e.o=m;e.p=r;e.f=function(a,d,b){b=void 0===b?q:b;k(d);var f=Object.keys(d);f.sort();if(3!==f.length||"x"!==f[0]||"y"!==f[1]||"z"!==f[2])throw Error("Expected object to have keys ['x', 'y', 'z'], but received: "+JSON.stringify(d)+".");a[0]=b(d.x);a[1]=b(d.y);a[2]=b(d.z);return a};e.b=function(a,d){var b=a.length;if(!Array.isArray(d)||d.length!==b)throw Error("Incompatible sizes");for(var f=0;f<b;++f)if(!Number.isFinite(parseFloat(d[f])))throw Error("Non-finite value.");
for(f=0;f<b;++f)a[f]=parseFloat(d[f]);return a};e.d=function(a,d){var b=a.length;if(!Array.isArray(d)||d.length!==b)throw Error("Incompatible sizes.");for(var f=0;f<b;++f){var g=parseInt(d[f],void 0);if(!Number.isInteger(g))throw Error("Non-integer value.");}for(f=0;f<b;++f)a[f]=parseInt(d[f],void 0);return a};e.g=a;e.i=l;e.h=u;e.a=function(a,d){if(!Array.isArray(a))throw Error("Expected array, but received: "+JSON.stringify(a)+".");return a.map(d)};e.c=p;e.u=k;e.s=h;e.A=g;e.t=function(a,d){var b=
d.get(a);if(void 0===b)throw Error("Expected one of "+JSON.stringify(Array.from(d.keys()))+", "+("but received: "+JSON.stringify(a)+"."));return b};e.B=d;e.z=function(a){if(void 0!==a)return d(a)};e.y=function(a){if(void 0!==a)return h(a)};e.x=function(a){if(void 0!==a){if("boolean"===typeof a)return a;if("true"===a)return!0;if("false"===a)return!1;throw Error("Expected string or boolean but received: "+JSON.stringify(a));}};e.w=function(a,d,b){a=a.hasOwnProperty(d)?a[d]:void 0;try{return b(a)}catch(x){throw Error("Error parsing "+
JSON.stringify(d)+" property: "+x.message);}};e.v=function(a,d){k(a);for(var b=new Map,f=$jscomp.makeIterator(Object.keys(a)),g=f.next();!g.done;g=f.next()){g=g.value;try{b.set(g,d(a[g]))}catch(H){throw Error("Error parsing value associated with key "+JSON.stringify(g)+": "+H.message);}}return b};e.r=function(a){if("number"!==typeof a||!Number.isFinite(a)||0>a||1<a)throw Error("Expected floating point number in [0,1], but received: "+JSON.stringify(a)+".");return a};e.e=function(a){if(""===a)return{};
if(a.startsWith("{"))return u(a);var d={};a=a.split(/[&;]/);a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next()){b=b.value;var f=b.match(/^([^=&;]+)=([^&;]*)$/);if(null===f)throw Error("Invalid query string part: "+JSON.stringify(b)+".");d[f[1]]=decodeURIComponent(f[2])}return d};e.n=function(a,d){if("string"===typeof a&&null!==a.match(/^[a-zA-Z]/)&&(a=a.toUpperCase(),d.hasOwnProperty(a)))return d[a];throw Error("Invalid enum value: "+JSON.stringify(a)+".");};e.l=function(a){return p(f.p.create(),
a,m)};e.k=function(a){return p(f.p.create(),a,r)};e.j=function(a){return p(f.p.create(),a,g)};e.m=function(a){if("boolean"!==typeof a)throw Error("Expected boolean, received: "+JSON.stringify(a));return a};var f=c(1);n=/('(?:[^'\\]|(?:\\.))*')/;e=/("(?:[^'\\]|(?:\\.))*")/;var v=new RegExp(n.source+"|"+e.source),y=new RegExp(e.source+"|"+n.source),G=/^((?:[^"'\\]|(?:\\.))*)"/,E=/^((?:[^"'\\]|(?:\\.))*)'/},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(e,"b",function(){return a});c.d(e,"a",function(){return b});var r=function(){function a(a,b){for(var c=0;c<b.length;c++){var k=b[c];k.enumerable=k.enumerable||!1;k.configurable=!0;"value"in k&&(k.writable=!0);Object.defineProperty(a,
k.key,k)}}return function(b,c,p){c&&a(b.prototype,c);p&&a(b,p);return b}}(),a=function(){function a(){m(this,a);this.handlers=new Set;this.count=0;var b=this;this.dispatch=function(){var a=this,c=arguments;++b.count;b.handlers.forEach(function(b){b.apply(a,c)})}}r(a,[{key:"add",value:function(a){var b=this;this.handlers.add(a);return function(){return b.remove(a)}}},{key:"remove",value:function(a){return this.handlers.delete(a)}},{key:"dispose",value:function(){this.handlers=void 0}}]);return a}(),
b=function(a){function b(){m(this,b);var a=(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&"function"!==typeof a?this:a}q(b,a);return b}(a)},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,
writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(e,"b",function(){return b});c.d(e,"a",function(){return l});var r=c(3),a=function(){function a(a,b){for(var k=0;k<b.length;k++){var h=b[k];h.enumerable=h.enumerable||!1;h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(a,h.key,h)}}return function(b,c,k){c&&a(b.prototype,c);k&&a(b,k);
return b}}(),b=function(){function b(a){m(this,b);this.value_=a;this.changed=new r.a}a(b,[{key:"value",get:function(){return this.value_},set:function(a){a!==this.value_&&(this.value_=a,this.changed.dispatch())}}]);return b}(),l=function(b){function c(a,b,h){h=void 0===h?a:h;m(this,c);a=(c.__proto__||Object.getPrototypeOf(c)).call(this,a);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a.validator=
b;a.defaultValue=h;return a}q(c,b);a(c,[{key:"toJSON",value:function(){if(this.value_!==this.defaultValue)return this.value_}},{key:"reset",value:function(){this.value=this.defaultValue}},{key:"restoreState",value:function(a){if(void 0!==a){var b=this.validator;try{this.value=b(a);return}catch(h){}}this.value=this.defaultValue}}]);return c}(b)},function(n,e,c){e.a=function(c){for(;;){var e=c.firstElementChild;if(!e)break;c.removeChild(e)}};e.b=function(c){var e=c.parentElement;return e?(e.removeChild(c),
!0):!1}},function(n,e,c){function q(a,d){if(!(a instanceof d))throw new TypeError("Cannot call a class as a function");}function m(a,d){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!d||"object"!==typeof d&&"function"!==typeof d?a:d}function r(a,d){if("function"!==typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+typeof d);a.prototype=Object.create(d&&d.prototype,{constructor:{value:a,enumerable:!1,
writable:!0,configurable:!0}});d&&(Object.setPrototypeOf?Object.setPrototypeOf(a,d):a.__proto__=d)}function a(a,d){p.set(a,d)}e.e=a;e.d=function(d,f){a(d,function(a){var d=this,g=a.id,h=new b.b;a=f.call(this,a,h);this.set(g,{promise:a,cancellationToken:h});a.then(function(a){var b=a.value;a=a.transfers;d.delete(g);d.invoke("rpc.promise.response",{id:g,value:b},a)},function(a){d.delete(g);d.invoke("rpc.promise.response",{id:g,error:a.message,errorName:a.name})})})};c.d(e,"a",function(){return g});
c.d(e,"b",function(){return d});c.d(e,"c",function(){return f});e.g=function(a){return function(d){d.prototype.RPC_TYPE_ID=a}};e.f=function(a){return function(d){if(void 0!==a)d.prototype.RPC_TYPE_ID=a;else if(a=d.prototype.RPC_TYPE_ID,void 0===a)throw Error("RPC_TYPE_ID should have already been defined");v.set(a,d)}};var b=c(14);n=c(0);var l=function G(a,d,b){null===a&&(a=Function.prototype);var f=Object.getOwnPropertyDescriptor(a,d);if(void 0===f){if(a=Object.getPrototypeOf(a),null!==a)return G(a,
d,b)}else{if("value"in f)return f.value;d=f.get;return void 0===d?void 0:d.call(b)}},w=function(){function a(a,d){for(var b=0;b<d.length;b++){var f=d[b];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(d,b,f){b&&a(d.prototype,b);f&&a(d,f);return d}}(),u=!("undefined"!==typeof Window&&self instanceof Window),p=new Map,k=function(a){function d(a,b){q(this,d);var f=m(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b));
f.name=a;f.message=b;return f}r(d,a);return d}(Error);a("rpc.promise.cancel",function(a){this.get(a.id).cancellationToken.cancel()});a("rpc.promise.response",function(a){var d=a.id,f=this.get(d),g=f.resolve;f=f.reject;this.delete(d);a.hasOwnProperty("value")?g(a.value):a.errorName===b.a.name?f(b.a):f(new k(a.errorName,a.error))});var h=u?-1:0,g=function(){function a(d){var b=this;q(this,a);this.target=d;this.objects=new Map;this.nextId=h;d.onmessage=function(a){a=a.data;p.get(a.functionName).call(b,
a)}}w(a,[{key:"set",value:function(a,d){this.objects.set(a,d)}},{key:"delete",value:function(a){this.objects.delete(a)}},{key:"get",value:function(a){return this.objects.get(a)}},{key:"getRef",value:function(a){var d=this.get(a.id);d.referencedGeneration=a.gen;d.addRef();return d}},{key:"invoke",value:function(a,d,b){d.functionName=a;this.target.postMessage(d,b)}},{key:"promiseInvoke",value:function(a,d,f,g){var h=this;f=void 0===f?b.e:f;return Object(b.d)(f,function(b,f,k){var c=d.id=h.newId();h.set(c,
{resolve:b,reject:f});h.invoke(a,d,g);k.add(function(){h.invoke("rpc.promise.cancel",{id:c})})})}},{key:"newId",value:function(){return u?this.nextId--:this.nextId++}},{key:"numObjects",get:function(){return this.objects.size}}]);return a}(),d=function(a){function d(){q(this,d);var a=m(this,(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments));a.rpc=null;a.rpcId=null;return a}r(d,a);w(d,[{key:"initializeSharedObject",value:function(a,d){d=void 0===d?a.newId():d;this.rpc=a;this.rpcId=d;this.isOwner=
!1;a.set(d,this)}},{key:"initializeCounterpart",value:function(a,d){d=void 0===d?{}:d;this.initializeSharedObject(a);this.referencedGeneration=this.unreferencedGeneration=0;this.isOwner=!0;d.id=this.rpcId;d.type=this.RPC_TYPE_ID;a.invoke("SharedObject.new",d)}},{key:"dispose",value:function(){l(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"dispose",this).call(this)}},{key:"addCounterpartRef",value:function(){return{id:this.rpcId,gen:++this.referencedGeneration}}},{key:"refCountReachedZero",
value:function(){!0===this.isOwner?this.referencedGeneration===this.unreferencedGeneration&&this.ownerDispose():!1===this.isOwner?this.rpc.invoke("SharedObject.refCountReachedZero",{id:this.rpcId,gen:this.referencedGeneration}):l(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"refCountReachedZero",this).call(this)}},{key:"ownerDispose",value:function(){var a=this.rpc,b=this.rpcId;l(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"refCountReachedZero",this).call(this);a.delete(b);
a.invoke("SharedObject.dispose",{id:b})}},{key:"counterpartRefCountReachedZero",value:function(a){this.unreferencedGeneration=a;0===this.refCount&&a===this.referencedGeneration&&this.ownerDispose()}}]);return d}(n.a),f=function(a){function d(a,b){b=void 0===b?{}:b;q(this,d);var f=m(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));b=void 0===b?{}:b;null!=a&&f.initializeSharedObject(a,b.id);return f}r(d,a);return d}(d);a("SharedObject.dispose",function(a){a=this.get(a.id);if(0!==a.refCount)throw Error("Attempted to dispose object with non-zero reference count.");
a.disposed();this.delete(a.rpcId);a.rpcId=null;a.rpc=null});a("SharedObject.refCountReachedZero",function(a){this.get(a.id).counterpartRefCountReachedZero(a.gen)});var v=new Map;a("SharedObject.new",function(a){--(new (v.get(a.type))(this,a)).refCount})},function(n,e,c){c.d(e,"i",function(){return r});e.q=function(a){return(a[3]+1/256*a[2]+1/65536*a[1]+1/16777216*a[0])/256};c.d(e,"g",function(){return a});c.d(e,"f",function(){return w});c.d(e,"h",function(){return u});c.d(e,"d",function(){return p});
e.p=function(a,b){for(var g=0;4>g;++g)a[g]=(b>>8*g&255)/255;return a};e.a=function(a,b){b=void 0===b?1:b;switch(a){case q.b.FLOAT32:if(1===b)return"float";if(1<b&&4>b)return"vec"+b;break;case q.b.UINT8:if(1===b)return"uint8_t";if(1<b&&4>b)return"uint8x"+b+"_t";break;case q.b.UINT16:if(1===b)return"uint16_t";if(2===b)return"uint16x2_t";break;case q.b.UINT32:if(1===b)return"uint32_t";break;case q.b.UINT64:if(1===b)return"uint64_t"}throw Error("No shader type for "+q.b[a]+"["+b+"].");};var q=c(27),m=
c(137),r="\nvec4 packFloat01ToFixedPoint(const float value) {\n  const vec4 shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n  const vec4 mask = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n  vec4 result = fract(value * shift);\n  result -= result.xxyz * mask;\n  return result * 256.0 / 255.0;\n}\n",a="\nvec3 hueToRgb(float hue) {\n  float hue6 = hue * 6.0;\n  float r = abs(hue6 - 3.0) - 1.0;\n  float g = 2.0 - abs(hue6 - 2.0);\n  float b = 2.0 - abs(hue6 - 4.0);\n  return clamp(vec3(r, g, b), 0.0, 1.0);\n}\nvec3 hsvToRgb(vec3 c) {\n  vec3 hueRgb = hueToRgb(c.x);\n  return c.z * ((hueRgb - 1.0) * c.y + 1.0);\n}\n";
n=["float","vec2","vec3","vec4"].map(function(a){return"\n"+a+" unnormalizeUint8("+a+" value) {\n  return floor(value * 255.0 + 0.5);\n}\n"}).join("");e.o=n;var b=[n,"\nfloat uintleToFloat(float v) {\n  return unnormalizeUint8(v);\n}\nfloat uintleToFloat(vec2 v) {\n  v = unnormalizeUint8(v);\n  return v.x + v.y * 256.0;\n}\nfloat uintleToFloat(vec3 v) {\n  v = unnormalizeUint8(v);\n  return v.x + v.y * 256.0 + v.z * 256.0 * 256.0;\n}\n"];e.n=b;var l=[n,"\nfloat uintbeToFloat(float v) {\n  return unnormalizeUint8(v);\n}\nfloat uintbeToFloat(vec2 v) {\n  v = unnormalizeUint8(v);\n  return v.y + v.x * 256.0;\n}\nfloat uintbeToFloat(vec3 v) {\n  v = unnormalizeUint8(v);\n  return v.z + v.y * 256.0 + v.x * 256.0 * 256.0;\n}\n"];
(function(){var a=m.a===m.b.BIG?"be":"le";return[m.a===m.b.BIG?l:b,"\nfloat uintToFloat(float v) {\n  return uint"+a+"ToFloat(v);\n}\nfloat uintToFloat(vec2 v) {\n  return uint"+a+"ToFloat(v);\n}\nfloat uintToFloat(vec3 v) {\n  return uint"+a+"ToFloat(v);\n}\n"]})();e.l="\nstruct uint64_t {\n  vec4 low, high;\n};\nuint64_t toUint64(uint64_t x) { return x; }\n";e.m=[n,"\nstruct uint64_t {\n  vec4 low, high;\n};\nuint64_t toUint64(uint64_t x) { return x; }\n","\nstruct uint8_t {\n  float value;\n};\nstruct uint8x2_t {\n  vec2 value;\n};\nstruct uint8x3_t {\n  vec3 value;\n};\nstruct uint8x4_t {\n  vec4 value;\n};\nfloat toRaw(uint8_t x) { return unnormalizeUint8(x.value); }\nfloat toNormalized(uint8_t x) { return x.value; }\nvec2 toRaw(uint8x2_t x) { return unnormalizeUint8(x.value); }\nvec2 toNormalized(uint8x2_t x) { return x.value; }\nvec3 toRaw(uint8x3_t x) { return unnormalizeUint8(x.value); }\nvec3 toNormalized(uint8x3_t x) { return x.value; }\nvec4 toRaw(uint8x4_t x) { return unnormalizeUint8(x.value); }\nvec4 toNormalized(uint8x4_t x) { return x.value; }\nuint64_t toUint64(uint8_t x) {\n  uint64_t result;\n  result.low = vec4(x.value, 0.0, 0.0, 0.0);\n  result.high = vec4(0.0, 0.0, 0.0, 0.0);\n  return result;\n}\n"];
e.e="\nfloat toRaw(float x) { return x; }\nfloat toNormalized(float x) { return x; }\nvec2 toRaw(vec2 x) { return x; }\nvec2 toNormalized(vec2 x) { return x; }\nvec3 toRaw(vec3 x) { return x; }\nvec3 toNormalized(vec3 x) { return x; }\nvec4 toRaw(vec4 x) { return x; }\nvec4 toNormalized(vec4 x) { return x; }\n";e.j=["\nstruct uint64_t {\n  vec4 low, high;\n};\nuint64_t toUint64(uint64_t x) { return x; }\n",b,"\nstruct uint16_t {\n  vec2 value;\n};\nstruct uint16x2_t {\n  vec4 value;\n};\nfloat toRaw(uint16_t x) { return uintleToFloat(x.value); }\nfloat toNormalized(uint16_t x) { return toRaw(x) / 65535.0; }\nvec2 toRaw(uint16x2_t x) { return vec2(uintleToFloat(x.value.xy), uintleToFloat(x.value.zw)); }\nvec2 toNormalized(uint16x2_t x) { return toRaw(x) / 65535.0; }\nuint64_t toUint64(uint16_t x) {\n  uint64_t result;\n  result.low = vec4(x.value, 0.0, 0.0);\n  result.high = vec4(0.0, 0.0, 0.0, 0.0);\n  return result;\n}\n"];
n=["\nstruct uint64_t {\n  vec4 low, high;\n};\nuint64_t toUint64(uint64_t x) { return x; }\n","\nstruct uint32_t {\n  vec4 value;\n};\nuint64_t toUint64(uint32_t x) {\n  uint64_t result;\n  result.low = x.value;\n  result.high = vec4(0.0, 0.0, 0.0, 0.0);\n  return result;\n}\n"];e.k=n;var w=["\nvec3 getSubscriptsFromNormalized(vec3 normalizedPosition, vec3 size) {\n  return floor(min(normalizedPosition * size, size - 1.0));\n}\n","\nfloat getFortranOrderIndex(vec3 subscripts, vec3 size) {\n  return subscripts.x + size.x * (subscripts.y + size.y * subscripts.z);\n}\n",
"\nfloat getFortranOrderIndexFromNormalized(vec3 normalizedPosition, vec3 size) {\n  return getFortranOrderIndex(getSubscriptsFromNormalized(normalizedPosition, size), size);\n}\n"],u="\nfloat imod(float x, float y) {\n  return x - y * floor(x / y);\n}\n",p="\nfloat exactDot(vec4 a, vec4 b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n}\nfloat exactDot(vec3 a, vec3 b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n";e.b=[n,"\nuint32_t add(uint32_t a, uint32_t b) {\n  uint32_t result;\n  float partial = 0.0;\n\n  partial += a.value.x * 255.0 + b.value.x * 255.0;\n  {\n    float byte0 = mod(partial, 256.0);\n    result.value.x = byte0 / 255.0;\n    partial = (partial - byte0) / 256.0;\n  }\n\n  partial += a.value.y * 255.0 + b.value.y * 255.0;\n  {\n    float byte1 = mod(partial, 256.0);\n    result.value.y = byte1 / 255.0;\n    partial = (partial - byte1) / 256.0;\n  }\n\n  partial += a.value.z * 255.0 + b.value.z * 255.0;\n  {\n    float byte2 = mod(partial, 256.0);\n    result.value.z = byte2 / 255.0;\n    partial = (partial - byte2) / 256.0;\n  }\n\n  partial += a.value.w * 255.0 + b.value.w * 255.0;\n  {\n    float byte3 = mod(partial, 256.0);\n    result.value.w = byte3 / 255.0;\n    partial = (partial - byte3) / 256.0;\n  }\n  return result;\n}\n"];
e.c=[n,"\nfloat divmod(uint32_t dividend, float divisor, out uint32_t quotient) {\n\n  float partial = dividend.value.w * 255.0;\n  float remainder;\n\n  remainder = mod(partial, divisor);\n  quotient.value.w = (partial - remainder) / divisor / 255.0;\n  partial = remainder * 256.0 + dividend.value.z * 255.0;\n\n  remainder = mod(partial, divisor);\n  quotient.value.z = (partial - remainder) / divisor / 255.0;\n  partial = remainder * 256.0 + dividend.value.y * 255.0;\n\n  remainder = mod(partial, divisor);\n  quotient.value.y = (partial - remainder) / divisor / 255.0;\n  partial = remainder * 256.0 + dividend.value.x * 255.0;\n\n  remainder = mod(partial, divisor);\n  quotient.value.x = (partial - remainder) / divisor / 255.0;\n\n  return remainder;\n}\n"]},
function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"d",function(){return l});c.d(e,"c",function(){return w});var m=c(39),r=c(27),a=c(1);c.d(e,"a",function(){return r.b});var b=function(){function a(a,b){for(var h=0;h<
b.length;h++){var g=b[h];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,k,h){k&&a(b.prototype,k);h&&a(b,h);return b}}(),l;(function(a){a[a.UNKNOWN=0]="UNKNOWN";a[a.IMAGE=1]="IMAGE";a[a.SEGMENTATION=2]="SEGMENTATION"})(l||(l={}));var w=function(c){function e(b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var h=(e.__proto__||Object.getPrototypeOf(e)).call(this,b);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
h=!h||"object"!==typeof h&&"function"!==typeof h?this:h;var g=h.dataType=b.dataType,d=h.numChannels=b.numChannels;h.chunkBytes=Object(a.k)(b.chunkDataSize)*r.a[g]*d;h.compressedSegmentationBlockSize=b.compressedSegmentationBlockSize;return h}q(e,c);b(e,[{key:"toObject",value:function(){return{transform:this.chunkLayout.transform,numChannels:this.numChannels,chunkDataSize:this.chunkDataSize,voxelSize:this.voxelSize,dataType:this.dataType,lowerVoxelBound:this.lowerVoxelBound,upperVoxelBound:this.upperVoxelBound,
lowerClipBound:this.lowerClipBound,upperClipBound:this.upperClipBound,baseVoxelOffset:this.baseVoxelOffset,compressedSegmentationBlockSize:this.compressedSegmentationBlockSize}}}],[{key:"make",value:function(a){return new e(Object.assign({},a,{transform:Object(m.e)(a.transform,a.volumeSourceOptions)}))}},{key:"fromObject",value:function(a){return new e(a)}},{key:"withDefaultCompression",value:function(a){var b=a.compressedSegmentationBlockSize,g=a.dataType,d=a.voxelSize,f=a.transform,c=a.lowerVoxelBound,
k=a.upperVoxelBound;f=Object(m.e)(f,a.volumeSourceOptions);void 0!==b||a.volumeType!==l.SEGMENTATION||g!==r.b.UINT32&&g!==r.b.UINT64||(b=Object(m.f)({voxelSize:d,transform:f,lowerVoxelBound:c,upperVoxelBound:k,maxVoxelsPerChunkLog2:9}));return new e(Object.assign({},a,{compressedSegmentationBlockSize:b,transform:f}))}},{key:"getDefaults",value:function(a){var b=Object.assign({},a,{transform:Object(m.e)(a.transform,a.volumeSourceOptions)});return(void 0===a.chunkDataSizes?Object(m.d)(b):a.chunkDataSizes).map(function(b){return e.withDefaultCompression(Object.assign({},
a,{chunkDataSize:b}))})}}]);return e}(m.c);e.b="volume/RenderLayer"},function(n,e,c){function q(a,d){if(!(a instanceof d))throw new TypeError("Cannot call a class as a function");}function m(a,d){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!d||"object"!==typeof d&&"function"!==typeof d?a:d}function r(a,d){if("function"!==typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+typeof d);a.prototype=Object.create(d&&
d.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});d&&(Object.setPrototypeOf?Object.setPrototypeOf(a,d):a.__proto__=d)}function a(a,d,b,f){f=void 0===f?{}:f;return w.a.forPromise(new Promise(function(g){g(a.getVolume(d,b,f))}),{initialMessage:"Retrieving metadata for volume "+b+".",delay:!0,errorPrefix:"Error retrieving metadata for volume "+b+": "})}e.h=function(a,d){a=a.editorSource;w.a.showMessage(d+": "+a.channel+" at "+a.host)};e.g=function(a,d){var b=new Promise(function(b,
f){a.editorSocket.send(b,f,d)}),f=a.editorSource,g=f.host;return w.a.forPromise(b,{initialMessage:"Trying to write to "+g+".",delay:!0,errorPrefix:"Cannot write to "+f.channel+" at "+g+":"})};e.d=a;c.d(e,"b",function(){return h});c.d(e,"c",function(){return g});c.d(e,"a",function(){return d});e.e=function(a,d){f.set(a,d)};e.f=function(a,d){v.set(a,d)};var b=c(12),l=c(8),w=c(26);n=c(0);var u=c(2),p=c(3),k=function(){function a(a,d){for(var b=0;b<d.length;b++){var f=d[b];f.enumerable=f.enumerable||
!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(d,b,f){b&&a(d.prototype,b);f&&a(d,f);return d}}(),h=function(a){function d(a,b,f){q(this,d);a=m(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,a));a.initialSpecification=b;a.manager=f;return a}r(d,a);k(d,[{key:"toJSON",value:function(){var a=this.layer;if(!a)return this.initialSpecification;a=a.toJSON();this.visible||(a.visible=!1);return a}}]);return d}(b.c),g=function(d){function b(a,d,f,
g,h){q(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.dataSourceProvider=a;c.layerManager=d;c.chunkManager=f;c.layerSelectedValues=g;c.voxelSize=h;c.changed=new p.a;c.voxelCoordinatesSet=new p.b;c.registerDisposer(d.layersChanged.add(c.changed.dispatch));c.registerDisposer(d.specificationChanged.add(c.changed.dispatch));return c}r(b,d);k(b,[{key:"reset",value:function(){this.layerManager.clear()}},{key:"restoreState",value:function(a){Object(u.u)(a);this.layerManager.clear();
for(var d=$jscomp.makeIterator(Object.keys(a)),b=d.next();!b.done;b=d.next())b=b.value,this.layerManager.addManagedLayer(this.getLayer(b,a[b]))}},{key:"initializeLayerFromSpec",value:function(d,b){var g=this;d.initialSpecification=b;"string"===typeof b&&(b={source:b});Object(u.u)(b);var h=Object(u.w)(b,"type",u.z);d.visible=Object(u.w)(b,"visible",function(a){if(void 0===a||!0===a)return!0;if(!1===a)return!1;throw Error("Expected boolean, but received: "+JSON.stringify(a)+".");});var c=d.sourceUrl=
Object(u.w)(b,"source",u.z);if(void 0===h){if(void 0===c)throw Error("Either layer 'type' or 'source' URL must be specified.");a(this.dataSourceProvider,this.chunkManager,c).then(function(a){if(-1!==g.layerManager.managedLayers.indexOf(d)){var f=v.get(a.volumeType);if(void 0!==f)d.layer=new f(g,b);else throw Error("Unsupported volume type: "+l.d[a.volumeType]+".");}})}else if(c=f.get(h),void 0!==c)d.layer=new c(this,b);else throw Error("Unsupported layer type: "+JSON.stringify(h)+".");}},{key:"getLayer",
value:function(a,d){a=new h(a,d,this);this.initializeLayerFromSpec(a,d);return a}},{key:"add",value:function(a,d){this.layerManager.addManagedLayer(a,d)}},{key:"toJSON",value:function(){for(var a={},d=0,b=$jscomp.makeIterator(this.layerManager.managedLayers),f=b.next();!f.done;f=b.next()){f=f.value;var g=f.toJSON();null!=g&&(a[f.name]=g,++d)}if(0!==d)return a}},{key:"setVoxelCoordinates",value:function(a){this.voxelCoordinatesSet.dispatch(a)}},{key:"worker",get:function(){return this.chunkManager.rpc}},
{key:"rpc",get:function(){return this.chunkManager.rpc}},{key:"rootLayers",get:function(){return this.layerManager}}]);return b}(n.a),d=function(a){function d(a){q(this,d);var f=m(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));f.master=a;f.changed=new p.a;f.layerManager=new b.a;f.registerDisposer(a);a=f.layerManager;f.registerDisposer(a.layersChanged.add(f.changed.dispatch));f.registerDisposer(a.specificationChanged.add(f.changed.dispatch));return f}r(d,a);k(d,[{key:"reset",value:function(){this.layerManager.clear()}},
{key:"restoreState",value:function(a){var d=this.master.layerManager,b=[];a=$jscomp.makeIterator(new Set(Object(u.a)(a,u.B)));for(var f=a.next();!f.done;f=a.next()){f=f.value;var g=d.getLayerByName(f);if(void 0===g)throw Error("Undefined layer referenced in subset specification: "+JSON.stringify(f));b.push(g)}this.layerManager.clear();d=$jscomp.makeIterator(b);for(b=d.next();!b.done;b=d.next())this.layerManager.addManagedLayer(b.value.addRef())}},{key:"toJSON",value:function(){return this.layerManager.managedLayers.map(function(a){return a.name})}},
{key:"initializeLayerFromSpec",value:function(a,d){this.master.initializeLayerFromSpec(a,d)}},{key:"getLayer",value:function(a,d){return this.master.getLayer(a,d)}},{key:"add",value:function(a,d){-1===this.master.layerManager.managedLayers.indexOf(a)&&(a.name=this.master.layerManager.getUniqueLayerName(a.name),this.master.layerManager.addManagedLayer(a.addRef()));this.layerManager.addManagedLayer(a,d)}},{key:"setVoxelCoordinates",value:function(a){this.master.setVoxelCoordinates(a)}},{key:"voxelCoordinatesSet",
get:function(){return this.master.voxelCoordinatesSet}},{key:"worker",get:function(){return this.master.rpc}},{key:"rpc",get:function(){return this.master.rpc}},{key:"dataSourceProvider",get:function(){return this.master.dataSourceProvider}},{key:"chunkManager",get:function(){return this.master.chunkManager}},{key:"voxelSize",get:function(){return this.master.voxelSize}},{key:"layerSelectedValues",get:function(){return this.master.layerSelectedValues}},{key:"rootLayers",get:function(){return this.master.rootLayers}}]);
return d}(n.a),f=new Map,v=new Map},function(n,e,c){function q(a,d){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!d||"object"!==typeof d&&"function"!==typeof d?a:d}function m(a,d){if("function"!==typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+typeof d);a.prototype=Object.create(d&&d.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});d&&(Object.setPrototypeOf?Object.setPrototypeOf(a,
d):a.__proto__=d)}function r(a,d){if(!(a instanceof d))throw new TypeError("Cannot call a class as a function");}function a(a){if("number"!==typeof a||0>a)throw Error("Expected non-negative number as limit, but received: "+JSON.stringify(a));return a}c.d(e,"b",function(){return y});c.d(e,"a",function(){return G});c.d(e,"d",function(){return E});c.d(e,"c",function(){return B});c.d(e,"e",function(){return z});e.f=function(a,b){a=function(a){function b(a){for(var d=[],f=0;f<arguments.length;++f)d[f-
0]=arguments[f];r(this,b);var g;f=q(this,(g=b.__proto__||Object.getPrototypeOf(b)).call.apply(g,[].concat([this],$jscomp.arrayFromIterable(d))));f.parameters=d[1].parameters;return f}m(b,a);f(b,[{key:"initializeCounterpart",value:function(a,f){f.parameters=this.parameters;d(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"initializeCounterpart",this).call(this,a,f)}}],[{key:"encodeOptions",value:function(a){var f=d(b.__proto__||Object.getPrototypeOf(b),"encodeOptions",this).call(this,a);
f.parameters=a.parameters;return f}}]);return b}(a);return a=v([Object(g.g)(b.RPC_ID)],a)};var b=c(23),l=c(46),w=c(4),u=c(2),p=c(47),k=c(19),h=c(3),g=c(6),d=function x(a,d,b){null===a&&(a=Function.prototype);var f=Object.getOwnPropertyDescriptor(a,d);if(void 0===f){if(a=Object.getPrototypeOf(a),null!==a)return x(a,d,b)}else{if("value"in f)return f.value;d=f.get;return void 0===d?void 0:d.call(b)}},f=function(){function a(a,d){for(var b=0;b<d.length;b++){var f=d[b];f.enumerable=f.enumerable||!1;f.configurable=
!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(d,b,f){b&&a(d.prototype,b);f&&a(d,f);return d}}(),v=this&&this.__decorate||function(a,d,b,f){var g=arguments.length,h=3>g?d:null===f?f=Object.getOwnPropertyDescriptor(d,b):f,c;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)h=Reflect.decorate(a,d,b,f);else for(var v=a.length-1;0<=v;v--)if(c=a[v])h=(3>g?c(h):3<g?c(d,b,h):c(d,b))||h;return 3<g&&h&&Object.defineProperty(d,b,h),h},y=function(){function a(d){r(this,
a);this.source=d;this.state=b.d.SYSTEM_MEMORY}f(a,[{key:"copyToGPU",value:function(a){this.state=b.d.GPU_MEMORY}},{key:"freeGPUMemory",value:function(a){this.state=b.d.SYSTEM_MEMORY}},{key:"gl",get:function(){return this.source.gl}}]);return a}(),G=function C(d){var b=void 0===d?{}:d;d=void 0===b.defaultItemLimit?Number.POSITIVE_INFINITY:b.defaultItemLimit;b=void 0===b.defaultSizeLimit?Number.POSITIVE_INFINITY:b.defaultSizeLimit;r(this,C);this.sizeLimit=new w.a(b,a);this.itemLimit=new w.a(d,a)},E=
function(a){function d(a,b,f){r(this,d);var g=q(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));g.gl=b;g.capacities=f;g.visibleChunksChanged=new h.a;g.pendingChunkUpdates=null;g.pendingChunkUpdatesTail=null;g.chunkUpdateDeadline=null;g.chunkUpdateDelay=30;b=function(d){return{itemLimit:g.registerDisposer(l.a.makeFromExisting(a,d.itemLimit)).rpcId,sizeLimit:g.registerDisposer(l.a.makeFromExisting(a,d.sizeLimit)).rpcId}};g.initializeCounterpart(a,{gpuMemoryCapacity:b(f.gpuMemory),systemMemoryCapacity:b(f.systemMemory),
downloadCapacity:b(f.download)});return g}m(d,a);f(d,[{key:"scheduleChunkUpdate",value:function(){var a=this.chunkUpdateDeadline;a=null===a||Date.now()<a?0:this.chunkUpdateDelay;setTimeout(this.processPendingChunkUpdates.bind(this),a)}},{key:"processPendingChunkUpdates",value:function(){var a=this.chunkUpdateDeadline;null===a&&(a=Date.now()+30);for(var d=!1;;){if(Date.now()>a){setTimeout(this.processPendingChunkUpdates.bind(this),this.chunkUpdateDelay);break}var f=this.pendingChunkUpdates,g=this.rpc.get(f.source);
if(void 0===f.id){d=$jscomp.makeIterator(g.chunks.keys());for(var h=d.next();!h.done;h=d.next())g.deleteChunk(h.value);d=!0}else if(h=f.state,h===b.d.EXPIRED)g.deleteChunk(f.id);else{var c=f.id;if(f["new"]){var v=g.getChunk(f);g.addChunk(c,v)}else v=g.chunks.get(c);if(h!==v.state)switch(h){case b.d.GPU_MEMORY:v.copyToGPU(this.gl);d=!0;break;case b.d.SYSTEM_MEMORY:v.freeGPUMemory(this.gl);break;default:throw Error("INTERNAL ERROR: Invalid chunk state: "+b.d[h]);}}f=this.pendingChunkUpdates=f.nextUpdate;
--window.numPendingChunkUpdates;if(null==f){this.pendingChunkUpdatesTail=null;break}}d&&this.visibleChunksChanged.dispatch()}}]);return d}(g.b);E=v([Object(g.g)(b.b)],E);window.numPendingChunkUpdates=0;Object(g.e)("Chunk.update",function(a){var d=this.get(a.source).chunkManager.chunkQueueManager,b=d.pendingChunkUpdatesTail;++window.numPendingChunkUpdates;null==b?(d.pendingChunkUpdates=a,d.pendingChunkUpdatesTail=a,d.scheduleChunkUpdate()):(b.nextUpdate=a,d.pendingChunkUpdatesTail=a)});var B=function(a){function d(a){r(this,
d);var b=q(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));b.chunkQueueManager=a;b.memoize=new p.b;b.registerDisposer(a.addRef());b.initializeCounterpart(a.rpc,{chunkQueueManager:a.rpcId});return b}m(d,a);f(d,[{key:"getChunkSource",value:function(a,d){var b=this,f=a.encodeOptions(d);f.constructorId=Object(k.a)(a);f=Object(u.g)(f);return this.memoize.get(f,function(){var f=new a(b,d);f.initializeCounterpart(b.rpc,{});return f})}},{key:"gl",get:function(){return this.chunkQueueManager.gl}}]);
return d}(g.b);B=v([Object(g.g)(b.a)],B);var z=function(a){function g(a,d){r(this,g);d=q(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));d.chunkManager=a;d.chunks=new Map;return d}m(g,a);f(g,[{key:"initializeCounterpart",value:function(a,b){b.chunkManager=this.chunkManager.rpcId;d(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"initializeCounterpart",this).call(this,a,b)}},{key:"deleteChunk",value:function(a){var d=this.chunks.get(a);d.state===b.d.GPU_MEMORY&&d.freeGPUMemory(this.gl);
this.chunks.delete(a)}},{key:"addChunk",value:function(a,d){this.chunks.set(a,d)}},{key:"getChunk",value:function(a){throw Error("Not implemented.");}},{key:"invalidateCache",value:function(){this.rpc.invoke(b.c,{id:this.rpcId})}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}],[{key:"encodeOptions",value:function(a){return{}}}]);return g}(g.b)},function(n,e,c){c.d(e,"a",function(){return w});var q=function(){function a(a,b){for(var h=0;h<b.length;h++){var g=b[h];g.enumerable=
g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,c,h){c&&a(b.prototype,c);h&&a(b,h);return b}}(),m=new Uint32Array(2),r=[];for(n=2;36>=n;++n){e=Math.floor(32/Math.log2(n));c=Math.pow(n,e);var a=Math.floor(e/2),b=Math.pow(n,a);a=Math.pow(n,e-a);var l="^[0-"+String.fromCharCode(48+Math.min(9,n-1));10<n&&(l+="a-"+String.fromCharCode(97+n-11),l+="A-"+String.fromCharCode(65+n-11));l+="]{1,"+Math.ceil(64/Math.log2(n))+"}$";r[n]={lowDigits:e,
lowBase:c,lowBase1:b,lowBase2:a,pattern:new RegExp(l)}}var w=function(){function a(b,c){b=void 0===b?0:b;c=void 0===c?0:c;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.low=b;this.high=c}q(a,[{key:"clone",value:function(){return new a(this.low,this.high)}},{key:"assign",value:function(a){this.low=a.low;this.high=a.high}},{key:"toString",value:function(a){a=void 0===a?10:a;var b=this.low,h=this.high;if(0===h)return b.toString(a);h*=4294967296;var g=r[a],d=g.lowBase;
g=g.lowDigits;var f=h%d;h=Math.floor(h/d);b+=f;h+=Math.floor(b/d);b=(b%d).toString(a);return h.toString(a)+"0".repeat(g-b.length)+b}},{key:"tryParseString",value:function(a,b){b=void 0===b?10:b;var h=r[b],g=h.lowDigits,d=h.lowBase,f=h.lowBase1,c=h.lowBase2;if(!h.pattern.test(a))return!1;if(a.length<=g)return this.low=parseInt(a,b),this.high=0,!0;g=a.length-g;h=parseInt(a.substr(g),b);a=parseInt(a.substr(0,g),b);d=Math.floor(a*d/4294967296);f=h+a%4294967296*f%4294967296*c%4294967296;4294967296<f&&
(++d,f-=4294967296);if(f>>>0!==f||d>>>0!==d)return!1;this.low=f;this.high=d;return!0}},{key:"parseString",value:function(a,b){if(!this.tryParseString(a,void 0===b?10:b))throw Error("Failed to parse string as uint64 value: "+JSON.stringify(a)+".");return this}},{key:"valid",value:function(){var a=this.low,b=this.high;return a>>>0===a&&b>>>0===b}},{key:"toJSON",value:function(){return this.toString()}},{key:"lshift",value:function(b){b&=63;if(0==b)return this.clone();var c=this.low,h=this.high;return 32>
b?new a(c<<b,h<<b|c>>>32-b):new a(0,c<<b-32)}},{key:"rshift",value:function(b){b&=63;if(0==b)return this.clone();var c=this.low,h=this.high;return 32>b?new a(c>>>b|h<<32-b,h>>b):new a(h>>b-32,0<=h?0:-1)}},{key:"or",value:function(b){return new a(this.low|b.low,this.high|b.high)}},{key:"xor",value:function(b){return new a(this.low^b.low,this.high^b.high)}},{key:"and",value:function(b){return new a(this.low&b.low,this.high&b.high)}}],[{key:"less",value:function(a,b){return a.high<b.high||a.high===b.high&&
a.low<b.low}},{key:"compare",value:function(a,b){return a.high-b.high||a.low-b.low}},{key:"equal",value:function(a,b){return a.low===b.low&&a.high===b.high}},{key:"min",value:function(b,c){return a.less(b,c)?b:c}},{key:"random",value:function(){crypto.getRandomValues(m);return new a(m[0],m[1])}},{key:"parseString",value:function(b,c){c=void 0===c?10:c;return(new a).parseString(b,c)}},{key:"encodeUint32Array",value:function(a){for(var b=new Uint32Array(2*a.length),c=0;c<a.length;c++){var g=a[c];b[2*
c]=g.low;b[2*c+1]=g.high}return b}},{key:"decodeUint32Array",value:function(b){b instanceof ArrayBuffer&&(b=new Uint32Array(b));if(1===b.length%2)throw Error("Decode error. Length of input array was not even: "+b.length);for(var c=Array(b.length/2),h=0;h<c.length;h++)c[h]=new a(b[2*h],b[2*h+1]);return c}}]);return a}();w.ZERO=new w(0,0)},function(n,e,c){function q(a,d){if(!(a instanceof d))throw new TypeError("Cannot call a class as a function");}function m(a,d){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!d||"object"!==typeof d&&"function"!==typeof d?a:d}function r(a,d){if("function"!==typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+typeof d);a.prototype=Object.create(d&&d.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});d&&(Object.setPrototypeOf?Object.setPrototypeOf(a,d):a.__proto__=d)}c.d(e,"e",function(){return f});c.d(e,"h",function(){return v});c.d(e,"g",function(){return y});c.d(e,"f",function(){return G});
c.d(e,"c",function(){return E});c.d(e,"a",function(){return B});c.d(e,"d",function(){return z});c.d(e,"b",function(){return D});e.i=function(a,d,b){return b.registerDisposer(new x(a,d,function(a){var d=a.redrawNeeded.add(function(){return b.scheduleRedraw()});b.scheduleRedraw();return function(){d();b.scheduleRedraw()}},b.visibility))};n=c(13);var a=c.n(n);n=c(133);var b=c.n(n),l=c(134);n=c(0);var w=c(1),u=c(3),p=c(135),k=c(11),h=c(33),g=function H(a,d,b){null===a&&(a=Function.prototype);var f=Object.getOwnPropertyDescriptor(a,
d);if(void 0===f){if(a=Object.getPrototypeOf(a),null!==a)return H(a,d,b)}else{if("value"in f)return f.value;d=f.get;return void 0===d?void 0:d.call(b)}},d=function(){function a(a,d){for(var b=0;b<d.length;b++){var f=d[b];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(d,b,f){b&&a(d.prototype,b);f&&a(d,f);return d}}(),f=function(a){function b(){q(this,b);var a=m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments));
a.ready=!1;a.layerChanged=new u.a;a.redrawNeeded=new u.a;a.readyStateChanged=new u.a;a.voxelSize=null;a.boundingBox=null;return a}r(b,a);d(b,[{key:"setReady",value:function(a){this.ready=a;this.readyStateChanged.dispatch();this.layerChanged.dispatch()}},{key:"handleAction",value:function(a){}},{key:"getValueAt",value:function(a){}},{key:"transformPickedValue",value:function(a,d){return a}},{key:"updateMouseState",value:function(a,d,b){}}]);return b}(n.a),v=function(a){function d(){q(this,d);var a=
m(this,(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments));a.visibility=new h.a;return a}r(d,a);return d}(f),y=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);d(b,[{key:"onShow",value:function(){}},{key:"onHide",value:function(){}}]);return b}(n.a),G=function(a){function b(a){a=void 0===a?[]:a;q(this,b);var d=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));d.layersChanged=new u.a;d.readyStateChanged=new u.a;
d.specificationChanged=new u.a;d.renderLayers=[];a.forEach(d.addRenderLayer.bind(d));return d}r(b,a);d(b,[{key:"addRenderLayer",value:function(a){this.renderLayers.push(a);var d=this.layersChanged,b=this.readyStateChanged;this.registerDisposer(a);this.registerDisposer(a.layerChanged.add(d.dispatch));this.registerDisposer(a.readyStateChanged.add(b.dispatch));b.dispatch();d.dispatch()}},{key:"getValueAt",value:function(a,d){var b=this.renderLayers,f=d.pickedRenderLayer;if(null!==f&&-1!==b.indexOf(f)){var g=
f.transformPickedValue(d.pickedValue,d.pickedOffset);return this.transformPickedValue(g)}d=$jscomp.makeIterator(b);for(b=d.next();!b.done&&(b=b.value,!b.ready||(g=b.getValueAt(a),void 0===g));b=d.next());return this.transformPickedValue(g)}},{key:"transformPickedValue",value:function(a){return a}},{key:"toJSON",value:function(){return null}},{key:"makeDropdown",value:function(a){}},{key:"handleAction",value:function(a){}}]);return b}(n.a),E=function(a){function b(a,d,f){d=void 0===d?null:d;f=void 0===
f?!0:f;q(this,b);var g=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));g.name=a;g.visible=f;g.readyStateChanged=new u.a;g.layerChanged=new u.a;g.specificationChanged=new u.a;g.wasDisposed=!1;g.layer_=null;g.layer=d;return g}r(b,a);d(b,[{key:"handleLayerChanged",value:function(){this.visible&&this.layerChanged.dispatch()}},{key:"setVisible",value:function(a){a!==this.visible&&(this.visible=a,this.layerChanged.dispatch())}},{key:"disposed",value:function(){this.wasDisposed=!0;this.layer=
null;g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"disposed",this).call(this)}},{key:"layer",get:function(){return this.layer_},set:function(a){var d=this,b=this.layer_;null!=b&&(this.unregisterUserLayer(),b.dispose());this.layer_=a;if(null!=a){var f=[a.layersChanged.add(function(){return d.handleLayerChanged()}),a.readyStateChanged.add(this.readyStateChanged.dispatch),a.specificationChanged.add(this.specificationChanged.dispatch)];this.unregisterUserLayer=function(){f.forEach(function(a){return a()})};
this.readyStateChanged.dispatch();this.handleLayerChanged()}}}]);return b}(n.a),B=function(b){function f(){q(this,f);var d=m(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));d.managedLayers=[];d.layersChanged=new u.a;d.readyStateChanged=new u.a;d.specificationChanged=new u.a;d.boundPositions=new WeakSet;d.numDirectUsers=0;d.scheduleRemoveLayersWithSingleRef=d.registerCancellable(a()(function(){return d.removeLayersWithSingleRef()},0));d.layersChanged.add(d.scheduleRemoveLayersWithSingleRef);
return d}r(f,b);d(f,[{key:"filter",value:function(a){var d=this,b=!1;this.managedLayers=this.managedLayers.filter(function(f){return a(f)?!0:(d.unbindManagedLayer(f),b=!0,!1)});b&&this.layersChanged.dispatch()}},{key:"removeLayersWithSingleRef",value:function(){0<this.numDirectUsers||this.filter(function(a){return 1!==a.refCount})}},{key:"updateSignalBindings",value:function(a,d){d(a.layerChanged,this.layersChanged.dispatch);d(a.readyStateChanged,this.readyStateChanged.dispatch);d(a.specificationChanged,
this.specificationChanged.dispatch)}},{key:"useDirectly",value:function(){var a=this;1===++this.numDirectUsers&&this.layersChanged.remove(this.scheduleRemoveLayersWithSingleRef);return function(){0===--a.numDirectUsers&&(a.layersChanged.add(a.scheduleRemoveLayersWithSingleRef),a.scheduleRemoveLayersWithSingleRef())}}},{key:"addManagedLayer",value:function(a,d){this.updateSignalBindings(a,p.a);void 0===d&&(d=this.managedLayers.length);this.managedLayers.splice(d,0,a);this.layersChanged.dispatch();
this.readyStateChanged.dispatch();return a}},{key:"addUserLayer",value:function(a,d,b){a=new E(a,d,b);return this.addManagedLayer(a)}},{key:"readyRenderLayers",value:function(){function a(a,x){for(;;)switch(d){case 0:v=$jscomp.makeIterator(k.managedLayers),h=v.next();case 1:if(h.done){d=3;break}c=h.value;if(c.visible&&c.layer){d=4;break}d=2;break;case 4:g=$jscomp.makeIterator(c.layer.renderLayers),f=g.next();case 5:if(f.done){d=7;break}b=f.value;if(b.ready){d=8;break}d=6;break;case 8:return d=9,{value:b,
done:!1};case 9:if(void 0===x){d=10;break}d=-1;throw x;case 10:case 6:f=g.next();d=5;break;case 7:case 2:h=v.next();d=1;break;case 3:d=-1;default:return{value:void 0,done:!0}}}var d=0,b,f,g,c,h,v,k=this,x={next:function(d){return a(d,void 0)},throw:function(d){return a(void 0,d)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();x[Symbol.iterator]=function(){return this};return x}},{key:"unbindManagedLayer",value:function(a){this.updateSignalBindings(a,p.b);a.dispose()}},
{key:"clear",value:function(){for(var a=$jscomp.makeIterator(this.managedLayers),d=a.next();!d.done;d=a.next())this.unbindManagedLayer(d.value);this.managedLayers.length=0;this.layersChanged.dispatch()}},{key:"remove",value:function(a){this.unbindManagedLayer(this.managedLayers[a]);this.managedLayers.splice(a,1);this.layersChanged.dispatch()}},{key:"removeManagedLayer",value:function(a){a=this.managedLayers.indexOf(a);if(-1===a)throw Error("Internal error: invalid managed layer.");this.remove(a)}},
{key:"reorderManagedLayer",value:function(a,d){var b=this.managedLayers.length;a===d||0>a||a>=b||0>d||d>=b||(a=$jscomp.makeIterator(this.managedLayers.splice(a,1)).next().value,this.managedLayers.splice(d,0,a),this.layersChanged.dispatch())}},{key:"disposed",value:function(){this.clear();g(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"disposed",this).call(this)}},{key:"getLayerByName",value:function(a){return this.managedLayers.find(function(d){return d.name===a})}},{key:"getUniqueLayerName",
value:function(a){for(var d=a,b=0;void 0!==this.getLayerByName(d);)d=a+ ++b;return d}},{key:"has",value:function(a){return-1!==this.managedLayers.indexOf(a)}},{key:"initializePosition",value:function(d){var b=this,f=this.boundPositions;f.has(d)||(f.add(d),f=a()(function(){b.updatePositionFromLayers(d)}),this.readyStateChanged.add(f),d.changed.add(f),this.updatePositionFromLayers(d))}},{key:"updatePositionFromLayers",value:function(a){if(!a.valid)for(var d=$jscomp.makeIterator(this.managedLayers),
b=d.next();!b.done;b=d.next())if(b=b.value.layer,null!=b){b=$jscomp.makeIterator(b.renderLayers);for(var f=b.next();!f.done;f=b.next())if(f=f.value,f.ready&&(a.voxelSize.valid||null==f.voxelSize||(w.p.copy(a.voxelSize.size,f.voxelSize),a.voxelSize.setValid()),!a.spatialCoordinatesValid&&!a.voxelCoordinatesValid&&null!=f.boundingBox)){f=f.boundingBox;var g=a.spatialCoordinates;w.p.add(g,f.lower,f.upper);w.p.scale(g,g,.5);a.spatialCoordinatesValid=!0;a.changed.dispatch()}}}},{key:"uniqueAction",value:function(a,
d,b){if(d){var f=Object(l.b)(d);b&&f&&f==this.editorLayer?f.handleEditorAction(a,b):d.handleAction(a);d=$jscomp.makeIterator(d.renderLayers);for(b=d.next();!b.done;b=d.next())b=b.value,b.ready&&b.handleAction(a)}}},{key:"invokeAction",value:function(a,d){for(var b=$jscomp.makeIterator(this.managedLayers),f=b.next();!f.done;f=b.next())f=f.value,null!==f.layer&&f.visible&&this.uniqueAction(a,f.layer,d)}},{key:"editorLayer",get:function(){var a=[].concat($jscomp.arrayFromIterable(this.managedLayers)).reverse().find(function(a){return a.visible&&
Object(l.a)(a.layer)});return Object(l.b)(a?a.layer:{})}},{key:"renderLayers",get:function(){var a=this;$jscomp.initSymbol();$jscomp.initSymbolIterator();var d={};return d[Symbol.iterator]=function(){function d(d,x){for(;;)switch(b){case 0:k=$jscomp.makeIterator(a.managedLayers),v=k.next();case 1:if(v.done){b=3;break}h=v.value;if(null!==h.layer){b=4;break}b=2;break;case 4:c=$jscomp.makeIterator(h.layer.renderLayers),g=c.next();case 5:if(g.done){b=7;break}f=g.value;b=8;return{value:f,done:!1};case 8:if(void 0===
x){b=9;break}b=-1;throw x;case 9:case 6:g=c.next();b=5;break;case 7:case 2:v=k.next();b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,f,g,c,h,v,k,x={next:function(a){return d(a,void 0)},throw:function(a){return d(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();x[Symbol.iterator]=function(){return this};return x},d}},{key:"visibleRenderLayers",get:function(){var a=this;$jscomp.initSymbol();$jscomp.initSymbolIterator();var d={};return d[Symbol.iterator]=
function(){function d(d,x){for(;;)switch(b){case 0:k=$jscomp.makeIterator(a.managedLayers),v=k.next();case 1:if(v.done){b=3;break}h=v.value;if(null!==h.layer&&h.visible){b=4;break}b=2;break;case 4:c=$jscomp.makeIterator(h.layer.renderLayers),g=c.next();case 5:if(g.done){b=7;break}f=g.value;b=8;return{value:f,done:!1};case 8:if(void 0===x){b=9;break}b=-1;throw x;case 9:case 6:g=c.next();b=5;break;case 7:case 2:v=k.next();b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,f,g,c,h,v,
k,x={next:function(a){return d(a,void 0)},throw:function(a){return d(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();x[Symbol.iterator]=function(){return this};return x},d}}]);return f}(n.a),z=function(){function a(){var d=this;q(this,a);this.changed=new u.a;this.position=w.p.create();this.active=!1;this.pickedRenderLayer=null;this.pickedValue=new k.a(0,0);this.pickedOffset=0;this.updater=void 0;this.stale=!1;this.triggerUpdate=b()(function(){d.update()},
50,{leading:!0,trailing:!0})}d(a,[{key:"updateUnconditionally",value:function(){this.triggerUpdate.cancel();this.update();return this.active}},{key:"updateIfStale",value:function(){this.stale&&this.update()}},{key:"update",value:function(){var a=this.updater;this.stale=!1;a?this.setActive(a(this)):this.setActive(!1)}},{key:"setActive",value:function(a){this.stale=!1;if(this.active!==a||!0===a)this.active=a,this.changed.dispatch()}}]);return a}(),D=function(a){function b(a,d){q(this,b);var f=m(this,
(b.__proto__||Object.getPrototypeOf(b)).call(this));f.layerManager=a;f.mouseState=d;f.values=new Map;f.changed=new u.a;f.needsUpdate=!0;f.registerDisposer(d.changed.add(function(){f.handleChange()}));f.registerDisposer(a.layersChanged.add(function(){f.handleLayerChange()}));return f}r(b,a);d(b,[{key:"handleLayerChange",value:function(){this.mouseState.active&&this.handleChange()}},{key:"handleChange",value:function(){this.needsUpdate=!0;this.changed.dispatch()}},{key:"update",value:function(){if(this.needsUpdate){this.needsUpdate=
!1;var a=this.values,d=this.mouseState;a.clear();if(d.active)for(var b=d.position,f=$jscomp.makeIterator(this.layerManager.managedLayers),g=f.next();!g.done;g=f.next()){g=g.value;var c=g.layer;g.visible&&c&&a.set(c,c.getValueAt(b,d))}}}},{key:"get",value:function(a){this.update();return this.values.get(a)}},{key:"toJSON",value:function(){this.update();for(var a={},d=this.values,b=$jscomp.makeIterator(this.layerManager.managedLayers),f=b.next();!f.done;f=b.next()){f=f.value;var g=f.layer;g&&(g=d.get(g),
void 0!==g&&(g instanceof k.a&&(g={t:"u64",v:g}),a[f.name]=g))}return a}}]);return b}(n.a),x=function(a){function f(a,d,g,c){q(this,f);var h=m(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));h.layerManager=a;h.renderLayerType=d;h.layerAdded=g;h.visibility=c;h.visibleLayers=new Map;h.newVisibleLayers=new Set;h.throttledUpdateVisibleLayers=b()(function(){h.updateVisibleLayers()},0);h.registerDisposer(a.layersChanged.add(function(){h.handleLayersChanged()}));h.updateVisibleLayers();return h}
r(f,a);d(f,[{key:"handleLayersChanged",value:function(){this.throttledUpdateVisibleLayers()}},{key:"disposed",value:function(){this.throttledUpdateVisibleLayers.cancel();this.visibleLayers.forEach(function(a){return a()});this.visibleLayers.clear();g(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"disposed",this).call(this)}},{key:"updateVisibleLayers",value:function(){for(var a=this.visibleLayers,d=this.newVisibleLayers,b=this.renderLayerType,f=this.layerAdded,g={},c=$jscomp.makeIterator(this.layerManager.readyRenderLayers()),
h=c.next();!h.done;g={disposer:g.disposer,visibilityDisposer:g.visibilityDisposer,typedLayer:g.typedLayer},h=c.next())h=h.value,h instanceof b&&(g.typedLayer=h,d.add(g.typedLayer),a.has(g.typedLayer)||(g.visibilityDisposer=g.typedLayer.visibility.add(this.visibility),g.disposer=f(g.typedLayer),a.set(g.typedLayer.addRef(),function(a){return function(){a.disposer();a.visibilityDisposer();a.typedLayer.dispose()}}(g))));b=$jscomp.makeIterator(a);for(f=b.next();!f.done;f=b.next())g=$jscomp.makeIterator(f.value),
f=g.next().value,g=g.next().value,d.has(f)||(a.delete(f),g());d.clear()}},{key:"getVisibleLayers",value:function(){this.throttledUpdateVisibleLayers.flush();return[].concat($jscomp.arrayFromIterable(this.visibleLayers.keys()))}}]);return f}(n.a)},function(n,e,c){var q=c(50),m=c(124),r=c(127),a=Math.max,b=Math.min;n.exports=function(c,e,u){function l(a){var d=f,b=v;f=v=void 0;B=a;return y=c.apply(b,d)}function k(a){var d=a-E;a-=B;return void 0===E||d>=e||0>d||D&&a>=C}function h(){var a=m();if(k(a))return g(a);
var d=setTimeout;var f=a-B;a=e-(a-E);f=D?b(a,C-f):a;w=d(h,f)}function g(a){w=void 0;if(x&&f)return l(a);f=v=void 0;return y}function d(){var a=m(),d=k(a);f=arguments;v=this;E=a;if(d){if(void 0===w)return B=a=E,w=setTimeout(h,e),z?l(a):y;if(D)return w=setTimeout(h,e),l(E)}void 0===w&&(w=setTimeout(h,e));return y}var f,v,y,w,E,B=0,z=!1,D=!1,x=!0;if("function"!=typeof c)throw new TypeError("Expected a function");e=r(e)||0;if(q(u)){z=!!u.leading;var C=(D="maxWait"in u)?a(r(u.maxWait)||0,e):C;x="trailing"in
u?!!u.trailing:x}d.cancel=function(){void 0!==w&&clearTimeout(w);B=0;f=E=v=w=void 0};d.flush=function(){return void 0===w?y:g(m())};return d}},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function m(a,b){if(!(a instanceof
b))throw new TypeError("Cannot call a class as a function");}c.d(e,"b",function(){return l});c.d(e,"c",function(){return w});e.d=function(a,c){return new Promise(function(k,h){if(a===b)c(k,h,b);else{var g=new l,d=a.add(function(){g.cancel()});c(function(a){d();k(a)},function(a){d();h(a)},g)}})};var r=function(){function a(a,b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,c,h){c&&
a(b.prototype,c);h&&a(b,h);return b}}();n=new (function(){function a(){m(this,a);this.name="CancellationError";this.message="CANCELED"}r(a,[{key:"toString",value:function(){return"CANCELED"}}]);return a}());e.a=n;var a=function(){},b={isCanceled:!1,add:function(){return a},remove:a};e.e=b;var l=function(){function b(){m(this,b)}r(b,[{key:"cancel",value:function(){var a=this.handlers;if(null!==a&&(this.handlers=null,void 0!==a)){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())b=b.value,
b()}}},{key:"add",value:function(b){var c=this,h=this.handlers;if(null===h)return b(),a;void 0===h&&(h=this.handlers=new Set);h.add(b);return function(){c.remove(b)}}},{key:"remove",value:function(a){var b=this.handlers;null!=b&&b.delete(a)}},{key:"isCanceled",get:function(){return null===this.handlers}}]);return b}(),w=function(a){function c(){m(this,c);var a=(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a.consumers=new Set;return a}q(c,a);r(c,[{key:"addConsumer",value:function(a){var c=this;a=void 0===a?b:a;var g=this.consumers;g.has(a)||a.isCanceled||(g.add(a),a.add(function(){g.delete(a);0===g.size&&c.cancel()}))}}]);return c}(l)},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,
enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function m(a,b){var d="";b&1&&(d+="control+");b&2&&(d+="alt+");b&4&&(d+="meta+");b&8&&(d+="shift+");return d+a}function r(a){return"string"===typeof a?{action:a}:a}function a(a){function b(b,g){for(;;)switch(d){case 0:h=a.indexOf(":");a:{b=void 0;var v=a.substring(h+1).split("+"),k=0;v=$jscomp.makeIterator(v);for(var x=v.next();!x.done;x=v.next())switch(x=x.value,x){case "control":k|=1;
break;case "alt":k|=2;break;case "meta":k|=4;break;case "shift":k|=8;break;default:if(void 0===b)b=x;else{c=void 0;break a}}c=void 0===b?void 0:m(b,k)}if(void 0!==c){d=1;break}d=-1;throw Error("Invalid event identifier: "+JSON.stringify(a));case 1:if(-1===h){d=2;break}f=a.substring(0,h);if("at"===f||"bubble"===f){d=4;break}d=-1;throw Error("Invalid event phase: "+JSON.stringify(f));case 4:return d=5,{value:f+":"+c,done:!1};case 5:if(void 0===g){d=6;break}d=-1;throw g;case 6:d=3;break;case 2:return d=
7,{value:"at:"+c,done:!1};case 7:if(void 0===g){d=8;break}d=-1;throw g;case 8:return d=9,{value:"bubble:"+c,done:!1};case 9:if(void 0===g){d=10;break}d=-1;throw g;case 10:case 3:d=-1;default:return{value:void 0,done:!0}}}var d=0,f,c,h,k={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();k[Symbol.iterator]=function(){return this};return k}c.d(e,"a",function(){return p});e.b=function(a,b,d){a=
k[b.eventPhase]+":"+m(a,(b.ctrlKey?1:0)|(b.altKey?2:0)|(b.metaKey?4:0)|(b.shiftKey?8:0));d=d.get(a);void 0!==d&&(!1!==d.stopPropagation&&b.stopPropagation(),a=new CustomEvent("action:"+d.action,{bubbles:!0,detail:b,cancelable:!0}),a=!b.target.dispatchEvent(a),(!1!==d.preventDefault||a)&&b.preventDefault())};e.c=function(a,g,d,f){return Object(b.c)(a,"action:"+g,d,f)};var b=c(0);n=c(141);var l=function(){function a(a,d){for(var b=0;b<d.length;b++){var g=d[b];g.enumerable=g.enumerable||!1;g.configurable=
!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,d,f){d&&a(b.prototype,d);f&&a(b,f);return b}}(),w=function g(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return g(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},u;(function(a){a[a.CONTROL=1]="CONTROL";a[a.ALT=2]="ALT";a[a.META=4]="META";a[a.SHIFT=8]="SHIFT"})(u||(u={}));var p=function(b){function d(){if(!(this instanceof
d))throw new TypeError("Cannot call a class as a function");var a=(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&"function"!==typeof a?this:a}q(d,b);l(d,[{key:"setFromObject",value:function(a){for(var d=$jscomp.makeIterator(Object.keys(a)),b=d.next();!b.done;b=d.next())b=b.value,this.set(b,r(a[b]))}},{key:"set",value:function(b,g){g=r(g);b=$jscomp.makeIterator(a(b));
for(var f=b.next();!f.done;f=b.next())f=f.value,w(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"set",this).call(this,f,g)}},{key:"delete",value:function(b){b=$jscomp.makeIterator(a(b));for(var f=b.next();!f.done;f=b.next())f=f.value,w(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"delete",this).call(this,f)}}],[{key:"fromObject",value:function(a,b){b=void 0===b?{}:b;var f=new d;f.label=b.label;if(void 0!==b.parents){b=$jscomp.makeIterator(b.parents);for(var g=b.next();!g.done;g=
b.next()){var c=$jscomp.makeIterator(g.value);g=c.next().value;c=c.next().value;f.addParent(g,c)}}b=$jscomp.makeIterator(Object.keys(a));for(g=b.next();!g.done;g=b.next())g=g.value,f.set(g,r(a[g]));return f}}]);return d}(n.a),k=[];k[Event.AT_TARGET]="at";k[Event.CAPTURING_PHASE]="capture";k[Event.BUBBLING_PHASE]="bubble"},function(n,e,c){c.d(e,"a",function(){return q});e.b=1E-6;var q="undefined"!==typeof Float32Array?Float32Array:Array;e.c=Math.random},function(n,e,c){c.d(e,"a",function(){return r});
var q=c(20),m=function(){function a(a,c){for(var b=0;b<c.length;b++){var e=c[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),r=function(){function a(b,c){c=void 0===c?q.a:c;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.gl=b;this.bufferType=c;this.gl=b;this.buffer=b.createBuffer()}m(a,[{key:"bind",value:function(){this.gl.bindBuffer(this.bufferType,
this.buffer)}},{key:"bindToVertexAttrib",value:function(a,c,e,u,p,k){e=void 0===e?q.c:e;u=void 0===u?!1:u;p=void 0===p?0:p;k=void 0===k?0:k;this.bind();this.gl.enableVertexAttribArray(a);this.gl.vertexAttribPointer(a,c,e,u,p,k)}},{key:"setData",value:function(a,c){c=void 0===c?q.k:c;var b=this.gl;this.bind();b.bufferData(this.bufferType,a,c)}},{key:"dispose",value:function(){this.gl.deleteBuffer(this.buffer);this.gl=this.buffer=void 0}}],[{key:"fromData",value:function(b,c,e,u){b=new a(b,e);b.setData(c,
u);return b}}]);return a}()},function(n,e,c){function q(a,d){if(!(a instanceof d))throw new TypeError("Cannot call a class as a function");}function m(a,d){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!d||"object"!==typeof d&&"function"!==typeof d?a:d}function r(a,d){if("function"!==typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+typeof d);a.prototype=Object.create(d&&d.prototype,{constructor:{value:a,
enumerable:!1,writable:!0,configurable:!0}});d&&(Object.setPrototypeOf?Object.setPrototypeOf(a,d):a.__proto__=d)}function a(a,d){for(var b=$jscomp.makeIterator(p),g=b.next();!g.done;g=b.next())if(g=g.value,g=g(a,d),null!=g)return g;throw Error("No chunk format handler found.");}e.c=function(a){p.push(a)};c.d(e,"b",function(){return k});c.d(e,"a",function(){return h});n=c(35);var b=c(1),l=function(){function a(a,b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=
!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(d,b,g){b&&a(d.prototype,b);g&&a(d,g);return d}}(),w=b.p.create(),u=b.p.create(),p=[],k=function(g){function d(b,g){q(this,d);g=m(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,g));g.chunkFormatHandler=g.registerDisposer(a(b.chunkQueueManager.gl,g.spec));return g}r(d,g);l(d,[{key:"getValueAt",value:function(a){var d=this.spec,f=d.chunkLayout,g=f.size;f.globalToLocalSpatial(u,a);for(a=0;3>a;++a)w[a]=Math.floor(u[a]/
g[a]);a=Object(b.q)(w);a=this.chunks.get(a);if(!a)return null;f=d.voxelSize;for(var c=0;3>c;++c)w[c]=Math.floor((u[c]-w[c]*g[c])/f[c]);g=a.chunkDataSize;for(f=0;3>f;++f)if(w[f]>=g[f])return;d=d.numChannels;if(1===d)return a.getChannelValueAt(w,0);g=Array(d);for(f=0;f<d;++f)g[f]=a.getChannelValueAt(w,f);return g}},{key:"getChunk",value:function(a){return this.chunkFormatHandler.getChunk(this,a)}},{key:"chunkFormat",get:function(){return this.chunkFormatHandler.chunkFormat}}]);return d}(n.c),h=function(a){function d(a,
b){q(this,d);return m(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,a,b))}r(d,a);l(d,[{key:"chunkFormat",get:function(){return this.source.chunkFormat}}]);return d}(n.b)},function(n,e,c){e.a=function(c){if(c instanceof Object){var a=c[q];void 0===a&&(a=c[q]=m++);return"o"+a}return""+JSON.stringify(c)};$jscomp.initSymbol();var q=Symbol("objectId"),m=0},function(n,e,c){e.a=34962;e.k=35044;e.r=3317;e.t=5121;e.c=5126;e.i=6407;e.j=6408;e.f=6409;e.g=6410;e.d=35632;e.u=35633;e.h=9728;e.e=9729;e.n=
10240;e.o=10241;e.p=10242;e.q=10243;e.m=3553;e.l=33984;e.b=33071;e.s=37440},function(n,e){},function(n,e,c){e.b=function(c,a){m.set(c,a)};e.a=function(c){for(var a=new q.b,b=$jscomp.makeIterator(m),e=b.next();!e.done;e=b.next()){var w=$jscomp.makeIterator(e.value);e=w.next().value;w=w.next().value;a.register(e,w(c))}return a};var q=c(24),m=new Map},function(n,e,c){c.d(e,"d",function(){return q});var q;(function(c){c[c.GPU_MEMORY=0]="GPU_MEMORY";c[c.SYSTEM_MEMORY=1]="SYSTEM_MEMORY";c[c.SYSTEM_MEMORY_WORKER=
2]="SYSTEM_MEMORY_WORKER";c[c.DOWNLOADING=3]="DOWNLOADING";c[c.QUEUED=4]="QUEUED";c[c.NEW=5]="NEW";c[c.FAILED=6]="FAILED";c[c.EXPIRED=7]="EXPIRED"})(q||(q={}));var m;(function(c){c[c.FIRST_TIER=0]="FIRST_TIER";c[c.FIRST_ORDERED_TIER=0]="FIRST_ORDERED_TIER";c[c.VISIBLE=0]="VISIBLE";c[c.PREFETCH=1]="PREFETCH";c[c.LAST_ORDERED_TIER=1]="LAST_ORDERED_TIER";c[c.RECENT=2]="RECENT";c[c.LAST_TIER=2]="LAST_TIER"})(m||(m={}));e.b="ChunkQueueManager";e.a="ChunkManager";e.c="ChunkSource.invalidate"},function(n,
e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});
b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){void 0===b&&(b=-1===a.indexOf("/")?":":"/");a=a.lastIndexOf(b);return-1===a?0:a+1}c.d(e,"a",function(){return u});c.d(e,"b",function(){return k});var b=c(14),l=c(30);n=c(0);var w=function(){function a(a,d){for(var b=0;b<d.length;b++){var g=d[b];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,d,f){d&&a(b.prototype,d);f&&a(b,f);return b}}(),
u=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);return b}(n.a),p=/^(?:([a-zA-Z-+_]+):\/\/)?(.*)$/,k=function(c){function g(){q(this,g);var a=m(this,(g.__proto__||Object.getPrototypeOf(g)).apply(this,arguments));a.dataSources=new Map;return a}r(g,c);w(g,[{key:"register",value:function(a,b){this.dataSources.set(a,this.registerDisposer(b))}},{key:"getDataSource",value:function(a){a=a.match(p);if(null===a||void 0===a[1])throw Error('Data source URL must have the form "<protocol>://<path>".');
var d=a[1],b=this.dataSources.get(d);if(void 0===b)throw Error("Unsupported data source: "+JSON.stringify(d)+".");return[b,a[2],d]}},{key:"getVolume",value:function(a,f,g,c){g=void 0===g?{}:g;c=void 0===c?b.e:c;f=$jscomp.makeIterator(this.getDataSource(f));var d=f.next().value,h=f.next().value;return new Promise(function(b){b(d.getVolume(a,h,g,c))})}},{key:"getVectorGraphicsSource",value:function(a,f,g,c){g=void 0===g?{}:g;c=void 0===c?b.e:c;f=$jscomp.makeIterator(this.getDataSource(f));var d=f.next().value,
h=f.next().value;return new Promise(function(b){b(d.getVectorGraphicsSource(a,h,g,c))})}},{key:"getMeshSource",value:function(a,f,g){g=void 0===g?b.e:g;f=$jscomp.makeIterator(this.getDataSource(f));var d=f.next().value,c=f.next().value;return new Promise(function(b){b(d.getMeshSource(a,c,g))})}},{key:"getSkeletonSource",value:function(a,f,g){g=void 0===g?b.e:g;f=$jscomp.makeIterator(this.getDataSource(f));var d=f.next().value,c=f.next().value;return new Promise(function(b){b(d.getSkeletonSource(a,
c,g))})}},{key:"volumeCompleter",value:function(a,f,g){g=void 0===g?b.e:g;var d=a.match(p),c=d[1];if(void 0===c){f=[];g=$jscomp.makeIterator(this.dataSources);for(d=g.next();!d.done;d=g.next()){var h=$jscomp.makeIterator(d.value);d=h.next().value;h=h.next().value;d+="://";d.startsWith(a)&&f.push({value:d,description:h.description})}return Promise.resolve({offset:0,completions:f})}a=this.dataSources.get(c);return void 0!==a&&void 0!==a.volumeCompleter?a.volumeCompleter(d[2],f,g).then(function(a){return Object(l.a)(c.length+
3,a)}):Promise.reject(null)}},{key:"suggestLayerName",value:function(d){d=$jscomp.makeIterator(this.getDataSource(d));var b=d.next().value;d=d.next().value;b=b.suggestLayerName;if(void 0!==b)return b(d);b=a(d,void 0);return d.substring(b)}},{key:"findSourceGroup",value:function(d){var b=$jscomp.makeIterator(this.getDataSource(d));d=b.next().value;var g=b.next().value;b=b.next().value;return(d.findSourceGroup||a)(g)+b.length+3}}]);return g}(n.a)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b,g){var d=
a.createShader(g);a.shaderSource(d,b);a.compileShader(d);if(!a.getShaderParameter(d,a.COMPILE_STATUS)){a=a.getShaderInfoLog(d)||"";var f=a.replace("\x00","");d=[];f=$jscomp.makeIterator(f.split("\n"));for(var c=f.next();!c.done;c=f.next()){c=c.value;var h=c.match(/^ERROR:\s*(\d+):(\d+)\s*(.+)$/);null!==h?d.push({message:h[3].trim(),file:parseInt(h[1],10),line:parseInt(h[2],10)}):(h=c.match(/^ERROR:\s*(.+)$/),null!==h?d.push({message:h[1]}):(c=c.trim())&&d.push({message:c}))}throw new u(g,b,a,d);}return d}
c.d(e,"a",function(){return g});n=c(0);var b=c(20),l=function(){function a(a,b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,d,g){d&&a(b.prototype,d);g&&a(b,g);return b}}(),w;(function(a){a[a.VERTEX=b.u]="VERTEX";a[a.FRAGMENT=b.d]="FRAGMENT"})(w||(w={}));var u=function(a){function b(a,d,f,g){q(this,b);var c="Error compiling "+w[a].toLowerCase()+" shader: "+f,h=m(this,(b.__proto__||
Object.getPrototypeOf(b)).call(this,c));h.name="ShaderCompilationError";h.log=f;h.message=c;h.shaderType=a;h.source=d;h.errorMessages=g;return h}r(b,a);return b}(Error),p=function(a){function b(a,d,f){q(this,b);var g="Error linking shader: "+f,c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,g));c.name="ShaderLinkError";c.log=f;c.message=g;c.vertexSource=a;c.fragmentSource=d;return c}r(b,a);return b}(Error),k=function(b){function d(b,f,g,c,h){q(this,d);var k=m(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));
k.gl=b;k.vertexSource=f;k.fragmentSource=g;k.attributes=new Map;k.uniforms=new Map;var v=k.vertexShader=a(b,f,b.VERTEX_SHADER),x=k.fragmentShader=a(b,g,b.FRAGMENT_SHADER),C=b.createProgram();b.attachShader(C,v);b.attachShader(C,x);b.linkProgram(C);if(!b.getProgramParameter(C,b.LINK_STATUS))throw b=b.getProgramInfoLog(C)||"",new p(f,g,b);k.program=C;g=k.uniforms;f=k.attributes;if(c)for(c=$jscomp.makeIterator(c),v=c.next();!v.done;v=c.next())v=v.value,g.set(v,b.getUniformLocation(C,v));if(h)for(h=$jscomp.makeIterator(h),
v=h.next();!v.done;v=h.next())c=v.value,f.set(c,b.getAttribLocation(C,c));return k}r(d,b);l(d,[{key:"uniform",value:function(a){return this.uniforms.get(a)}},{key:"attribute",value:function(a){return this.attributes.get(a)}},{key:"textureUnit",value:function(a){return this.textureUnits.get(a)}},{key:"bind",value:function(){this.gl.useProgram(this.program)}},{key:"disposed",value:function(){var a=this.gl;a.deleteShader(this.vertexShader);this.vertexShader=void 0;a.deleteShader(this.fragmentShader);
this.fragmentShader=void 0;a.deleteProgram(this.program);this.uniforms=this.attributes=this.gl=this.program=void 0}}]);return d}(n.a),h=function(){function a(){q(this,a);this.code="";this.parts=new Set}l(a,[{key:"add",value:function(a){if(!this.parts.has(a))switch(this.parts.add(a),typeof a){case "string":this.code+=a;break;case "function":this.add(a());break;default:if(Array.isArray(a)){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())this.add(b.value)}else throw Error("Invalid code type");
}}},{key:"toString",value:function(){return this.code}}]);return a}(),g=function(){function a(b){q(this,a);this.gl=b;this.nextTextureUnit=this.nextSymbolID=0;this.varyingsCode=this.attributesCode=this.uniformsCode="";this.fragmentExtensionsSet=new Set;this.fragmentExtensions="";this.vertexCode=new h;this.vertexMain="";this.fragmentCode=new h;this.fragmentMain="";this.required=new Set;this.uniforms=[];this.attributes=[];this.initializers=[];this.textureUnits=new Map}l(a,[{key:"allocateTextureUnit",
value:function(a,b){b=void 0===b?1:b;if(this.textureUnits.has(a))throw Error("Duplicate texture unit symbol: "+a);var d=this.nextTextureUnit;this.nextTextureUnit+=b;this.textureUnits.set(a,d);return d}},{key:"addTextureSampler2D",value:function(a,b,d){var f=this.allocateTextureUnit(b,d);this.addUniform("highp sampler2D",a,d);this.addInitializer(function(b){if(d){for(var g=new Int32Array(d),c=0;c<d;++c)g[c]=c+f;b.gl.uniform1iv(b.uniform(a),g)}else b.gl.uniform1i(b.uniform(a),f)});return f}},{key:"symbol",
value:function(a){return a+this.nextSymbolID++}},{key:"addAttribute",value:function(a,b){this.attributes.push(b);this.attributesCode+="attribute "+a+" "+b+";\n";return b}},{key:"addVarying",value:function(a,b){this.varyingsCode+="varying "+a+" "+b+";\n"}},{key:"addUniform",value:function(a,b,d){this.uniforms.push(b);this.uniformsCode=null!=d?this.uniformsCode+("uniform "+a+" "+b+"["+d+"];\n"):this.uniformsCode+("uniform "+a+" "+b+";\n");return b}},{key:"addFragmentExtension",value:function(a){this.fragmentExtensionsSet.has(a)||
(this.fragmentExtensionsSet.add(a),this.fragmentExtensions+="#extension "+a+" : require\n")}},{key:"addVertexCode",value:function(a){this.vertexCode.add(a)}},{key:"addFragmentCode",value:function(a){this.fragmentCode.add(a)}},{key:"setVertexMain",value:function(a){this.vertexMain=a}},{key:"addVertexMain",value:function(a){this.vertexMain=(this.vertexMain||"")+a}},{key:"setFragmentMain",value:function(a){this.fragmentMain="void main() {\n"+a+"\n}\n"}},{key:"setFragmentMainFunction",value:function(a){this.fragmentMain=
a}},{key:"addInitializer",value:function(a){this.initializers.push(a)}},{key:"require",value:function(a){this.required.has(a)||(this.required.add(a),a(this))}},{key:"build",value:function(){var a=new k(this.gl,"\nprecision highp float;\n"+this.uniformsCode+"\n"+this.attributesCode+"\n"+this.varyingsCode+"\n"+this.vertexCode+"\nvoid main() {\n"+this.vertexMain+"\n}\n","\n"+this.fragmentExtensions+"\nprecision highp float;\n"+this.uniformsCode+"\n"+this.varyingsCode+"\n"+this.fragmentCode+"\n"+this.fragmentMain+
"\n",this.uniforms,this.attributes);a.textureUnits=this.textureUnits;var b=this.initializers;if(0<b.length){a.bind();b=$jscomp.makeIterator(b);for(var d=b.next();!d.done;d=b.next())d=d.value,d(a)}return a}}]);return a}()},function(n,e,c){c.d(e,"a",function(){return a});var q=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,
e);return b}}();c(146);var m=null,r=new Map,a=function(){function a(b){b=void 0===b?!1:b;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");if(null===m){m=document.createElement("div");m.id="statusContainer";var c=document.createElement("button");c.addEventListener("click",a.disposeAll);c.textContent="Dismiss All";m.appendChild(c);document.body.appendChild(m)}this.element=c=document.createElement("div");!0===b&&(b=200);!1!==b?(this.setVisible(!1),this.timer=setTimeout(this.setVisible.bind(this,
!0),b)):this.timer=null;r.set(this,this);m.appendChild(c)}q(a,[{key:"dispose",value:function(){m.removeChild(this.element);this.element=void 0;null!==this.timer&&clearTimeout(this.timer);r.delete(this)}},{key:"setText",value:function(a,b){this.element.textContent=a;b&&this.setVisible(!0)}},{key:"setHTML",value:function(a,b){this.element.innerHTML=a;b&&this.setVisible(!0)}},{key:"setVisible",value:function(a){null!==this.timer&&(clearTimeout(this.timer),this.timer=null);this.element.style.display=
a?"block":"none"}},{key:"makeDismissButton",value:function(){var a=this,b=document.createElement("button");b.textContent="Dismiss";b.addEventListener("click",function(){a.dispose()});this.element.appendChild(b)}}],[{key:"disposeAll",value:function(){r.forEach(function(a){a.dispose()})}},{key:"forPromise",value:function(b,c){var e=new a(c.delay);e.setText(c.initialMessage);var l=e.dispose.bind(e);b.then(l,function(a){e.element.textContent=(void 0===c.errorPrefix?"":c.errorPrefix)+(a instanceof Error?
a.message:""+a)+"  ";e.makeDismissButton();e.setVisible(!0)});return b}},{key:"showMessage",value:function(b){var c=new a;c.element.textContent=b;c.makeDismissButton();c.setVisible(!0);return c}},{key:"showTemporaryMessage",value:function(a,b){b=void 0===b?2E3:b;var c=this.showMessage(a);setTimeout(function(){return c.dispose()},b);return c}}]);return a}()},function(n,e,c){c.d(e,"b",function(){return q});var q;(function(c){c[c.UINT8=0]="UINT8";c[c.UINT16=1]="UINT16";c[c.UINT32=2]="UINT32";c[c.UINT64=
3]="UINT64";c[c.FLOAT32=4]="FLOAT32"})(q||(q={}));n=[];e.a=n;n[q.UINT8]=1;n[q.UINT16]=2;n[q.UINT32]=4;n[q.UINT64]=8;n[q.FLOAT32]=4},function(n,e,c){e.b=function(){return new q.b(void 0)};e.a=function(c){return new q.a(c,m.B)};var q=c(4),m=c(2)},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"b",function(){return w});c.d(e,"a",function(){return p});var r=c(38);n=c(0);var a=c(34),b=function(){function a(a,b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,g,d){g&&a(b.prototype,g);
d&&a(b,d);return b}}(),l=function h(a,b,f){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return h(a,b,f)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(f)}};c(165);var w=0,u=a.a.fromObject({escape:{action:"close"}}),p=function(c){function g(){if(!(this instanceof g))throw new TypeError("Cannot call a class as a function");var b=q(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));
b.keyMap=new a.a;b.keyMap.addParent(u,Number.NEGATIVE_INFINITY);++w;var f=b.container=document.createElement("div");f.className="overlay";var c=b.content=document.createElement("div");b.registerDisposer(new r.a(c));c.className="overlay-content";f.appendChild(c);document.body.appendChild(f);b.registerDisposer(new a.b(b.container,b.keyMap));b.registerEventListener(f,"action:close",function(){b.dispose()});c.focus();return b}m(g,c);b(g,[{key:"disposed",value:function(){--w;document.body.removeChild(this.container);
l(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"disposed",this).call(this)}}]);return g}(n.a)},function(n,e,c){e.a=function(c,e){e.offset+=c;return e};e.b=function(c,e){var m=[];e=$jscomp.makeIterator(e);for(var a=e.next();!a.done;a=e.next())a=a.value,a.startsWith(c)&&m.push({value:a});return m};e.c=function(c,e,r,a){var b=[];e=$jscomp.makeIterator(e);for(var l=e.next();!l.done;l=e.next()){l=l.value;var w=r(l);w.startsWith(c)&&b.push({value:w,description:a(l)})}return b}},function(n,
e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return w});e.b=function(a,c,k){k=void 0===k?"GET":k;var h=new XMLHttpRequest;if(Array.isArray(a)){var g=a.length;g=1===g?0:Math.abs(Object(r.a)(c))%g;a=a[g]+c}else a+=
c;h[l]=k;h[b]=a;h.open(k,a);return h};e.d=function(a,b,c){c=void 0===c?m.e:c;a.responseType=b;return new Promise(function(b,g){var d=function(){a.abort()};c.add(d);a.onloadend=function(){var f=this.status;c.remove(d);200<=f&&300>f?b(this.response):g(w.fromXhr(a))};a.send()})};e.c=function(a){var b=a.match(/^([^:\/]+):\/\/([^\/]+)(\/.*)?$/);if(null===b)throw Error("Invalid URL: "+JSON.stringify(a));return"gs"===b[1]?[["https://storage.googleapis.com/"+b[2]],b[3]]:[[a],""]};var m=c(14),r=c(121),a=function(){function a(a,
b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,c,h){c&&a(b.prototype,c);h&&a(b,h);return b}}();$jscomp.initSymbol();var b=Symbol("url");$jscomp.initSymbol();var l=Symbol("method"),w=function(c){function e(a,b,g,d){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var f=a+" "+JSON.stringify(b)+" resulted in HTTP error "+g;d&&(f+=": "+d);f+=".";var c=
(e.__proto__||Object.getPrototypeOf(e)).call(this,f);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c.name="HttpError";c.message=f;c.method=a;c.url=b;c.code=g;c.statusMessage=d;return c}q(e,c);a(e,null,[{key:"fromXhr",value:function(a){return new e(a[l],a[b],a.status,a.statusText)}}]);return e}(Error)},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return r});n=c(12);var m=function(){function a(a,c){for(var b=0;b<c.length;b++){var e=c[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),r=function(a){function b(){if(!(this instanceof
b))throw new TypeError("Cannot call a class as a function");var a=(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&"function"!==typeof a?this:a}q(b,a);m(b,[{key:"draw",value:function(a){}},{key:"isTransparent",get:function(){return!1}}]);return b}(n.h)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"b",function(){return w});
c.d(e,"a",function(){return u});e.c=function(c){return function(c){function h(){q(this,h);var a=m(this,(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments));a.visibility=new u;return a}r(h,c);l(h,[{key:"initializeCounterpart",value:function(g,d){d=void 0===d?{}:d;d.visibility=this.registerDisposer(a.a.makeFromExisting(g,this.visibility)).rpcId;b(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"initializeCounterpart",this).call(this,g,d)}}]);return h}(c)};var a=c(46);n=c(4);var b=
function k(a,b,d){null===a&&(a=Function.prototype);var f=Object.getOwnPropertyDescriptor(a,b);if(void 0===f){if(a=Object.getPrototypeOf(a),null!==a)return k(a,b,d)}else{if("value"in f)return f.value;b=f.get;return void 0===b?void 0:b.call(d)}},l=function(){function a(a,b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),w=function(a){function b(a){a=
void 0===a?Number.NEGATIVE_INFINITY:a;q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}r(b,a);l(b,[{key:"visible",get:function(){return this.value===Number.POSITIVE_INFINITY}},{key:"ignored",get:function(){return this.value===Number.NEGATIVE_INFINITY}}]);return b}(n.b);w.VISIBLE=Number.POSITIVE_INFINITY;w.IGNORED=Number.NEGATIVE_INFINITY;var u=function(a){function b(){q(this,b);var a=m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments));a.contributors=
new Map;return a}r(b,a);l(b,[{key:"add",value:function(a){var b=this,f=this.contributors,c=a.changed.add(function(){b.update()}),g=function(){f.delete(g);c();b.update()};f.set(g,a);this.update();return g}},{key:"update",value:function(){for(var a=Number.NEGATIVE_INFINITY,b=$jscomp.makeIterator(this.contributors.values()),f=b.next();!f.done;f=b.next())a=Math.max(a,f.value.value);this.value=a}}]);return b}(w)},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"b",function(){return l});n=c(0);var m=c(15);c.d(e,"a",function(){return m.a});c.d(e,"c",function(){return m.c});var r=function(){function a(a,b){for(var c=0;c<b.length;c++){var h=b[c];h.enumerable=h.enumerable||!1;h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(a,h.key,h)}}return function(b,
c,k){c&&a(b.prototype,c);k&&a(b,k);return b}}(),a=new Set("f1 f2 f3 f4 f5 f6 f7 f8 f9 f10 f11 f12 escape pause".split(" ")),b=new Set("color date datetime datetime-local email month number password search tel text time url week".split(" ")),l=function(c){function e(a,b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var c=(e.__proto__||Object.getPrototypeOf(e)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c.target=a;c.eventMap=b;c.modifierShortcutsAreGlobal=!0;c.allShortcutsAreGlobal=!1;c.allowSpaceKeyOnButtons=!1;c.registerEventListener(a,"keydown",c.handleKeyDown.bind(c),!1);return c}q(e,c);r(e,[{key:"shouldIgnoreEvent",value:function(c,k){var h=k.target,g=h.tagName;if(h===this.target)return!1;var d="TEXTAREA"===g||"INPUT"===g||"BUTTON"===g||"SELECT"===g,f=!d&&(h.isContentEditable||h.ownerDocument&&"on"===h.ownerDocument.designMode);return!d&&
!f||this.allShortcutsAreGlobal||a.has(c)?!1:f||this.modifierShortcutsAreGlobal&&(k.altKey||k.ctrlKey||k.metaKey)?!0:"INPUT"===g&&b.has(h.type)?"enter"!==c:"INPUT"===g||"BUTTON"===g?this.allowSpaceKeyOnButtons?!1:"space"===c:!0}},{key:"handleKeyDown",value:function(a){var b=a.code.toLowerCase();this.shouldIgnoreEvent(b,a)||Object(m.b)(b,a,this.eventMap)}}]);return e}(n.a)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return B});c.d(e,"c",function(){return z});c.d(e,"b",function(){return D});c.d(e,"d",function(){return x});
n=c(13);var a=c.n(n),b=c(23);n=c(10);e=c(39);var l=c(52),w=c(0),u=c(1),p=c(19),k=c(3),h=c(33),g=c(53),d=c(25),f=c(54);c=c(6);var v=function(){function a(a,b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,d,f){d&&a(b.prototype,d);f&&a(b,f);return b}}(),y=function H(a,b,d){null===a&&(a=Function.prototype);var f=Object.getOwnPropertyDescriptor(a,b);if(void 0===f){if(a=Object.getPrototypeOf(a),
null!==a)return H(a,b,d)}else{if("value"in f)return f.value;b=f.get;return void 0===b?void 0:b.call(d)}},G=this&&this.__decorate||function(a,b,d,f){var c=arguments.length,g=3>c?b:null===f?f=Object.getOwnPropertyDescriptor(b,d):f,h;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)g=Reflect.decorate(a,b,d,f);else for(var k=a.length-1;0<=k;k--)if(h=a[k])g=(3>c?h(g):3<c?h(b,d,g):h(b,d))||g;return 3<c&&g&&Object.defineProperty(b,d,g),g},E=u.j.create(),B=function(b){function d(b,f,c){q(this,
d);var h=m(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));h.chunkManager=b;h.layerManager=f;h.navigationState=c;h.gl=h.chunkManager.gl;h.dataToViewport=u.j.create();h.viewportToDevice=u.j.create();h.dataToDevice=u.j.create();h.visibleChunks=new Map;h.viewChanged=new k.a;h.renderingStale=!0;h.visibleChunksStale=!0;h.visibleLayerList=[];h.newVisibleLayers=new Set;h.offscreenFramebuffer=h.registerDisposer(new g.b(h.gl,{colorBuffers:Object(g.e)(h.gl,1),depthBuffer:new g.d(h.gl)}));h.updateVisibleLayers=
h.registerCancellable(a()(function(){h.updateVisibleLayersNow()},0));u.j.identity(h.dataToViewport);h.initializeCounterpart(h.chunkManager.rpc,{chunkManager:b.rpcId});h.registerDisposer(c.changed.add(function(){h.updateViewportFromNavigationState()}));h.updateViewportFromNavigationState();h.registerDisposer(f.layersChanged.add(function(){h.hasValidViewport&&h.updateVisibleLayers()}));h.viewChanged.add(function(){h.renderingStale=!0});h.registerDisposer(b.chunkQueueManager.visibleChunksChanged.add(h.viewChanged.dispatch));
h.updateViewportFromNavigationState();h.updateVisibleLayers();return h}r(d,b);v(d,[{key:"updateViewportFromNavigationState",value:function(){var a=this.navigationState;a.valid&&(a.toMat4(E),this.setViewportToDataMatrix(E))}},{key:"updateVisibleLayersNow",value:function(){if(this.wasDisposed||!this.hasValidViewport)return!1;var a=this.visibleLayers,b=this.rpc,d={id:this.rpcId},f=this.newVisibleLayers,c=!1,g=this.visibleLayerList;g.length=0;for(var h=$jscomp.makeIterator(this.layerManager.readyRenderLayers()),
k=h.next();!k.done;k=h.next())k=k.value,k instanceof l.a&&(f.add(k),g.push(k),a.has(k)||(a.set(k.addRef(),[]),k.redrawNeeded.add(this.viewChanged.dispatch),d.layerId=k.rpcId,b.invoke("SliceView.addVisibleLayer",d),c=!0));g=$jscomp.makeIterator(a.keys());for(k=g.next();!k.done;k=g.next())h=k.value,f.has(h)||(a.delete(h),h.redrawNeeded.remove(this.viewChanged.dispatch),d.layerId=h.rpcId,b.invoke("SliceView.removeVisibleLayer",d),h.dispose(),c=!0);f.clear();c&&(this.visibleSourcesStale=!0);this.viewChanged.dispatch();
return c}},{key:"onViewportChanged",value:function(){var a=this.width,b=this.height,d=this.viewportToDevice,f=this.dataToViewport,c=this.dataToDevice;u.j.ortho(d,-a/2,a/2,b/2,-b/2,-10,10);u.j.multiply(c,d,f);this.visibleChunksStale=!0;this.viewChanged.dispatch()}},{key:"setViewportSize",value:function(a,b){return y(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"setViewportSize",this).call(this,a,b)?(this.rpc.invoke("SliceView.updateView",{id:this.rpcId,width:a,height:b}),!0):!1}},{key:"onViewportToDataMatrixChanged",
value:function(){var a=this.viewportToData,b=this.dataToViewport;u.j.invert(b,a);Object(u.m)(b);this.rpc.invoke("SliceView.updateView",{id:this.rpcId,viewportToData:a})}},{key:"onHasValidViewport",value:function(){this.updateVisibleLayers()}},{key:"updateRendering",value:function(){if(this.renderingStale&&this.hasValidViewport&&0!==this.width&&0!==this.height){this.renderingStale=!1;this.maybeUpdateVisibleChunks();var a=this.gl,b=this.offscreenFramebuffer;b.bind(this.width,this.height);a.disable(a.SCISSOR_TEST);
a.clearStencil(0);a.clearColor(0,0,0,0);a.colorMask(!0,!0,!0,!0);a.clear(a.COLOR_BUFFER_BIT);a.enable(a.STENCIL_TEST);a.disable(a.DEPTH_TEST);a.stencilOpSeparate(a.FRONT_AND_BACK,a.KEEP,a.KEEP,a.REPLACE);for(var d=0,f=$jscomp.makeIterator(this.visibleLayerList),c=f.next();!c.done;c=f.next())c=c.value,a.clear(a.STENCIL_BUFFER_BIT),a.stencilFuncSeparate(a.FRONT_AND_BACK,a.GREATER,1,1),c.setGLBlendMode(a,d),c.draw(this),++d;a.disable(a.BLEND);a.disable(a.STENCIL_TEST);b.unbind()}}},{key:"maybeUpdateVisibleChunks",
value:function(){this.updateVisibleLayers.flush();if(!this.visibleChunksStale&&!this.visibleSourcesStale)return!1;this.visibleChunksStale=!1;this.updateVisibleChunks();return!0}},{key:"updateVisibleChunks",value:function(){var a=this.visibleChunks;this.computeVisibleChunks(function(b){var d=a.get(b);void 0===d?(d=[],a.set(b,d)):d.length=0;return d},function(a,b,d){a=Object(u.q)(d);b[b.length]=a})}},{key:"disposed",value:function(){for(var a=$jscomp.makeIterator(this.visibleLayers.keys()),b=a.next();!b.done;b=
a.next())b.value.dispose();this.visibleLayers.clear();this.visibleLayerList.length=0}}]);return d}(Object(h.c)(e.b));B=G([Object(c.g)(e.a)],B);var z=function(a){function b(a,d){q(this,b);a=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,d));a.spec=d.spec;return a}r(b,a);v(b,[{key:"initializeCounterpart",value:function(a,d){d.spec=this.spec.toObject();y(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"initializeCounterpart",this).call(this,a,d)}}],[{key:"encodeOptions",value:function(a){var d=
y(b.__proto__||Object.getPrototypeOf(b),"encodeOptions",this).call(this,a);d.spec=a.spec.toObject();return d}}]);return b}(n.e),D=function(a){function d(a,f){q(this,d);var c=m(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,a));c.chunkGridPosition=f.chunkGridPosition;c.chunkDataSize=f.chunkDataSize||a.spec.chunkDataSize;c.state=b.d.SYSTEM_MEMORY;return c}r(d,a);return d}(n.b),x=function(a){function b(a,c){q(this,b);var g=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));g.gl=a;g.copyVertexPositionsBuffer=
Object(f.a)(g.gl);g.textureCoordinateAdjustment=new Float32Array(4);var h=new d.a(a);h.addVarying("vec2","vTexCoord");h.addUniform("sampler2D","uSampler");h.addInitializer(function(b){a.uniform1i(b.uniform("uSampler"),0)});h.addUniform("vec4","uColorFactor");h.addUniform("vec4","uBackgroundColor");h.addUniform("mat4","uProjectionMatrix");h.addUniform("vec4","uTextureCoordinateAdjustment");h.require(c);h.setFragmentMain("\nvec4 sampledColor = texture2D(uSampler, vTexCoord);\nif (sampledColor.a == 0.0) {\n  sampledColor = uBackgroundColor;\n}\nemit(sampledColor * uColorFactor, vec4(0,0,0,0));\n");
h.addAttribute("vec4","aVertexPosition");h.setVertexMain("\nvTexCoord = uTextureCoordinateAdjustment.xy + 0.5 * (aVertexPosition.xy + 1.0) * uTextureCoordinateAdjustment.zw;\ngl_Position = uProjectionMatrix * aVertexPosition;\n");g.shader=g.registerDisposer(h.build());return g}r(b,a);v(b,[{key:"draw",value:function(a,b,d,f,c,g,h,k){var e=this.gl,v=this.shader,x=this.textureCoordinateAdjustment;x[0]=c;x[1]=g;x[2]=h-c;x[3]=k-g;v.bind();e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,a);e.uniformMatrix4fv(v.uniform("uProjectionMatrix"),
!1,b);e.uniform4fv(v.uniform("uColorFactor"),d);e.uniform4fv(v.uniform("uBackgroundColor"),f);e.uniform4fv(v.uniform("uTextureCoordinateAdjustment"),x);a=v.attribute("aVertexPosition");this.copyVertexPositionsBuffer.bindToVertexAttrib(a,2);e.drawArrays(e.TRIANGLE_FAN,0,4);e.disableVertexAttribArray(a);e.bindTexture(e.TEXTURE_2D,null)}}],[{key:"get",value:function(a,d){return a.memoize.get("sliceview/SliceViewRenderHelper:"+Object(p.a)(d),function(){return new b(a,d)})}}]);return b}(w.a)},function(n,
e,c){e.a=function(c){return new q.a(void 0===c?.5:c,m.r)};var q=c(4),m=c(2)},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});
b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function a(a,b){var d=b.redrawNeeded.dispatch;b.registerDisposer(a.segmentColorHash.changed.add(d));b.registerDisposer(a.visibleSegments.changed.add(d));b.registerDisposer(a.segmentEquivalences.changed.add(d));b.registerDisposer(a.segmentSelectionState.changed.add(d))}c.d(e,"c",function(){return h});c.d(e,"a",function(){return g});e.g=a;
e.f=function(b,d){a(b,d);d.registerDisposer(b.objectAlpha.changed.add(d.redrawNeeded.dispatch));d.registerDisposer(b.objectToDataTransform.changed.add(d.redrawNeeded.dispatch))};e.e=function(a,b,f){f=void 0===f?1:f;var c=d;c[3]=f;a.segmentColorHash.compute(c,b);if(a.segmentSelectionState.isSelected(b))for(a=0;3>a;++a)c[a]=.5*c[a]+.5;c[0]*=f;c[1]*=f;c[2]*=f;return c};e.d=function(a,d,f){Object(b.a)(a,function(c,g){var h=Object(b.b)(c,a.clipBounds.value);h=d.get(h);void 0!==h&&f(g,c,h)})};c.d(e,"b",
function(){return f});var b=c(136);n=c(0);e=c(1);var l=c(3),w=c(11),u=c(33);c=c(6);var p=function y(a,b,d){null===a&&(a=Function.prototype);var f=Object.getOwnPropertyDescriptor(a,b);if(void 0===f){if(a=Object.getPrototypeOf(a),null!==a)return y(a,b,d)}else{if("value"in f)return f.value;b=f.get;return void 0===b?void 0:b.call(d)}},k=function(){function a(a,b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,
f.key,f)}}return function(b,d,f){d&&a(b.prototype,d);f&&a(b,f);return b}}(),h=function(){function a(b,d){r(this,a);this.key=b;this.value=d}k(a,[{key:"toString",value:function(){return this.key+"\u2192"+this.value}}]);return a}(),g=function(a){function b(){r(this,b);var a=q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments));a.selectedSegment=new w.a;a.hasSelectedSegment=!1;a.changed=new l.a;return a}m(b,a);k(b,[{key:"set",value:function(a){if(null==a)this.hasSelectedSegment&&(this.hasSelectedSegment=
!1,this.changed.dispatch());else{var b=this.selectedSegment;this.hasSelectedSegment&&a.low===b.low&&a.high===b.high||(b.low=a.low,b.high=a.high,this.hasSelectedSegment=!0,this.changed.dispatch())}}},{key:"isSelected",value:function(a){return this.hasSelectedSegment&&w.a.equal(a,this.selectedSegment)}},{key:"bindTo",value:function(a,b){var d=this,f=new w.a;this.registerDisposer(a.changed.add(function(){var c=a.get(b);"number"===typeof c?(f.low=c,f.high=0,c=f):c instanceof h&&(c=c.value);d.set(c)}))}}]);
return b}(n.a),d=e.r.create(),f=function(a){function b(a,d){r(this,b);var f=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));f.chunkManager=a;f.displayState=d;f.registerDisposer(d.clipBounds.changed.add(function(){return a.chunkQueueManager.scheduleChunkUpdate()}));return f}m(b,a);k(b,[{key:"initializeCounterpartWithChunkManager",value:function(a){var d=this.displayState;a.chunkManager=this.chunkManager.rpcId;a.visibleSegments=d.visibleSegments.rpcId;a.segmentEquivalences=d.segmentEquivalences.rpcId;
a.clipBounds=d.clipBounds.rpcId;p(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"initializeCounterpart",this).call(this,this.chunkManager.rpc,a)}}]);return b}(Object(u.c)(c.b))},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(e,"a",function(){return k});n=c(13);var a=c.n(n);n=c(0);var b=c(140),l=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,
c.key,c)}}return function(b,d,f){d&&a(b.prototype,d);f&&a(b,f);return b}}(),w=function g(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return g(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},u=new function d(){r(this,d);b.a.initializeHead(this)},p=a()(function(){var a=document.activeElement;if(null===a||a===document.body)a=b.a.front(u),null!==a&&a.element.focus()});window.addEventListener("focus",
function(){p()},!0);window.addEventListener("blur",function(){p()},!0);var k=function(d){function f(d){r(this,f);var c=q(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));c.element=d;c.prev0=null;c.next0=null;c.lastFocusedElement=null;c.scheduleUpdateFocus=c.registerCancellable(a()(function(){var a=document.activeElement,b=c.element;b.contains(a)||((a===c.lastFocusedElement||a.contains(b))&&c.element.focus(),c.lastFocusedElement=null)},0));d.tabIndex=-1;c.registerEventListener(d,"mouseenter",
function(){c.lastFocusedElement=document.activeElement;c.scheduleUpdateFocus()});c.registerEventListener(d,"mouseleave",function(){c.scheduleUpdateFocus.cancel()});b.a.insertBefore(u,c);c.registerEventListener(d,"focus",function(){b.a.pop(c);b.a.insertAfter(u,c)});p();return c}m(f,d);l(f,[{key:"disposed",value:function(){b.a.pop(this);w(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"disposed",this).call(this)}}]);return f}(n.a)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(a,b,d){for(var f=0;3>f;++f)a[f]=Number.POSITIVE_INFINITY,b[f]=Number.NEGATIVE_INFINITY;d=$jscomp.makeIterator(d);for(f=d.next();!f.done;f=d.next()){var c=f.value.spec;f=c.lowerChunkBound;
c=c.upperChunkBound;for(var g=0;3>g;++g)a[g]=Math.min(a[g],f[g]),b[g]=Math.max(b[g],c[g])}}function a(a,b,f,c){for(var g=d.FULLY_INSIDE,h=0;3>h;++h){var k=a[h];var e=b[h],v=f[h],l=c[h];k=k>=l||e<=v?d.FULLY_OUTSIDE:k>=v&&e<=l?d.FULLY_INSIDE:d.PARTIALLY_INSIDE;switch(k){case d.FULLY_OUTSIDE:return k;case d.PARTIALLY_INSIDE:g=k}}return g}function b(a,b){var d=b.length,f=0;if(1<d)for(var c=0,h=0;h<d;++h){var k=b[h].spec.chunkLayout;var e=k.size;k=k.globalToLocalSpatialVector(g,a);for(var v=0,l=0,y=1,
p=0;3>p;++p){var w=e[p];y*=w;w*=k[p];v=Math.min(v,w);l=Math.max(l,w)}e=y/(l-v);e>c&&(c=e,f=h)}return b[f]}function l(a){var b=a.voxelSize,d=void 0===a.lowerVoxelBound?k.h:a.lowerVoxelBound,f=a.upperVoxelBound,c=void 0===a.maxVoxelsPerChunkLog2?18:a.maxVoxelsPerChunkLog2;a=void 0===a.transform?k.d:a.transform;a=Object(k.c)(k.p.create(),a);b=k.p.multiply(a,a,b);a=k.p.fromValues(1,1,1);if(void 0===f)var g=k.f;else{g=k.p.create();for(var h=0;3>h;++h)g[h]=Math.pow(2,Math.floor(Math.log2(f[h]-d[h])))}for(d=
0;d<c;++d){f=Infinity;h=-1;for(var e=0;3>e;++e)if(!(a[e]>=g[e])){var v=a[e]*b[e];v<f&&(f=v,h=e)}f=h;if(-1===f)break;a[f]*=2}return a}c.d(e,"b",function(){return v});e.f=l;e.e=function(a,b){b=b.transform;return void 0===b?void 0===a?k.d:a:void 0===a?b:k.j.multiply(k.j.create(),b,a)};e.d=function(a){if(void 0!==a.chunkDataSizes)return a.chunkDataSizes;var b=void 0===a.chunkLayoutPreference?y.ISOTROPIC:a.chunkLayoutPreference;switch(b){case y.ISOTROPIC:return[l(a)];case y.FLAT:b=[];for(var d=0;3>d;++d){var f=
d;var c=a.lowerVoxelBound;var h=a.upperVoxelBound,e=d,v=a.voxelSize,p=a.maxVoxelsPerChunkLog2,w=a.transform;k.p.subtract(g,void 0===h?k.f:h,void 0===c?k.h:c);g[e]=1;c=l({voxelSize:v,upperVoxelBound:g,maxVoxelsPerChunkLog2:p,transform:w});b[f]=c}b.push(l(a));return b}throw Error("Invalid chunk layout preference: "+b+".");};c.d(e,"c",function(){return G});var w=c(144),u=c(82),p=c(145);c(27);var k=c(1);n=c(6);var h=function(){function a(a,b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||
!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,d,f){d&&a(b.prototype,d);f&&a(b,f);return b}}(),g=k.p.create(),d;(function(a){a[a.FULLY_OUTSIDE=0]="FULLY_OUTSIDE";a[a.FULLY_INSIDE=1]="FULLY_INSIDE";a[a.PARTIALLY_INSIDE=2]="PARTIALLY_INSIDE"})(d||(d={}));var f=[k.p.create(),k.p.create(),k.p.create(),k.p.create()],v=function(c){function e(){q(this,e);var a=(e.__proto__||Object.getPrototypeOf(e)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a.width=-1;a.height=-1;a.hasViewportToData=!1;a.hasValidViewport=!1;a.viewportToData=k.j.create();a.viewportAxes=[k.p.create(),k.p.create(),k.p.create()];a.previousViewportAxes=[k.p.create(),k.p.create()];a.centerDataPosition=k.p.create();a.viewportPlaneDistanceToOrigin=0;a.visibleChunkLayouts=new Map;a.visibleLayers=new Map;a.visibleSourcesStale=!0;a.pixelSize=0;k.j.identity(a.viewportToData);return a}m(e,c);h(e,[{key:"onViewportChanged",value:function(){}},
{key:"maybeSetHasValidViewport",value:function(){!this.hasValidViewport&&-1!==this.width&&-1!==this.height&&this.hasViewportToData&&(this.hasValidViewport=!0,this.onHasValidViewport());if(this.hasValidViewport)this.onViewportChanged()}},{key:"onHasValidViewport",value:function(){}},{key:"setViewportSize",value:function(a,b){return a!==this.width||b!==this.height?(this.width=a,this.height=b,this.maybeSetHasValidViewport(),!0):!1}},{key:"setViewportToDataMatrix",value:function(a){if(this.hasViewportToData&&
k.j.equals(this.viewportToData,a))return!1;this.hasViewportToData=!0;var b=this.viewportToData;k.j.copy(b,a);Object(k.m)(b);k.p.transformMat4(this.centerDataPosition,k.h,a);a=0;for(var d=this.viewportAxes,f=this.previousViewportAxes,c=0;3>c;++c){var g=d[c];Object(k.n)(g,k.e[c],b);0===c&&(a=k.p.length(g));k.p.normalize(g,g)}this.viewportAxes=d;this.previousViewportAxes=f;if(!Object(p.a)(a,this.pixelSize)||.95>k.p.dot(d[0],f[0])||.95>k.p.dot(d[1],f[1]))k.p.copy(f[0],d[0]),k.p.copy(f[1],d[1]),this.visibleSourcesStale=
!0,this.pixelSize=a;this.viewportPlaneDistanceToOrigin=k.p.dot(this.centerDataPosition,this.viewportAxes[2]);this.onViewportToDataMatrixChanged();this.maybeSetHasValidViewport();return!0}},{key:"onViewportToDataMatrixChanged",value:function(){}},{key:"updateVisibleSources",value:function(){if(this.visibleSourcesStale){this.visibleSourcesStale=!1;var a=1.1*this.pixelSize,d=this.visibleChunkLayouts,f=this.viewportAxes[2],c=this.visibleLayers;d.clear();var g={};c=$jscomp.makeIterator(c);for(var h=c.next();!h.done;g=
{smallestVoxelSize:g.smallestVoxelSize,visibleSources:g.visibleSources},h=c.next()){h=$jscomp.makeIterator(h.value);var e=h.next().value;g.visibleSources=h.next().value;g.visibleSources.length=0;h=e.sources;var k=h.length;e=void 0;g.smallestVoxelSize=h[0][0].spec.voxelSize;var v=function(b){return function(d){for(var f=0;3>f;++f){var c=d[f];if(c>a&&c>b.smallestVoxelSize[f])return!0}return!1}}(g),l=function(a){return function(b,f){a.visibleSources[a.visibleSources.length++]=b;var c=b.spec.chunkLayout,
g=d.get(c);void 0===g&&(g=new Map,d.set(c,g));g.set(b,f)}}(g);for(e=k-1;;){k=b(f,h[e]);l(k,e);if(0===e||!v(k.spec.voxelSize))break;--e}g.visibleSources.reverse()}}}},{key:"computeVisibleChunks",value:function(b,c){var h=this;this.updateVisibleSources();for(var e=this.width,v=this.height,l=this.viewportToData,D=0;3>D;++D)f[0][D]=-k.e[0][D]*e/2-k.e[1][D]*v/2,f[1][D]=-k.e[0][D]*e/2+k.e[1][D]*v/2,f[2][D]=k.e[0][D]*e/2-k.e[1][D]*v/2,f[3][D]=k.e[0][D]*e/2+k.e[1][D]*v/2;for(e=0;4>e;++e)k.p.transformMat4(f[e],
f[e],l);var p=k.p.create(),y=k.p.create(),w=k.p.create(),z=k.p.create(),G=k.p.create(),B=k.p.create(),m=[],q=[];this.visibleChunkLayouts.forEach(function(e,v){function x(){for(var a=0,b=0,d=0;3>d;++d){var f=B[d],c=p[d],g=y[d]-c,h=G[d]*g;a+=f*(c+h);b+=f*(c+g-h)}return a<H?!1:b<=H}function C(b){function f(){E=Object(u.b)(m,0,H,function(b){var f=b.spec;switch(a(p,y,f.lowerChunkBound,f.upperChunkBound)){case d.PARTIALLY_INSIDE:return!0;case d.FULLY_INSIDE:q.push(b);default:return!1}})}if(0!==q.length||
0!==E){for(var g=1,h=0;3>h;++h)g*=Math.max(0,y[h]-p[h]);if(0!==g&&x())if(1===g)c(v,l,p,q);else{for(var e;;)if(g=p[b],h=y[b],e=h-g,1===e)b=(b+1)%3;else break;e=g+Math.floor(.5*e);var k=(b+1)%3,D=q.length;y[b]=e;var H=E;f();C(k);q.length=D;E=H;y[b]=h;p[b]=e;f();C(k);p[b]=g;q.length=D;E=H}}}var l=b(v);r(w,z,e.keys());k.p.set(p,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);k.p.set(y,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);v.globalToLocalSpatialVector(B,
h.viewportAxes[2]);for(var D=0;3>D;++D)G[D]=0<B[D]?1:0;var H=k.p.dot(v.globalToLocalGrid(g,h.centerDataPosition),B);for(D=0;4>D;++D)for(var K=v.globalToLocalGrid(g,f[D]),F=0;3>F;++F)p[F]=Math.min(p[F],Math.floor(K[F])),y[F]=Math.max(y[F],Math.floor(K[F])+1);k.p.max(p,p,w);k.p.min(y,y,z);q.length=0;m.length=0;e=$jscomp.makeIterator(e.keys());for(D=e.next();!D.done;D=e.next())switch(D=D.value,K=D.spec,a(p,y,K.lowerChunkBound,K.upperChunkBound)){case d.FULLY_INSIDE:q.push(D);break;case d.PARTIALLY_INSIDE:m.push(D)}var E=
m.length;C(0)})}}]);return e}(n.b),y;(function(a){a[a.ISOTROPIC=0]="ISOTROPIC";a[a.FLAT=1]="FLAT"})(y||(y={}));var G=function B(a){q(this,B);var b=void 0===a.lowerVoxelBound?k.h:a.lowerVoxelBound,d=a.upperVoxelBound,f=a.chunkDataSize,c=a.voxelSize,g=a.transform,h=void 0===a.baseVoxelOffset?k.h:a.baseVoxelOffset,e=void 0===a.lowerClipBound?k.p.multiply(k.p.create(),c,b):a.lowerClipBound,v=void 0===a.upperClipBound?k.p.multiply(k.p.create(),c,d):a.upperClipBound;this.voxelSize=c;this.chunkDataSize=
f;this.chunkLayout=w.a.get(k.p.multiply(k.p.create(),a.chunkDataSize,c),g);this.lowerClipBound=e;this.upperClipBound=v;this.lowerVoxelBound=b;this.upperVoxelBound=d;this.baseVoxelOffset=h;a=this.lowerChunkBound=k.p.create();c=this.upperChunkBound=k.p.create();for(g=0;3>g;++g)a[g]=Math.floor(b[g]/f[g]),c[g]=Math.floor((d[g]-1)/f[g]+1)};e.a="SliceView"},function(n,e,c){function q(c){c.texParameteri(m.m,m.o,m.h);c.texParameteri(m.m,m.n,m.h);c.texParameteri(m.m,m.p,m.b);c.texParameteri(m.m,m.q,m.b)}e.b=
q;e.a=function(c,a,b,e,w,u){w=void 0===w?m.j:w;u=void 0===u?m.t:u;c.activeTexture(m.l+c.tempTextureUnit);c.bindTexture(m.m,a);q(c);c.texImage2D(m.m,0,w,b,e,0,w,u,null);c.bindTexture(m.m,null)};e.c=function(c,a,b){c.activeTexture(m.l+c.tempTextureUnit);c.bindTexture(m.m,a);c.texParameteri(m.m,m.o,m.e);c.texParameteri(m.m,m.n,m.e);c.texParameteri(m.m,m.p,m.b);c.texParameteri(m.m,m.q,m.b);c.pixelStorei(m.s,!0);c.pixelStorei(m.r,4);c.texImage2D(m.m,0,m.j,m.j,m.t,b);c.pixelStorei(m.s,!1);c.bindTexture(m.m,
null)};var m=c(20)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,
writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){Object(z.u)(a);var b=Object(z.w)(a,"neariso_voxelres",function(a){return Object(z.v)(a,z.k)}),d=Object(z.w)(a,"neariso_imagesize",function(a){return Object(z.v)(a,z.j)}),f=Object(z.w)(a,"neariso_offset",function(a){return Object(z.v)(a,z.l)});return Object(z.w)(a,"resolutions",function(a){return Object(z.a)(a,z.s)}).map(function(a){var c=""+a,g=b.get(c),h=d.get(c),e=f.get(c);if(void 0===
g||void 0===h||void 0===e)throw Error("Missing neariso_voxelres/neariso_imagesize/neariso_offset for resolution "+(a+"."));return{key:c,voxelSize:g,imageSize:h,voxelOffset:e}})}function b(a){a=x.get(a);void 0===a&&(a=v.d.UNKNOWN);return a}function l(a){Object(z.u)(a);var d=Object(z.w)(a,"channel_type",z.B);return{channelType:d,description:Object(z.w)(a,"description",z.B),volumeType:b(d),dataType:Object(z.w)(a,"datatype",function(a){return Object(z.n)(a,v.a)})}}function w(b){Object(z.u)(b);return{channels:Object(z.w)(b,
"channels",function(a){return Object(z.v)(a,l)}),scales:Object(z.w)(b,"dataset",a)}}function u(a,b,d,f){return a.memoize.getUncounted({type:"ndstore:getTokenInfo",hostnames:b,token:d},function(){return Object(B.d)(Object(B.b)(b,f+"/"+d+"/info/"),"json").then(w)})}function p(a,b,d,f){var c=d.match(F);if(null===c)throw Error("Invalid volume path "+JSON.stringify(d));var g=c[1],h=c[2],e=Object(z.e)(c[3]||"");return a.memoize.getUncounted({type:"ndstore:MultiscaleVolumeChunkSource",hostnames:b,path:d},
function(){return u(a,b,g,f).then(function(d){return new K(a,b,g,d,h,f,e)})})}function k(a,b){var d=b.match(T);if(null===d)throw Error("Invalid ndstore volume path: "+JSON.stringify(b));return p(a,[d[1]],d[2],f.b)}function h(a,b,d){return a.memoize.getUncounted({type:"dvid:getPublicTokens",hostnames:b},function(){return Object(B.d)(Object(B.b)(b,d+"/public_tokens/"),"json").then(function(a){return Object(z.a)(a,z.B)})})}function g(a,b,d,f){var c=d.match(/^(?:([^\/]+)(?:\/([^\/]*))?)?$/);if(null===
c)return Promise.reject(null);if(void 0===c[2]){var g=c[1]||"";return h(a,b,f).then(function(a){return{offset:0,completions:Object(G.c)(g,a,function(a){return a+"/"},function(){})}})}return u(a,b,c[1],f).then(function(a){a=Object(G.c)(c[2],a.channels,function(a){return a[0]},function(a){return a[1].channelType+" ("+v.a[a[1].dataType]+")"});return{offset:c[1].length+1,completions:a}})}function d(a,b){var d=a.match(T);return null===d?Promise.reject(null):g(b,[d[1]],d[2],f.b).then(function(a){return Object(G.a)(d[1].length+
1,a)})}Object.defineProperty(e,"__esModule",{value:!0});c.d(e,"getVolume",function(){return k});c.d(e,"volumeCompleter",function(){return d});c.d(e,"MultiscaleVolumeChunkSource",function(){return K});e.getTokenInfo=u;e.getShardedVolume=p;e.getPublicTokens=h;e.tokenAndChannelCompleter=g;c.d(e,"NDStoreDataSource",function(){return J});c.d(e,"SingleServerDataSource",function(){return R});n=c(10);e=c(24);var f=c(87),v=c(8),y=c(18),G=c(30),E=c(1),B=c(31),z=c(2),D=function(){function a(a,b){for(var d=0;d<
b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,d,f){d&&a(b.prototype,d);f&&a(b,f);return b}}(),x=new Map;x.set("image",v.d.IMAGE);x.set("annotation",v.d.SEGMENTATION);var C=new Set(["npz","raw","jpeg"]),H=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);return b}(Object(n.f)(y.b,f.c)),K=function(){function a(b,d,c,g,h,e,k){q(this,
a);this.chunkManager=b;this.baseUrls=d;this.key=c;this.tokenInfo=g;this.parameters=k;this.urlPrefix=f.b;this.neariso=!0;if(void 0===h){h=Array.from(g.channels.keys());if(1!==h.length)throw Error("Dataset contains multiple channels: "+JSON.stringify(h));h=h[0]}b=g.channels.get(h);if(void 0===b)throw Error("Specified channel "+JSON.stringify(h)+" is not one of the supported "+("channels "+JSON.stringify(Array.from(g.channels.keys()))));this.channel=h;this.channelInfo=b;this.scales=g.scales;void 0!==
e&&(this.urlPrefix=e);"false"===Object(z.z)(k.neariso)&&(this.neariso=!1);g=Object(z.z)(k.encoding);if(void 0===g)g=this.volumeType===v.d.IMAGE?"jpeg":"npz";else if(!C.has(g))throw Error("Invalid encoding: "+JSON.stringify(g)+".");this.encoding=g}D(a,[{key:"getSources",value:function(a){var b=this;return this.scales.map(function(d){for(var f=d.voxelOffset,c=d.voxelSize,g=E.p.create(),h=0;3>h;++h)g[h]=Math.ceil(f[h]);return v.c.getDefaults({numChannels:b.numChannels,volumeType:b.volumeType,dataType:b.dataType,
voxelSize:c,transform:E.j.fromTranslation(E.j.create(),E.p.multiply(E.p.create(),f,c)),baseVoxelOffset:g,upperVoxelBound:d.imageSize,volumeSourceOptions:a}).map(function(a){return b.chunkManager.getChunkSource(H,{spec:a,parameters:{baseUrls:b.baseUrls,urlPrefix:b.urlPrefix,key:b.key,channel:b.channel,resolution:d.key,encoding:b.encoding,neariso:b.neariso}})})})}},{key:"getMeshSource",value:function(){return null}},{key:"dataType",get:function(){return this.channelInfo.dataType}},{key:"numChannels",
get:function(){return 1}},{key:"volumeType",get:function(){return this.channelInfo.volumeType}}]);return a}(),F=/^([^\/?]+)(?:\/([^\/?]+))?(?:\?(.*))?$/,T=/^((?:http|https):\/\/[^\/?]+)\/(.*)$/,J=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);D(b,[{key:"volumeCompleter",value:function(a,b){return d(a,b)}},{key:"getVolume",value:function(a,b){return k(a,b)}},{key:"description",get:function(){return"NDstore"}}]);return b}(e.a),
R=function(a){function b(a,d,c){c=void 0===c?f.b:c;q(this,b);var g=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));g.description=a;g.hostnames=d;g.urlprefix=c;return g}r(b,a);D(b,[{key:"getVolume",value:function(a,b){return p(a,this.hostnames,b,this.urlprefix)}},{key:"volumeCompleter",value:function(a,b){return g(b,this.hostnames,a,this.urlprefix)}}]);return b}(e.a)},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(e,"a",function(){return w});c.d(e,
"b",function(){return u});n=c(0);var a=c(3),b=function k(a,b,d){null===a&&(a=Function.prototype);var f=Object.getOwnPropertyDescriptor(a,b);if(void 0===f){if(a=Object.getPrototypeOf(a),null!==a)return k(a,b,d)}else{if("value"in f)return f.value;b=f.get;return void 0===b?void 0:b.call(d)}},l=function(){function a(a,b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,d){c&&a(b.prototype,
c);d&&a(b,d);return b}}(),w=function(){function b(c,g){r(this,b);this.value_=c;this.defaultValue=g;this.changed=new a.a}l(b,[{key:"toggle",value:function(){this.value=!this.value}},{key:"toJSON",value:function(){if(this.value_!==this.defaultValue)return this.value_}},{key:"restoreState",value:function(a){this.value=!0===a||!1===a?a:this.defaultValue}},{key:"reset",value:function(){this.value=this.defaultValue}},{key:"value",get:function(){return this.value_},set:function(a){a!==this.value_&&(this.value_=
a,this.changed.dispatch())}}]);return b}(),u=function(a){function c(a){r(this,c);var b=q(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));b.model=a;b.element=document.createElement("input");var f=b.element;f.type="checkbox";b.registerDisposer(a.changed.add(function(){b.updateCheckbox()}));b.updateCheckbox();b.registerEventListener(f,"change",function(b){a.value=this.checked});f.addEventListener("mousedown",function(a){a.preventDefault()});return b}m(c,a);l(c,[{key:"updateCheckbox",value:function(){this.element.checked=
this.model.value}},{key:"disposed",value:function(){var a=this.element,d=a.parentElement;d&&d.removeChild(a);b(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}}]);return c}(n.a);(function(a){function b(a,d){r(this,b);var f=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));f.model=a;f.element=d;f.updateVisibility();f.registerDisposer(a.changed.add(function(){f.updateVisibility()}));return f}m(b,a);l(b,[{key:"updateVisibility",value:function(){this.element.style.display=
this.model.value?"":"none"}}]);return b})(n.a)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,
{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b,d,f){var c=!1,g;a.registerDisposer(b);var h=p.UNLINKED,e=function(){var c=d.value;if(c!==h)switch(c){case p.UNLINKED:g=void 0;break;case p.LINKED:g=void 0;f.assign(a,b);break;case p.RELATIVE:g=f.difference(a,b)}h=c;a.changed.dispatch()};a.registerDisposer(a.changed.add(function(){if(!c)switch(d.value){case p.LINKED:f.assign(b,a);break;case p.RELATIVE:f.subtract(b,
a,g)}}));a.registerDisposer(b.changed.add(function(){c=!0;switch(d.value){case p.UNLINKED:if(f.isValid(a))break;case p.LINKED:f.assign(a,b);break;case p.RELATIVE:f.add(a,b,g)}c=!1}));a.registerDisposer(d.changed.add(e));e();return a}c.d(e,"d",function(){return p});c.d(e,"b",function(){return v});c.d(e,"f",function(){return y});c.d(e,"a",function(){return G});c.d(e,"g",function(){return E});c.d(e,"c",function(){return z});c.d(e,"e",function(){return D});n=c(0);var b=c(1),l=c(2),w=c(3);c=c(212);var u=
function(){function a(a,b){for(var d=0;d<b.length;d++){var f=b[d];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,d,f){d&&a(b.prototype,d);f&&a(b,f);return b}}(),p;(function(a){a[a.LINKED=0]="LINKED";a[a.RELATIVE=1]="RELATIVE";a[a.UNLINKED=2]="UNLINKED"})(p||(p={}));var k=function(a){function b(a){a=void 0===a?p.LINKED:a;q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,p,a))}r(b,a);return b}(c.a),
h=function(a){function d(a){q(this,d);var f=m(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));f.changed=new w.a;var c=!0;null==a&&(a=b.p.create(),c=!1);f.size=a;f.valid=c;return f}r(d,a);u(d,[{key:"reset",value:function(){this.valid=!1;this.changed.dispatch()}},{key:"setValid",value:function(){this.valid||(this.valid=!0,this.changed.dispatch())}},{key:"toJSON",value:function(){if(this.valid)return Array.prototype.slice.call(this.size)}},{key:"restoreState",value:function(a){try{Object(l.b)(this.size,
a),this.valid=!0,this.changed.dispatch()}catch(K){this.valid=!1,this.changed.dispatch()}}},{key:"toString",value:function(){return this.valid?this.size.toString():null}},{key:"voxelFromSpatial",value:function(a,d){return b.p.divide(a,d,this.size)}},{key:"spatialFromVoxel",value:function(a,d){return b.p.multiply(a,d,this.size)}}]);return d}(n.a),g=b.p.create(),d=b.l.create(),f=function(a){function d(a,f){q(this,d);var c=m(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));c.voxelCoordinates=
null;c.changed=new w.a;null==a&&(a=new h);c.voxelSize=a;var g=!0;null==f&&(f=b.p.create(),g=!1);c.spatialCoordinates=f;c.spatialCoordinatesValid=g;c.registerDisposer(a);c.registerDisposer(a.changed.add(function(){c.handleVoxelSizeChanged()}));return c}r(d,a);u(d,[{key:"reset",value:function(){this.spatialCoordinatesValid=!1;this.voxelCoordinates=null;this.voxelSize.reset();this.changed.dispatch()}},{key:"getVoxelCoordinates",value:function(a){var d=this.voxelCoordinates;if(d)b.p.copy(a,d);else if(this.valid)this.voxelSize.voxelFromSpatial(a,
this.spatialCoordinates);else return!1;return!0}},{key:"setVoxelCoordinates",value:function(a){var d=this.voxelSize;d.valid?(d.spatialFromVoxel(this.spatialCoordinates,a),this.markSpatialCoordinatesChanged()):(d=this.voxelCoordinates)?b.p.copy(d,a):this.voxelCoordinates=b.p.clone(a);this.changed.dispatch()}},{key:"markSpatialCoordinatesChanged",value:function(){this.spatialCoordinatesValid=!0;this.voxelCoordinates=null;this.changed.dispatch()}},{key:"handleVoxelSizeChanged",value:function(){null==
this.voxelCoordinates||this.spatialCoordinatesValid||(this.voxelSize.spatialFromVoxel(this.spatialCoordinates,this.voxelCoordinates),this.spatialCoordinatesValid=!0);this.voxelCoordinates=null;this.changed.dispatch()}},{key:"toJSON",value:function(){var a=!0,b=this.voxelSize.toJSON(),d={};void 0!==b&&(a=!1,d.voxelSize=b);this.voxelCoordinatesValid?(this.getVoxelCoordinates(g),d.voxelCoordinates=Array.prototype.slice.call(g),a=!1):this.spatialCoordinatesValid&&(d.spatialCoordinates=Array.prototype.slice.call(this.spatialCoordinates),
a=!1);if(!a)return d}},{key:"restoreState",value:function(a){var d=this;Object(l.u)(a);Object(l.w)(a,"voxelSize",function(a){void 0!==a&&d.voxelSize.restoreState(a)});this.spatialCoordinatesValid=!1;Object(l.w)(a,"voxelCoordinates",function(a){void 0!==a&&d.setVoxelCoordinates(Object(l.b)(b.p.create(),a))});Object(l.w)(a,"spatialCoordinates",function(a){void 0!==a&&(Object(l.b)(d.spatialCoordinates,a),d.markSpatialCoordinatesChanged())})}},{key:"snapToVoxel",value:function(){if(this.valid){for(var a=
this.spatialCoordinates,b=this.voxelSize.size,d=0;3>d;++d){var f=b[d];a[d]=Math.round(a[d]/f)*f}this.changed.dispatch()}else if(a=this.voxelCoordinates,null!=a){for(b=0;3>b;++b)a[b]=Math.round(a[b]);this.changed.dispatch()}}},{key:"assign",value:function(a){this.spatialCoordinatesValid=a.spatialCoordinatesValid;b.p.copy(this.spatialCoordinates,a.spatialCoordinates);this.voxelCoordinates=(a=a.voxelCoordinates)&&b.p.clone(a);this.changed.dispatch()}},{key:"valid",get:function(){return this.spatialCoordinatesValid&&
this.voxelSize.valid}},{key:"voxelCoordinatesValid",get:function(){return this.valid||null!=this.voxelCoordinates}}],[{key:"getOffset",value:function(a,d){if(a.spatialCoordinatesValid&&d.spatialCoordinatesValid)return{spatialOffset:b.p.subtract(b.p.create(),a.spatialCoordinates,d.spatialCoordinates)};if(a.voxelCoordinates&&d.voxelCoordinates){if(a.voxelSize!==d.voxelSize)throw Error("Voxel offsets are only meaningful with identical voxelSize.");return{voxelOffset:b.p.subtract(b.p.create(),a.voxelCoordinates,
d.voxelCoordinates)}}return{}}},{key:"addOffset",value:function(a,d,f,c){c=void 0===c?1:c;var h=f.spatialOffset;f=f.voxelOffset;void 0!==h&&d.spatialCoordinatesValid?(b.p.scaleAndAdd(a.spatialCoordinates,d.spatialCoordinates,h,c),a.markSpatialCoordinatesChanged()):void 0!==f&&d.getVoxelCoordinates(g)&&a.setVoxelCoordinates(b.p.scaleAndAdd(g,g,f,c))}}]);return d}(n.a);c=function(){function a(b,d){d=void 0===d?new k:d;q(this,a);this.peer=b;this.link=d}u(a,[{key:"toJSON",value:function(){var a=this.link;
if(a.value!==p.LINKED)return{link:a.toJSON(),value:this.getValueJson()}}},{key:"getValueJson",value:function(){return this.value.toJSON()}},{key:"reset",value:function(){this.link.value=p.LINKED}},{key:"restoreState",value:function(a){var b=this;void 0===a?this.link.value=p.LINKED:(Object(l.u)(a),this.link.value=p.UNLINKED,Object(l.w)(a,"value",function(a){void 0!==a&&b.value.restoreState(a)}),Object(l.w)(a,"link",function(a){return b.link.restoreState(a)}))}},{key:"copyToPeer",value:function(){this.link.value!==
p.LINKED&&(this.link.value=p.UNLINKED,this.peer.assign(this.value),this.link.value=p.LINKED)}},{key:"changed",get:function(){return this.value.changed}}]);return a}();var v=function(b){function d(){q(this,d);var b=m(this,(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments));b.value=a(new f(b.peer.voxelSize.addRef()),b.peer,b.link,{assign:function(a,b){return a.assign(b)},isValid:function(a){return a.spatialCoordinatesValid||a.voxelCoordinatesValid},difference:f.getOffset,add:f.addOffset,
subtract:function(a,b,d){f.addOffset(a,b,d,-1)}});return b}r(d,b);u(d,[{key:"getValueJson",value:function(){var a=this.value.toJSON()||{};delete a.voxelSize;return a}}]);return d}(c),y=function(a){function d(a){q(this,d);var f=m(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));f.changed=new w.a;null==a&&(a=b.l.create());f.orientation=a;return f}r(d,a);u(d,[{key:"toJSON",value:function(){var a=this.orientation;if(0!==a[0]||0!==a[1]||0!==a[2]||1!==a[3])return Array.prototype.slice.call(this.orientation)}},
{key:"restoreState",value:function(a){try{Object(l.b)(this.orientation,a),b.l.normalize(this.orientation,this.orientation)}catch(K){b.l.identity(this.orientation)}this.changed.dispatch()}},{key:"reset",value:function(){b.l.identity(this.orientation);this.changed.dispatch()}},{key:"snap",value:function(){var a=b.i.create();b.i.fromQuat(a,this.orientation);for(var d=[!1,!1,!1],f=0;3>f;++f){for(var c=0,g=0,h=0;3>h;++h){var e=a[3*f+h];a[3*f+h]=0;!d[h]&&Math.abs(e)>Math.abs(c)&&(c=e,g=h)}a[3*f+g]=Math.sign(c);
d[g]=!0}b.l.fromMat3(this.orientation,a);this.changed.dispatch()}},{key:"assign",value:function(a){b.l.copy(this.orientation,a.orientation);this.changed.dispatch()}}],[{key:"makeRelative",value:function(a,f){var c=new d(b.l.multiply(b.l.create(),a.orientation,f)),g=!1;c.registerDisposer(a.changed.add(function(){g||(h=!0,b.l.multiply(c.orientation,a.orientation,f),c.changed.dispatch(),h=!1)}));var h=!1,e=b.l.invert(b.l.create(),f);c.registerDisposer(c.changed.add(function(){h||(g=!0,b.l.multiply(a.orientation,
c.orientation,e),a.changed.dispatch(),g=!1)}));return c}}]);return d}(n.a),G=function(f){function c(){q(this,c);var f=m(this,(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments));f.value=a(new y,f.peer,f.link,{assign:function(a,b){return a.assign(b)},isValid:function(){return!0},difference:function(a,d){var f=b.l.create();return b.l.multiply(f,b.l.invert(f,d.orientation),a.orientation)},add:function(a,d,f){b.l.multiply(a.orientation,d.orientation,f);a.changed.dispatch()},subtract:function(a,
f,c){b.l.multiply(a.orientation,f.orientation,b.l.invert(d,c));a.changed.dispatch()}});return f}r(c,f);return c}(c),E=function(a){function c(a,b){q(this,c);var d=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));d.changed=new w.a;null==a&&(a=new f);d.position=a;null==b&&(b=new y);d.orientation=b;d.registerDisposer(d.position);d.registerDisposer(d.orientation);d.registerDisposer(d.position.changed.add(d.changed.dispatch));d.registerDisposer(d.orientation.changed.add(d.changed.dispatch));return d}
r(c,a);u(c,[{key:"reset",value:function(){this.position.reset();this.orientation.reset()}},{key:"toMat4",value:function(a){b.j.fromRotationTranslation(a,this.orientation.orientation,this.position.spatialCoordinates)}},{key:"toJSON",value:function(){var a=this.position.toJSON(),b=this.orientation.toJSON();if(void 0!==a||void 0!==b)return{position:a,orientation:b}}},{key:"restoreState",value:function(a){var b=this;Object(l.u)(a);Object(l.w)(a,"position",function(a){void 0!==a&&b.position.restoreState(a)});
Object(l.w)(a,"orientation",function(a){void 0!==a&&b.orientation.restoreState(a)})}},{key:"snap",value:function(){this.orientation.snap();this.position.snapToVoxel();this.changed.dispatch()}},{key:"translateAbsolute",value:function(a){b.p.add(this.position.spatialCoordinates,this.position.spatialCoordinates,a);this.position.changed.dispatch()}},{key:"translateRelative",value:function(a){this.valid&&(b.p.transformQuat(g,a,this.orientation.orientation),b.p.add(this.position.spatialCoordinates,this.position.spatialCoordinates,
g),this.position.changed.dispatch())}},{key:"translateVoxelsRelative",value:function(a){if(this.valid){var d=b.p.create();b.p.transformQuat(d,a,this.orientation.orientation);b.p.multiply(d,d,this.position.voxelSize.size);b.p.add(this.position.spatialCoordinates,this.position.spatialCoordinates,d);this.position.changed.dispatch()}}},{key:"rotateRelative",value:function(a,d){var f=b.l.create();b.l.setAxisAngle(f,a,d);a=this.orientation.orientation;b.l.multiply(a,a,f);this.orientation.changed.dispatch()}},
{key:"rotateAbsolute",value:function(a,f,c){var h=b.l.create();b.l.setAxisAngle(h,a,f);a=this.orientation.orientation;if(void 0!==c){f=this.position.spatialCoordinates;var e=b.p.subtract(g,c,f),k=b.l.invert(d,a);b.p.transformQuat(e,e,k);b.l.multiply(a,h,a);b.p.transformQuat(f,e,a);b.p.subtract(f,c,f);this.position.changed.dispatch()}else b.l.multiply(a,h,a);this.orientation.changed.dispatch()}},{key:"valid",get:function(){return this.position.valid}}]);return c}(n.a),B=function(a){function b(a,d){a=
void 0===a?Number.NaN:a;d=void 0===d?a:d;q(this,b);var f=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));f.value_=a;f.defaultValue=d;f.changed=new w.a;return f}r(b,a);u(b,[{key:"toJSON",value:function(){var a=this.value_,b=this.defaultValue;if(!(Number.isNaN(a)&&Number.isNaN(b)||a===b))return a}},{key:"restoreState",value:function(a){"number"===typeof a&&Number.isFinite(a)&&0<a?this.value=a:this.value=this.defaultValue}},{key:"reset",value:function(){this.value=this.defaultValue}},{key:"zoomBy",
value:function(a){var b=this.value_;Number.isNaN(b)||(this.value=b*a)}},{key:"assign",value:function(a){this.value=a.value}},{key:"value",get:function(){return this.value_},set:function(a){a!==this.value_&&(this.value_=a,this.changed.dispatch())}},{key:"valid",get:function(){return!Number.isNaN(this.value)}}]);return b}(n.a),z=function(b){function d(){q(this,d);var b=m(this,(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments));b.value=function(){var d=new B;return a(d,b.peer,b.link,{assign:function(a,
b){return a.assign(b)},isValid:function(a){return a.valid},difference:function(a,b){return a.value/b.value},add:function(a,b,d){a.value=b.value*d},subtract:function(a,b,d){a.value=b.value/d}})}();return b}r(d,b);return d}(c),D=function(a){function d(a,b){a=void 0===a?new E:a;b=void 0===b?Number.NaN:b;q(this,d);var f=m(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));f.pose=a;f.changed=new w.a;f.zoomFactor="number"===typeof b?new B(b):b;f.registerDisposer(f.zoomFactor);f.registerDisposer(a);
f.registerDisposer(f.pose.changed.add(function(){f.changed.dispatch()}));f.registerDisposer(f.zoomFactor.changed.add(function(){f.changed.dispatch()}));f.registerDisposer(f.voxelSize.changed.add(function(){f.handleVoxelSizeChanged()}));f.handleVoxelSizeChanged();return f}r(d,a);u(d,[{key:"reset",value:function(){this.pose.reset();this.zoomFactor.reset()}},{key:"setZoomFactorFromVoxelSize",value:function(){this.voxelSize.valid&&(this.zoomFactor.value=Math.min.apply(null,this.voxelSize.size))}},{key:"handleVoxelSizeChanged",
value:function(){this.zoomFactor.valid||this.setZoomFactorFromVoxelSize()}},{key:"toMat4",value:function(a){this.pose.toMat4(a);var d=this.zoomFactor.value;b.j.scale(a,a,b.p.fromValues(d,d,d))}},{key:"toJSON",value:function(){var a=this.pose.toJSON(),b=this.zoomFactor.toJSON();if(void 0!==a||void 0!==b)return{pose:a,zoomFactor:b}}},{key:"restoreState",value:function(a){var b=this;try{Object(l.u)(a),Object(l.w)(a,"pose",function(a){void 0!==a&&b.pose.restoreState(a)}),Object(l.w)(a,"zoomFactor",function(a){void 0!==
a&&b.zoomFactor.restoreState(a)}),this.handleVoxelSizeChanged(),this.changed.dispatch()}catch(F){this.reset()}}},{key:"zoomBy",value:function(a){this.zoomFactor.zoomBy(a)}},{key:"voxelSize",get:function(){return this.pose.position.voxelSize}},{key:"position",get:function(){return this.pose.position}},{key:"valid",get:function(){return this.pose.valid}}]);return d}(n.a)},function(n,e){},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function r(a){var b=p.get(a),c=a.changed.count;if(void 0!==b&&b.generation===c)return b;if(a instanceof u){var d=a.baseJSON();for(var f=$jscomp.makeIterator(a.children),e=f.next();!e.done;e=f.next()){var k=$jscomp.makeIterator(e.value);
e=k.next().value;k=k.next().value;d[e]=r(k).value}}else d=a.toJSON();void 0===b?(b={generation:c,value:d},p.set(a,b)):(b.generation=c,b.value=d);return b}c.d(e,"a",function(){return u});e.b=r;var a=c(2),b=c(3),l=function h(a,b,f){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return h(a,b,f)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(f)}},w=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=
b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,f){d&&a(b.prototype,d);f&&a(b,f);return b}}(),u=function(){function c(){m(this,c);this.children=new Map;this.changed=new b.a}w(c,[{key:"add",value:function(a,b){var d=this;if(this.children.has(a))throw Error("Key "+JSON.stringify(a)+" already registered.");this.children.set(a,b);b.changed.add(this.changed.dispatch);this.changed.dispatch();return function(){d.remove(a)}}},
{key:"remove",value:function(a){var b=this.children;if(b.has(a))throw Error("Key "+JSON.stringify(a)+" not registered.");b=b.get(a);this.children.delete(a);b.changed.remove(this.changed.dispatch);this.changed.dispatch()}},{key:"dispose",value:function(){for(var a=this.changed,b=$jscomp.makeIterator(this.children.values()),f=b.next();!f.done;f=b.next())f.value.changed.remove(a.dispatch);this.children=void 0}},{key:"toJSON",value:function(){for(var a=this.baseJSON(),b=$jscomp.makeIterator(this.children),
f=b.next();!f.done;f=b.next()){var c=$jscomp.makeIterator(f.value);f=c.next().value;c=c.next().value;a[f]=c.toJSON()}return a}},{key:"baseJSON",value:function(){return{}}},{key:"reset",value:function(){for(var a=$jscomp.makeIterator(this.children.values()),b=a.next();!b.done;b=a.next())b.value.reset()}},{key:"restoreState",value:function(b){Object(a.u)(b);for(var d=$jscomp.makeIterator(this.children),f=d.next();!f.done;f=d.next()){var c=$jscomp.makeIterator(f.value);f=c.next().value;c=c.next().value;
try{b.hasOwnProperty(f)&&c.restoreState(b[f])}catch(y){throw Error("Error restoring property "+JSON.stringify(f)+": "+y.message);}}}}]);return c}();(function(b){function c(){m(this,c);var a=(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a.lastState={};return a}q(c,b);w(c,[{key:"restoreState",value:function(b){Object(a.u)(b);this.lastState=
b;l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"restoreState",this).call(this,b)}},{key:"reset",value:function(){this.lastState={};l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"reset",this).call(this)}},{key:"baseJSON",value:function(){for(var a=Object.assign(l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"baseJSON",this).call(this),this.lastState),b=$jscomp.makeIterator(this.children.keys()),g=b.next();!g.done;g=b.next())delete a[g.value];return a}},{key:"toJSON",
value:function(){var a=l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"toJSON",this).call(this);return this.lastState=a}},{key:"add",value:function(a,b){var d=l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"add",this).call(this,a,b);a=this.lastState[a];void 0!==a&&(b.reset(),b.restoreState(a));return d}}]);return c})(u);var p=new WeakMap},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return b});var m=c(4);n=c(6);var r=function(){function a(a,b){for(var c=0;c<b.length;c++){var h=b[c];h.enumerable=h.enumerable||!1;h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(a,h.key,h)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),a=function u(a,b,
c){null===a&&(a=Function.prototype);var g=Object.getOwnPropertyDescriptor(a,b);if(void 0===g){if(a=Object.getPrototypeOf(a),null!==a)return u(a,b,c)}else{if("value"in g)return g.value;b=g.get;return void 0===b?void 0:b.call(c)}};e=this&&this.__decorate||function(a,b,c,h){var g=arguments.length,d=3>g?b:null===h?h=Object.getOwnPropertyDescriptor(b,c):h,f;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)d=Reflect.decorate(a,b,c,h);else for(var e=a.length-1;0<=e;e--)if(f=a[e])d=(3>g?
f(d):3<g?f(b,c,d):f(b,c))||d;return 3<g&&d&&Object.defineProperty(b,c,d),d};var b=l=function(b){function c(a,b){b=void 0===b?{}:b;if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");var g=(c.__proto__||Object.getPrototypeOf(c)).call(this,a,b);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");g=!g||"object"!==typeof g&&"function"!==typeof g?this:g;g.updatingValue_=!1;void 0!==a&&(g.base=new m.b(b.value),g.setupChangedHandler());
return g}q(c,b);r(c,[{key:"initializeCounterpart",value:function(b,h){h=void 0===h?{}:h;h.value=this.value;a(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"initializeCounterpart",this).call(this,b,h)}},{key:"setupChangedHandler",value:function(){var a=this;this.registerDisposer(this.base.changed.add(function(){if(a.updatingValue_)a.updatingValue_=!1;else{var b=a.rpc;null!==b&&b.invoke("SharedWatchableValue.changed",{id:a.rpcId,value:a.value})}}))}},{key:"value",get:function(){return this.base.value},
set:function(a){this.base.value=a}},{key:"changed",get:function(){return this.base.changed}}],[{key:"makeFromExisting",value:function(a,b){var c=new l;c.base=b;c.setupChangedHandler();c.initializeCounterpart(a);return c}},{key:"make",value:function(a,b){return l.makeFromExisting(a,new m.b(b))}}]);return c}(n.c);b=l=e([Object(n.f)("SharedWatchableValue")],b);Object(n.e)("SharedWatchableValue.changed",function(a){var b=this.get(a.id);b.updatingValue_=!0;b.base.value=a.value;b.updatingValue_=!1});var l},
function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(e,"a",function(){return w});c.d(e,"b",function(){return u});var r=c(0),
a=c(2),b=function k(a,b,d){null===a&&(a=Function.prototype);var c=Object.getOwnPropertyDescriptor(a,b);if(void 0===c){if(a=Object.getPrototypeOf(a),null!==a)return k(a,b,d)}else{if("value"in c)return c.value;b=c.get;return void 0===b?void 0:b.call(d)}},l=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),w=function(){function a(){m(this,
a);this.map=new Map}l(a,[{key:"get",value:function(a,b){var d=this.map,c=d.get(a);void 0===c?(c=b(),c.registerDisposer(function(){d.delete(a)}),d.set(a,c)):c.addRef();return c}}]);return a}(),u=function(c){function h(){m(this,h);var a=(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&"function"!==typeof a?this:a}q(h,c);l(h,[{key:"get",value:function(c,d){"string"!==
typeof c&&(c=Object(a.g)(c));return b(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"get",this).call(this,c,d)}},{key:"getUncounted",value:function(a,b){return this.get(a,function(){return new r.b(b())}).value}}]);return h}(w)},function(n,e,c){e.b=function(c,a,b,e){e=void 0===e?q.e:e;var l=void 0;return new Promise(function(w,p){function k(g){null!==l&&(l=Object(m.b)(c.serverUrls,b.path,b.method),l.responseType=b.responseType,l.setRequestHeader("Authorization",g.credentials.tokenType+
" "+g.credentials.accessToken),l.onloadend=function(){if(null!==l){var b=this.status;200<=b&&300>b?(e.remove(h),w(this.response)):401===b?a.get(g,e).then(k):504===b||503===b?a.get(void 0,e).then(k):(e.remove(h),p(m.a.fromXhr(this)))}},l.send(b.payload))}var h=function(){var a=l;l=null;null!=a&&a.abort();p(q.a)};e.add(h);a.get(void 0,e).then(k)})};var q=c(14),m=c(31);e.a="google-brainmaps"},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(e,"a",function(){return y});c.d(e,
"b",function(){return E});var a=c(23);n=c(10);var b=c(123);e=c(32);var l=c(37),w=c(1),u=c(19),p=c(17),k=c(25),h=c(7);c=c(6);var g=function D(a,b,d){null===a&&(a=Function.prototype);var c=Object.getOwnPropertyDescriptor(a,b);if(void 0===c){if(a=Object.getPrototypeOf(a),null!==a)return D(a,b,d)}else{if("value"in c)return c.value;b=c.get;return void 0===b?void 0:b.call(d)}},d=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&
(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}(),f=this&&this.__decorate||function(a,b,d,c){var f=arguments.length,g=3>f?b:null===c?c=Object.getOwnPropertyDescriptor(b,d):c,h;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)g=Reflect.decorate(a,b,d,c);else for(var e=a.length-1;0<=e;e--)if(h=a[e])g=(3>f?h(g):3<f?h(b,d,g):h(b,d))||g;return 3<f&&g&&Object.defineProperty(b,d,g),g},v=function(){function a(){r(this,a);
this.tempLightVec=new Float32Array(4);this.tempPickID=new Float32Array(4)}d(a,[{key:"defineShader",value:function(a){a.addAttribute("highp vec3","aVertexPosition");a.addAttribute("highp vec3","aVertexNormal");a.addVarying("highp vec4","vColor");a.addUniform("highp vec4","uLightDirection");a.addUniform("highp vec4","uColor");a.addUniform("highp mat4","uModelMatrix");a.addUniform("highp mat4","uProjection");a.addUniform("highp vec4","uPickID");a.setVertexMain("\ngl_Position = uProjection * (uModelMatrix * vec4(aVertexPosition, 1.0));\nvec3 normal = (uModelMatrix * vec4(aVertexNormal, 0.0)).xyz;\nfloat lightingFactor = abs(dot(normal, uLightDirection.xyz)) + uLightDirection.w;\nvColor = vec4(lightingFactor * uColor.rgb, uColor.a);\n");
a.setFragmentMain("emit(vColor, uPickID);")}},{key:"beginLayer",value:function(a,b,d){var c=d.dataToDevice,f=d.lightDirection,g=d.ambientLighting;d=d.directionalLighting;a.uniformMatrix4fv(b.uniform("uProjection"),!1,c);c=this.tempLightVec;w.p.scale(c,f,d);c[3]=g;a.uniform4fv(b.uniform("uLightDirection"),c)}},{key:"setColor",value:function(a,b,d){a.uniform4fv(b.uniform("uColor"),d)}},{key:"setPickID",value:function(a,b,d){a.uniform4fv(b.uniform("uPickID"),Object(h.p)(this.tempPickID,d))}},{key:"beginObject",
value:function(a,b,d){a.uniformMatrix4fv(b.uniform("uModelMatrix"),!1,d)}},{key:"getShader",value:function(a,b){var d=this;return a.memoize.get("mesh/MeshShaderManager:"+Object(u.a)(b),function(){var c=new k.a(a);c.require(b);d.defineShader(c);return c.build()})}},{key:"drawFragment",value:function(a,b,d){d.vertexBuffer.bindToVertexAttrib(b.attribute("aVertexPosition"),3);d.normalBuffer.bindToVertexAttrib(b.attribute("aVertexNormal"),3);d.indexBuffer.bind();a.drawElements(a.TRIANGLES,d.numIndices,
a.UNSIGNED_INT,0)}},{key:"endLayer",value:function(a,b){a.disableVertexAttribArray(b.attribute("aVertexPosition"));a.disableVertexAttribArray(b.attribute("aVertexNormal"))}}]);return a}(),y=function(c){function f(a,d,c){r(this,f);var g=q(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));g.chunkManager=a;g.source=d;g.displayState=c;g.meshShaderManager=new v;g.shaders=new Map;Object(l.f)(c,g);a=g.sharedObject=g.registerDisposer(new l.b(a,c));a.RPC_TYPE_ID=b.b;a.initializeCounterpartWithChunkManager({source:d.addCounterpartRef()});
g.setReady(!0);a.visibility.add(g.visibility);return g}m(f,c);d(f,[{key:"getShader",value:function(a){var b=this.shaders,d=b.get(a);void 0===d&&(d=this.registerDisposer(this.meshShaderManager.getShader(this.gl,a)),b.set(a,d));return d}},{key:"draw",value:function(b){var d=this;if(b.emitColor||!b.alreadyEmittedPickID){var c=this.gl,f=this.displayState,g=this.meshShaderManager,h=Math.min(1,f.objectAlpha.value);if(!(0>=h)){var e=this.getShader(b.emitter);e.bind();g.beginLayer(c,e,b);var k=b.pickIDs,
v=this.displayState.objectToDataTransform.transform;Object(l.d)(f,this.source.fragmentSource.objectChunks,function(x,C,D){b.emitColor&&g.setColor(c,e,Object(l.e)(f,x,h));b.emitPickID&&g.setPickID(c,e,k.registerUint64(d,C));g.beginObject(c,e,v);x=$jscomp.makeIterator(D);for(C=x.next();!C.done;C=x.next())C=C.value,C.state===a.d.GPU_MEMORY&&g.drawFragment(c,e,C)});g.endLayer(c,e)}}}},{key:"isTransparent",get:function(){return 1>this.displayState.objectAlpha.value}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}]);
return f}(e.a),G=function(a){function b(a,d){r(this,b);a=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));a.objectKey=d.objectKey;a.vertexPositions=d.vertexPositions;var c=a.indices=d.indices;a.numIndices=c.length;a.vertexNormals=d.vertexNormals;return a}m(b,a);d(b,[{key:"copyToGPU",value:function(a){g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"copyToGPU",this).call(this,a);this.vertexBuffer=p.a.fromData(a,this.vertexPositions,a.ARRAY_BUFFER,a.STATIC_DRAW);this.indexBuffer=
p.a.fromData(a,this.indices,a.ELEMENT_ARRAY_BUFFER,a.STATIC_DRAW);this.normalBuffer=p.a.fromData(a,this.vertexNormals,a.ARRAY_BUFFER,a.STATIC_DRAW)}},{key:"freeGPUMemory",value:function(a){g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"freeGPUMemory",this).call(this,a);this.vertexBuffer.dispose();this.indexBuffer.dispose();this.normalBuffer.dispose()}}]);return b}(n.b),E=function(a){function b(){r(this,b);var a=q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments));a.fragmentSource=
a.registerDisposer(new B(a.chunkManager,a));return a}m(b,a);d(b,[{key:"initializeCounterpart",value:function(a,d){this.fragmentSource.initializeCounterpart(this.chunkManager.rpc,{});d.fragmentSource=this.fragmentSource.addCounterpartRef();g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"initializeCounterpart",this).call(this,a,d)}}]);return b}(n.e),B=function(a){function b(a,d){r(this,b);a=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));a.meshSource=d;a.objectChunks=new Map;
return a}m(b,a);d(b,[{key:"addChunk",value:function(a,d){g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"addChunk",this).call(this,a,d);a=this.objectChunks;var c=d.objectKey,f=a.get(c);void 0===f&&(f=new Set,a.set(c,f));f.add(d)}},{key:"deleteChunk",value:function(a){var d=this.chunks.get(a);g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"deleteChunk",this).call(this,a);a=this.objectChunks;var c=d.objectKey,f=a.get(c);f.delete(d);0===f.size&&a.delete(c)}},{key:"getChunk",
value:function(a){return new G(this,a)}}]);return b}(n.e);B=f([Object(c.g)(b.a)],B)},function(n,e){n.exports=function(c){var e=typeof c;return null!=c&&("object"==e||"function"==e)}},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&
null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){a.addFragmentCode("\nvoid emit(vec4 color, vec4 pickId) {\n  gl_FragColor = color;\n}\n")}function b(a){a.addFragmentCode("\nvoid emit(vec4 color, vec4 pickId) {\n  gl_FragColor = pickId;\n}\n")}c.d(e,"b",function(){return G});
c.d(e,"a",function(){return E});var l=c(76),w=c(12),u=c(78);n=c(79);var p=c(35),k=c(15),h=c(1),g=c(83),d=c(53),f=c(84),v=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}(),y;(function(a){a[a.COLOR=0]="COLOR";a[a.PICK=1]="PICK";a[a.NUM_TEXTURES=2]="NUM_TEXTURES"})(y||(y={}));var G=function(a){function b(){q(this,
b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);v(b,[{key:"draw",value:function(a){}}]);return b}(w.h),E=function(c){function e(b,c,v,z){q(this,e);var x=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,b,c,z));x.sliceView=v;x.axesLineHelper=x.registerDisposer(l.a.get(x.gl));x.sliceViewRenderHelper=x.registerDisposer(p.d.get(x.gl,a));x.colorFactor=h.r.fromValues(1,1,1,1);x.backgroundColor=h.r.fromValues(.5,.5,.5,1);x.pickIDs=new u.a;x.visibleLayerTracker=
Object(w.i)(x.viewer.layerManager,G,x);x.offscreenFramebuffer=x.registerDisposer(new d.b(x.gl,{colorBuffers:Object(d.e)(x.gl,y.NUM_TEXTURES)}));x.offscreenCopyHelper=x.registerDisposer(d.c.get(x.gl));x.scaleBarCopyHelper=x.registerDisposer(d.c.get(x.gl));x.scaleBarTexture=x.registerDisposer(new f.a(x.gl));Object(k.c)(c,"translate-via-mouse-drag",function(a){x.viewer.mouseState.updateUnconditionally()&&Object(g.a)(a.detail,function(a,b,d){a=x.viewer.navigationState.position;var c=a.spatialCoordinates;
h.p.set(c,b,d,0);h.p.transformMat4(c,c,x.sliceView.viewportToData);a.changed.dispatch()})});Object(k.c)(c,"rotate-via-mouse-drag",function(a){var b=x.viewer.mouseState;if(b.updateUnconditionally()){var d=h.p.clone(b.position);Object(g.a)(a.detail,function(a,b,c){a=x.sliceView.viewportAxes;x.viewer.navigationState.pose.rotateAbsolute(a[1],b/4*Math.PI/180,d);x.viewer.navigationState.pose.rotateAbsolute(a[0],c/4*Math.PI/180,d)})}});x.registerDisposer(v);x.registerDisposer(v.visibility.add(x.visibility));
x.registerDisposer(v.viewChanged.add(function(){x.visible&&b.scheduleRedraw()}));x.registerDisposer(z.showAxisLines.changed.add(function(){x.visible&&x.scheduleRedraw()}));x.registerDisposer(z.showScaleBar.changed.add(function(){x.visible&&x.context.scheduleRedraw()}));return x}r(e,c);v(e,[{key:"draw",value:function(){var d=this.sliceView;if(d.hasValidViewport){this.onResize();d.updateRendering();var c=this.gl,f=d.width,g=d.height,e=d.dataToDevice;this.offscreenFramebuffer.bind(f,g);c.disable(c.SCISSOR_TEST);
this.gl.clearColor(0,0,0,0);c.clear(c.COLOR_BUFFER_BIT);var k=h.j.create();this.sliceViewRenderHelper.draw(d.offscreenFramebuffer.colorBuffers[0].texture,h.d,this.colorFactor,this.backgroundColor,0,0,1,1);var v=this.visibleLayerTracker.getVisibleLayers(),l=this.pickIDs;l.clear();this.offscreenFramebuffer.bindSingle(y.COLOR);l={dataToDevice:e,pickIDs:l,emitter:a,emitColor:!0,emitPickID:!1,viewportWidth:f,viewportHeight:g};c.enable(c.BLEND);c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA);for(var w=$jscomp.makeIterator(v),
p=w.next();!p.done;p=w.next())p.value.draw(l);c.disable(c.BLEND);this.offscreenFramebuffer.bindSingle(y.PICK);l.emitColor=!1;l.emitPickID=!0;l.emitter=b;v=$jscomp.makeIterator(v);for(p=v.next();!p.done;p=v.next())p.value.draw(l);if(this.viewer.showAxisLines.value||this.viewer.showScaleBar.value){if(this.viewer.showAxisLines.value){h.j.copy(k,e);for(e=0;3>e;++e)k[12+e]=0;for(e=0;4>e;++e)k[2+4*e]=0;g=Math.min(f,g)/4*1.5;e=d.pixelSize;for(v=0;12>v;++v)k[v]=k[v]*g*e}this.offscreenFramebuffer.bindSingle(y.COLOR);
this.viewer.showAxisLines.value&&this.axesLineHelper.draw(k);this.viewer.showScaleBar.value&&(c.enable(c.BLEND),c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA),k=this.scaleBarTexture,g=k.dimensions,g.targetLengthInPixels=Math.min(f/4,100),g.nanometersPerPixel=d.pixelSize,k.update(),c.viewport(10,10,k.width,k.height),this.scaleBarCopyHelper.draw(k.texture),c.disable(c.BLEND))}this.offscreenFramebuffer.unbind();this.setGLViewport();this.offscreenCopyHelper.draw(this.offscreenFramebuffer.colorBuffers[y.COLOR].texture)}}},
{key:"onResize",value:function(){this.sliceView.setViewportSize(this.element.clientWidth,this.element.clientHeight)}},{key:"updateMouseState",value:function(a){a.pickedRenderLayer=null;var b=this.sliceView;if(!b.hasValidViewport)return!1;var d=b.width,c=b.height,f=this.offscreenFramebuffer;if(!f.hasSize(d,c))return!1;var g=a.position,e=this.mouseX,k=this.mouseY;h.p.set(g,e-d/2,k-c/2,0);h.p.transformMat4(g,g,b.viewportToData);b=c-k;d=this.viewer;c=d.layerManager;c.uniqueAction("edit",c.editorLayer,
d.editorState);this.pickIDs.setMouseState(a,f.readPixelAsUint32(y.PICK,e,b));return!0}},{key:"zoomByMouse",value:function(a){var b=this.navigationState;if(b.valid){var d=this.sliceView,c=d.height,f=this.mouseX,g=this.mouseY;f-=d.width/2;g-=c/2;c=this.navigationState.zoomFactor.value;b.zoomBy(a);a=b.zoomFactor.value;var e=b.position.spatialCoordinates;h.p.scaleAndAdd(e,e,d.viewportAxes[0],f*(c-a));h.p.scaleAndAdd(e,e,d.viewportAxes[1],g*(c-a));b.position.changed.dispatch()}}},{key:"navigationState",
get:function(){return this.sliceView.navigationState}}]);return e}(n.a)},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return u});n=c(12);var m=c(1),r=c(28),a=c(25),b=function(){function a(a,b){for(var c=
0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,g){c&&a(b.prototype,c);g&&a(b,g);return b}}(),l=function k(a,b,d){null===a&&(a=Function.prototype);var c=Object.getOwnPropertyDescriptor(a,b);if(void 0===c){if(a=Object.getPrototypeOf(a),null!==a)return k(a,b,d)}else{if("value"in c)return c.value;b=c.get;return void 0===b?void 0:b.call(d)}},w=m.p.create(),u=function(c){function h(a,b,c){c=
void 0===c?{}:c;var d=void 0===c.shaderError?Object(r.b)():c.shaderError;if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");c=(h.__proto__||Object.getPrototypeOf(h)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c.sources=null;c.sourceIds=[];c.shader=void 0;c.shaderUpdated=!0;c.rpcId=null;c.shaderError=d;d.value=void 0;c.chunkManager=a;c.sources=b;a=$jscomp.makeIterator(b);
for(b=a.next();!b.done;b=a.next()){d=b.value;b=[];c.sourceIds.push(b);d=$jscomp.makeIterator(d);for(var f=d.next();!f.done;f=d.next())b.push(f.value.rpcId)}a=c.sources[0][0].spec;b=a.chunkLayout;d=c.voxelSize=b.localSpatialVectorToGlobal(m.p.create(),a.voxelSize);for(f=0;3>f;++f)d[f]=Math.abs(d[f]);d=c.boundingBox=new m.b(m.p.fromValues(Infinity,Infinity,Infinity),m.p.fromValues(-Infinity,-Infinity,-Infinity));f=m.p.create();for(var g=0;8>g;++g){for(var e=0;3>e;++e)w[e]=g&1<<e?a.upperClipBound[e]:
a.lowerClipBound[e];b.localSpatialToGlobal(f,w);m.p.min(d.lower,d.lower,f);m.p.max(d.upper,d.upper,f)}c.setReady(!0);return c}q(h,c);b(h,[{key:"initializeShader",value:function(){if(this.shaderUpdated){this.shaderUpdated=!1;try{var a=this.getShader();this.disposeShader();this.shader=a;this.shaderError.value=null}catch(d){this.shaderError.value=d}}}},{key:"disposeShader",value:function(){this.shader&&(this.shader.dispose(),this.shader=void 0)}},{key:"disposed",value:function(){l(h.prototype.__proto__||
Object.getPrototypeOf(h.prototype),"disposed",this).call(this);this.disposeShader()}},{key:"getShaderKey",value:function(){return""}},{key:"getShader",value:function(){var a=this,b=this.getShaderKey();return this.gl.memoize.get(b,function(){return a.buildShader()})}},{key:"buildShader",value:function(){var b=new a.a(this.gl);this.defineShader(b);return b.build()}},{key:"setGLBlendMode",value:function(a,b){0<b&&(a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA))}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}]);
return h}(n.e)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,
writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return h});e.e=function(a,b,d,c){d=void 0===d?a.RGBA:d;c=void 0===c?a.UNSIGNED_BYTE:c;for(var g=[],h=0;h<b;++h)g[h]=new f(a,d,c);return g};c.d(e,"b",function(){return y});c.d(e,"c",function(){return G});n=c(0);var a=c(1),b=c(19),l=c(54),w=c(40),u=c(77),p=function B(a,b,d){null===a&&(a=Function.prototype);var c=Object.getOwnPropertyDescriptor(a,b);if(void 0===c){if(a=Object.getPrototypeOf(a),
null!==a)return B(a,b,d)}else{if("value"in c)return c.value;b=c.get;return void 0===b?void 0:b.call(d)}},k=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}();c=function(a){function b(){q(this,b);var a=m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments));a.width=Number.NaN;a.height=Number.NaN;
return a}r(b,a);k(b,[{key:"hasSize",value:function(a,b){return this.width===a&&this.height===b}},{key:"resize",value:function(a,b){this.hasSize(a,b)||(this.width=a,this.height=b,this.performResize())}}]);return b}(n.a);var h=function(a){function b(a,d){d=void 0===d?!1:d;q(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,d?a.DEPTH_STENCIL:a.DEPTH_COMPONENT16));c.gl=a;c.includeStencilBuffer=d;return c}r(b,a);k(b,[{key:"attachToFramebuffer",value:function(){var a=this.gl;p(b.prototype.__proto__||
Object.getPrototypeOf(b.prototype),"attachToFramebuffer",this).call(this,this.includeStencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT)}}]);return b}(function(a){function b(a,d){q(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.gl=a;c.internalformat=d;c.renderbuffer=null;c.renderbuffer=a.createRenderbuffer();return c}r(b,a);k(b,[{key:"performResize",value:function(){var a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,this.renderbuffer);a.renderbufferStorage(a.RENDERBUFFER,
this.internalformat,this.width,this.height);a.bindRenderbuffer(a.RENDERBUFFER,null)}},{key:"disposed",value:function(){this.gl.deleteRenderbuffer(this.renderbuffer)}},{key:"attachToFramebuffer",value:function(a){var b=this.gl;b.framebufferRenderbuffer(b.FRAMEBUFFER,a,b.RENDERBUFFER,this.renderbuffer)}}]);return b}(c)),g=function(a){function b(a){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,!0))}r(b,a);return b}(h);e.d=g;var d=function(a){function b(a){q(this,b);var d=
m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));d.gl=a;d.framebuffer=d.gl.createFramebuffer();return d}r(b,a);k(b,[{key:"disposed",value:function(){this.gl.deleteFramebuffer(this.framebuffer)}},{key:"bind",value:function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer)}},{key:"unbind",value:function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,null)}}]);return b}(n.a),f=function(a){function b(a,d,c){q(this,b);var f=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));
f.gl=a;f.format=d;f.dataType=c;f.texture=a.createTexture();return f}r(b,a);k(b,[{key:"performResize",value:function(){Object(w.a)(this.gl,this.texture,this.width,this.height,this.format,this.dataType)}},{key:"disposed",value:function(){this.gl.deleteTexture(this.texture)}},{key:"attachToFramebuffer",value:function(a){var b=this.gl;b.framebufferTexture2D(b.FRAMEBUFFER,a,b.TEXTURE_2D,this.texture,0)}}]);return b}(c),v=new Uint8Array(4),y=function(a){function b(a,c){q(this,b);var f=m(this,(b.__proto__||
Object.getPrototypeOf(b)).call(this));f.gl=a;f.width=Number.NaN;f.height=Number.NaN;f.fullAttachmentList=[];f.attachmentVerified=!1;f.singleAttachmentList=[f.gl.COLOR_ATTACHMENT0];var g=void 0===c.framebuffer?new d(a):c.framebuffer,h=c.colorBuffers;c=c.depthBuffer;f.framebuffer=f.registerDisposer(g);f.colorBuffers=h;f.depthBuffer=c;void 0!==c&&f.registerDisposer(c);var e=f.fullAttachmentList;h.forEach(function(b,d){f.registerDisposer(b);e[d]=a.COLOR_ATTACHMENT0+d});return f}r(b,a);k(b,[{key:"hasSize",
value:function(a,b){return this.width===a&&this.height===b}},{key:"bind",value:function(a,b){this.width=a;this.height=b;this.framebuffer.bind();var d=this.gl,c=this.depthBuffer;void 0!==c&&(c.resize(a,b),c.attachToFramebuffer());this.colorBuffers.forEach(function(c,f){c.resize(a,b);c.attachToFramebuffer(d.COLOR_ATTACHMENT0+f)});d.WEBGL_draw_buffers.drawBuffersWEBGL(this.fullAttachmentList);this.verifyAttachment();d.viewport(0,0,a,b)}},{key:"bindSingle",value:function(a){var b=this.gl;this.framebuffer.bind();
0!==a&&b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0+a,b.TEXTURE_2D,null,0);b.bindTexture(b.TEXTURE_2D,null);this.colorBuffers[a].attachToFramebuffer(b.COLOR_ATTACHMENT0);b.WEBGL_draw_buffers.drawBuffersWEBGL(this.singleAttachmentList)}},{key:"unbind",value:function(){this.framebuffer.unbind()}},{key:"readPixel",value:function(a,b,d){var c=this.gl;try{this.bindSingle(a),c.readPixels(b,d,1,1,c.RGBA,c.UNSIGNED_BYTE,v)}finally{this.framebuffer.unbind()}return v}},{key:"readPixelAsUint32",
value:function(a,b,d){a=this.readPixel(a,b,d);return a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24)}},{key:"verifyAttachment",value:function(){if(!this.attachmentVerified){var a=this.gl;if(a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE)throw Error("Framebuffer configuration not supported");this.attachmentVerified=!0}}}]);return b}(n.a),G=function(d){function c(a,b){q(this,c);var d=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));d.gl=a;d.shader=b;d.copyVertexPositionsBuffer=Object(l.a)(d.gl);
d.copyTexCoordsBuffer=Object(l.a)(d.gl,0,0,1,1);d.registerDisposer(b);return d}r(c,d);k(c,[{key:"draw",value:function(b){for(var d=[],c=0;c<arguments.length;++c)d[c-0]=arguments[c];c=this.gl;var f=this.shader;f.bind();for(var g=d.length,h=0;h<g;++h)c.activeTexture(c.TEXTURE0+h),c.bindTexture(c.TEXTURE_2D,d[h]);c.uniformMatrix4fv(f.uniform("uProjectionMatrix"),!1,a.d);d=f.attribute("aVertexPosition");this.copyVertexPositionsBuffer.bindToVertexAttrib(d,2);f=f.attribute("aTexCoord");this.copyTexCoordsBuffer.bindToVertexAttrib(f,
2);c.drawArrays(c.TRIANGLE_FAN,0,4);c.disableVertexAttribArray(d);c.disableVertexAttribArray(f);for(d=0;d<g;++d)c.activeTexture(c.TEXTURE0+d),c.bindTexture(c.TEXTURE_2D,null)}}],[{key:"get",value:function(a,d,f){d=void 0===d?u.a:d;f=void 0===f?1:f;return a.memoize.get("OffscreenCopyHelper:"+f+":"+Object(b.a)(d),function(){return new c(a,Object(u.b)(a,d,f))})}}]);return c}(n.a)},function(n,e,c){e.a=function(a,b,c,e,u){b=void 0===b?-1:b;c=void 0===c?-1:c;e=void 0===e?1:e;u=void 0===u?1:u;return a.memoize.get("SquareCornersBuffer:"+
b+","+c+","+e+","+u,function(){return new q.b(m.a.fromData(a,new Float32Array([b,c,b,u,e,u,e,c]),r.a,r.k))}).value};var q=c(0),m=c(17),r=c(20)},function(n,e){n.exports="\n\nvec3 colormapJet(float x) {\n  vec3 result;\n  result.r = x < 0.89 ? ((x - 0.35) / 0.31) : (1.0 - (x - 0.89) / 0.11 * 0.5);\n  result.g = x < 0.64 ? ((x - 0.125) * 4.0) : (1.0 - (x - 0.64) / 0.27);\n  result.b = x < 0.34 ? (0.5 + x * 0.5 / 0.11) : (1.0 - (x - 0.34) / 0.31);\n  return clamp(result, 0.0, 1.0);\n}\n"},function(n,
e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"c",function(){return b});c.d(e,"b",function(){return l});var m=c(39),r=c(1),a=function(){function a(a,b){for(var c=0;c<b.length;c++){var h=b[c];h.enumerable=h.enumerable||!1;
h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(a,h.key,h)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),b;(function(a){a[a.LINE=0]="LINE";a[a.POINT=1]="POINT"})(b||(b={}));var l=function(b){function c(a){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");a=(c.__proto__||Object.getPrototypeOf(c)).call(this,a);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&
"function"!==typeof a?this:a}q(c,b);a(c,[{key:"toObject",value:function(){return{transform:this.chunkLayout.transform,chunkDataSize:this.chunkDataSize,voxelSize:this.voxelSize,lowerVoxelBound:this.lowerVoxelBound,upperVoxelBound:this.upperVoxelBound,lowerClipBound:this.lowerClipBound,upperClipBound:this.upperClipBound,baseVoxelOffset:this.baseVoxelOffset}}}],[{key:"make",value:function(a){return new c(Object.assign({},a,{transform:Object(m.e)(a.transform,a.vectorGraphicsSourceOptions)}))}},{key:"fromObject",
value:function(a){return new c(a)}},{key:"withDefaults",value:function(a){var b=a.transform,h=a.lowerVoxelBound,g=a.upperVoxelBound,d=a.chunkDataSize;b=Object(m.e)(b,a.vectorGraphicsSourceOptions);if(void 0===d&&(d=r.p.clone(g),void 0!==h))for(g=0;3>g;g++)d[g]+=Math.abs(h[g]);console.log(d);console.log(a);return new c(Object.assign({},a,{transform:b,chunkDataSize:d}))}}]);return c}(m.c);e.a="vectorgraphics/RenderLayer"},function(n,e,c){c.d(e,"a",function(){return b});var q=c(1),m=c(2),r=c(3),a=function(){function a(a,
b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),b=function(){function b(a){a=void 0===a?q.j.create():a;if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.transform=a;this.changed=new r.a}a(b,[{key:"reset",value:function(){q.j.copy(this.transform,q.d);this.changed.dispatch()}},{key:"toJSON",value:function(){if(!q.j.equals(q.d,
this.transform)){var a=this.transform;return[[a[0],a[4],a[8],a[12]],[a[1],a[5],a[9],a[13]],[a[2],a[6],a[10],a[14]],[a[3],a[7],a[11],a[15]]]}}},{key:"restoreState",value:function(a){if(null==a)this.reset();else if(Array.isArray(a))if(4===a.length)try{for(var b=0;4>b;++b)Object(m.b)(this.transform.subarray(4*b,4*(b+1)),a[b]);q.j.transpose(this.transform,this.transform)}catch(h){this.reset()}else if(16===a.length)try{Object(m.b)(this.transform,a),q.j.transpose(this.transform,this.transform)}catch(h){this.reset()}else this.reset();
else if("object"===typeof a){b=q.l.create();var c=q.p.create(),e=q.p.fromValues(1,1,1);try{Object(m.b)(b,a.rotation),q.l.normalize(b,b)}catch(h){q.l.identity(b)}try{Object(m.b)(c,a.translation)}catch(h){q.p.copy(c,q.h)}try{Object(m.b)(e,a.scale)}catch(h){q.p.copy(e,q.g)}q.j.fromRotationTranslationScale(this.transform,b,c,e);this.changed.dispatch()}else this.reset()}},{key:"clone",value:function(){return new b(q.j.clone(this.transform))}}]);return b}()},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return l});n=c(0);var r=c(5),a=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=
e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),b=function u(a,b,c){null===a&&(a=Function.prototype);var g=Object.getOwnPropertyDescriptor(a,b);if(void 0===g){if(a=Object.getPrototypeOf(a),null!==a)return u(a,b,c)}else{if("value"in g)return g.value;b=g.get;return void 0===b?void 0:b.call(c)}};c(167);var l=function(c){function e(a,b){var c=void 0===b?{}:b;b=void 0===c.min?0:c.min;var d=
void 0===c.max?1:c.max;c=void 0===c.step?.01:c.step;if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var f=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));f.value=a;f.element=document.createElement("label");f.promptElement=document.createElement("span");f.inputElement=document.createElement("input");var h=f.element,k=f.promptElement,l=f.inputElement;h.className="range-slider";k.className="range-prompt";l.type="range";l.min=""+b;l.max=""+d;l.step=""+c;l.valueAsNumber=
f.value.value;h.appendChild(k);h.appendChild(l);var p=function(){f.value.value=f.inputElement.valueAsNumber};f.registerEventListener(l,"change",p);f.registerEventListener(l,"input",p);f.registerEventListener(l,"wheel",function(a){a=a.deltaY;0<a?(f.inputElement.stepUp(),p()):0>a&&(f.inputElement.stepDown(),p())});a.changed.add(function(){f.inputElement.valueAsNumber=f.value.value});return f}m(e,c);a(e,[{key:"disposed",value:function(){Object(r.b)(this.element);b(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),
"disposed",this).call(this)}}]);return e}(n.a)},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return u});n=c(168);c.n(n);n=c(96);var r=c.n(n);n=c(13);var a=c.n(n);n=c(0);var b=c(5),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,g){c&&a(b.prototype,c);g&&a(b,g);return b}}(),w=function k(a,b,d){null===a&&(a=Function.prototype);var c=Object.getOwnPropertyDescriptor(a,b);if(void 0===
c){if(a=Object.getPrototypeOf(a),null!==a)return k(a,b,d)}else{if("value"in c)return c.value;b=c.get;return void 0===b?void 0:b.call(d)}};c(169);c(170);c(171);c(172)(r.a);var u=function(c){function e(b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var d=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));d.state=b;d.changingValue=!1;d.debouncedValueUpdater=a()(function(){d.changingValue=!0;try{d.state.fragmentMain.value=d.textEditor.getValue()}finally{d.changingValue=
!1}},500);d.textEditor=r()(function(a){},{value:d.state.fragmentMain.value,mode:"glsl",gutters:["CodeMirror-lint-markers"]});d.textEditor.on("change",function(){d.setValidState(void 0);d.debouncedValueUpdater()});d.registerDisposer(d.state.fragmentMain.changed.add(function(){d.changingValue||d.textEditor.setValue(d.state.fragmentMain.value)}));d.element.classList.add("neuroglancer-shader-code-widget");d.registerDisposer(d.state.shaderError.changed.add(function(){d.updateErrorState()}));d.updateErrorState();
return d}m(e,c);l(e,[{key:"updateErrorState",value:function(){var a=this,b=this.state.shaderError.value;void 0===b?this.setValidState(void 0):null!==b?(this.textEditor.setOption("lint",{getAnnotations:function(){if("ShaderCompilationError"===b.name){var d=b.source.split("\n").indexOf(a.state.fragmentMainStartLine)+2;return b.errorMessages.map(function(a){return{message:a.message,severity:"error",from:r.a.Pos(void 0===a.line?0:a.line-d)}})}return"ShaderLinkError"===b.name?[{message:b.log,severity:"error",
from:r.a.Pos(0)}]:[{message:b.message,severity:"error",from:r.a.Pos(0)}]}}),this.setValidState(!1)):(this.textEditor.setOption("lint",void 0),this.setValidState(!0))}},{key:"setValidState",value:function(a){var b=this.element;b.classList.remove("invalid-input");b.classList.remove("valid-input");!0===a?b.classList.add("valid-input"):!1===a&&b.classList.add("invalid-input")}},{key:"disposed",value:function(){this.debouncedValueUpdater.flush();this.debouncedValueUpdater=void 0;Object(b.b)(this.element);
this.textEditor=void 0;w(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}},{key:"element",get:function(){return this.textEditor.getWrapperElement()}}]);return e}(n.a)},function(n,e){},function(n,e,c){c.d(e,"a",function(){return m});var q=function(){function c(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,b,e){b&&c(a.prototype,b);e&&c(a,
e);return a}}();e.b=4093;var m=function(){function c(a,b,e,w){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this.a0=a;this.a1=b;this.b=e;this.c=w}q(c,[{key:"computeDotProduct",value:function(a,b){var c=this.a0,e=this.a1;return c[0]*(a&255)+c[1]*(a>>8&255)+c[2]*(a>>16&255)+c[3]*(a>>24&255)+(e[0]*(b&255)+e[1]*(b>>8&255)+e[2]*(b>>16&255)+e[3]*(b>>24&255))}},{key:"compute",value:function(a,b){var c=this.b,e=this.c;a=this.computeDotProduct(a,b);return(a+a*a%4093*e+c)%
4093}},{key:"toString",value:function(){return"new HashFunction(Float32Array.of("+this.a0+"), "+("Float32Array.of("+this.a1+"), "+this.b+", "+this.c+")")}}],[{key:"generate",value:function(){function a(){return Math.floor(4093*Math.random())}return new c(Float32Array.of(a(),a(),a(),a()),Float32Array.of(a(),a(),a(),a()),a(),a())}}]);return c}()},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&
"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(e,"b",function(){return g});c.d(e,"a",function(){return G});
var a=c(61),b=c(11),l=function B(a,b,d){null===a&&(a=Function.prototype);var c=Object.getOwnPropertyDescriptor(a,b);if(void 0===c){if(a=Object.getPrototypeOf(a),null!==a)return B(a,b,d)}else{if("value"in c)return c.value;b=c.get;return void 0===b?void 0:b.call(d)}},w=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}();
e.c=3;var u=0,p=0,k=0,h=0;n=function(){function d(a){a=void 0===a?d.generateHashFunctions(3):a;r(this,d);this.loadFactor=.9;this.size=0;this.growFactor=1.2;this.maxHeight=8192;this.emptyHigh=this.emptyLow=4294967295;this.maxAttempts=this.maxRehashAttempts=5;this.maxWidth=4096/this.entryStride;this.generation=0;this.mungedEmptyKey=-1;this.hashFunctions=a;this.allocate(4,1)}w(d,[{key:"updateHashFunctions",value:function(a){this.hashFunctions=d.generateHashFunctions(a);this.mungedEmptyKey=-1}},{key:"tableWithMungedEmptyKey",
value:function(a){for(var b=this.hashFunctions.length,d=Array(b),c=0;c<b;++c)d[c]=this.getHash(c,this.emptyLow,this.emptyHigh);c=this.mungedEmptyKey;if(-1===c)a:for(;;){c=16777216*Math.random()>>>0;for(var f=0;f<b;++f)for(var g=this.getHash(f,c,c),e=0;e<b;++e)if(d[e]===g)continue a;this.mungedEmptyKey=c;break}f=this.table;g=this.emptyLow;e=this.emptyHigh;for(var h=0;h<b;++h){var v=d[h];f[v]===g&&f[v+1]===e&&(f[v]=c,f[v+1]=c)}try{a(f)}finally{for(a=0;a<b;++a)h=d[a],f[h]===c&&f[h+1]===c&&(f[h]=g,f[h+
1]=e)}}},{key:"getHash",value:function(a,b,d){a=this.hashFunctions[a];var c=this.width,f=this.height;c=a[0].compute(b,d)%c;b=a[1].compute(b,d)%f;return this.entryStride*(b*this.width+c)}},{key:"keys",value:function(a){function d(d,x){for(;;)switch(c){case 0:a=void 0===a?new b.a:a,p=u,w=p.emptyLow,y=p.emptyHigh,l=p.entryStride,k=u,v=k.table,h=0,e=v.length;case 1:if(!(h<e)){c=3;break}g=v[h];f=v[h+1];if(g===w&&f===y){c=4;break}a.low=g;a.high=f;c=5;return{value:a,done:!1};case 5:if(void 0===x){c=6;break}c=
-1;throw x;case 6:case 4:case 2:h+=l;c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,f,g,e,h,v,k,l,y,w,p,u=this,z={next:function(a){return d(a,void 0)},throw:function(a){return d(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();z[Symbol.iterator]=function(){return this};return z}},{key:"indexOfPair",value:function(a,b){var d=this.table,c=this.emptyHigh;if(a===this.emptyLow&&b===c)return-1;c=0;for(var f=this.hashFunctions.length;c<
f;++c){var g=this.getHash(c,a,b);if(d[g]===a&&d[g+1]===b)return g}return-1}},{key:"indexOf",value:function(a){return this.indexOfPair(a.low,a.high)}},{key:"chooseAnotherEmptyKey",value:function(){for(var a=this.emptyLow,b=this.emptyHigh,d=this.table,c=this.entryStride,f,g;f=4294967296*Math.random()>>>0,g=4294967296*Math.random()>>>0,f===a&&g===b||this.hasPair(f,g););this.emptyLow=f;this.emptyHigh=g;for(var e=0,h=d.length;e<h;e+=c)d[e]===a&&d[e+1]===b&&(d[e]=f,d[e+1]=g)}},{key:"has",value:function(a){return-1!==
this.indexOf(a)}},{key:"hasPair",value:function(a,b){return-1!==this.indexOfPair(a,b)}},{key:"delete",value:function(a){a=this.indexOf(a);if(-1!==a){var b=this.table;b[a]=this.emptyLow;b[a+1]=this.emptyHigh;++this.generation;this.size--;return!0}return!1}},{key:"clearTable",value:function(){for(var a=this.table,b=this.entryStride,d=this.emptyLow,c=this.emptyHigh,f=a.length,g=0;g<f;g+=b)a[g]=d,a[g+1]=c}},{key:"clear",value:function(){if(0===this.size)return!1;this.size=0;++this.generation;this.clearTable();
return!0}},{key:"swapPending",value:function(a,b){var d=u,c=p;this.storePending(a,b);a[b]=d;a[b+1]=c}},{key:"storePending",value:function(a,b){u=a[b];p=a[b+1]}},{key:"backupPending",value:function(){k=u;h=p}},{key:"restorePending",value:function(){u=k;p=h}},{key:"tryToInsert",value:function(){for(var a=0,b=this.emptyLow,d=this.emptyHigh,c=this.maxAttempts,f=this.table,g=this.hashFunctions.length,e=Math.floor(Math.random()*g);;){var h=this.getHash(e,u,p);this.swapPending(f,h);if(u===b&&p===d)return!0;
if(++a===c)break;e=(e+Math.floor(Math.random()*(g-1))+1)%g}return!1}},{key:"allocate",value:function(a,b){var d=a*b;this.width=a;this.height=b;this.table=new Uint32Array(d*this.entryStride);this.maxAttempts=d;this.clearTable();this.capacity=d*this.loadFactor;this.mungedEmptyKey=-1}},{key:"rehash",value:function(a,b,d){this.allocate(b,d);this.updateHashFunctions(this.hashFunctions.length);b=this.emptyLow;d=this.emptyHigh;for(var c=this.entryStride,f=0,g=a.length;f<g;f+=c){var e=a[f+1];if(a[f]!==b||
e!==d)if(this.storePending(a,f),!this.tryToInsert())return!1}return!0}},{key:"grow",value:function(a){for(var b=this.table,d=this.width,c=this.height,f=this.maxWidth,g=this.maxHeight;;){var e=d*c;d=Math.min(f,Math.ceil(a/this.height));d*c<a&&(c=Math.min(g,Math.ceil(a/d)));var h=d*c;if(h<a&&h===e)throw Error("Maximum table size exceeded");for(e=0;e<this.maxRehashAttempts;++e)if(this.rehash(b,d,c))return;a=Math.ceil(this.growFactor*a)}}},{key:"insertInternal",value:function(){++this.generation;u===
this.emptyLow&&p===this.emptyHigh&&this.chooseAnotherEmptyKey();++this.size>this.capacity&&(this.backupPending(),this.grow(Math.ceil(this.growFactor*this.width*this.height)),this.restorePending());for(;!this.tryToInsert();)this.backupPending(),this.grow(this.width*this.height),this.restorePending()}}],[{key:"generateHashFunctions",value:function(b){b=void 0===b?3:b;for(var d=[],c=0;c<b;++c){var f=[a.a.generate(),a.a.generate()];d.push(f)}return d}}]);return d}();var g=function(a){function b(){r(this,
b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}m(b,a);$jscomp.initSymbol();$jscomp.initSymbolIterator();w(b,[{key:"add",value:function(a){var b=a.low;a=a.high;if(this.hasPair(b,a))return!1;u=b;p=a;this.insertInternal();return!0}},{key:Symbol.iterator,value:function(){return this.keys()}}]);return b}(n);g.prototype.entryStride=2;var d=0,f=0,v=0,y=0,G=function(a){function c(){r(this,c);return q(this,(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments))}m(c,
a);$jscomp.initSymbol();$jscomp.initSymbolIterator();w(c,[{key:"set",value:function(a,b){var c=a.low;a=a.high;if(this.hasPair(c,a))return!1;u=c;p=a;d=b.low;f=b.high;this.insertInternal();return!0}},{key:"get",value:function(a,b){a=this.indexOf(a);if(-1===a)return!1;var d=this.table;b.low=d[a+2];b.high=d[a+3];return!0}},{key:"swapPending",value:function(a,b){var g=d,e=f;l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"swapPending",this).call(this,a,b);a[b+2]=g;a[b+3]=e}},{key:"storePending",
value:function(a,b){l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"storePending",this).call(this,a,b);d=a[b+2];f=a[b+3]}},{key:"backupPending",value:function(){l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"backupPending",this).call(this);v=d;y=f}},{key:"restorePending",value:function(){l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"restorePending",this).call(this);d=v;f=y}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(a){function d(d,
x){for(;;)switch(c){case 0:a=void 0===a?[new b.a,new b.a]:a,G=m,D=G.emptyLow,u=G.emptyHigh,w=G.entryStride,p=m,y=p.table,l=$jscomp.makeIterator(a),k=l.next().value,v=l.next().value,h=0,e=y.length;case 1:if(!(h<e)){c=3;break}g=y[h];f=y[h+1];if(g===D&&f===u){c=4;break}k.low=g;k.high=f;v.low=y[h+2];v.high=y[h+3];c=5;return{value:a,done:!1};case 5:if(void 0===x){c=6;break}c=-1;throw x;case 6:case 4:case 2:h+=w;c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,f,g,e,h,v,k,l,y,p,w,u,D,
G,m=this,q={next:function(a){return d(a,void 0)},throw:function(a){return d(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();q[Symbol.iterator]=function(){return this};return q}}]);return c}(n);G.prototype.entryStride=4},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b,c){c=Math.ceil(c/b);a.dataWidth=b;a.textureHeight=c;a.textureAccessCoefficients=Float32Array.of(1/b,1/(b*c),
b)}c.d(e,"b",function(){return p});e.c=function(d,c,g){g=void 0===g?1:g;switch(c){case a.b.UINT8:if(1>g||4<g)break;d.texelsPerElement=1;d.textureFormat=k[g];d.texelType=b.t;d.arrayElementsPerTexel=g;d.arrayConstructor=Uint8Array;return d;case a.b.UINT16:if(1>g||2<g)break;d.texelsPerElement=1;d.textureFormat=k[2*g];d.texelType=b.t;d.arrayElementsPerTexel=2*g;d.arrayConstructor=Uint8Array;return d;case a.b.UINT64:if(1!==g)break;d.texelsPerElement=2;d.textureFormat=b.j;d.texelType=b.t;d.arrayElementsPerTexel=
4;d.arrayConstructor=Uint8Array;return d;case a.b.UINT32:if(1!==g)break;d.texelsPerElement=1;d.textureFormat=b.j;d.texelType=b.t;d.arrayElementsPerTexel=4;d.arrayConstructor=Uint8Array;return d;case a.b.FLOAT32:if(!(1>g||4<g))return d.texelsPerElement=1,d.textureFormat=k[g],d.texelType=b.c,d.arrayElementsPerTexel=g,d.arrayConstructor=Float32Array,d}throw Error("No supported texture format for "+a.b[c]+"["+g+"].");};e.e=function(a,b,c,g,e,h){b=b.maxTextureSize;var d=g*e*h;if(!(c*g<=b&&e*h<=b))if(c*
g*e<=b&&h<=b)g*=e;else if(g=Math.ceil(d/b),g*c>b)throw Error("Chunk data size exceeds maximum texture size: "+c+" * "+d);m(a,g,d)};e.d=function(a,b,c,g){b=b.maxTextureSize;var d=Math.ceil(g/b);if(d*c>b)throw Error("Number of elements exceeds maximum texture size: "+c+" * "+g);m(a,d,g)};e.f=function(a,c,g,e){var d=g.arrayConstructor,f=g.textureFormat,h=g.texelsPerElement,k=c.dataWidth;c=c.textureHeight;var v=k*c*g.arrayElementsPerTexel*h;e.constructor!==d&&(e=new d(e.buffer,e.byteOffset,e.byteLength/
d.BYTES_PER_ELEMENT));e=Object(r.a)(e,v);a.pixelStorei(b.r,1);Object(w.b)(a);a.texImage2D(a.TEXTURE_2D,0,f,k*h,c,0,f,g.texelType,e)};c.d(e,"a",function(){return g});var r=c(82),a=c(27),b=c(20),l=c(7),w=c(40),u=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}(),p=function f(){q(this,f)},k=[-1,b.f,b.g,b.i,b.j],
h=["","r","ra","rgb","rgba"],g=function(){function b(a){q(this,b);this.key=a;this.uniformName="uTextureAccessCoefficients_"+this.key;this.readTextureValue="readTextureValue_"+this.key}u(b,[{key:"defineShader",value:function(a){a.addUniform("highp vec3",this.uniformName)}},{key:"getReadTextureValueCode",value:function(a){for(var b=this.uniformName,c="\nvoid "+this.readTextureValue+"(highp sampler2D sampler, float index",f=0;f<a;++f)c+=", out vec4 output"+f;c+=") {\n  float offset = "+.5/a+";\n  float xCoord = fract((index + offset) * "+
b+".x);\n  vec2 texCoords = vec2(xCoord,\n                        (index - (xCoord - 0.5 - offset * "+b+".x) * "+b+".z) *\n                        "+b+".y);\n";for(f=0;f<a;++f)c+="\n  output"+f+" = texture2D(sampler,\n                        vec2(texCoords.x +\n                             "+b+".x * "+(f/a).toFixed(8)+",\n                             texCoords.y));\n";return c+"\n}\n"}},{key:"getAccessor",value:function(b,c,f,g){g=void 0===g?1:g;var e=Object(l.a)(f,g),k=[];k.push(this.getReadTextureValueCode(f===
a.b.UINT64?2:1));b="\n"+e+" "+b+"(float index) {\n";switch(f){case a.b.UINT8:k.push(l.m);b+="\n  "+e+" result;\n  vec4 temp;\n  "+this.readTextureValue+"("+c+", index, temp);\n  result.value = temp."+h[g]+";\n  return result;\n";break;case a.b.UINT16:k.push(l.j);b+="\n  "+e+" result;\n  vec4 temp;\n  "+this.readTextureValue+"("+c+", index, temp);\n  result.value = temp."+h[2*g]+";\n  return result;\n";break;case a.b.UINT32:k.push(l.k);b+="\n  "+e+" result;\n  "+this.readTextureValue+"("+c+", index, result.value);\n  return result;\n";
break;case a.b.UINT64:k.push(l.l);b+="\n  "+e+" result;\n  "+this.readTextureValue+"("+c+", index, result.low, result.high);\n  return result;\n";break;case a.b.FLOAT32:k.push(l.e),b+="\n  vec4 temp;\n  "+this.readTextureValue+"("+c+", index, temp);\n  return temp."+h[g]+";\n"}k.push(b+"\n}\n");return k}},{key:"setupTextureLayout",value:function(a,b,c){a.uniform3fv(b.uniform(this.uniformName),c.textureAccessCoefficients)}}]);return b}()},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==
b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function m(a,b){var c=document.documentElement.scrollTop+Math.min(document.documentElement.clientHeight-a.offsetHeight,b.clientY);a.style.left=document.documentElement.scrollLeft+Math.min(document.documentElement.clientWidth-a.offsetWidth,
b.clientX)+"px";a.style.top=c+"px";a.style.visibility=null}c.d(e,"a",function(){return w});var r=c(0),a=c(5),b=c(3),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}();c(227);var w=function(c){function e(a){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var c=(e.__proto__||
Object.getPrototypeOf(e)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c.element=document.createElement("div");c.parentDisposers=new Map;c.disabledValue=!1;c.opened=new b.a;c.closed=new b.a;var g=c.element;g.className="neuroglancer-context-menu";g.style.visibility="hidden";g.tabIndex=-1;document.body.appendChild(g);void 0!==a&&c.registerParent(a);return c}q(e,c);l(e,[{key:"registerParent",
value:function(a){var b=this,c=this.parentDisposers;c.has(a)||c.set(a,Object(r.c)(a,"contextmenu",function(a){b.show(a);a.stopPropagation();a.preventDefault()}))}},{key:"show",value:function(a){var b=this;if(!this.disabledValue){this.hide();var c=this.element,d=Object(r.c)(document,"mousedown",function(a){a.target instanceof Node&&!c.contains(a.target)&&b.hide()},!0),f=Object(r.c)(document,"keydown",function(a){"Escape"===a.code&&b.hide()},!0);c.style.display=null;c.style.visibility="hidden";this.opened.dispatch();
m(c,a);this.menuDisposer=function(){f();d();c.style.display="none"}}}},{key:"unregisterParent",value:function(a){var b=this.parentDisposers,c=b.get(a);void 0!==c&&(c(),b.delete(a))}},{key:"disposed",value:function(){for(var b=this.parentDisposers,c=$jscomp.makeIterator(b.values()),g=c.next();!g.done;g=c.next())g=g.value,g();b.clear();Object(a.b)(this.element)}},{key:"hide",value:function(){void 0!==this.menuDisposer&&(this.menuDisposer(),this.menuDisposer=void 0,this.closed.dispatch())}},{key:"disabled",
get:function(){return this.disabledValue},set:function(a){this.disabledValue!==a&&(this.disabledValue=a)&&this.hide()}},{key:"open",get:function(){return void 0!==this.menuDisposer}}]);return e}(r.a)},function(n,e,c){function q(a){return Object(b.a)(a.dataTransfer.types,"neuroglancer-layer\x00")}function m(a){if(void 0!==u&&u.manager.rootLayers===a.rootLayers)return u}function r(a,b,c){if(a.shiftKey)return"copy";if(a.ctrlKey)return"move";a=void 0===c?!1:c;a=void 0===a?!1:a;c=m(b);b=void 0===c?"copy":
a||c.manager!==b?"link":"move";return b}e.e=function(a,c){a.dataTransfer.setData(Object(b.b)("neuroglancer-layer\x00",c.layers.map(function(a){return{name:a.name,visible:a.visible}})),JSON.stringify(c.layers.map(function(a){return a.toJSON()})));void 0!==u&&u.disposer();var g,d=function(){c.manager.unregisterDisposer(d);for(var a=$jscomp.makeIterator(c.layers),b=a.next();!b.done;b=a.next())b.value.dispose();c.manager.dispose();u===g&&(u=void 0)};u=g={manager:c.manager.addRef(),layers:c.layers.map(function(a){return a.addRef()}),
disposer:d}};e.a=function(a){if(void 0!==u){if(a&&"move"===a.dataTransfer.dropEffect){var b=new Set(u.layers);u.manager.layerManager.filter(function(a){return!b.has(a)})}u.disposer()}};e.c=q;e.d=r;e.f=function(a,c,g){return Object(b.e)(a,r(a,c,void 0===g?!1:g))};e.b=function(b,c,g,d,f){var e=m(c),h=!f&&void 0!==e&&e.manager===c;if(!g&&void 0!==e){var k=new p;k.manager=c;k.numSourceLayers=e.layers.length;k.sourceManager=e.manager;k.moveSupported=h;k.layers=new Map;if(!f&&e.manager===c)if(d)e.layers.forEach(function(a,
b){k.layers.set(a,b)});else return;e.layers.forEach(function(a,b){!f&&c.layerManager.has(a)||k.layers.set(a.addRef(),b)});return k}b=q(b);if(void 0!==b)try{var w=Object(l.a)(b.parameters,function(b,d){var f=Object(l.w)(b,"name",l.B);b=Object(l.w)(b,"visible",l.m);f=new a.b(f,null,c);f.visible=b;return[f,d]}),u=new p;u.numSourceLayers=w.length;u.moveSupported=h;u.manager=c;u.dragType=b.dragType;u.layers=new Map(w);return u}catch(z){}};var a=c(9),b=c(66),l=c(2),w=function(){function a(a,b){for(var d=
0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),u,p=function(){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");}w(a,[{key:"finalize",value:function(a){var b=this.dragType;if(void 0!==b)try{var d=JSON.parse(a.dataTransfer.getData(b));if(!Array.isArray(d)||this.numSourceLayers!==d.length)throw Error("Invalid layer drop data");
for(var c=$jscomp.makeIterator(this.layers),e=c.next();!e.done;e=c.next()){var h=$jscomp.makeIterator(e.value),k=h.next().value,l=h.next().value;this.manager.initializeLayerFromSpec(k,d[l])}}catch(B){return!1}return!0}},{key:"compatibleWithMethod",value:function(a){return this.method===a||!this.moveSupported&&"move"===a?!0:!1}},{key:"method",get:function(){return void 0!==this.sourceManager?this.manager===this.sourceManager?"move":"link":"copy"}}]);return a}()},function(n,e,c){e.b=function(a,b){b=
JSON.stringify(b);b=Object(q.b)((new TextEncoder).encode(b));return a+b};e.a=function(a,b){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){c=c.value;a:{var e=b;if(c.startsWith(e))try{var u=c.substring(e.length);var p=(new TextDecoder).decode(Object(q.a)(u));var k=JSON.parse(p);break a}catch(h){k=void 0;break a}k=void 0}e=k;if(void 0!==e)return{parameters:e,dragType:c}}};e.e=function(a,b){return r=a.dataTransfer.dropEffect=b};e.c=function(){return r};e.d=function(a){a.draggable=!0;
return Object(m.c)(a,"dragstart",function(a){a.stopPropagation();a.preventDefault()})};var q=c(228),m=c(0),r},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"b",function(){return y});c.d(e,"c",function(){return G});c.d(e,"a",function(){return E});var a=c(26),b=c(109),l=c(110);n=c(0);var w=c(5),u=c(15),p=c(1),k=c(34),h=c(81),g=c(84),d=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=
!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}(),f=function z(a,b,d){null===a&&(a=Function.prototype);var c=Object.getOwnPropertyDescriptor(a,b);if(void 0===c){if(a=Object.getPrototypeOf(a),null!==a)return z(a,b,d)}else{if("value"in c)return c.value;b=c.get;return void 0===b?void 0:b.call(d)}};c(229);c(44);e.d="neuroglancer-position";var v=u.a.fromObject({tab:{action:"tab-forward",preventDefault:!1},arrowup:{action:"adjust-up"},arrowdown:{action:"adjust-down"},
wheel:{action:"adjust-via-wheel"},"shift+tab":{action:"tab-backward",preventDefault:!1},backspace:{action:"delete-backward",preventDefault:!1},escape:{action:"cancel"},mouseup0:{action:"select-all-if-was-not-focused",preventDefault:!1}}),y=function(c){function g(d,c){c=void 0===c?6:c;q(this,g);var f=m(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));f.position=d;f.maxNumberWidth=c;f.element=document.createElement("div");f.inputContainer=document.createElement("div");f.inputElement=document.createElement("input");
f.hintElement=document.createElement("input");f.tempPosition=p.p.create();f.updateHintScrollPosition=f.registerCancellable(Object(b.a)(function(){f.hintElement.scrollLeft=f.inputElement.scrollLeft}));var e=f.element,y=f.inputElement,w=f.hintElement,x=f.inputContainer;x.className="neuroglancer-position-widget-input-container";y.className="neuroglancer-position-widget-input";w.className="neuroglancer-position-widget-hint";f.inputFieldWidth=3*c+11;c=$jscomp.makeIterator([y,w]);for(var C=c.next();!C.done;C=
c.next())C=C.value,C.spellcheck=!1,C.autocomplete="off",C.type="text",C.style.width=f.inputFieldWidth+"ch";w.disabled=!0;c=document.createElement("div");c.textContent="\u29c9";c.className="neuroglancer-copy-button neuroglancer-button";c.title="Copy position to clipboard";c.addEventListener("click",function(){var b=Object(l.b)(f.getPositionText());a.a.showTemporaryMessage(b?"Position copied to clipboard":"Failed to copy position to clipboard")});c.addEventListener("dragstart",function(a){a.dataTransfer.setData("neuroglancer-position",
JSON.stringify(d.toJSON()));a.dataTransfer.setData("text",f.getPositionText());a.stopPropagation()});c.draggable=!0;e.appendChild(c);e.appendChild(x);x.appendChild(y);x.appendChild(w);e.className="neuroglancer-position-widget";f.registerDisposer(d.changed.add(f.registerCancellable(Object(b.a)(function(){return f.updateView()}))));f.registerDisposer(new k.b(y,v)).allShortcutsAreGlobal=!0;f.registerDisposer(new h.a(y,v));f.registerEventListener(y,"change",function(){return f.updatePosition()});f.registerEventListener(y,
"blur",function(){return f.updatePosition()});f.registerEventListener(y,"input",function(){return f.cleanInput()});f.registerEventListener(y,"keydown",f.updateHintScrollPosition);f.registerEventListener(y,"copy",function(a){var b=y.value.substring(y.selectionStart,y.selectionEnd);b=b.trim().replace(/\s+/g," ");a.clipboardData.setData("text/plain",b);a.stopPropagation();a.preventDefault()});var D=!1;f.registerEventListener(y,"mousedown",function(){D=document.activeElement===y});f.registerDisposer(Object(u.c)(y,
"select-all-if-was-not-focused",function(a){D||(y.selectionStart=0,y.selectionEnd=y.value.length,y.selectionDirection="forward",a.preventDefault())}));f.registerDisposer(Object(u.c)(y,"tab-forward",function(a){var b=Math.min(y.selectionStart,y.selectionEnd),d=y.value.substring(b).match(/^([^,\s]*)((?:\s+)|(?:\s*,\s*))?([^,\s]*)/);null!==d&&void 0!==d[2]&&(y.selectionStart=b+d[1].length+d[2].length,y.selectionEnd=y.selectionStart+d[3].length,y.selectionDirection="forward",a.preventDefault())}));f.registerDisposer(Object(u.c)(y,
"tab-backward",function(a){var b=y.value.substring(0,Math.max(y.selectionStart,y.selectionEnd)).match(/([^,\s]*)((?:\s+)|(?:\s*,\s*))?([^,\s]*)$/);null!==b&&void 0!==b[2]&&(y.selectionStart=b.index,y.selectionEnd=y.selectionStart+b[1].length,y.selectionDirection="forward",a.preventDefault())}));f.registerDisposer(Object(u.c)(y,"delete-backward",function(a){if(y.selectionStart===y.selectionEnd&&y.selectionStart===y.value.length){var b=y.value.match(/^(.*)(?![\s])(?:(?:\s+)|(?:\s*,\s*))$/);null!==b&&
(y.value=b[1],f.cleanInput(),a.preventDefault())}}));f.registerDisposer(Object(u.c)(y,"cancel",function(){f.updateView();f.inputElement.blur()}));f.registerDisposer(Object(u.c)(y,"adjust-via-wheel",function(a){a=a.detail;var b=a.deltaY;0!==b&&f.adjustFromCursor(Math.ceil((y.scrollLeft+a.offsetX-y.clientLeft)/(y.scrollWidth/f.inputFieldWidth)),-Math.sign(b))}));f.registerDisposer(Object(u.c)(y,"adjust-up",function(){f.adjustFromCursor(void 0,1)}));f.registerDisposer(Object(u.c)(y,"adjust-down",function(){f.adjustFromCursor(void 0,
-1)}));f.updateView();return f}r(g,c);d(g,[{key:"adjustFromCursor",value:function(a,b){var d=this.inputElement;void 0===a&&(a="forward"===d.selectionDirection?d.selectionEnd:d.selectionStart);void 0!==this.cleanInput()&&(a=d.value.substring(0,a).split(",").length-1,this.updatePosition(),d=this.tempPosition,this.position.getVoxelCoordinates(d)&&(d[a]+=b,this.position.setVoxelCoordinates(d),this.updateView()))}},{key:"cleanInput",value:function(){var a=this.inputElement.selectionStart,b=/(-?\d+(?:\.(?:\d+)?)?)/.source,
d=/((?:\s+(?![\s,]))|(?:\s*,\s*))/.source,c=/([\[\]{}()\s]*)/.source;b=this.inputElement.value.match(new RegExp("^"+c+"(?![\\s])"+b+"?"+("(?:"+d+b+"?(?:"+d+b+"?)?)?")+(c+"$")));if(null!==b){var f="  ",g="x ",e=2,h=b[1].length;d=function(b,d,c){if(void 0!==b){var k=h+b.length;void 0===d&&(d=b,c=" ".repeat(d.length));a>=h&&(e=a===k?f.length+d.length:f.length+Math.min(d.length,a-h));f+=d;g+=c;h=k}};d(b[2]);d(b[3],",   ","  y ");d(b[4]);d(b[5],",   ","  z ");d(b[6]);this.hintElement.value=g;this.inputElement.value!==
f&&(this.inputElement.value=f,this.inputElement.selectionEnd=e,this.inputElement.selectionStart=e);this.updateHintScrollPosition();return void 0!==b[2]&&void 0!==b[4]&&void 0!==b[6]?{position:p.p.set(this.tempPosition,parseFloat(b[2]),parseFloat(b[4]),parseFloat(b[6]))}:{}}this.hintElement.value=""}},{key:"updatePosition",value:function(){var a=this.cleanInput();void 0!==a&&void 0!==a.position&&this.position.setVoxelCoordinates(a.position)}},{key:"getPositionText",value:function(){var a=this.tempPosition;
return this.position.getVoxelCoordinates(a)?Math.floor(a[0])+", "+Math.floor(a[1])+", "+Math.floor(a[2]):"<unspecified position>"}},{key:"updateView",value:function(){var a=this.tempPosition;if(this.position.getVoxelCoordinates(a)){var b=this.inputElement;a="  "+Math.floor(a[0])+",   "+Math.floor(a[1])+",   "+Math.floor(a[2]);var d=a.indexOf(","),c=a.indexOf(",",d+1)-d-4;d="x "+" ".repeat(d-2)+"  y "+" ".repeat(c)+"  z";c=b.selectionStart;var f=b.selectionEnd,g=b.selectionDirection;b.value=a;b.setSelectionRange(c,
f,g);this.hintElement.value=d+" ".repeat(a.length-d.length);this.updateHintScrollPosition()}else this.inputElement.value="",this.hintElement.value=""}},{key:"disposed",value:function(){Object(w.b)(this.element);f(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"disposed",this).call(this)}}]);return g}(n.a),G=function(a){function c(a,d){q(this,c);var f=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));f.element=a;f.voxelSize=d;f.dimensionsContainer=document.createElement("span");
f.unitsElement=document.createElement("span");var g=f.dimensionsContainer,e=f.unitsElement;a.className="neuroglancer-voxel-size-widget";a.title="Voxel size";g.className="neuroglancer-voxel-size-dimensions-container";a.appendChild(g);a.appendChild(e);e.className="neuroglancer-voxel-size-units";f.registerDisposer(d.changed.add(f.registerCancellable(Object(b.a)(function(){return f.updateView()}))));f.updateView();return f}r(c,a);d(c,[{key:"updateView",value:function(){var a=this.dimensionsContainer,
b=this.unitsElement;Object(w.a)(a);this.element.style.display=this.voxelSize.valid?null:"none";var d=this.voxelSize.size,c=Object(g.b)(Math.min(d[0],d[1],d[2]));b.textContent=c.unit;for(b=0;3>b;++b){for(var f=d[b]/c.lengthInNanometers,e="",h=0;2>=h&&(e=f.toFixed(h),parseFloat(e)!==f);++h);f=document.createElement("span");f.className="neuroglancer-voxel-size-dimension";f.textContent=e;a.appendChild(f)}}},{key:"disposed",value:function(){Object(w.b)(this.element);f(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),
"disposed",this).call(this)}}]);return c}(n.a),E=function(a){function c(a,d,f){q(this,c);var g=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));g.element=a;g.mouseState=d;g.voxelSize=f;g.tempPosition=p.p.create();a.className="neuroglancer-mouse-position-widget";a=g.registerCancellable(Object(b.a)(function(){return g.updateView()}));g.registerDisposer(d.changed.add(a));g.registerDisposer(f.changed.add(a));return g}r(c,a);d(c,[{key:"updateView",value:function(){var a="",b=this.mouseState,
d=this.voxelSize;b.active&&d.valid&&(a=this.tempPosition,d.voxelFromSpatial(a,b.position),a="x "+Math.floor(a[0])+",  y "+Math.floor(a[1])+",  z "+Math.floor(a[2]));this.element.textContent=a}},{key:"disposed",value:function(){Object(w.b)(this.element);f(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}}]);return c}(n.a)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){var b=a.match(/^([^:?]+:[^:?]+:[^:?]+)(?::([^:?]+))?(?:\?(.*))?$/);if(null===b)throw Error("Invalid Brain Maps volume key: "+
JSON.stringify(a)+".");var d;void 0!==b[2]&&(d={changeStackId:b[2]});a=Object(B.e)(b[3]||"");return{volumeId:b[1],changeSpec:d,parameters:a}}function b(a){try{return Object(B.u)(a),{id:Object(B.w)(a,"id",B.B),label:Object(B.w)(a,"label",B.B),description:Object(B.w)(a,"description",B.z)}}catch(M){throw Error("Failed to parse project: "+M.message);}}function l(a){try{return Object(B.u)(a),Object(B.w)(a,"project",function(a){return void 0===a?[]:Object(B.a)(a,b)})}catch(M){throw Error("Error parsing project list: "+
M.message);}}function w(a){return Object(B.w)(a,"changeStackId",function(a){return void 0===a?void 0:Object(B.a)(a,B.B)})}Object.defineProperty(e,"__esModule",{value:!0});c.d(e,"BrainmapsSkeletonSource",function(){return C});c.d(e,"VolumeInfo",function(){return K});c.d(e,"MeshInfo",function(){return F});c.d(e,"MultiscaleVolumeChunkSource",function(){return T});e.parseVolumeKey=a;c.d(e,"VolumeList",function(){return R});e.parseChangeStackList=w;c.d(e,"BrainmapsDataSource",function(){return W});n=c(10);
var u=c(118),p=c(24),k=c(48),h=c(122),g=c(49),d=c(75),f=c(8),v=c(18),y=c(26),G=c(30),E=c(1),B=c(2),z=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}(),D=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);return b}(Object(n.f)(Object(u.a)()(v.b),
h.d)),x=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);return b}(Object(n.f)(Object(u.a)()(g.b),h.a)),C=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);z(b,[{key:"skeletonVertexCoordinatesInVoxels",get:function(){return!1}}]);return b}(Object(n.f)(Object(u.a)()(d.d),h.b)),H=new Map;H.set("UINT8",f.a.UINT8);H.set("FLOAT",f.a.FLOAT32);H.set("UINT64",f.a.UINT64);
var K=function M(a){q(this,M);try{Object(B.u)(a),this.numChannels=Object(B.A)(a.channelCount),this.dataType=Object(B.t)(a.channelType,H),this.voxelSize=Object(B.f)(E.p.create(),a.pixelSize,B.p),this.upperVoxelBound=Object(B.f)(E.p.create(),a.volumeSize,B.A)}catch(aa){throw Error("Failed to parse BrainMaps volume geometry: "+aa.message);}},F=function Q(a){q(this,Q);Object(B.u)(a);this.name=Object(B.w)(a,"name",B.B);this.type=Object(B.w)(a,"type",B.B)},T=function(){function a(b,d,c,g,e,h,k,v){q(this,
a);this.chunkManager=b;this.instance=d;this.credentialsProvider=c;this.volumeId=g;this.changeSpec=e;this.encoding=v.encoding;try{Object(B.u)(h);var l=this.scales=Object(B.w)(h,"geometry",function(a){return Object(B.a)(a,function(a){return new K(a)})});if(0===l.length)throw Error("Expected at least one scale.");var y=l[0],w=this.numChannels=y.numChannels,p=this.dataType=y.dataType;b=1;for(var u=l.length;b<u;++b){var x=l[b];if(x.dataType!==p)throw Error("Scale "+b+" has data type "+f.a[x.dataType]+
" "+("but scale 0 has data type "+f.a[p]+"."));if(x.numChannels!==w)throw Error("Scale "+b+" has "+x.numChannels+" channel(s) "+("but scale 0 has "+w+" channels."));}if(1===w)switch(p){case f.a.UINT64:var m=f.d.SEGMENTATION}void 0===m&&(m=void 0!==v.volumeType?v.volumeType:f.d.IMAGE);this.volumeType=m}catch(mb){throw Error("Failed to parse BrainMaps multiscale volume specification: "+mb.message);}try{Object(B.u)(k),this.meshes=Object(B.w)(k,"meshes",function(a){return void 0===a?[]:Object(B.a)(a,
function(a){return new F(a)})})}catch(mb){throw Error("Failed to parse BrainMaps meshes specification: "+mb.message);}}z(a,[{key:"getSources",value:function(a){var b=this,d=h.c.RAW;this.dataType===f.a.UINT64?d=h.c.COMPRESSED_SEGMENTATION:this.volumeType===f.d.IMAGE&&this.dataType===f.a.UINT8&&1===this.numChannels&&this.encoding!==h.c.RAW&&(d=h.c.JPEG);return this.scales.map(function(c,g){return f.c.getDefaults({voxelSize:c.voxelSize,dataType:c.dataType,numChannels:c.numChannels,upperVoxelBound:c.upperVoxelBound,
volumeType:b.volumeType,volumeSourceOptions:a}).map(function(a){return b.chunkManager.getChunkSource(D,{credentialsProvider:b.credentialsProvider,spec:a,parameters:{instance:b.instance,volumeId:b.volumeId,changeSpec:b.changeSpec,scaleIndex:g,encoding:d}})})})}},{key:"getMeshSource",value:function(){var a=this.meshes.find(function(a){return"TRIANGLES"===a.type});return void 0===a?null:this.chunkManager.getChunkSource(x,{credentialsProvider:this.credentialsProvider,parameters:{instance:this.instance,
volumeId:this.volumeId,meshName:a.name,changeSpec:this.changeSpec}})}}]);return a}(),J=/^([^\/]+)\/(.*)$/,R=function aa(a,b){q(this,aa);this.projects=new Map;this.hierarchicalVolumeIds=new Map;var d=this.projects;a=$jscomp.makeIterator(l(a));for(var c=a.next();!c.done;c=a.next())c=c.value,d.set(c.id,c);try{Object(B.u)(b);var f=this.volumeIds=Object(B.w)(b,"volumeId",function(a){return void 0===a?[]:Object(B.a)(a,B.B)});f.sort();for(var g=new Map,e=$jscomp.makeIterator(f),h=e.next();!h.done;h=e.next()){var k=
h.value;for(b=0;;){var v=k.indexOf(":",b);-1===v?v=void 0:++v;var y=k.substring(0,b),w=g.get(y);void 0===w&&(w=new Set,g.set(y,w));w.add(k.substring(b,v));if(void 0===v)break;b=v}}for(var p=this.hierarchicalVolumeIds,u=$jscomp.makeIterator(g),x=u.next();!x.done;x=u.next()){var m=$jscomp.makeIterator(x.value),G=m.next().value,D=m.next().value;p.set(G,Array.from(D))}}catch(sc){throw Error("Failed to parse Brain Maps volume list reply: "+sc.message);}},W=function(b){function d(a,b){q(this,d);var c=m(this,
(d.__proto__||Object.getPrototypeOf(d)).call(this));c.instance=a;c.credentialsProvider=b;return c}r(d,b);z(d,[{key:"getMeshSource",value:function(a,b){return a.getChunkSource(x,{credentialsProvider:this.credentialsProvider,parameters:this.getMeshSourceParameters(b)})}},{key:"getMeshSourceParameters",value:function(b){var d=b.match(J);if(null===d)throw Error("Invalid Brainmaps mesh URL: "+b);b=a(d[1]);return{instance:this.instance,volumeId:b.volumeId,changeSpec:b.changeSpec,meshName:d[2]}}},{key:"getSkeletonSource",
value:function(a,b){return a.getChunkSource(C,{credentialsProvider:this.credentialsProvider,parameters:this.getMeshSourceParameters(b)})}},{key:"getVolume",value:function(b,d,c){var f=this;d=a(d);var g=d.volumeId,e=d.changeSpec,v=d.parameters;Object(B.u)(v);d=Object(B.w)(v,"encoding",function(a){return void 0===a?void 0:Object(B.n)(v.encoding,h.c)});var l=Object.assign({},c,{encoding:d});return b.memoize.getUncounted({type:"brainmaps:getVolume",instance:this.instance,volumeId:g,changeSpec:e,brainmapsOptions:l},
function(){return Promise.all([Object(k.b)(f.instance,f.credentialsProvider,{method:"GET",path:"/v1beta2/volumes/"+g,responseType:"json"}),Object(k.b)(f.instance,f.credentialsProvider,{method:"GET",path:"/v1beta2/objects/"+g+"/meshes",responseType:"json"})]).then(function(a){var d=$jscomp.makeIterator(a);a=d.next().value;d=d.next().value;return new T(b,f.instance,f.credentialsProvider,g,e,a,d,l)})})}},{key:"getVolumeList",value:function(a){var b=this;return a.memoize.getUncounted({instance:this.instance,
type:"brainmaps:getVolumeList"},function(){var a=Promise.all([Object(k.b)(b.instance,b.credentialsProvider,{method:"GET",path:"/v1beta2/projects",responseType:"json"}),Object(k.b)(b.instance,b.credentialsProvider,{method:"GET",path:"/v1beta2/volumes",responseType:"json"})]).then(function(a){var b=$jscomp.makeIterator(a);a=b.next().value;b=b.next().value;return new R(a,b)}),d=b.instance.description+" volume list";y.a.forPromise(a,{delay:!0,initialMessage:"Retrieving "+d+".",errorPrefix:"Error retrieving "+
d+": "});return a})}},{key:"getChangeStackList",value:function(a,b){var d=this;return a.memoize.getUncounted({instance:this.instance,type:"brainmaps:getChangeStackList",volumeId:b},function(){var a=Object(k.b)(d.instance,d.credentialsProvider,{method:"GET",path:"/v1beta2/changes/"+b+"/change_stacks",responseType:"json"}).then(function(a){return w(a)}),c="change stacks for "+b;y.a.forPromise(a,{delay:!0,initialMessage:"Retrieving "+c+".",errorPrefix:"Error retrieving "+c+": "});return a})}},{key:"volumeCompleter",
value:function(a,b){var d=this;return this.getVolumeList(b).then(function(c){var f=a.match(/^([^:]+:[^:]+:[^:]+):(.*)$/);if(null!==f){var g=f[1],e=f[2];return d.getChangeStackList(b,g).then(function(a){if(void 0===a)throw null;return{offset:g.length+1,completions:Object(G.b)(e,a)}})}var h=a.lastIndexOf(":")+1;f=a.substring(0,h);h=a.substring(h);var k=c.hierarchicalVolumeIds.get(f);if(void 0===k)throw null;return f?{offset:f.length,completions:Object(G.b)(h,k)}:{offset:0,completions:Object(G.c)(h,
k,function(a){return a},function(a){return(a=c.projects.get(a.substring(0,a.length-1)))&&a.label})}})}},{key:"description",get:function(){return this.instance.description}}]);return d}(p.a);e.productionInstance={description:"Google Brain Maps",serverUrls:["https://brainmaps.googleapis.com"]}},function(n,e,c){c(16);c(113);c(114);var q=c(70),m=c(115),r=c(116);c(117);var a=c(71),b=c(72);c.d(e,"a",function(){return q});c.d(e,"b",function(){return m});c.d(e,"c",function(){return r});c.d(e,"d",function(){return a});
c.d(e,"e",function(){return b})},function(n,e,c){function q(a,b,c){var e=b[0],l=b[1],p=b[2],k=b[3],h=b[4],g=b[5],d=b[6],f=b[7];b=b[8];var v=c[0],y=c[1],m=c[2],q=c[3],r=c[4],z=c[5],D=c[6],x=c[7];c=c[8];a[0]=v*e+y*k+m*d;a[1]=v*l+y*h+m*f;a[2]=v*p+y*g+m*b;a[3]=q*e+r*k+z*d;a[4]=q*l+r*h+z*f;a[5]=q*p+r*g+z*b;a[6]=D*e+x*k+c*d;a[7]=D*l+x*h+c*f;a[8]=D*p+x*g+c*b;return a}function m(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];a[7]=b[7]-c[7];
a[8]=b[8]-c[8];return a}Object.defineProperty(e,"__esModule",{value:!0});e.create=function(){var a=new r.a(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};e.fromMat4=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a};e.clone=function(a){var b=new r.a(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};e.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=
b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};e.fromValues=function(a,b,c,e,u,p,k,h,g){var d=new r.a(9);d[0]=a;d[1]=b;d[2]=c;d[3]=e;d[4]=u;d[5]=p;d[6]=k;d[7]=h;d[8]=g;return d};e.set=function(a,b,c,e,u,p,k,h,g,d){a[0]=b;a[1]=c;a[2]=e;a[3]=u;a[4]=p;a[5]=k;a[6]=h;a[7]=g;a[8]=d;return a};e.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};e.transpose=function(a,b){if(a===b){var c=b[1],e=b[2],u=b[5];a[1]=b[3];a[2]=b[6];a[3]=c;a[5]=b[7];a[6]=
e;a[7]=u}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a};e.invert=function(a,b){var c=b[0],e=b[1],u=b[2],p=b[3],k=b[4],h=b[5],g=b[6],d=b[7];b=b[8];var f=b*k-h*d,v=-b*p+h*g,y=d*p-k*g,m=c*f+e*v+u*y;if(!m)return null;m=1/m;a[0]=f*m;a[1]=(-b*e+u*d)*m;a[2]=(h*e-u*k)*m;a[3]=v*m;a[4]=(b*c-u*g)*m;a[5]=(-h*c+u*p)*m;a[6]=y*m;a[7]=(-d*c+e*g)*m;a[8]=(k*c-e*p)*m;return a};e.adjoint=function(a,b){var c=b[0],e=b[1],u=b[2],p=b[3],k=b[4],h=b[5],g=b[6],d=b[7];
b=b[8];a[0]=k*b-h*d;a[1]=u*d-e*b;a[2]=e*h-u*k;a[3]=h*g-p*b;a[4]=c*b-u*g;a[5]=u*p-c*h;a[6]=p*d-k*g;a[7]=e*g-c*d;a[8]=c*k-e*p;return a};e.determinant=function(a){var b=a[3],c=a[4],e=a[5],u=a[6],p=a[7],k=a[8];return a[0]*(k*c-e*p)+a[1]*(-k*b+e*u)+a[2]*(p*b-c*u)};e.multiply=q;e.translate=function(a,b,c){var e=b[0],l=b[1],p=b[2],k=b[3],h=b[4],g=b[5],d=b[6],f=b[7];b=b[8];var v=c[0];c=c[1];a[0]=e;a[1]=l;a[2]=p;a[3]=k;a[4]=h;a[5]=g;a[6]=v*e+c*k+d;a[7]=v*l+c*h+f;a[8]=v*p+c*g+b;return a};e.rotate=function(a,
b,c){var e=b[0],l=b[1],p=b[2],k=b[3],h=b[4],g=b[5],d=b[6],f=b[7];b=b[8];var v=Math.sin(c);c=Math.cos(c);a[0]=c*e+v*k;a[1]=c*l+v*h;a[2]=c*p+v*g;a[3]=c*k-v*e;a[4]=c*h-v*l;a[5]=c*g-v*p;a[6]=d;a[7]=f;a[8]=b;return a};e.scale=function(a,b,c){var e=c[0];c=c[1];a[0]=e*b[0];a[1]=e*b[1];a[2]=e*b[2];a[3]=c*b[3];a[4]=c*b[4];a[5]=c*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};e.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=b[0];a[7]=b[1];a[8]=1;return a};e.fromRotation=function(a,
b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=0;a[3]=-c;a[4]=b;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};e.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=b[1];a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};e.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};e.fromQuat=function(a,b){var c=b[0],e=b[1],u=b[2];b=b[3];var p=c+c,k=e+e,h=u+u;c*=p;var g=e*p;e*=k;var d=u*p,f=u*k;u*=h;p*=b;k*=b;b*=h;a[0]=1-e-u;a[3]=g-b;a[6]=d+k;a[1]=
g+b;a[4]=1-c-u;a[7]=f-p;a[2]=d-k;a[5]=f+p;a[8]=1-c-e;return a};e.normalFromMat4=function(a,b){var c=b[0],e=b[1],u=b[2],p=b[3],k=b[4],h=b[5],g=b[6],d=b[7],f=b[8],v=b[9],y=b[10],m=b[11],q=b[12],r=b[13],z=b[14];b=b[15];var D=c*h-e*k,x=c*g-u*k,C=c*d-p*k,n=e*g-u*h,K=e*d-p*h,F=u*d-p*g,T=f*r-v*q,J=f*z-y*q;f=f*b-m*q;var R=v*z-y*r;v=v*b-m*r;y=y*b-m*z;m=D*y-x*v+C*R+n*f-K*J+F*T;if(!m)return null;m=1/m;a[0]=(h*y-g*v+d*R)*m;a[1]=(g*f-k*y-d*J)*m;a[2]=(k*v-h*f+d*T)*m;a[3]=(u*v-e*y-p*R)*m;a[4]=(c*y-u*f+p*J)*m;a[5]=
(e*f-c*v-p*T)*m;a[6]=(r*F-z*K+b*n)*m;a[7]=(z*C-q*F-b*x)*m;a[8]=(q*K-r*C+b*D)*m;return a};e.projection=function(a,b,c){a[0]=2/b;a[1]=0;a[2]=0;a[3]=0;a[4]=-2/c;a[5]=0;a[6]=-1;a[7]=1;a[8]=1;return a};e.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],
2))};e.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];return a};e.subtract=m;e.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;return a};e.multiplyScalarAndAdd=function(a,b,c,e){a[0]=b[0]+c[0]*e;a[1]=b[1]+c[1]*e;a[2]=b[2]+c[2]*e;a[3]=b[3]+c[3]*e;a[4]=b[4]+c[4]*e;a[5]=b[5]+c[5]*e;a[6]=b[6]+c[6]*e;a[7]=
b[7]+c[7]*e;a[8]=b[8]+c[8]*e;return a};e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};e.equals=function(a,b){var c=a[0],e=a[1],u=a[2],p=a[3],k=a[4],h=a[5],g=a[6],d=a[7];a=a[8];var f=b[0],v=b[1],y=b[2],m=b[3],q=b[4],n=b[5],z=b[6],D=b[7];b=b[8];return Math.abs(c-f)<=r.b*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(e-v)<=r.b*Math.max(1,Math.abs(e),Math.abs(v))&&Math.abs(u-y)<=r.b*Math.max(1,Math.abs(u),
Math.abs(y))&&Math.abs(p-m)<=r.b*Math.max(1,Math.abs(p),Math.abs(m))&&Math.abs(k-q)<=r.b*Math.max(1,Math.abs(k),Math.abs(q))&&Math.abs(h-n)<=r.b*Math.max(1,Math.abs(h),Math.abs(n))&&Math.abs(g-z)<=r.b*Math.max(1,Math.abs(g),Math.abs(z))&&Math.abs(d-D)<=r.b*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(a-b)<=r.b*Math.max(1,Math.abs(a),Math.abs(b))};var r=c(16);e.mul=q;e.sub=m},function(n,e,c){function q(){var a=new g.a(3);a[0]=0;a[1]=0;a[2]=0;return a}function m(a){var b=a[0],d=a[1];a=a[2];return Math.sqrt(b*
b+d*d+a*a)}function r(a,b,c){var d=new g.a(3);d[0]=a;d[1]=b;d[2]=c;return d}function a(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];return a}function b(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];return a}function l(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];return a}function w(a,b){var d=b[0]-a[0],c=b[1]-a[1];a=b[2]-a[2];return Math.sqrt(d*d+c*c+a*a)}function u(a,b){var d=b[0]-a[0],c=b[1]-a[1];a=b[2]-a[2];return d*d+c*c+a*a}function p(a){var b=a[0],d=a[1];a=a[2];return b*
b+d*d+a*a}function k(a,b){var d=b[0],c=b[1],f=b[2];d=d*d+c*c+f*f;0<d&&(d=1/Math.sqrt(d),a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d);return a}function h(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}Object.defineProperty(e,"__esModule",{value:!0});e.create=q;e.clone=function(a){var b=new g.a(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};e.length=m;e.fromValues=r;e.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a};e.set=function(a,b,c,g){a[0]=b;a[1]=c;a[2]=g;return a};e.add=function(a,b,c){a[0]=b[0]+c[0];
a[1]=b[1]+c[1];a[2]=b[2]+c[2];return a};e.subtract=a;e.multiply=b;e.divide=l;e.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);return a};e.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);a[2]=Math.floor(b[2]);return a};e.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);return a};e.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);return a};e.round=function(a,
b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);a[2]=Math.round(b[2]);return a};e.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a};e.scaleAndAdd=function(a,b,c,g){a[0]=b[0]+c[0]*g;a[1]=b[1]+c[1]*g;a[2]=b[2]+c[2]*g;return a};e.distance=w;e.squaredDistance=u;e.squaredLength=p;e.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];return a};e.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];return a};e.normalize=k;e.dot=h;e.cross=function(a,b,c){var d=b[0],f=b[1];b=b[2];var g=
c[0],e=c[1];c=c[2];a[0]=f*c-b*e;a[1]=b*g-d*c;a[2]=d*e-f*g;return a};e.lerp=function(a,b,c,g){var d=b[0],f=b[1];b=b[2];a[0]=d+g*(c[0]-d);a[1]=f+g*(c[1]-f);a[2]=b+g*(c[2]-b);return a};e.hermite=function(a,b,c,g,e,h){var d=h*h,f=d*(2*h-3)+1,k=d*(h-2)+h,v=d*(h-1);h=d*(3-2*h);a[0]=b[0]*f+c[0]*k+g[0]*v+e[0]*h;a[1]=b[1]*f+c[1]*k+g[1]*v+e[1]*h;a[2]=b[2]*f+c[2]*k+g[2]*v+e[2]*h;return a};e.bezier=function(a,b,c,g,e,h){var d=1-h,f=d*d,k=h*h,v=f*d;f*=3*h;d*=3*k;h*=k;a[0]=b[0]*v+c[0]*f+g[0]*d+e[0]*h;a[1]=b[1]*
v+c[1]*f+g[1]*d+e[1]*h;a[2]=b[2]*v+c[2]*f+g[2]*d+e[2]*h;return a};e.random=function(a,b){b=b||1;var c=2*g.c()*Math.PI,d=2*g.c()-1,f=Math.sqrt(1-d*d)*b;a[0]=Math.cos(c)*f;a[1]=Math.sin(c)*f;a[2]=d*b;return a};e.transformMat4=function(a,b,c){var d=b[0],f=b[1];b=b[2];var g=c[3]*d+c[7]*f+c[11]*b+c[15];g=g||1;a[0]=(c[0]*d+c[4]*f+c[8]*b+c[12])/g;a[1]=(c[1]*d+c[5]*f+c[9]*b+c[13])/g;a[2]=(c[2]*d+c[6]*f+c[10]*b+c[14])/g;return a};e.transformMat3=function(a,b,c){var d=b[0],f=b[1];b=b[2];a[0]=d*c[0]+f*c[3]+
b*c[6];a[1]=d*c[1]+f*c[4]+b*c[7];a[2]=d*c[2]+f*c[5]+b*c[8];return a};e.transformQuat=function(a,b,c){var d=b[0],f=b[1],g=b[2];b=c[0];var e=c[1],h=c[2];c=c[3];var k=c*d+e*g-h*f,v=c*f+h*d-b*g,l=c*g+b*f-e*d;d=-b*d-e*f-h*g;a[0]=k*c+d*-b+v*-h-l*-e;a[1]=v*c+d*-e+l*-b-k*-h;a[2]=l*c+d*-h+k*-e-v*-b;return a};e.rotateX=function(a,b,c,g){var d=[],f=[];d[0]=b[0]-c[0];d[1]=b[1]-c[1];d[2]=b[2]-c[2];f[0]=d[0];f[1]=d[1]*Math.cos(g)-d[2]*Math.sin(g);f[2]=d[1]*Math.sin(g)+d[2]*Math.cos(g);a[0]=f[0]+c[0];a[1]=f[1]+
c[1];a[2]=f[2]+c[2];return a};e.rotateY=function(a,b,c,g){var d=[],f=[];d[0]=b[0]-c[0];d[1]=b[1]-c[1];d[2]=b[2]-c[2];f[0]=d[2]*Math.sin(g)+d[0]*Math.cos(g);f[1]=d[1];f[2]=d[2]*Math.cos(g)-d[0]*Math.sin(g);a[0]=f[0]+c[0];a[1]=f[1]+c[1];a[2]=f[2]+c[2];return a};e.rotateZ=function(a,b,c,g){var d=[],f=[];d[0]=b[0]-c[0];d[1]=b[1]-c[1];d[2]=b[2]-c[2];f[0]=d[0]*Math.cos(g)-d[1]*Math.sin(g);f[1]=d[0]*Math.sin(g)+d[1]*Math.cos(g);f[2]=d[2];a[0]=f[0]+c[0];a[1]=f[1]+c[1];a[2]=f[2]+c[2];return a};e.angle=function(a,
b){a=r(a[0],a[1],a[2]);b=r(b[0],b[1],b[2]);k(a,a);k(b,b);b=h(a,b);return 1<b?0:-1>b?Math.PI:Math.acos(b)};e.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]};e.equals=function(a,b){var c=a[0],d=a[1];a=a[2];var f=b[0],e=b[1];b=b[2];return Math.abs(c-f)<=g.b*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(d-e)<=g.b*Math.max(1,Math.abs(d),Math.abs(e))&&Math.abs(a-b)<=g.b*Math.max(1,Math.abs(a),Math.abs(b))};var g=c(16);
e.sub=a;e.mul=b;e.div=l;e.dist=w;e.sqrDist=u;e.len=m;e.sqrLen=p;n=function(){var a=q();return function(b,c,d,g,e,h){c||(c=3);d||(d=0);for(g=g?Math.min(g*c+d,b.length):b.length;d<g;d+=c)a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],e(a,a,h),b[d]=a[0],b[d+1]=a[1],b[d+2]=a[2];return b}}();e.forEach=n},function(n,e,c){function q(){var a=new h.a(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a}function m(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];return a}function r(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*
c[1];a[2]=b[2]*c[2];a[3]=b[3]*c[3];return a}function a(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];a[3]=b[3]/c[3];return a}function b(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;return a}function l(a,b){var c=b[0]-a[0],d=b[1]-a[1],g=b[2]-a[2];a=b[3]-a[3];return Math.sqrt(c*c+d*d+g*g+a*a)}function w(a,b){var c=b[0]-a[0],d=b[1]-a[1],g=b[2]-a[2];a=b[3]-a[3];return c*c+d*d+g*g+a*a}function u(a){var b=a[0],c=a[1],g=a[2];a=a[3];return Math.sqrt(b*b+c*c+g*g+a*a)}function p(a){var b=a[0],
c=a[1],g=a[2];a=a[3];return b*b+c*c+g*g+a*a}function k(a,b){var c=b[0],d=b[1],g=b[2];b=b[3];var e=c*c+d*d+g*g+b*b;0<e&&(e=1/Math.sqrt(e),a[0]=c*e,a[1]=d*e,a[2]=g*e,a[3]=b*e);return a}Object.defineProperty(e,"__esModule",{value:!0});e.create=q;e.clone=function(a){var b=new h.a(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};e.fromValues=function(a,b,c,e){var d=new h.a(4);d[0]=a;d[1]=b;d[2]=c;d[3]=e;return d};e.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a};e.set=function(a,
b,c,e,h){a[0]=b;a[1]=c;a[2]=e;a[3]=h;return a};e.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];return a};e.subtract=m;e.multiply=r;e.divide=a;e.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);a[3]=Math.ceil(b[3]);return a};e.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);a[2]=Math.floor(b[2]);a[3]=Math.floor(b[3]);return a};e.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],
c[2]);a[3]=Math.min(b[3],c[3]);return a};e.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);a[3]=Math.max(b[3],c[3]);return a};e.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);a[2]=Math.round(b[2]);a[3]=Math.round(b[3]);return a};e.scale=b;e.scaleAndAdd=function(a,b,c,e){a[0]=b[0]+c[0]*e;a[1]=b[1]+c[1]*e;a[2]=b[2]+c[2]*e;a[3]=b[3]+c[3]*e;return a};e.distance=l;e.squaredDistance=w;e.length=u;e.squaredLength=p;e.negate=function(a,b){a[0]=
-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=-b[3];return a};e.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];a[3]=1/b[3];return a};e.normalize=k;e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};e.lerp=function(a,b,c,e){var d=b[0],f=b[1],g=b[2];b=b[3];a[0]=d+e*(c[0]-d);a[1]=f+e*(c[1]-f);a[2]=g+e*(c[2]-g);a[3]=b+e*(c[3]-b);return a};e.random=function(a,c){c=c||1;a[0]=h.c();a[1]=h.c();a[2]=h.c();a[3]=h.c();k(a,a);b(a,a,c);return a};e.transformMat4=function(a,b,c){var d=b[0],f=b[1],
g=b[2];b=b[3];a[0]=c[0]*d+c[4]*f+c[8]*g+c[12]*b;a[1]=c[1]*d+c[5]*f+c[9]*g+c[13]*b;a[2]=c[2]*d+c[6]*f+c[10]*g+c[14]*b;a[3]=c[3]*d+c[7]*f+c[11]*g+c[15]*b;return a};e.transformQuat=function(a,b,c){var d=b[0],f=b[1],g=b[2],e=c[0],h=c[1],k=c[2];c=c[3];var l=c*d+h*g-k*f,p=c*f+k*d-e*g,u=c*g+e*f-h*d;d=-e*d-h*f-k*g;a[0]=l*c+d*-e+p*-k-u*-h;a[1]=p*c+d*-h+u*-e-l*-k;a[2]=u*c+d*-k+l*-h-p*-e;a[3]=b[3];return a};e.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};e.exactEquals=function(a,b){return a[0]===
b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};e.equals=function(a,b){var c=a[0],d=a[1],e=a[2];a=a[3];var g=b[0],k=b[1],l=b[2];b=b[3];return Math.abs(c-g)<=h.b*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(d-k)<=h.b*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(e-l)<=h.b*Math.max(1,Math.abs(e),Math.abs(l))&&Math.abs(a-b)<=h.b*Math.max(1,Math.abs(a),Math.abs(b))};var h=c(16);e.sub=m;e.mul=r;e.div=a;e.dist=l;e.sqrDist=w;e.len=u;e.sqrLen=p;n=function(){var a=q();return function(b,c,e,g,h,k){c||(c=4);e||
(e=0);for(g=g?Math.min(g*c+e,b.length):b.length;e<g;e+=c)a[0]=b[e],a[1]=b[e+1],a[2]=b[e+2],a[3]=b[e+3],h(a,a,k),b[e]=a[0],b[e+1]=a[1],b[e+2]=a[2],b[e+3]=a[3];return b}}();e.forEach=n},function(n,e,c){e=c(125);c="object"==typeof self&&self&&self.Object===Object&&self;e=e||c||Function("return this")();n.exports=e},function(n,e,c){e=c(73).Symbol;n.exports=e},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){switch(a){case h.b.FLOAT32:return E.c;default:throw Error("Data type not supported by WebGL: ${DataType[dataType]}");
}}e.f=function(a){return new k.a(void 0===a?"void main() {\n  emitDefault();\n}\n":a,f.B)};c.d(e,"c",function(){return T});c.d(e,"b",function(){return J});c.d(e,"e",function(){return R});c.d(e,"d",function(){return Q});var b=c(23);n=c(10);var l=c(32),w=c(37),u=c(138),p=c(51),k=c(4),h=c(27),g=c(0),d=c(1),f=c(2),v=c(19),y=c(3),G=c(17),E=c(20),B=c(25),z=c(7),D=function ha(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==
a)return ha(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},x=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),C=c(55),H=d.j.create(),K=new Float32Array(4);e.a="//NEUROGLANCER_SKELETON_LAYER_FRAGMENT_MAIN_START";var F=function(a){function b(a){q(this,b);var c=m(this,(b.__proto__||
Object.getPrototypeOf(b)).call(this));c.vertexAttributes=a;c.shaders=new Map;c.shaderGeneration=-1;c.vertexAttributesKey=Object(f.g)(c.vertexAttributes);return c}r(b,a);x(b,[{key:"defineShader",value:function(a,b){a.addUniform("highp vec4","uColor");a.addUniform("highp mat4","uProjection");a.addUniform("highp vec4","uPickID");var c="\ngl_Position = uProjection * vec4(aVertex0, 1.0);\n";a.addFragmentCode("\nvec4 segmentColor() {\n  return uColor;\n}\nvoid emitRGB(vec3 color) {\n  emit(vec4(color * uColor.a, uColor.a), uPickID);\n}\nvoid emitDefault() {\n  emit(uColor, uPickID);\n}\n");
a.addFragmentCode(C);this.vertexAttributes.forEach(function(b,d){a.addAttribute("highp "+b.glslDataType,"aVertex"+d);0!==d&&(a.addVarying("highp "+b.glslDataType,"vVertex"+d),c+="vVertex"+d+" = aVertex"+d+";\n",a.addFragmentCode("#define "+b.name+" vVertex"+d+"\n"))});a.setVertexMain(c);a.setFragmentMainFunction("//NEUROGLANCER_SKELETON_LAYER_FRAGMENT_MAIN_START\n"+b)}},{key:"beginLayer",value:function(a,b,c,f){c=d.j.multiply(H,c.dataToDevice,f);a.uniformMatrix4fv(b.uniform("uProjection"),!1,c)}},
{key:"getShader",value:function(a,b,c){var d=this;return this.registerDisposer(a.memoize.get("skeleton/SkeletonShaderManager:"+Object(v.a)(b)+":"+this.vertexAttributesKey+":"+c,function(){var f=new B.a(a);f.require(b);d.defineShader(f,c);return f.build()}))}},{key:"setColor",value:function(a,b,c){a.uniform4fv(b.uniform("uColor"),c)}},{key:"setPickID",value:function(a,b,c){a.uniform4fv(b.uniform("uPickID"),Object(z.p)(K,c))}},{key:"drawSkeleton",value:function(a,b,c){for(var d=this.vertexAttributes,
f=d.length,e=c.vertexAttributeOffsets,g=0;g<f;++g){var h=d[g];c.vertexBuffer.bindToVertexAttrib(b.attribute("aVertex"+g),h.numComponents,h.webglDataType,!1,0,e[g])}c.indexBuffer.bind();a.drawElements(a.LINES,c.numIndices,a.UNSIGNED_INT,0)}},{key:"endLayer",value:function(a,b){for(var c=this.vertexAttributes.length,d=0;d<c;++d)a.disableVertexAttribArray(b.attribute("aVertex"+d))}}]);return b}(g.a),T=function(c){function f(b,c,e,g){q(this,f);var h=m(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));
h.chunkManager=b;h.source=c;h.voxelSizeObject=e;h.displayState=g;h.tempMat=d.j.create();h.redrawNeeded=new y.a;h.fallbackFragmentMain="void main() {\n  emitDefault();\n}\n";Object(w.f)(g,h);h.displayState.shaderError.value=void 0;h.registerDisposer(g.fragmentMain.changed.add(function(){h.displayState.shaderError.value=void 0;h.redrawNeeded.dispatch()}));b=h.sharedObject=h.registerDisposer(new w.b(b,g));b.RPC_TYPE_ID=u.a;b.initializeCounterpartWithChunkManager({source:c.addCounterpartRef()});b=h.vertexAttributes=
[W];c=$jscomp.makeIterator(c.vertexAttributes);for(e=c.next();!e.done;e=c.next())g=$jscomp.makeIterator(e.value),e=g.next().value,g=g.next().value,b.push({name:e,dataType:g.dataType,numComponents:g.numComponents,webglDataType:a(g.dataType),glslDataType:1<g.numComponents?"vec"+g.numComponents:"float"});return h}r(f,c);x(f,[{key:"getShader",value:function(a,b,c){var d=this.displayState.fragmentMain,f=d.changed.count,e=b.shaders;b.shaderGeneration!==f&&(e.clear(),b.shaderGeneration=f);f=e.get(c);if(void 0===
f){f=null;try{f=b.getShader(a,c,d.value),this.fallbackFragmentMain=d.value,this.displayState.shaderError.value=null}catch(uc){this.displayState.shaderError.value=uc;try{f=b.getShader(a,c,this.fallbackFragmentMain)}catch(Db){}}e.set(c,f)}return f}},{key:"draw",value:function(a,c,f,e){void 0===e&&(e=a.emitColor?1:5);var g=this.gl,h=this.source,k=this.displayState,l=Math.min(1,k.objectAlpha.value);if(!(0>=l)){var v=this.getShader(g,f,a.emitter);if(null!==v){v.bind();var p=this.tempMat;d.j.identity(p);
h.skeletonVertexCoordinatesInVoxels&&d.j.scale(p,p,this.voxelSizeObject.size);d.j.multiply(p,this.displayState.objectToDataTransform.transform,p);f.beginLayer(g,v,a,p);h=h.chunks;var y=a.pickIDs;g.lineWidth(e);Object(w.d)(k,h,function(d,e,h){h.state===b.d.GPU_MEMORY&&(a.emitColor&&f.setColor(g,v,Object(w.e)(k,d,l)),a.emitPickID&&f.setPickID(g,v,y.registerUint64(c,e)),f.drawSkeleton(g,v,h))});f.endLayer(g,v)}}}},{key:"visibility",get:function(){return this.sharedObject.visibility}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}]);
return f}(g.a),J=function(a){function b(a){q(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.base=a;c.renderHelper=c.registerDisposer(new F(c.base.vertexAttributes));c.registerDisposer(a);c.registerDisposer(a.redrawNeeded.add(function(){c.redrawNeeded.dispatch()}));c.setReady(!0);c.registerDisposer(a.visibility.add(c.visibility));return c}r(b,a);x(b,[{key:"draw",value:function(a){this.base.draw(a,this,this.renderHelper)}},{key:"gl",get:function(){return this.base.gl}},{key:"isTransparent",
get:function(){return 1>this.base.displayState.objectAlpha.value}}]);return b}(l.a),R=function(a){function b(a){q(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.base=a;c.renderHelper=c.registerDisposer(new F(c.base.vertexAttributes));c.registerDisposer(a);c.registerDisposer(a.redrawNeeded.add(function(){c.redrawNeeded.dispatch()}));c.setReady(!0);c.registerDisposer(a.visibility.add(c.visibility));return c}r(b,a);x(b,[{key:"draw",value:function(a){this.base.draw(a,this,
this.renderHelper,10)}},{key:"gl",get:function(){return this.base.gl}}]);return b}(p.b),W={dataType:h.b.FLOAT32,numComponents:3,name:"",webglDataType:E.c,glslDataType:"vec3"},V=function(a){function b(a,c){q(this,b);a=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));a.vertexAttributes=c.vertexAttributes;var d=a.indices=c.indices;a.vertexAttributeOffsets=c.vertexAttributeOffsets;a.numIndices=d.length;return a}r(b,a);x(b,[{key:"copyToGPU",value:function(a){D(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),
"copyToGPU",this).call(this,a);this.vertexBuffer=G.a.fromData(a,this.vertexAttributes,a.ARRAY_BUFFER,a.STATIC_DRAW);this.indexBuffer=G.a.fromData(a,this.indices,a.ELEMENT_ARRAY_BUFFER,a.STATIC_DRAW)}},{key:"freeGPUMemory",value:function(a){D(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"freeGPUMemory",this).call(this,a);this.vertexBuffer.dispose();this.indexBuffer.dispose()}}]);return b}(n.b),M=new Map,Q=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,
arguments))}r(b,a);x(b,[{key:"getChunk",value:function(a){return new V(this,a)}},{key:"skeletonVertexCoordinatesInVoxels",get:function(){return!0}},{key:"vertexAttributes",get:function(){return M}}]);return b}(n.e)},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return b});n=c(0);var m=c(17),r=c(77),a=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),b=function(b){function c(a){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");var b=(c.__proto__||Object.getPrototypeOf(c)).call(this);
if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");b=!b||"object"!==typeof b&&"function"!==typeof b?this:b;b.gl=a;b.vertexBuffer=b.registerDisposer(m.a.fromData(a,new Float32Array([0,0,0,1,1,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,1,1]),a.ARRAY_BUFFER,a.STATIC_DRAW));b.colorBuffer=b.registerDisposer(m.a.fromData(a,new Float32Array([1,0,0,.5,1,0,0,.5,0,1,0,.5,0,1,0,.5,0,0,1,.5,0,0,1,.5]),a.ARRAY_BUFFER,a.STATIC_DRAW));b.trivialColorShader=b.registerDisposer(Object(r.c)(a));
return b}q(c,b);a(c,[{key:"draw",value:function(a,b){b=void 0===b?!0:b;var c=this.trivialColorShader,e=this.gl;c.bind();e.uniformMatrix4fv(c.uniform("uProjectionMatrix"),!1,a);a=c.attribute("aVertexPosition");this.vertexBuffer.bindToVertexAttrib(a,4);c=c.attribute("aColor");this.colorBuffer.bindToVertexAttrib(c,4);b&&(e.colorMask(!1,!1,!1,!0),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.colorMask(!0,!0,!0,!0),e.enable(e.BLEND),e.blendFunc(e.ONE_MINUS_DST_ALPHA,e.DST_ALPHA));e.lineWidth(1);
e.drawArrays(e.LINES,0,6);b&&e.disable(e.BLEND);e.disableVertexAttribArray(a);e.disableVertexAttribArray(c)}}],[{key:"get",value:function(a){return a.memoize.get("SliceViewPanel:AxesLineHelper",function(){return new c(a)})}}]);return c}(n.a)},function(n,e,c){function q(a){a.setFragmentMain("gl_FragColor = getValue0();")}e.a=q;e.b=function(a,b,c){b=void 0===b?q:b;c=void 0===c?1:c;return a.memoize.get("elementWiseTextureShader:"+c+":"+Object(m.a)(b),function(){var e=new r.a(a);e.addVarying("vec2","vTexCoord");
e.addUniform("sampler2D","uSampler",c);e.addInitializer(function(b){for(var e=[],h=0;h<c;++h)e[h]=h;a.uniform1iv(b.uniform("uSampler"),e)});for(var l=0;l<c;++l)e.addFragmentCode("\nvec4 getValue"+l+"() {\n  return texture2D(uSampler["+l+"], vTexCoord);\n}\n");e.addUniform("mat4","uProjectionMatrix");e.require(b);e.addAttribute("vec4","aVertexPosition");e.addAttribute("vec2","aTexCoord");e.setVertexMain("vTexCoord = aTexCoord; gl_Position = uProjectionMatrix * aVertexPosition;");return e.build()})};
e.c=function(a){return a.memoize.get("trivialColorShader",function(){var b=new r.a(a);b.addVarying("vec4","vColor");b.setFragmentMain("gl_FragColor = vColor;");b.addAttribute("vec4","aVertexPosition");b.addAttribute("vec4","aColor");b.addUniform("mat4","uProjectionMatrix");b.setVertexMain("vColor = aColor; gl_Position = uProjectionMatrix * aVertexPosition;");return b.build()})};var m=c(19),r=c(25)},function(n,e,c){c.d(e,"a",function(){return m});var q=function(){function c(a,b){for(var c=0;c<b.length;c++){var e=
b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,b,e){b&&c(a.prototype,b);e&&c(a,e);return a}}(),m=function(){function c(){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this.renderLayers=[null];this.values=[0,0,0];this.nextPickID=1}q(c,[{key:"clear",value:function(){this.renderLayers.length=1;this.values.length=3;this.nextPickID=1}},{key:"registerUint64",value:function(a,b,c){return this.register(a,
void 0===c?1:c,b.low,b.high)}},{key:"register",value:function(a,b,c,e){var l=this.renderLayers,p=this.values,k=this.nextPickID;this.nextPickID+=void 0===b?1:b;b=l.length;l[b]=a;a=3*b;p[a]=k;p[a+1]=void 0===c?0:c;p[a+2]=void 0===e?0:e;return k}},{key:"setMouseState",value:function(a,b){for(var c=this.renderLayers,e=this.values,u=0,p=c.length-1;u<p;){var k=Math.ceil(u+(p-u)/2);e[3*k]>b?p=k-1:u=k}c=a.pickedRenderLayer=c[u];u*=3;b=a.pickedOffset=b-e[u];p=a.pickedValue;p.low=e[u+1];p.high=e[u+2];null!==
c&&c.updateMouseState(a,p,b)}}]);return c}()},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return g});n=c(80);var r=c(38),a=c(15),b=c(1),l=c(34),w=c(81),u=c(142),p=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),k=function f(a,b,c){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,b);if(void 0===e){if(a=Object.getPrototypeOf(a),
null!==a)return f(a,b,c)}else{if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(c)}};c(143);c(21);var h=b.p.create(),g=function(c){function f(c,e,g){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var k=q(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,c,e,g.visibility));k.viewer=g;k.mouseX=0;k.mouseY=0;k.mouseStateUpdater=k.updateMouseState.bind(k);k.inputEventMap=g.inputEventMap;e.classList.add("neuroglancer-rendered-data-panel");e.classList.add("neuroglancer-panel");
e.classList.add("neuroglancer-noselect");k.registerDisposer(new r.a(e));k.registerDisposer(new l.b(e,k.inputEventMap));k.registerDisposer(new w.a(e,k.inputEventMap));k.registerEventListener(e,"mousemove",k.onMousemove.bind(k));k.registerEventListener(e,"mouseleave",k.onMouseout.bind(k));Object(a.c)(e,"snap",function(){k.navigationState.pose.snap()});Object(a.c)(e,"zoom-in",function(){k.navigationState.zoomBy(.5)});Object(a.c)(e,"zoom-out",function(){k.navigationState.zoomBy(2)});for(c={axis:0};3>
c.axis;c={axis:c.axis},++c.axis){g=b.a[c.axis];for(var v={},p=$jscomp.makeIterator([-1,1]),y=p.next();!y.done;v={sign:v.sign,tempOffset:v.tempOffset},y=p.next())v.sign=y.value,y=0>v.sign?"-":"+",Object(a.c)(e,"rotate-relative-"+g+y,function(a,c){return function(){k.navigationState.pose.rotateRelative(b.e[a.axis],.1*c.sign)}}(c,v)),v.tempOffset=b.p.create(),Object(a.c)(e,""+g+y,function(a,b){return function(){var c=k.navigationState,f=a.tempOffset;f[0]=0;f[1]=0;f[2]=0;f[b.axis]=a.sign;c.pose.translateVoxelsRelative(f)}}(v,
c))}Object(a.c)(e,"zoom-via-wheel",function(a){a=a.detail;k.onMousemove(a);k.zoomByMouse(Object(u.a)(a))});c={};g=$jscomp.makeIterator([1,10]);for(v=g.next();!v.done;c={amount:c.amount},v=g.next())c.amount=v.value,Object(a.c)(e,"z+"+c.amount+"-via-wheel",function(a){return function(b){var c=b.detail;b=k.navigationState;c=0!==c.deltaY?c.deltaY:c.deltaX;h[0]=0;h[1]=0;h[2]=(0<c?-1:1)*a.amount;b.pose.translateVoxelsRelative(h)}}(c));Object(a.c)(e,"move-to-mouse-position",function(){var a=k.viewer.mouseState;
if(a.updateUnconditionally()){var c=k.navigationState.pose.position;b.p.copy(c.spatialCoordinates,a.position);c.changed.dispatch()}});Object(a.c)(e,"snap",function(){return k.navigationState.pose.snap()});return k}m(f,c);p(f,[{key:"onMouseout",value:function(a){a=this.viewer.mouseState;a.updater=void 0;a.setActive(!1)}},{key:"onMousemove",value:function(a){var b=this.element;a.target===b&&(this.mouseX=a.offsetX-b.clientLeft,this.mouseY=a.offsetY-b.clientTop,a=this.viewer.mouseState,a.updater=this.mouseStateUpdater,
a.triggerUpdate())}},{key:"disposed",value:function(){var a=this.viewer.mouseState;a.updater===this.mouseStateUpdater&&(a.updater=void 0,a.setActive(!1));k(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"disposed",this).call(this)}}]);return f}(n.b)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==
typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"b",function(){return u});c.d(e,"a",function(){return p});n=c(0);var a=c(3),b=c(139),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var f=
b[c];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),w=function h(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return h(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},u=function(a){function b(a,c,e){q(this,b);var d=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));
d.context=a;d.element=c;d.visibility=e;d.gl=a.gl;a.addPanel(d);return d}r(b,a);l(b,[{key:"scheduleRedraw",value:function(){this.context.scheduleRedraw()}},{key:"setGLViewport",value:function(){var a=this.element,b=a.getBoundingClientRect(),c=this.context.canvasRect,e=a.clientLeft+b.left-c.left,g=a.clientWidth,h=a.clientHeight;b=b.top-c.top+a.clientTop+h;a=this.gl;a.enable(a.SCISSOR_TEST);b=this.context.canvas.height-b;a.viewport(e,b,g,h);a.scissor(e,b,g,h)}},{key:"disposed",value:function(){this.context.removePanel(this);
w(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"disposed",this).call(this)}},{key:"visible",get:function(){return this.visibility.visible}}]);return b}(n.a),p=function(c){function e(c){q(this,e);var d=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));d.container=c;d.canvas=document.createElement("canvas");d.updateStarted=new a.a;d.updateFinished=new a.a;d.panels=new Set;d.updatePending=null;d.needsRedraw=!1;var g=d.canvas;c.style.position="relative";g.style.position="absolute";
g.style.top="0px";g.style.left="0px";g.style.width="100%";g.style.height="100%";g.style.zIndex="0";c.appendChild(g);d.gl=Object(b.a)(g);d.registerEventListener(window,"resize",d.onResize.bind(d));return d}r(e,c);l(e,[{key:"makeCanvasOverlayElement",value:function(){var a=document.createElement("div");a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="100%";a.style.height="100%";a.style.zIndex="2";this.container.appendChild(a);return a}},{key:"disposed",value:function(){null!=
this.updatePending&&(cancelAnimationFrame(this.updatePending),this.updatePending=null)}},{key:"addPanel",value:function(a){this.panels.add(a)}},{key:"removePanel",value:function(a){this.panels.delete(a);a.dispose()}},{key:"onResize",value:function(){this.scheduleRedraw();for(var a=$jscomp.makeIterator(this.panels),b=a.next();!b.done;b=a.next())b.value.onResize()}},{key:"scheduleUpdate",value:function(){null===this.updatePending&&(this.updatePending=requestAnimationFrame(this.update.bind(this)))}},
{key:"scheduleRedraw",value:function(){this.needsRedraw||(this.needsRedraw=!0,this.scheduleUpdate())}},{key:"update",value:function(){this.updatePending=null;this.updateStarted.dispatch();if(this.needsRedraw){this.needsRedraw=!1;var a=this.gl,b=this.canvas;b.width=b.offsetWidth;b.height=b.offsetHeight;this.canvasRect=b.getBoundingClientRect();this.gl.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);b=$jscomp.makeIterator(this.panels);for(var c=b.next();!c.done;c=b.next()){c=c.value;
var e=c.element;c.visible&&0!==e.clientWidth&&0!==e.clientHeight&&0!==e.offsetWidth&&0!==e.offsetHeight&&(c.setGLViewport(),c.draw())}a.disable(a.SCISSOR_TEST);this.gl.clearColor(1,1,1,1);this.gl.colorMask(!1,!1,!1,!0);a.clear(a.COLOR_BUFFER_BIT);this.gl.colorMask(!0,!0,!0,!0)}this.updateFinished.dispatch()}}]);return e}(n.a)},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?
a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return b});n=c(0);var r=c(15),a=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=
!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),b=function(b){function c(a,b){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");var e=q(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));e.target=a;e.eventMap=b;e.registerEventListener(a,"wheel",function(a){e.dispatch("wheel",a)});e.registerEventListener(a,"click",function(a){e.dispatch("click"+a.button,a)});e.registerEventListener(a,"dblclick",function(a){e.dispatch("dblclick"+
a.button,a)});e.registerEventListener(a,"mousedown",function(a){e.dispatch("mousedown"+a.button,a)});e.registerEventListener(a,"mouseup",function(a){e.dispatch("mouseup"+a.button,a)});return e}m(c,b);a(c,[{key:"dispatch",value:function(a,b){Object(r.b)(a,b,this.eventMap)}}]);return c}(n.a)},function(n,e,c){e.b=function(c,e,r,a){for(;e<r;){var b=c[e];a(b)?++e:(--r,c[e]=c[r],c[r]=b)}return r};e.a=function(c,e){if(c.length===e)return c;e=new c.constructor(e);e.set(c);return e}},function(n,e,c){e.a=function(c,
e){var m=c.view.document,a=c.screenX,b=c.screenY,l=function(c){var k=a-c.screenX,h=b-c.screenY;a=c.screenX;b=c.screenY;e(c,k,h)},w=c.button,u=function(a){a.button===w&&(m.removeEventListener("mousemove",l,!0),m.removeEventListener("mouseup",u,!1))};m.addEventListener("mousemove",l,!0);m.addEventListener("mouseup",u,!1)}},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&
b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function r(a){for(var b=u.length,c=u[b-1],f=0;f<b;++f){var e=u[f];if(a>=e.lengthInNanometers){c=e;break}}return c}e.b=r;c.d(e,"a",function(){return k});n=c(0);var a=c(40),b=function g(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,
b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return g(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),w=[1.5,2,3,5,7.5,10],u=[{unit:"km",lengthInNanometers:1E12},{unit:"m",lengthInNanometers:1E9},{unit:"mm",
lengthInNanometers:1E6},{unit:"\u00b5m",lengthInNanometers:1E3},{unit:"nm",lengthInNanometers:1},{unit:"pm",lengthInNanometers:.001}],p=function(){function a(){m(this,a);this.allowedSignificands=w;this.prevTargetLengthInPixels=this.prevNanometersPerPixel=this.nanometersPerPixel=this.targetLengthInPixels=0}l(a,[{key:"update",value:function(){var a=this.nanometersPerPixel,b=this.targetLengthInPixels;if(this.prevNanometersPerPixel===a&&this.prevTargetLengthInPixels===b)return!1;this.prevNanometersPerPixel=
a;this.prevTargetLengthInPixels=b;var c=b*a;b=Math.pow(10,Math.floor(Math.log(c)/Math.LN10));c/=b;for(var e=1,g=$jscomp.makeIterator(this.allowedSignificands),k=g.next();!k.done;k=g.next())if(k=k.value,Math.abs(k-c)<Math.abs(e-c))e=k;else break;b*=e;c=r(b);this.lengthInPixels=Math.round(b/a);this.physicalUnit=c.unit;this.physicalLength=b/c.lengthInNanometers;return!0}}]);return a}(),k=function(c){function d(a,b){b=void 0===b?new p:b;m(this,d);var c=(d.__proto__||Object.getPrototypeOf(d)).call(this);
if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c.gl=a;c.dimensions=b;c.texture=null;c.width=0;c.height=0;return c}q(d,c);l(d,[{key:"update",value:function(){var b=this.dimensions,c=this.texture;if(b.update()||null===c){null===c&&(c=this.texture=this.gl.createTexture());var d=this.gl,e=document.createElement("canvas"),g=e.getContext("2d");g.font="bold 15px sans-serif";g.fillStyle="white";var k=b.physicalLength+
" "+b.physicalUnit,l=g.measureText(k);l=Math.max(b.lengthInPixels,l.width)+4;e.width=l;e.height=32;g.font="bold 15px sans-serif";g.textAlign="center";g.fillStyle="rgba(0, 0, 0, 0.3)";g.fillRect(0,0,l,32);g.fillStyle="white";g.fillText(k,l/2,17);g.fillRect(2,22,b.lengthInPixels,8);Object(a.c)(d,c,e);this.width=l;this.height=32}}},{key:"disposed",value:function(){this.gl.deleteTexture(this.texture);this.texture=null;b(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"disposed",this).call(this)}}]);
return d}(n.a)},function(n,e,c){n=new (c(86).a);e.a=n},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,
{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){var c,d,f;return function(e,g){if(void 0!==d&&(void 0===c||void 0===e||c.generation!==e.generation))return void 0===c&&f.addConsumer(g),d;c=void 0;f=new b.c;return d=a(e,f).then(function(a){c=a;f=void 0;return a},function(a){f.isCanceled&&(d=f=void 0);throw a;})}}c.d(e,"b",function(){return u});e.c=function(b){var c=0;return a(function(a,f){return b(f).then(function(a){return{generation:++c,
credentials:a}})})};c.d(e,"a",function(){return k});var b=c(14);n=c(0);var l=c(47),w=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),u=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);return b}(n.a),p=function(){function a(){q(this,a);this.providers=
new Map}w(a,[{key:"register",value:function(a,b){this.providers.set(a,b)}},{key:"getCredentialsProvider",value:function(a,b){var c=this.providers.get(a);if(void 0===c)throw Error("No registered credentials provider: "+JSON.stringify(a));return c(b)}}]);return a}(),k=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,new p))}r(b,a);w(b,[{key:"register",value:function(a,b){this.base.register(a,b)}}]);return b}(function(a){function b(a){q(this,b);var c=
m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.base=a;c.memoize=new l.b;return c}r(b,a);w(b,[{key:"getCredentialsProvider",value:function(a,b){var c=this;return this.memoize.get({key:a,parameters:b},function(){return c.registerDisposer(c.base.getCredentialsProvider(a,b).addRef())})}}]);return b}(n.a))},function(n,e,c){c.d(e,"c",function(){return q});e.a="/ocp/ca";e.b="/nd/sd";var q=function r(){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");};q.RPC_ID=
"ndstore/VolumeChunkSource"},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,
b):a.__proto__=b)}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function a(a,b,c){Object(z.u)(a);var f=Object(z.w)(a,"Base",function(a){return new C(a)});switch(f.typeName){case "uint8blk":case "grayscale8":return new F(a,b,f,d.c.JPEG,c);case "imagetile":return new W(a,b,f);case "labels64":case "labelblk":return new F(a,b,f,d.c.COMPRESSED_SEGMENTATION,c);default:throw Error("DVID data type "+JSON.stringify(f.typeName)+" is not supported.");}}function b(a){try{for(var b=
Object(z.v)(a,function(a){return new V(a)}),c=new Map,d=$jscomp.makeIterator(b),f=d.next();!f.done;f=d.next()){var e=$jscomp.makeIterator(f.value),g=e.next().value,h=e.next().value;c.set(g,h);for(var k=$jscomp.makeIterator(h.vnodes),l=k.next();!l.done;l=k.next()){var v=l.value;if(v!==g){var p=new V(h);c.set(v,p)}}}for(var x=$jscomp.makeIterator(c),u=x.next();!u.done;u=x.next()){var m=$jscomp.makeIterator(u.value),y=m.next().value;m.next().value.uuid=y}return c}catch(Ka){throw Error("Failed to parse DVID repositories info: "+
Ka.message);}}function l(a,b){return a.memoize.getUncounted({type:"dvid:getServerInfo",baseUrls:b},function(){var a=Object(B.d)(Object(B.b)(b,"/api/repos/info","GET"),"json").then(function(a){return new M(a)}),c="repository info for DVID server "+b[0];y.a.forPromise(a,{initialMessage:"Retrieving "+c+".",delay:!0,errorPrefix:"Error retrieving "+c+": "});return a})}function w(a,b,c,d){return a.memoize.getUncounted({type:"dvid:getInstanceDetails",baseUrls:b,nodeKey:c,name:d.name},function(){var a=Object(B.d)(Object(B.b)(b,
"/api/node/"+c+"/"+d.name+"/info","GET"),"json"),f="datainstance info for node "+c+" and instance "+d.name+" "+("on DVID server "+b[0]);y.a.forPromise(a,{initialMessage:"Retrieving "+f+".",delay:!0,errorPrefix:"Error retrieving "+f+": "});return a.then(function(a){a=Object(z.w)(a,"Extended",z.u);d.lowerVoxelBound=Object(z.w)(a,"MinPoint",function(a){return Object(z.d)(E.p.create(),a)});d.upperVoxelBound=Object(z.w)(a,"MaxPoint",function(a){return Object(z.d)(E.p.create(),a)});return d})})}function u(a,
b,c,d){return l(a,b).then(function(f){f=f.getNode(c);if(void 0===f)throw Error("Invalid node: "+JSON.stringify(c)+".");f=f.dataInstances.get(d);if(!(f instanceof F||f instanceof W))throw Error("Invalid data instance "+d+".");return w(a,b,c,f)}).then(function(f){return a.memoize.getUncounted({type:"dvid:MultiscaleVolumeChunkSource",baseUrls:b,nodeKey:c,dataInstanceKey:d},function(){return new Q(a,b,c,d,f)})})}function p(a,b){var c=b.match(aa);if(null===c)throw Error("Invalid DVID URL: "+JSON.stringify(b)+
".");return u(a,[c[1]],c[2],c[3])}function k(a,b){return{offset:0,completions:Object(G.c)(b,a.dataInstances.values(),function(a){return a.name},function(a){return""+a.base.typeName})}}function h(a,b){var c=b.match(/^(?:([^\/]+)(?:\/([^\/]*))?)?$/);if(null===c)throw Error("Invalid DVID URL syntax.");if(void 0===c[2])return{offset:0,completions:Object(G.c)(b,a.repositories.values(),function(a){return a.uuid+"/"},function(a){return a.alias+": "+a.description})};b=c[1];a=a.getNode(b);return Object(G.a)(b.length+
1,k(a,c[2]))}function g(a,b){a=a.match(/^((?:http|https):\/\/[^\/]+)\/(.*)$/);if(null===a)return Promise.reject(null);var c=a[1],d=a[2];return l(b,[c]).then(function(a){return Object(G.a)(c.length+1,h(a,d))})}Object.defineProperty(e,"__esModule",{value:!0});c.d(e,"getVolume",function(){return p});c.d(e,"volumeCompleter",function(){return g});c.d(e,"DataInstanceBaseInfo",function(){return C});c.d(e,"DataInstanceInfo",function(){return H});c.d(e,"VolumeDataInstanceInfo",function(){return F});c.d(e,
"TileLevelInfo",function(){return T});c.d(e,"TileDataInstanceInfo",function(){return W});e.parseDataInstance=a;c.d(e,"RepositoryInfo",function(){return V});e.parseRepositoriesInfo=b;c.d(e,"ServerInfo",function(){return M});e.getServerInfo=l;e.getDataInstanceDetails=w;c.d(e,"MultiscaleVolumeChunkSource",function(){return Q});e.getShardedVolume=u;e.completeInstanceName=k;e.completeNodeAndInstance=h;c.d(e,"DVIDDataSource",function(){return ha});n=c(10);e=c(24);var d=c(153),f=c(8),v=c(18),y=c(26),G=c(30),
E=c(1),B=c(31),z=c(2),D=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),x=new Map;x.set("uint8",f.a.UINT8);x.set("uint32",f.a.UINT32);x.set("uint64",f.a.UINT64);var C=function(){function a(b){r(this,a);this.obj=b;Object(z.u)(b);Object(z.w)(b,"TypeName",z.B)}D(a,[{key:"typeName",get:function(){return this.obj.TypeName}}]);
return a}(),H=function P(a,b,c){r(this,P);this.obj=a;this.name=b;this.base=c},K=function(a){function b(){r(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}m(b,a);return b}(Object(n.f)(v.b,d.d)),F=function(a){function b(a,c,d,f,e){r(this,b);d=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c,d));d.encoding=f;a=Object(z.w)(a,"Extended",z.u);f=Object(z.w)(a,"Values",function(a){return Object(z.a)(a,z.u)});if(1>f.length)throw Error("Expected Extended.Values property to have length >= 1, but received: ${JSON.stringify(extendedValues)}.");
d.numLevels=1;for(e=new Set(e);e.has(c+"_"+d.numLevels.toString());)d.numLevels+=1;d.dataType=Object(z.w)(f[0],"DataType",function(a){return Object(z.t)(a,x)});d.voxelSize=Object(z.w)(a,"VoxelSize",function(a){return Object(z.c)(E.p.create(),a,z.p)});d.numChannels=1;return d}m(b,a);D(b,[{key:"getSources",value:function(a,b,c){for(var e=this.encoding,g=[],h={},k=0;k<this.numLevels;h={volParameters:h.volParameters},++k){for(var l=E.p.scale(E.p.create(),this.voxelSize,Math.pow(2,k)),v=E.p.create(),p=
E.p.create(),x=0;3>x;++x)v[x]=Math.floor(this.voxelSize[x]/l[x]*this.lowerVoxelBound[x]),p[x]=Math.ceil(this.voxelSize[x]/l[x]*this.upperVoxelBound[x]);x=b.dataInstanceKey;0<k&&(x+="_"+k.toString());h.volParameters={baseUrls:b.baseUrls,nodeKey:b.nodeKey,dataInstanceKey:x,encoding:e};l=f.c.getDefaults({voxelSize:l,dataType:this.dataType,numChannels:this.numChannels,transform:E.j.fromTranslation(E.j.create(),E.p.multiply(E.p.create(),v,l)),baseVoxelOffset:v,upperVoxelBound:E.p.subtract(E.p.create(),
p,v),volumeType:this.volumeType,volumeSourceOptions:c,compressedSegmentationBlockSize:e===d.c.COMPRESSED_SEGMENTATION?E.p.fromValues(8,8,8):void 0}).map(function(b){return function(c){return a.getChunkSource(K,{spec:c,parameters:b.volParameters})}}(h));g.push(l)}return g}},{key:"volumeType",get:function(){return this.encoding===d.c.COMPRESSED_SEGMENTATION?f.d.SEGMENTATION:f.d.IMAGE}}]);return b}(H),T=function Va(a){r(this,Va);Object(z.u)(a);this.resolution=Object(z.w)(a,"Resolution",function(a){return Object(z.c)(E.p.create(),
a,z.p)});this.tileSize=Object(z.w)(a,"TileSize",function(a){return Object(z.c)(E.p.create(),a,z.A)})},J=[[0,1],[0,2],[1,2]],R=function(a){function b(){r(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}m(b,a);return b}(Object(n.f)(v.b,d.a)),W=function(a){function b(a,c,f){r(this,b);c=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c,f));a=Object(z.w)(a,"Extended",z.u);c.levels=Object(z.w)(a,"Levels",function(a){return Object(z.v)(a,function(a){return new T(a)})});
f=c.levels.get("0");if(void 0===f)throw Error("Level 0 is not defined.");c.voxelSize=f.resolution;var e=Object(z.w)(a,"MinTileCoord",function(a){return Object(z.c)(E.p.create(),a,z.s)}),g=Object(z.w)(a,"MaxTileCoord",function(a){return Object(z.c)(E.p.create(),a,z.s)});c.lowerVoxelBound=E.p.multiply(E.p.create(),f.tileSize,e);c.upperVoxelBound=E.p.multiply(E.p.create(),f.tileSize,g);a=Object(z.w)(a,"Encoding",function(a){return a});switch(a){case 2:c.encoding=d.b.JPEG;break;default:throw Error("Unsupported tile encoding: "+
JSON.stringify(a)+".");}return c}m(b,a);D(b,[{key:"dataType",get:function(){return f.a.UINT8}},{key:"volumeType",get:function(){return f.d.IMAGE}},{key:"numChannels",get:function(){return 1}}]);D(b,[{key:"getSources",value:function(a,b,c){for(var d=this,e=[],g=this.numChannels,h=this.dataType,k=this.encoding,l={},v=$jscomp.makeIterator(this.levels),p=v.next();!p.done;l={levelInfo:l.levelInfo,level:l.level},p=v.next())p=$jscomp.makeIterator(p.value),l.level=p.next().value,l.levelInfo=p.next().value,
p=J.map(function(e){return function(l){for(var v=E.p.clone(d.voxelSize),p=E.p.fromValues(1,1,1),x=0;2>x;++x)v[l[x]]=e.levelInfo.resolution[l[x]],p[l[x]]=e.levelInfo.tileSize[l[x]];x=E.p.create();for(var u=E.p.create(),m=0;3>m;++m)x[m]=Math.floor(d.voxelSize[m]/v[m]*d.lowerVoxelBound[m]),u[m]=Math.ceil(d.voxelSize[m]/v[m]*d.upperVoxelBound[m]);v=f.c.make({voxelSize:v,chunkDataSize:p,numChannels:g,dataType:h,lowerVoxelBound:x,upperVoxelBound:u,volumeSourceOptions:c});return a.getChunkSource(R,{spec:v,
parameters:{baseUrls:b.baseUrls,nodeKey:b.nodeKey,dataInstanceKey:b.dataInstanceKey,encoding:k,level:e.level,dims:l[0]+"_"+l[1]}})}}(l)),e.push(p);return e}}]);return b}(H),V=function Wa(b){r(this,Wa);this.errors=[];this.dataInstances=new Map;this.vnodes=new Set;if(b instanceof Wa)this.alias=b.alias,this.description=b.description,this.errors=b.errors,this.dataInstances=b.dataInstances;else{Object(z.u)(b);this.alias=Object(z.w)(b,"Alias",z.B);this.description=Object(z.w)(b,"Description",z.B);for(var c=
Object(z.w)(b,"DataInstances",z.u),d=Object.keys(c),f=$jscomp.makeIterator(d),e=f.next();!e.done;e=f.next()){e=e.value;try{this.dataInstances.set(e,a(c[e],e,d))}catch(Ja){e="Failed to parse data instance "+JSON.stringify(e)+": "+Ja.message,console.log(e),this.errors.push(e)}}b=Object(z.w)(b,"DAG",z.u);b=Object(z.w)(b,"Nodes",z.u);b=$jscomp.makeIterator(Object.keys(b));for(e=b.next();!e.done;e=b.next())this.vnodes.add(e.value)}},M=function(){function a(c){r(this,a);this.repositories=b(c)}D(a,[{key:"getNode",
value:function(a){for(var b=[],c=$jscomp.makeIterator(this.repositories.keys()),d=c.next();!d.done;d=c.next())d=d.value,d.startsWith(a)&&b.push(d);if(1!==b.length)throw Error("Node key "+JSON.stringify(a)+" matches "+JSON.stringify(b)+" nodes.");return this.repositories.get(b[0])}}]);return a}(),Q=function(){function a(b,c,d,f,e){r(this,a);this.chunkManager=b;this.baseUrls=c;this.nodeKey=d;this.dataInstanceKey=f;this.info=e}D(a,[{key:"getSources",value:function(a){return this.info.getSources(this.chunkManager,
{baseUrls:this.baseUrls,nodeKey:this.nodeKey,dataInstanceKey:this.dataInstanceKey},a)}},{key:"getMeshSource",value:function(){return null}},{key:"dataType",get:function(){return this.info.dataType}},{key:"numChannels",get:function(){return this.info.numChannels}},{key:"volumeType",get:function(){return this.info.volumeType}}]);return a}(),aa=/^((?:http|https):\/\/[^\/]+)\/([^\/]+)\/([^\/]+)$/,ha=function(a){function b(){r(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}
m(b,a);D(b,[{key:"getVolume",value:function(a,b){return p(a,b)}},{key:"volumeCompleter",value:function(a,b){return g(a,b)}},{key:"description",get:function(){return"DVID"}}]);return b}(e.a)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&
null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){var c=Object(F.a)(a,F.u);if(1>c.length)throw Error("No stacks found for owner object.");a=new Map;var d=Object(F.w)(c[0],"stackId",l);c=$jscomp.makeIterator(c);for(var f=c.next();!f.done;f=c.next()){var e=f.value;
f=Object(F.w)(e,"stackId",b);Object(F.u)(e);var g=Object(F.w)(e,"state",F.B);if(V.has(g)){g=Object(F.w)(e,"stats",F.u);var h=g;Object(F.u)(h);h=Object(F.w)(h,"stackBounds",F.u);var k=H.p.create();k[0]=Object(F.w)(h,"minX",F.q);k[1]=Object(F.w)(h,"minY",F.q);k[2]=Object(F.w)(h,"minZ",F.q);h=k;k=g;Object(F.u)(k);k=Object(F.w)(k,"stackBounds",F.u);var v=H.p.create();v[0]=Object(F.w)(k,"maxX",F.q);v[1]=Object(F.w)(k,"maxY",F.q);v[2]=Object(F.w)(k,"maxZ",F.q);k=v;v=[];g.hasOwnProperty("channelNames")&&
(v=w(g));g=Object(F.w)(e,"currentVersion",u);e=Object(F.w)(e,"stackId",p);e={lowerVoxelBound:h,upperVoxelBound:k,voxelResolution:g,project:e,channels:v}}else e=void 0;void 0!==e&&(g=e.project,h=a.get(g),void 0===h&&(h=new Map,a.set(g,{stacks:h}),h=a.get(g)),h.stacks.set(f,e))}return{owner:d,projects:a}}function b(a){Object(F.u)(a);return Object(F.w)(a,"stack",F.B)}function l(a){Object(F.u)(a);return Object(F.w)(a,"owner",F.B)}function w(a){Object(F.u)(a);return Object(F.w)(a,"channelNames",function(a){return Object(F.a)(a,
F.B)})}function u(a){Object(F.u)(a);var b=H.p.create();try{b[0]=Object(F.w)(a,"stackResolutionX",F.q),b[1]=Object(F.w)(a,"stackResolutionY",F.q),b[2]=Object(F.w)(a,"stackResolutionZ",F.q)}catch(Wa){b[0]=1,b[1]=1,b[2]=1}return b}function p(a){Object(F.u)(a);return Object(F.w)(a,"project",F.B)}function k(a,b){for(var c=0,d=0;2>d;d++)c<a.upperVoxelBound[d]&&(c=a.upperVoxelBound[d]);for(a=0;c>b;)c/=2,a++;return a}function h(b,c,d){return b.memoize.getUncounted({type:"render:getOwnerInfo",hostnames:c,
owner:d},function(){return Object(K.d)(Object(K.b)(c,"/render-ws/v1/owner/"+d+"/stacks"),"json").then(a)})}function g(a,b,c){var d=c.match(Q);if(null===d)throw Error("Invalid volume path "+JSON.stringify(c));var f=d[1],e=d[2],g=d[3],k=d[4],l=Object(F.e)(d[5]||"");return a.memoize.getUncounted({type:"render:MultiscaleVolumeChunkSource",hostnames:b,path:c},function(){return h(a,b,f).then(function(c){return new M(a,b,c,g,e,k,l)})})}function d(a,b){var c=b.match(aa);if(null===c)throw Error("Invalid render volume path: "+
JSON.stringify(b));b=c[1].split(",");return g(a,b,c[2])}function f(a,b,c){var d=c.match(/^(?:([^\/]+)(?:\/([^\/]*))?(?:\/([^\/]*))?(\/.*?)?)?$/);if(null===d||void 0===d[2])return Promise.reject(null);if(void 0===d[3]){var f=d[2]||"";return h(a,b,d[1]).then(function(a){a=Object(C.c)(f,a.projects,function(a){return a[0]+"/"},function(){});return{offset:d[1].length+1,completions:a}})}if(void 0===d[4]){var e=d[3]||"";return h(a,b,d[1]).then(function(a){a=a.projects.get(d[2]);if(void 0===a)return Promise.reject(null);
a=Object(C.c)(e,a.stacks,function(a){return a[0]+"/"},function(a){return"("+a[1].project+")"});return{offset:d[1].length+d[2].length+2,completions:a}})}var g=d[4].substr(1)||"";return h(a,b,d[1]).then(function(a){a=a.projects.get(d[2]);if(void 0===a)return Promise.reject(null);a=a.stacks.get(d[3]);if(void 0===a)return Promise.reject(null);a=a.channels;if(0===a.length)return Promise.reject(null);a=Object(C.c)(g,a,function(a){return a},function(){});return{offset:d[1].length+d[2].length+d[3].length+
3,completions:a}})}function v(a,b){var c=a.match(aa);if(null===c)return Promise.reject(null);a=c[1].split(",");return f(b,a,c[2]).then(function(a){return Object(C.a)(c[1].length+1,a)})}function y(a,b){var c=b.match(aa);if(null===c)throw Error("Invalid render point path: "+JSON.stringify(b));return G(a,[c[1]],c[2])}function G(a,b,c){var d=c.match(Q);if(null===d)throw Error("Invalid point path "+JSON.stringify(c));var f=d[1],e=d[2],g=d[3],k=Object(F.e)(d[4]||"");return a.memoize.getUncounted({type:"render:MultiscaleVectorGraphicsChunkSource",
hostnames:b,path:c},function(){return h(a,b,f).then(function(c){return new ha(a,b,c,g,e,k)})})}Object.defineProperty(e,"__esModule",{value:!0});c.d(e,"getVolume",function(){return d});c.d(e,"volumeCompleter",function(){return v});c.d(e,"MultiscaleVolumeChunkSource",function(){return M});e.computeStackHierarchy=k;e.getOwnerInfo=h;e.getShardedVolume=g;e.stackAndProjectCompleter=f;c.d(e,"MultiscaleVectorGraphicsChunkSource",function(){return ha});e.getPointMatches=y;e.getShardedPointMatches=G;c.d(e,
"RenderDataSource",function(){return I});n=c(10);e=c(24);var E=c(155),B=c(56),z=c(90),D=c(8),x=c(18),C=c(30),H=c(1),K=c(31),F=c(2),T=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),J=new Set(["jpg"]),R=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}
r(b,a);return b}(Object(n.f)(x.b,E.b)),W=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);return b}(Object(n.f)(z.b,E.a)),V=new Set(["COMPLETE"]),M=function(){function a(b,c,d,f,e,g,h){q(this,a);this.chunkManager=b;this.baseUrls=c;this.ownerInfo=d;this.project=e;this.parameters=h;b=d.projects.get(e);if(void 0===b)throw Error("Specified project "+JSON.stringify(e)+" does not exist for "+("specified owner "+JSON.stringify(d.owner)));
if(void 0===f){f=Array.from(b.stacks.keys());if(1!==f.length)throw Error("Dataset contains multiple stacks: "+JSON.stringify(f));f=f[0]}d=b.stacks.get(f);if(void 0===d)throw Error("Specified stack "+JSON.stringify(f)+" is not one of the supported stacks: "+JSON.stringify(Array.from(b.stacks.keys())));this.stack=f;this.stackInfo=d;void 0!==g&&0<g.length&&(this.channel=g);this.minIntensity=Object(F.y)(h.minIntensity);this.maxIntensity=Object(F.y)(h.maxIntensity);this.maxTileSpecsToRender=Object(F.y)(h.maxTileSpecsToRender);
this.filter=Object(F.x)(h.filter);g=Object(F.z)(h.encoding);if(void 0===g)g="jpg";else if(!J.has(g))throw Error("Invalid encoding: "+JSON.stringify(g)+".");this.encoding=g;this.numLevels=Object(F.y)(h.numlevels);this.dims=H.p.create();h=Object(F.y)(h.tilesize);void 0===h&&(h=1024);this.dims[0]=h;this.dims[1]=h;this.dims[2]=1}T(a,[{key:"getSources",value:function(a){var b=[],c=this.numLevels;void 0===c&&(c=k(this.stackInfo,this.dims[0]));for(var d=H.p.create(),f=H.p.create(),e=0;3>e;e++)d[e]=this.stackInfo.lowerVoxelBound[e]*
this.stackInfo.voxelResolution[e],f[e]=this.stackInfo.upperVoxelBound[e]*this.stackInfo.voxelResolution[e];for(e=0;e<c;e++){for(var g=H.p.clone(this.stackInfo.voxelResolution),h=H.p.fromValues(1,1,1),l=0;2>l;++l)g[l]*=Math.pow(2,e),h[l]=this.dims[l];l=H.p.create();for(var v=H.p.create(),p=0;3>p;p++)l[p]=Math.floor(this.stackInfo.voxelResolution[p]/g[p]*this.stackInfo.lowerVoxelBound[p]),v[p]=Math.ceil(this.stackInfo.voxelResolution[p]/g[p]*this.stackInfo.upperVoxelBound[p]);g=D.c.make({voxelSize:g,
chunkDataSize:h,numChannels:this.numChannels,dataType:this.dataType,lowerClipBound:d,upperClipBound:f,lowerVoxelBound:l,upperVoxelBound:v,volumeSourceOptions:a});g=this.chunkManager.getChunkSource(R,{spec:g,parameters:{baseUrls:this.baseUrls,owner:this.ownerInfo.owner,project:this.stackInfo.project,stack:this.stack,channel:this.channel,minIntensity:this.minIntensity,maxIntensity:this.maxIntensity,maxTileSpecsToRender:this.maxTileSpecsToRender,filter:this.filter,dims:this.dims[0]+"_"+this.dims[1],
level:e,encoding:this.encoding}});b.push([g])}return b}},{key:"getMeshSource",value:function(){return null}},{key:"dataType",get:function(){return D.a.UINT8}},{key:"numChannels",get:function(){return 3}},{key:"volumeType",get:function(){return D.d.IMAGE}}]);return a}(),Q=/^([^\/?]+)(?:\/([^\/?]+))?(?:\/([^\/?]+))(?:\/([^\/?]*))?(?:\?(.*))?$/,aa=/^((?:(?:(?:http|https):\/\/[^,\/]+)[^\/?])+)\/(.*)$/,ha=function(){function a(b,c,d,f,e,g){q(this,a);this.chunkManager=b;this.baseUrls=c;this.ownerInfo=d;
this.project=e;this.parameters=g;b=d.projects.get(e);if(void 0===b)throw Error("Specified project "+JSON.stringify(e)+" does not exist for "+("specified owner "+JSON.stringify(d.owner)));if(void 0===f){f=Array.from(b.stacks.keys());if(1!==f.length)throw Error("Dataset contains multiple stacks: "+JSON.stringify(f));f=f[0]}d=b.stacks.get(f);if(void 0===d)throw Error("Specified stack "+JSON.stringify(f)+" is not one of the supported stacks: "+JSON.stringify(Array.from(b.stacks.keys())));this.stack=f;
this.stackInfo=d;d=Object(F.z)(g.matchCollection);void 0===d&&(d=f);this.matchCollection=d;f=Object(F.y)(g.zoffset);void 0===f&&(f=1);this.zoffset=f;this.dims=H.p.create();g=Object(F.y)(g.tilesize);void 0===g&&(g=1024);this.dims[0]=g;this.dims[1]=g;this.dims[2]=1}T(a,[{key:"getSources",value:function(a){for(var b=H.p.clone(this.stackInfo.voxelResolution),c=H.p.create(),d=H.p.create(),f=0;3>f;f++)c[f]=Math.floor(this.stackInfo.voxelResolution[f]/b[f]*this.stackInfo.lowerVoxelBound[f]),d[f]=Math.ceil(this.stackInfo.voxelResolution[f]/
b[f]*this.stackInfo.upperVoxelBound[f]);f=H.p.clone(d);f[0]+=Math.abs(c[0]);f[1]+=Math.abs(c[1]);f[2]=1;a=B.b.make({voxelSize:b,lowerVoxelBound:c,upperVoxelBound:d,chunkDataSize:f,vectorGraphicsSourceOptions:a});return[[this.chunkManager.getChunkSource(W,{spec:a,parameters:{baseUrls:this.baseUrls,owner:this.ownerInfo.owner,project:this.stackInfo.project,stack:this.stack,encoding:"points",matchCollection:this.matchCollection,zoffset:this.zoffset}})]]}}]);return a}(),I=function(a){function b(){q(this,
b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);T(b,[{key:"getVolume",value:function(a,b){return d(a,b)}},{key:"volumeCompleter",value:function(a,b){return v(a,b)}},{key:"getVectorGraphicsSource",value:function(a,b){return y(a,b)}},{key:"description",get:function(){return"Render"}}]);return b}(e.a)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return p});c.d(e,"b",function(){return h});n=c(35);e=c(52);var a=c(56),b=c(17),l=c(6),w=function d(a,b,c){null===
a&&(a=Function.prototype);var f=Object.getOwnPropertyDescriptor(a,b);if(void 0===f){if(a=Object.getPrototypeOf(a),null!==a)return d(a,b,c)}else{if("value"in f)return f.value;b=f.get;return void 0===b?void 0:b.call(c)}},u=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),p=function(b){function c(b,d){d=void 0===
d?{}:d;d=void 0===d.sourceOptions?{}:d.sourceOptions;q(this,c);b=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,b.chunkManager,b.getSources(d)));b.shader=void 0;b.shaderUpdated=!0;b.rpcId=null;d=b.registerDisposer(new l.b);d.RPC_TYPE_ID=a.a;d.initializeCounterpart(b.chunkManager.rpc,{sources:b.sourceIds});b.rpcId=d.rpcId;return b}r(c,b);u(c,[{key:"defineShader",value:function(a){a.addFragmentCode("\nvoid emit(vec4 color) {\n  gl_FragColor = color;\n}\nvoid emitRGBA(vec4 rgba) {\n  emit(vec4(rgba.rgb, rgba.a * uOpacity));\n}\nvoid emitRGB(vec3 rgb) {\n  emit(vec4(rgb, uOpacity));\n}\nvoid emitGrayscale(float value) {\n  emit(vec4(value, value, value, uOpacity));\n}\nvoid emitTransparent() {\n  emit(vec4(0.0, 0.0, 0.0, 0.0));\n}\n")}},
{key:"beginSlice",value:function(a){a=this.shader;a.bind();return a}}]);return c}(e.a),k=function(a){function c(a,b){q(this,c);a=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,a,b));a.vertexPositions=b.vertexPositions;a.numPoints=Math.floor(a.vertexPositions.length/3);return a}r(c,a);u(c,[{key:"copyToGPU",value:function(a){w(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"copyToGPU",this).call(this,a);this.vertexBuffer=b.a.fromData(a,this.vertexPositions,a.ARRAY_BUFFER,a.STATIC_DRAW)}},
{key:"freeGPUMemory",value:function(a){w(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"freeGPUMemory",this).call(this,a);this.vertexBuffer.dispose()}}]);return c}(n.b),h=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);u(b,[{key:"getChunk",value:function(a){return new k(this,a)}},{key:"vectorGraphicsCoordinatesInVoxels",get:function(){return!0}}]);return b}(n.c)},function(n,e,c){function q(a,c){if("function"!==typeof c&&
null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}Object.defineProperty(e,"__esModule",{value:!0});c.d(e,"OpenConnectomeDataSource",function(){return a});var m=c(87),r=["http://openconnecto.me","http://www.openconnecto.me"],a=function(a){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");
var a=(b.__proto__||Object.getPrototypeOf(b)).call(this,"NDstore server hosted at openconnecto.me",r,m.a);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&"function"!==typeof a?this:a}q(b,a);return b}(c(41).SingleServerDataSource)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){return a.getChunkSource(G,{parameters:b})}function b(a,b,c){return a.memoize.getUncounted({type:"precomputed:MultiscaleVolumeChunkSource",
baseUrls:b,path:c},function(){return Object(d.d)(Object(d.b)(b,c+"/info"),"json").then(function(d){return new B(a,b,c,d)})})}function l(b,c){var f=$jscomp.makeIterator(Object(d.c)(c));c=f.next().value;f=f.next().value;return a(b,{baseUrls:c,path:f,lod:0})}function w(a,c){var f=$jscomp.makeIterator(Object(d.c)(c));c=f.next().value;f=f.next().value;return b(a,c,f)}Object.defineProperty(e,"__esModule",{value:!0});c.d(e,"getMeshSource",function(){return l});c.d(e,"getVolume",function(){return w});c.d(e,
"MultiscaleVolumeChunkSource",function(){return B});e.getShardedMeshSource=a;e.getShardedVolume=b;c.d(e,"PrecomputedDataSource",function(){return z});n=c(10);e=c(24);var u=c(158),p=c(49),k=c(8),h=c(18),g=c(1),d=c(31),f=c(2),v=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),y=function(a){function b(){q(this,
b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);return b}(Object(n.f)(h.b,u.c)),G=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);return b}(Object(n.f)(p.b,u.a)),E=function x(a){q(this,x);Object(f.u)(a);this.resolution=Object(f.w)(a,"resolution",function(a){return Object(f.c)(g.p.create(),a,f.p)});this.voxelOffset=Object(f.w)(a,"voxel_offset",function(a){return Object(f.d)(g.p.create(),a)});
this.size=Object(f.w)(a,"size",function(a){return Object(f.c)(g.p.create(),a,f.A)});this.chunkSizes=Object(f.w)(a,"chunk_sizes",function(a){return Object(f.a)(a,function(a){return Object(f.c)(g.p.create(),a,f.A)})});if(0===this.chunkSizes.length)throw Error("No chunk sizes specified.");(this.encoding=Object(f.w)(a,"encoding",function(a){return Object(f.n)(a,u.b)}))===u.b.COMPRESSED_SEGMENTATION&&(this.compressedSegmentationBlockSize=Object(f.w)(a,"compressed_segmentation_block_size",function(a){return Object(f.c)(g.p.create(),
a,f.A)}));this.key=Object(f.w)(a,"key",f.B)},B=function(){function b(a,c,d,e){q(this,b);this.chunkManager=a;this.baseUrls=c;this.path=d;Object(f.u)(e);this.dataType=Object(f.w)(e,"data_type",function(a){return Object(f.n)(a,k.a)});this.numChannels=Object(f.w)(e,"num_channels",f.A);this.volumeType=Object(f.w)(e,"type",function(a){return Object(f.n)(a,k.d)});this.mesh=Object(f.w)(e,"mesh",f.z);this.scales=Object(f.w)(e,"scales",function(a){return Object(f.a)(a,function(a){return new E(a)})})}v(b,[{key:"getMeshSource",
value:function(){var b=this.mesh;return void 0===b?null:a(this.chunkManager,{baseUrls:this.baseUrls,path:this.path+"/"+b,lod:0})}},{key:"getSources",value:function(a){var b=this;return this.scales.map(function(c){return k.c.getDefaults({voxelSize:c.resolution,dataType:b.dataType,numChannels:b.numChannels,transform:g.j.fromTranslation(g.j.create(),g.p.multiply(g.p.create(),c.resolution,c.voxelOffset)),upperVoxelBound:c.size,volumeType:b.volumeType,chunkDataSizes:c.chunkSizes,baseVoxelOffset:c.voxelOffset,
compressedSegmentationBlockSize:c.compressedSegmentationBlockSize,volumeSourceOptions:a}).map(function(a){return b.chunkManager.getChunkSource(y,{spec:a,parameters:{baseUrls:b.baseUrls,path:b.path+"/"+c.key,encoding:c.encoding}})})})}}]);return b}(),z=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);v(b,[{key:"getVolume",value:function(a,b){return w(a,b)}},{key:"getMeshSource",value:function(a,b){return l(a,b)}},{key:"description",
get:function(){return"Precomputed file-backed data source"}}]);return b}(e.a)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=
Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b,c){return a.rpc.promiseInvoke(l.a,{chunkManager:a.addCounterpartRef(),url:b},c)}function b(b,c){return b.memoize.getUncounted({type:"nifti/getVolume",url:c},function(){return a(b,c,p.e).then(function(a){return new d(b,c,a)})})}Object.defineProperty(e,"__esModule",{value:!0});c.d(e,"getVolume",function(){return b});c.d(e,
"MultiscaleVolumeChunkSource",function(){return d});c.d(e,"NiftiDataSource",function(){return f});n=c(10);e=c(24);var l=c(160),w=c(8),u=c(18),p=c(14),k=c(1),h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),g=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,
arguments))}r(b,a);return b}(Object(n.f)(u.b,l.b)),d=function(){function a(b,c,d){q(this,a);this.chunkManager=b;this.url=c;this.info=d}h(a,[{key:"getSources",value:function(a){var b=this.info;a=w.c.withDefaultCompression({volumeType:b.volumeType,chunkDataSize:b.volumeSize,dataType:b.dataType,voxelSize:b.voxelSize,numChannels:b.numChannels,upperVoxelBound:b.volumeSize,transform:Object(k.o)(k.j.create(),b.qoffset,b.quatern,k.g,b.qfac),volumeSourceOptions:a});return[[this.chunkManager.getChunkSource(g,
{spec:a,parameters:{url:this.url}})]]}},{key:"getMeshSource",value:function(){return null}},{key:"numChannels",get:function(){return this.info.numChannels}},{key:"dataType",get:function(){return this.info.dataType}},{key:"volumeType",get:function(){return this.info.volumeType}}]);return a}(),f=function(a){function c(){q(this,c);return m(this,(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments))}r(c,a);h(c,[{key:"getVolume",value:function(a,c){return b(a,c)}},{key:"description",get:function(){return"Single NIfTI file"}}]);
return c}(e.a)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,
writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){for(var b=0,c=0;3>c;++c)0>a[c]&&(b+=1<<c);return b}c.d(e,"a",function(){return E});var b=c(23);n=c(52);var l=c(8);e=c(0);var w=c(1),u=c(17),p=c(28),k=c(7),h=c(6),g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,
d);return b}}(),d=w.p.create(),f=w.p.create(),v=w.j.create(),y=function(a){function b(a){q(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.outputVertexIndices=c.registerDisposer(u.a.fromData(a,new Float32Array([0,1,2,3,4,5]),a.ARRAY_BUFFER,a.STATIC_DRAW));c.vertexBasePositions=[0,0,0,1,0,0,0,1,0,1,1,0,0,0,1,1,0,1,0,1,1,1,1,1];a=[0,1,2,4,5,3,6,7];for(var d=[0,1,2,5,3,4,6,7],f=[0,1,1,4,4,7,4,7,1,5,0,1,1,4,4,7,0,2,2,5,5,7,5,7,2,6,0,2,2,5,5,7,0,3,3,6,6,7,6,7,3,4,0,3,3,6,6,7],
e=[0,1,2,3,4,5,6,7,1,4,5,0,3,7,2,6,2,6,0,5,7,3,1,4,3,0,6,4,1,2,7,5,4,3,7,1,0,6,5,2,5,2,1,7,6,0,4,3,6,7,3,2,5,4,0,1,7,5,4,6,2,1,3,0],g=[],h=0;8>h;++h)for(var k=0;k<f.length;++k)g.push(a[e[8*d[h]+f[k]]]);c.vertexIndices=new Int32Array(g);return c}r(b,a);g(b,null,[{key:"get",value:function(a){return a.memoize.get("SliceViewShaderBuffers",function(){return new b(a)})}}]);return b}(e.a),G=function(b){function c(a){q(this,c);var b=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));b.data=b.registerDisposer(y.get(a));
return b}r(c,b);g(c,null,[{key:"get",value:function(a){return a.memoize.get("volume.VolumeSliceVertexComputationManager",function(){return new c(a)})}}]);g(c,[{key:"defineShader",value:function(a){var b=this.data;a.addAttribute("highp float","aVertexIndexFloat");a.addUniform("highp vec3","uTranslation");a.addUniform("highp mat4","uProjectionMatrix");a.addUniform("highp vec3","uPlaneNormal");a.addUniform("highp float","uPlaneDistance");a.addUniform("highp ivec2","uVertexIndex",24);a.addUniform("highp vec3",
"uVertexBasePosition",8);a.addInitializer(function(a){a.gl.uniform3fv(a.uniform("uVertexBasePosition"),new Float32Array(b.vertexBasePositions))});a.addUniform("highp vec3","uChunkDataSize");a.addUniform("highp vec3","uVoxelSize");a.addUniform("highp vec3","uLowerClipBound");a.addUniform("highp vec3","uUpperClipBound");a.addVarying("highp vec3","vChunkPosition");a.setVertexMain("\nvec3 chunkSize = uChunkDataSize * uVoxelSize;\nint vertexIndex = int(aVertexIndexFloat);\nfor (int e = 0; e < 4; ++e) {\n  highp ivec2 vidx = uVertexIndex[vertexIndex*4 + e];\n  highp vec3 v1 = max(uLowerClipBound, min(uUpperClipBound, chunkSize * uVertexBasePosition[vidx.x] + uTranslation));\n  highp vec3 v2 = max(uLowerClipBound, min(uUpperClipBound, chunkSize * uVertexBasePosition[vidx.y] + uTranslation));\n  highp vec3 vDir = v2 - v1;\n  highp float denom = dot(vDir, uPlaneNormal);\n  if (abs(denom) > 0.001) {\n    highp float lambda = (uPlaneDistance - dot(v1, uPlaneNormal)) / denom;\n    if ((lambda >= -0.001) && (lambda <= (1.0 + 0.001))) {\n      lambda = clamp(lambda, 0.0, 1.0);\n      highp vec3 position = v1 + lambda * vDir;\n      gl_Position = uProjectionMatrix * vec4(position, 1.0);\n      vChunkPosition = (position - uTranslation) / uVoxelSize + 0.001 * abs(uPlaneNormal);\n      break;\n    }\n  }\n}\n");
a.addFragmentCode("\nvec3 getPositionWithinChunk () {\n  return floor(min(vChunkPosition, uChunkDataSize - 1.0));\n}\n")}},{key:"computeVerticesDebug",value:function(b,c,d,f,e,g,h,k){b=w.p.multiply(w.p.create(),b,c);var l=a(g);l=this.data.vertexIndices.subarray(48*l,48*(l+1));for(var p=[0,0],v=[w.p.create(),w.p.create()],m=w.p.create(),u=w.p.create(),x=w.p.create(),q=w.p.create(),y=w.p.fromValues(Math.abs(g[0]),Math.abs(g[1]),Math.abs(g[2])),r=new Float32Array(this.data.vertexBasePositions),n=function(a){return r.subarray(3*
a,3*a+3)},D=0;6>D;++D)for(var C=0;4>C;++C){for(var z=0;2>z;++z)p[z]=l[2*(4*D+C)+z],w.p.multiply(v[z],b,n(p[z])),w.p.add(v[z],v[z],h),w.p.min(v[z],v[z],f),w.p.max(v[z],v[z],d);w.p.subtract(m,v[1],v[0]);z=w.p.dot(m,g);if(.001<Math.abs(z)){var B=(e-w.p.dot(v[0],g))/z;if(-.001<=B&&1.001>=B){B=Math.max(0,Math.min(1,B));w.p.scaleAndAdd(u,v[0],m,B);w.p.transformMat4(x,u,k);w.p.sub(q,u,h);w.p.divide(q,q,c);w.p.scaleAndAdd(q,q,y,.001);console.log("vertex "+D+", e = "+C+", at "+x+", "+("vChunkPosition = "+
q+", edge dir = "+m+", denom = "+z));break}else console.log("vertex "+D+", e = "+C+", skipped, deom = "+z+", "+("vDir = "+Object(w.q)(m)+", ")+("uPlaneNormal = "+Object(w.q)(g)+", ")+("lambda="+B))}else console.log("vertex "+D+", e = "+C+", skipped, deom = "+z+", "+("vDir = "+Object(w.q)(m)+", uPlaneNormal = "+Object(w.q)(g)))}}},{key:"beginSlice",value:function(a,b){a=b.attribute("aVertexIndexFloat");this.data.outputVertexIndices.bindToVertexAttrib(a,1)}},{key:"endSlice",value:function(a,b){b=b.attribute("aVertexIndexFloat");
a.disableVertexAttribArray(b)}},{key:"beginSource",value:function(b,c,e,g,h){var k=h.chunkLayout,l=k.globalToLocalSpatialVector(d,e.viewportAxes[2]);e=w.p.dot(k.globalToLocalSpatial(f,e.centerDataPosition),l);b.uniform3fv(c.uniform("uPlaneNormal"),l);b.uniform1f(c.uniform("uPlaneDistance"),e);l=a(l);b.uniform2iv(c.uniform("uVertexIndex"),this.data.vertexIndices.subarray(48*l,48*(l+1)));b.uniformMatrix4fv(c.uniform("uProjectionMatrix"),!1,w.j.multiply(v,g,k.transform));b.uniform3fv(c.uniform("uVoxelSize"),
h.voxelSize);b.uniform3fv(c.uniform("uLowerClipBound"),h.lowerClipBound);b.uniform3fv(c.uniform("uUpperClipBound"),h.upperClipBound)}},{key:"setupChunkDataSize",value:function(a,b,c){a.uniform3fv(b.uniform("uChunkDataSize"),c)}},{key:"drawChunk",value:function(a,b,c){a.uniform3fv(b.uniform("uTranslation"),c);a.drawArrays(a.TRIANGLE_FAN,0,6)}}]);return c}(e.a),E=function(a){function c(a,b){var d=void 0===b?{}:b;b=void 0===d.shaderError?Object(p.b)():d.shaderError;d=void 0===d.sourceOptions?{}:d.sourceOptions;
q(this,c);a=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,a.chunkManager,a.getSources(d),{shaderError:b}));a.vertexComputationManager=G.get(a.gl);b=a.registerDisposer(new h.b);b.RPC_TYPE_ID=l.b;b.initializeCounterpart(a.chunkManager.rpc,{sources:a.sourceIds});a.rpcId=b.rpcId;return a}r(c,a);g(c,[{key:"getValueAt",value:function(a){for(var b=$jscomp.makeIterator(this.sources),c=b.next();!c.done;c=b.next()){c=$jscomp.makeIterator(c.value);for(var d=c.next();!d.done;d=c.next())if(d=d.value.getValueAt(a),
null!=d)return d}return null}},{key:"getShader",value:function(){var a=this,b=this.getShaderKey()+"/"+this.chunkFormat.shaderKey;return this.gl.memoize.get(b,function(){return a.buildShader()})}},{key:"defineShader",value:function(a){this.vertexComputationManager.defineShader(a);a.addFragmentCode("\nvoid emit(vec4 color) {\n  gl_FragData[0] = color;\n}\n");this.chunkFormat.defineShader(a);a.addFragmentCode("\n"+Object(k.a)(this.dataType)+" getDataValue() { return getDataValue(0); }\n")}},{key:"beginSlice",
value:function(a){a=this.gl;var b=this.shader;b.bind();this.vertexComputationManager.beginSlice(a,b);return b}},{key:"endSlice",value:function(a){this.vertexComputationManager.endSlice(this.gl,a)}},{key:"draw",value:function(a){var c=a.visibleLayers.get(this);if(0!==c.length&&(this.initializeShader(),void 0!==this.shader)){var d=this.gl,f=w.p.create(),e=this.beginSlice(a),g=this.vertexComputationManager,h=this.chunkFormat;h.beginDrawing(d,e);var k={};c=$jscomp.makeIterator(c);for(var l=c.next();!l.done;k=
{chunkDataSize:k.chunkDataSize},l=c.next()){var p=l.value,v=p.spec.chunkLayout;l=p.chunks;var m=v.size;k.chunkDataSize=void 0;var u=a.visibleChunks.get(v);if(u){g.beginSource(d,e,a,a.dataToDevice,p.spec);p=p.chunkFormat;p.beginSource(d,e);v=function(a){return function(b){a.chunkDataSize=b;g.setupChunkDataSize(d,e,a.chunkDataSize)}}(k);u=$jscomp.makeIterator(u);for(var q=u.next();!q.done;q=u.next())if((q=l.get(q.value))&&q.state===b.d.GPU_MEMORY){var y=q.chunkDataSize;y!==k.chunkDataSize&&v(y);w.p.multiply(f,
m,q.chunkGridPosition);p.bindChunk(d,e,q);g.drawChunk(d,e,f)}}}h.endDrawing(d,e);this.endSlice(e)}}},{key:"dataType",get:function(){return this.sources[0][0].spec.dataType}},{key:"chunkFormat",get:function(){return this.sources[0][0].chunkFormat}}]);return c}(n.a)},function(n,e,c){function q(b){if(Object(r.n)(b,a))return Object(r.B)(b);throw Error();}c.d(e,"b",function(){return a});e.c=function(a){return new m.a(void 0===a?"default":a,q)};var m=c(4),r=c(2),a;(function(a){a[a.DEFAULT=0]="DEFAULT";
a[a.ADDITIVE=1]="ADDITIVE"})(a||(a={}));n=new Map;e.a=n;n.set(a.DEFAULT,function(a){a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA)});n.set(a.ADDITIVE,function(a){a.blendFunc(a.SRC_ALPHA,a.ONE)})},function(n,e,c){(function(c,e){n.exports=e()})(this,function(){function c(a){return new RegExp("(^|\\s)"+a+"(?:$|\\s)\\s*")}function e(a){for(var b=a.childNodes.length;0<b;--b)a.removeChild(a.firstChild);return a}function r(a,b){return e(a).appendChild(b)}function a(a,b,c,d){a=document.createElement(a);c&&
(a.className=c);d&&(a.style.cssText=d);if("string"==typeof b)a.appendChild(document.createTextNode(b));else if(b)for(c=0;c<b.length;++c)a.appendChild(b[c]);return a}function b(b,c,d,f){b=a(b,c,d,f);b.setAttribute("role","presentation");return b}function l(a,b){3==b.nodeType&&(b=b.parentNode);if(a.contains)return a.contains(b);do if(11==b.nodeType&&(b=b.host),b==a)return!0;while(b=b.parentNode)}function w(){try{var a=document.activeElement}catch(A){a=document.body||null}for(;a&&a.shadowRoot&&a.shadowRoot.activeElement;)a=
a.shadowRoot.activeElement;return a}function u(a,b){var d=a.className;c(b).test(d)||(a.className+=(d?" ":"")+b)}function p(a,b){a=a.split(" ");for(var d=0;d<a.length;d++)a[d]&&!c(a[d]).test(b)&&(b+=" "+a[d]);return b}function k(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}}function h(a,b,c){b||(b={});for(var d in a)!a.hasOwnProperty(d)||!1===c&&b.hasOwnProperty(d)||(b[d]=a[d]);return b}function g(a,b,c,d,f){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=
a.length));d=d||0;for(f=f||0;;){var t=a.indexOf("\t",d);if(0>t||t>=b)return f+(b-d);f+=t-d;f+=c-f%c;d=t+1}}function d(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return c;return-1}function f(a,b,c){for(var d=0,t=0;;){var A=a.indexOf("\t",d);-1==A&&(A=a.length);var f=A-d;if(A==a.length||t+f>=b)return d+Math.min(f,b-t);t+=A-d;t+=c-t%c;d=A+1;if(t>=b)return d}}function v(a){for(;vc.length<=a;)vc.push(y(vc)+" ");return vc[a]}function y(a){return a[a.length-1]}function n(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=
b(a[d],d);return c}function E(a,b,c){for(var d=0,t=c(b);d<a.length&&c(a[d])<=t;)d++;a.splice(d,0,b)}function B(){}function z(a,b){Object.create?a=Object.create(a):(B.prototype=a,a=new B);b&&h(b,a);return a}function D(a){return/\w/.test(a)||"\u0080"<a&&(a.toUpperCase()!=a.toLowerCase()||ag.test(a))}function x(a,b){return b?-1<b.source.indexOf("\\w")&&D(a)?!0:b.test(a):D(a)}function C(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function H(a){return 768<=a.charCodeAt(0)&&bg.test(a)}
function K(a,b,c){for(;(0>c?0<b:b<a.length)&&H(a.charAt(b));)b+=c;return b}function F(a,b,c){for(var d=b>c?-1:1;;){if(b==c)return b;var t=(b+c)/2;t=0>d?Math.ceil(t):Math.floor(t);if(t==b)return a(t)?b:c;a(t)?c=t:b=t+d}}function T(c,d,f){this.input=f;this.scrollbarFiller=a("div",null,"CodeMirror-scrollbar-filler");this.scrollbarFiller.setAttribute("cm-not-content","true");this.gutterFiller=a("div",null,"CodeMirror-gutter-filler");this.gutterFiller.setAttribute("cm-not-content","true");this.lineDiv=
b("div",null,"CodeMirror-code");this.selectionDiv=a("div",null,null,"position: relative; z-index: 1");this.cursorDiv=a("div",null,"CodeMirror-cursors");this.measure=a("div",null,"CodeMirror-measure");this.lineMeasure=a("div",null,"CodeMirror-measure");this.lineSpace=b("div",[this.measure,this.lineMeasure,this.selectionDiv,this.cursorDiv,this.lineDiv],null,"position: relative; outline: none");var t=b("div",[this.lineSpace],"CodeMirror-lines");this.mover=a("div",[t],null,"position: relative");this.sizer=
a("div",[this.mover],"CodeMirror-sizer");this.sizerWidth=null;this.heightForcer=a("div",null,null,"position: absolute; height: 30px; width: 1px;");this.gutters=a("div",null,"CodeMirror-gutters");this.lineGutter=null;this.scroller=a("div",[this.sizer,this.heightForcer,this.gutters],"CodeMirror-scroll");this.scroller.setAttribute("tabIndex","-1");this.wrapper=a("div",[this.scrollbarFiller,this.gutterFiller,this.scroller],"CodeMirror");X&&8>ba&&(this.gutters.style.zIndex=-1,this.scroller.style.paddingRight=
0);na||Oa&&Eb||(this.scroller.draggable=!0);c&&(c.appendChild?c.appendChild(this.wrapper):c(this.wrapper));this.reportedViewFrom=this.reportedViewTo=this.viewFrom=this.viewTo=d.first;this.view=[];this.externalMeasured=this.renderedView=null;this.lastWrapHeight=this.lastWrapWidth=this.viewOffset=0;this.updateLineNumbers=null;this.nativeBarWidth=this.barHeight=this.barWidth=0;this.scrollbarsClipped=!1;this.lineNumWidth=this.lineNumInnerWidth=this.lineNumChars=null;this.alignWidgets=!1;this.maxLine=
this.cachedCharWidth=this.cachedTextHeight=this.cachedPaddingH=null;this.maxLineLength=0;this.maxLineChanged=!1;this.wheelDX=this.wheelDY=this.wheelStartX=this.wheelStartY=null;this.shift=!1;this.activeTouch=this.selForContextMenu=null;f.init(this)}function J(a,b){b-=a.first;if(0>b||b>=a.size)throw Error("There is no line "+(b+a.first)+" in the document.");for(;!a.lines;)for(var c=0;;++c){var d=a.children[c],t=d.chunkSize();if(b<t){a=d;break}b-=t}return a.lines[b]}function R(a,b,c){var d=[],t=b.line;
a.iter(b.line,c.line+1,function(a){a=a.text;t==c.line&&(a=a.slice(0,c.ch));t==b.line&&(a=a.slice(b.ch));d.push(a);++t});return d}function W(a,b,c){var d=[];a.iter(b,c,function(a){d.push(a.text)});return d}function V(a,b){if(b-=a.height)for(;a;a=a.parent)a.height+=b}function M(a){if(null==a.parent)return null;var b=a.parent;a=d(b.lines,a);for(var c=b.parent;c;b=c,c=c.parent)for(var t=0;c.children[t]!=b;++t)a+=c.children[t].chunkSize();return a+b.first}function Q(a,b){var c=a.first;a:do{for(var d=0;d<
a.children.length;++d){var t=a.children[d],A=t.height;if(b<A){a=t;continue a}b-=A;c+=t.chunkSize()}return c}while(!a.lines);for(d=0;d<a.lines.length;++d){t=a.lines[d].height;if(b<t)break;b-=t}return c+d}function aa(a,b){return b>=a.first&&b<a.first+a.size}function ha(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}function I(a,b,c){void 0===c&&(c=null);if(!(this instanceof I))return new I(a,b,c);this.line=a;this.ch=b;this.sticky=c}function P(a,b){return a.line-b.line||a.ch-b.ch}function Va(a,
b){return a.sticky==b.sticky&&0==P(a,b)}function Wa(a){return I(a.line,a.ch)}function tc(a,b){return 0>P(a,b)?b:a}function rc(a,b){return 0>P(a,b)?a:b}function U(a,b){if(b.line<a.first)return I(a.first,0);var c=a.first+a.size-1;if(b.line>c)return I(c,J(a,c).text.length);a=J(a,b.line).text.length;c=b.ch;b=null==c||c>a?I(b.line,a):0>c?I(b.line,0):b;return b}function uc(a,b){for(var c=[],d=0;d<b.length;d++)c[d]=U(a,b[d]);return c}function Db(a,b,c){this.marker=a;this.from=b;this.to=c}function Ja(a,b){if(a)for(var c=
0;c<a.length;++c){var d=a[c];if(d.marker==b)return d}}function qc(a,b){if(b.full)return null;var c=aa(a,b.from.line)&&J(a,b.from.line).markedSpans,d=aa(a,b.to.line)&&J(a,b.to.line).markedSpans;if(!c&&!d)return null;a=b.from.ch;var t=b.to.ch,f=0==P(b.from,b.to),A;if(c)for(var e=0;e<c.length;++e){var g=c[e],h=g.marker;if(null==g.from||(h.inclusiveLeft?g.from<=a:g.from<a)||!(g.from!=a||"bookmark"!=h.type||f&&g.marker.insertLeft)){var k=null==g.to||(h.inclusiveRight?g.to>=a:g.to>a);(A||(A=[])).push(new Db(h,
g.from,k?null:g.to))}}c=A;var l;if(d)for(A=0;A<d.length;++A)if(e=d[A],g=e.marker,null==e.to||(g.inclusiveRight?e.to>=t:e.to>t)||e.from==t&&"bookmark"==g.type&&(!f||e.marker.insertLeft))h=null==e.from||(g.inclusiveLeft?e.from<=t:e.from<t),(l||(l=[])).push(new Db(g,h?null:e.from-t,null==e.to?null:e.to-t));d=1==b.text.length;t=y(b.text).length+(d?a:0);if(c)for(f=0;f<c.length;++f)if(A=c[f],null==A.to)(e=Ja(l,A.marker),e)?d&&(A.to=null==e.to?null:e.to+t):A.to=a;if(l)for(a=0;a<l.length;++a)f=l[a],null!=
f.to&&(f.to+=t),null==f.from?Ja(c,f.marker)||(f.from=t,d&&(c||(c=[])).push(f)):(f.from+=t,d&&(c||(c=[])).push(f));c&&(c=Vd(c));l&&l!=c&&(l=Vd(l));a=[c];if(!d){b=b.text.length-2;var p;if(0<b&&c)for(d=0;d<c.length;++d)null==c[d].to&&(p||(p=[])).push(new Db(c[d].marker,null,null));for(c=0;c<b;++c)a.push(p);a.push(l)}return a}function Vd(a){for(var b=0;b<a.length;++b){var c=a[b];null!=c.from&&c.from==c.to&&!1!==c.marker.clearWhenEmpty&&a.splice(b--,1)}return a.length?a:null}function $f(a,b,c){var t=null;
a.iter(b.line,c.line+1,function(a){if(a.markedSpans)for(var b=0;b<a.markedSpans.length;++b){var c=a.markedSpans[b].marker;!c.readOnly||t&&-1!=d(t,c)||(t||(t=[])).push(c)}});if(!t)return null;a=[{from:b,to:c}];for(b=0;b<t.length;++b){c=t[b];for(var f=c.find(0),e=0;e<a.length;++e){var A=a[e];if(!(0>P(A.to,f.from)||0<P(A.from,f.to))){var g=[e,1],h=P(A.from,f.from),S=P(A.to,f.to);(0>h||!c.inclusiveLeft&&!h)&&g.push({from:A.from,to:f.from});(0<S||!c.inclusiveRight&&!S)&&g.push({from:f.to,to:A.to});a.splice.apply(a,
g);e+=g.length-3}}}return a}function mb(a){var b=a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function Wd(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);a.markedSpans=b}}function Xd(a,b){var c=a.lines.length-b.lines.length;if(0!=c)return c;c=a.find();var d=b.find(),t=P(c.from,d.from)||(a.inclusiveLeft?-1:0)-(b.inclusiveLeft?-1:0);return t?-t:(c=P(c.to,d.to)||(a.inclusiveRight?1:0)-(b.inclusiveRight?1:0))?c:b.id-a.id}function Ka(a,b){a=
Pa&&a.markedSpans;if(a)for(var c,d=0;d<a.length;++d)if(c=a[d],c.marker.collapsed&&null==(b?c.from:c.to)&&(!t||0>Xd(t,c.marker)))var t=c.marker;return t}function sc(a,b,c,d,f){a=J(a,b);if(a=Pa&&a.markedSpans)for(b=0;b<a.length;++b){var t=a[b];if(t.marker.collapsed){var e=t.marker.find(0),A=P(e.from,c)||(t.marker.inclusiveLeft?-1:0)-(f.inclusiveLeft?-1:0),g=P(e.to,d)||(t.marker.inclusiveRight?1:0)-(f.inclusiveRight?1:0);if(!(0<=A&&0>=g||0>=A&&0<=g)&&(0>=A&&(t.marker.inclusiveRight&&f.inclusiveLeft?
0<=P(e.to,c):0<P(e.to,c))||0<=A&&(t.marker.inclusiveRight&&f.inclusiveLeft?0>=P(e.from,d):0>P(e.from,d))))return!0}}}function Ea(a){for(var b;b=Ka(a,!0);)a=b.find(-1,!0).line;return a}function Xc(a,b){a=J(a,b);var c=Ea(a);return a==c?b:M(c)}function Yd(a,b){if(b>a.lastLine())return b;var c=J(a,b);if(!Xa(a,c))return b;for(;a=Ka(c,!1);)c=a.find(1,!0).line;return M(c)+1}function Xa(a,b){var c=Pa&&b.markedSpans;if(c)for(var d,t=0;t<c.length;++t)if(d=c[t],d.marker.collapsed&&(null==d.from||!d.marker.widgetNode&&
0==d.from&&d.marker.inclusiveLeft&&Yc(a,b,d)))return!0}function Yc(a,b,c){if(null==c.to)return b=c.marker.find(1,!0),Yc(a,b.line,Ja(b.line.markedSpans,c.marker));if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var d,t=0;t<b.markedSpans.length;++t)if(d=b.markedSpans[t],d.marker.collapsed&&!d.marker.widgetNode&&d.from==c.to&&(null==d.to||d.to!=c.from)&&(d.marker.inclusiveLeft||c.marker.inclusiveRight)&&Yc(a,b,d))return!0}function Fa(a){a=Ea(a);for(var b=0,c=a.parent,d=0;d<c.lines.length;++d){var t=
c.lines[d];if(t==a)break;else b+=t.height}for(a=c.parent;a;c=a,a=c.parent)for(d=0;d<a.children.length&&(t=a.children[d],t!=c);++d)b+=t.height;return b}function wc(a){if(0==a.height)return 0;for(var b=a.text.length,c,d=a;c=Ka(d,!0);)c=c.find(0,!0),d=c.from.line,b+=c.from.ch-c.to.ch;for(d=a;c=Ka(d,!1);)a=c.find(0,!0),b-=d.text.length-a.from.ch,d=a.to.line,b+=d.text.length-a.to.ch;return b}function Zc(a){var b=a.display;a=a.doc;b.maxLine=J(a,a.first);b.maxLineLength=wc(b.maxLine);b.maxLineChanged=!0;
a.iter(function(a){var c=wc(a);c>b.maxLineLength&&(b.maxLineLength=c,b.maxLine=a)})}function cg(a,b,c,d){if(!a)return d(b,c,"ltr",0);for(var t=!1,f=0;f<a.length;++f){var e=a[f];if(e.from<c&&e.to>b||b==c&&e.to==b)d(Math.max(e.from,b),Math.min(e.to,c),1==e.level?"rtl":"ltr",f),t=!0}t||d(b,c,"ltr")}function Fb(a,b,c){var d;Gb=null;for(var t=0;t<a.length;++t){var f=a[t];if(f.from<b&&f.to>b)return t;f.to==b&&(f.from!=f.to&&"before"==c?d=t:Gb=t);f.from==b&&(f.from!=f.to&&"before"!=c?d=t:Gb=t)}return null!=
d?d:Gb}function La(a,b){var c=a.order;null==c&&(c=a.order=dg(a.text,b));return c}function va(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else{var t=(a=a._handlers)&&a[b];t&&(c=d(t,c),-1<c&&(a[b]=t.slice(0,c).concat(t.slice(c+1))))}}function da(a,b){var c=a._handlers&&a._handlers[b]||xc;if(c.length)for(var d=Array.prototype.slice.call(arguments,2),t=0;t<c.length;++t)c[t].apply(null,d)}function ia(a,b,c){"string"==typeof b&&(b={type:b,
preventDefault:function(){this.defaultPrevented=!0}});da(a,c||b.type,a,b);return $c(b)||b.codemirrorIgnore}function $d(a){var b=a._handlers&&a._handlers.cursorActivity;if(b){a=a.curOp.cursorActivityHandlers||(a.curOp.cursorActivityHandlers=[]);for(var c=0;c<b.length;++c)-1==d(a,b[c])&&a.push(b[c])}}function ya(a,b){return 0<(a._handlers&&a._handlers[b]||xc).length}function nb(a){a.prototype.on=function(a,b){O(this,a,b)};a.prototype.off=function(a,b){va(this,a,b)}}function oa(a){a.preventDefault?a.preventDefault():
a.returnValue=!1}function ae(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}function $c(a){return null!=a.defaultPrevented?a.defaultPrevented:0==a.returnValue}function Hb(a){oa(a);ae(a)}function be(a){var b=a.which;null==b&&(a.button&1?b=1:a.button&2?b=3:a.button&4&&(b=2));za&&a.ctrlKey&&1==b&&(b=3);return b}function eg(b){if(null==ad){var c=a("span","\u200b");r(b,a("span",[c,document.createTextNode("x")]));0!=b.firstChild.offsetHeight&&(ad=1>=c.offsetWidth&&2<c.offsetHeight&&!(X&&8>ba))}b=
ad?a("span","\u200b"):a("span","\u00a0",null,"display: inline-block; width: 1px; margin-right: -1px");b.setAttribute("cm-text","");return b}function fg(a,b){2<arguments.length&&(b.dependencies=Array.prototype.slice.call(arguments,2));bd[a]=b}function yc(a){if("string"==typeof a&&ob.hasOwnProperty(a))a=ob[a];else if(a&&"string"==typeof a.name&&ob.hasOwnProperty(a.name)){var b=ob[a.name];"string"==typeof b&&(b={name:b});a=z(b,a);a.name=b.name}else{if("string"==typeof a&&/^[\w\-]+\/[\w\-]+\+xml$/.test(a))return yc("application/xml");
if("string"==typeof a&&/^[\w\-]+\/[\w\-]+\+json$/.test(a))return yc("application/json")}return"string"==typeof a?{name:a}:a||{name:"null"}}function cd(a,b){b=yc(b);var c=bd[b.name];if(!c)return cd(a,"text/plain");a=c(a,b);if(pb.hasOwnProperty(b.name)){c=pb[b.name];for(var d in c)c.hasOwnProperty(d)&&(a.hasOwnProperty(d)&&(a["_"+d]=a[d]),a[d]=c[d])}a.name=b.name;b.helperType&&(a.helperType=b.helperType);if(b.modeProps)for(var t in b.modeProps)a[t]=b.modeProps[t];return a}function gg(a,b){a=pb.hasOwnProperty(a)?
pb[a]:pb[a]={};h(b,a)}function Ya(a,b){if(!0===b)return b;if(a.copyState)return a.copyState(b);a={};for(var c in b){var d=b[c];d instanceof Array&&(d=d.concat([]));a[c]=d}return a}function dd(a,b){for(var c;a.innerMode;){c=a.innerMode(b);if(!c||c.mode==a)break;b=c.state;a=c.mode}return c||{mode:a,state:b}}function ce(a,b,c){return a.startState?a.startState(b,c):!0}function de(a,b,c,d){var t=[a.state.modeGen],f={};ee(a,b.text,a.doc.mode,c,function(a,b){return t.push(a,b)},f,d);var e=c.state;d=function(d){c.baseTokens=
t;var A=a.state.overlays[d],g=1,h=0;c.state=!0;ee(a,b.text,A.mode,c,function(a,b){for(var c=g;h<a;){var d=t[g];d>a&&t.splice(g,1,a,t[g+1],d);g+=2;h=Math.min(a,d)}if(b)if(A.opaque)t.splice(c,g-c,a,"overlay "+b),g=c+2;else for(;c<g;c+=2)a=t[c+1],t[c+1]=(a?a+" ":"")+"overlay "+b},f);c.state=e;c.baseTokens=null;c.baseTokenPos=1};for(var A=0;A<a.state.overlays.length;++A)d(A);return{styles:t,classes:f.bgClass||f.textClass?f:null}}function fe(a,b,c){if(!b.styles||b.styles[0]!=a.state.modeGen){var d=Ib(a,
M(b)),t=b.text.length>a.options.maxHighlightLength&&Ya(a.doc.mode,d.state),f=de(a,b,d);t&&(d.state=t);b.stateAfter=d.save(!t);b.styles=f.styles;f.classes?b.styleClasses=f.classes:b.styleClasses&&(b.styleClasses=null);c===a.doc.highlightFrontier&&(a.doc.modeFrontier=Math.max(a.doc.modeFrontier,++a.doc.highlightFrontier))}return b.styles}function Ib(a,b,c){var d=a.doc,t=a.display;if(!d.mode.startState)return new Ga(d,!0,b);var f=hg(a,b,c),e=f>d.first&&J(d,f-1).stateAfter,A=e?Ga.fromSaved(d,e,f):new Ga(d,
ce(d.mode),f);d.iter(f,b,function(c){ed(a,c.text,A);var d=A.line;c.stateAfter=d==b-1||0==d%5||d>=t.viewFrom&&d<t.viewTo?A.save():null;A.nextLine()});c&&(d.modeFrontier=A.line);return A}function ed(a,b,c,d){var t=a.doc.mode;a=new ea(b,a.options.tabSize,c);a.start=a.pos=d||0;for(""==b&&ge(t,c.state);!a.eol();)fd(t,a,c.state),a.start=a.pos}function ge(a,b){if(a.blankLine)return a.blankLine(b);if(a.innerMode&&(a=dd(a,b),a.mode.blankLine))return a.mode.blankLine(a.state)}function fd(a,b,c,d){for(var t=
0;10>t;t++){d&&(d[0]=dd(a,c).mode);var f=a.token(b,c);if(b.pos>b.start)return f}throw Error("Mode "+a.name+" failed to advance stream.");}function he(a,b,c,d){var t=a.doc,f=t.mode;b=U(t,b);var e=J(t,b.line);c=Ib(a,b.line,c);a=new ea(e.text,a.options.tabSize,c);var A;for(d&&(A=[]);(d||a.pos<b.ch)&&!a.eol();){a.start=a.pos;var g=fd(f,a,c.state);d&&A.push(new ie(a,g,Ya(t.mode,c.state)))}return d?A:new ie(a,g,c.state)}function je(a,b){if(a)for(;;){var c=a.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!c)break;
a=a.slice(0,c.index)+a.slice(c.index+c[0].length);var d=c[1]?"bgClass":"textClass";null==b[d]?b[d]=c[2]:(new RegExp("(?:^|s)"+c[2]+"(?:$|s)")).test(b[d])||(b[d]+=" "+c[2])}return a}function ee(a,b,c,d,f,e,g){var t=c.flattenSpans;null==t&&(t=a.options.flattenSpans);var A=0,h=null,L=new ea(b,a.options.tabSize,d),k=a.options.addModeClass&&[null];for(""==b&&je(ge(c,d.state),e);!L.eol();){if(L.pos>a.options.maxHighlightLength){t=!1;g&&ed(a,b,d,L.pos);L.pos=b.length;var S=null}else S=je(fd(c,L,d.state,
k),e);if(k){var N=k[0].name;N&&(S="m-"+(S?N+" "+S:N))}if(!t||h!=S){for(;A<L.start;)A=Math.min(L.start,A+5E3),f(A,h);h=S}L.start=L.pos}for(;A<L.pos;)a=Math.min(L.pos,A+5E3),f(a,h),A=a}function hg(a,b,c){for(var d,t,f=a.doc,e=c?-1:b-(a.doc.mode.innerMode?1E3:100);b>e;--b){if(b<=f.first)return f.first;var A=J(f,b-1),h=A.stateAfter;if(h&&(!c||b+(h instanceof zc?h.lookAhead:0)<=f.modeFrontier))return b;A=g(A.text,null,a.options.tabSize);if(null==t||d>A)t=b-1,d=A}return t}function ig(a,b){a.modeFrontier=
Math.min(a.modeFrontier,b);if(!(a.highlightFrontier<b-10)){for(var c=a.first,d=b-1;d>c;d--){var t=J(a,d).stateAfter;if(t&&(!(t instanceof zc)||d+t.lookAhead<b)){c=d+1;break}}a.highlightFrontier=Math.min(a.highlightFrontier,c)}}function ke(a,b){if(!a||/^\s*$/.test(a))return null;b=b.addModeClass?jg:kg;return b[a]||(b[a]=a.replace(/\S+/g,"cm-$&"))}function le(a,c){var d=b("span",null,null,na?"padding-right: .1px":null);d={pre:b("pre",[d],"CodeMirror-line"),content:d,col:0,pos:0,cm:a,trailingSpace:!1,
splitSpaces:(X||na)&&a.getOption("lineWrapping")};c.measure={};for(var t=0;t<=(c.rest?c.rest.length:0);t++){var f=t?c.rest[t-1]:c.line,A=void 0;d.pos=0;d.addToken=lg;var g=a.display.measure;if(null!=gd)g=gd;else{var h=r(g,document.createTextNode("A\u062eA")),k=Jb(h,0,1).getBoundingClientRect();h=Jb(h,1,2).getBoundingClientRect();e(g);g=k&&k.left!=k.right?gd=3>h.right-k.right:!1}g&&(A=La(f,a.doc.direction))&&(d.addToken=mg(d.addToken,A));d.map=[];var l=c!=a.display.externalMeasured&&M(f);a:{var v=
h=k=g=void 0,u=void 0,m=void 0,q=void 0;A=d;l=fe(a,f,l);var w=f.markedSpans,x=f.text,y=0;if(w)for(var n=x.length,C=0,D=1,z="",B=0;;){if(B==C){u=v=h=k=m="";g=null;B=Infinity;for(var G=[],E=void 0,H=0;H<w.length;++H){var K=w[H],F=K.marker;"bookmark"==F.type&&K.from==C&&F.widgetNode?G.push(F):K.from<=C&&(null==K.to||K.to>C||F.collapsed&&K.to==C&&K.from==C)?(null!=K.to&&K.to!=C&&B>K.to&&(B=K.to,v=""),F.className&&(u+=" "+F.className),F.css&&(m=(m?m+";":"")+F.css),F.startStyle&&K.from==C&&(h+=" "+F.startStyle),
F.endStyle&&K.to==B&&(E||(E=[])).push(F.endStyle,K.to),F.title&&!k&&(k=F.title),F.collapsed&&(!g||0>Xd(g.marker,F))&&(g=K)):K.from>C&&B>K.from&&(B=K.from)}if(E)for(H=0;H<E.length;H+=2)E[H+1]==B&&(v+=" "+E[H]);if(!g||g.from==C)for(E=0;E<G.length;++E)me(A,0,G[E]);if(g&&(g.from||0)==C){me(A,(null==g.to?n+1:g.to)-C,g.marker,null==g.from);if(null==g.to)break a;g.to==C&&(g=!1)}}if(C>=n)break;for(G=Math.min(n,B);;){if(z){E=C+z.length;g||(H=E>G?z.slice(0,G-C):z,A.addToken(A,H,q?q+u:u,h,C+H.length==B?v:"",
k,m));if(E>=G){z=z.slice(G-C);C=G;break}C=E;h=""}z=x.slice(y,y=l[D++]);q=ke(l[D++],A.cm.options)}}else for(g=1;g<l.length;g+=2)A.addToken(A,x.slice(y,y=l[g]),ke(l[g+1],A.cm.options))}f.styleClasses&&(f.styleClasses.bgClass&&(d.bgClass=p(f.styleClasses.bgClass,d.bgClass||"")),f.styleClasses.textClass&&(d.textClass=p(f.styleClasses.textClass,d.textClass||"")));0==d.map.length&&d.map.push(0,0,d.content.appendChild(eg(a.display.measure)));0==t?(c.measure.map=d.map,c.measure.cache={}):((c.measure.maps||
(c.measure.maps=[])).push(d.map),(c.measure.caches||(c.measure.caches=[])).push({}))}na&&(t=d.content.lastChild,/\bcm-tab\b/.test(t.className)||t.querySelector&&t.querySelector(".cm-tab"))&&(d.content.className="cm-tab-wrap-hack");da(a,"renderLine",a,c.line,d.pre);d.pre.className&&(d.textClass=p(d.pre.className,d.textClass||""));return d}function ng(b){var c=a("span","\u2022","cm-invalidchar");c.title="\\u"+b.charCodeAt(0).toString(16);c.setAttribute("aria-label",c.title);return c}function lg(b,c,
d,f,e,g,h){if(c){if(b.splitSpaces){var t=b.trailingSpace;if(1<c.length&&!/  /.test(c))t=c;else{for(var A="",L=0;L<c.length;L++){var k=c.charAt(L);" "!=k||!t||L!=c.length-1&&32!=c.charCodeAt(L+1)||(k="\u00a0");A+=k;t=" "==k}t=A}}else t=c;A=t;L=b.cm.state.specialChars;k=!1;if(L.test(c)){t=document.createDocumentFragment();for(var S=0;;){L.lastIndex=S;var N=L.exec(c),l=N?N.index-S:c.length-S;if(l){var p=document.createTextNode(A.slice(S,S+l));X&&9>ba?t.appendChild(a("span",[p])):t.appendChild(p);b.map.push(b.pos,
b.pos+l,p);b.col+=l;b.pos+=l}if(!N)break;S+=l+1;"\t"==N[0]?(N=b.cm.options.tabSize,N-=b.col%N,l=t.appendChild(a("span",v(N),"cm-tab")),l.setAttribute("role","presentation"),l.setAttribute("cm-text","\t"),b.col+=N):("\r"==N[0]||"\n"==N[0]?(l=t.appendChild(a("span","\r"==N[0]?"\u240d":"\u2424","cm-invalidchar")),l.setAttribute("cm-text",N[0])):(l=b.cm.options.specialCharPlaceholder(N[0]),l.setAttribute("cm-text",N[0]),X&&9>ba?t.appendChild(a("span",[l])):t.appendChild(l)),b.col+=1);b.map.push(b.pos,
b.pos+1,l);b.pos++}}else b.col+=c.length,t=document.createTextNode(A),b.map.push(b.pos,b.pos+c.length,t),X&&9>ba&&(k=!0),b.pos+=c.length;b.trailingSpace=32==A.charCodeAt(c.length-1);if(d||f||e||k||h)return c=d||"",f&&(c+=f),e&&(c+=e),f=a("span",[t],c,h),g&&(f.title=g),b.content.appendChild(f);b.content.appendChild(t)}}function mg(a,b){return function(c,d,t,f,e,A,g){t=t?t+" cm-force-border":"cm-force-border";for(var h=c.pos,L=h+d.length;;){for(var k=void 0,S=0;S<b.length&&!(k=b[S],k.to>h&&k.from<=
h);S++);if(k.to>=L)return a(c,d,t,f,e,A,g);a(c,d.slice(0,k.to-h),t,f,null,A,g);f=null;d=d.slice(k.to-h);h=k.to}}}function me(a,b,c,d){var t=!d&&c.widgetNode;t&&a.map.push(a.pos,a.pos+b,t);!d&&a.cm.display.input.needsContentAttribute&&(t||(t=a.content.appendChild(document.createElement("span"))),t.setAttribute("cm-marker",c.id));t&&(a.cm.display.input.setUneditable(t),a.content.appendChild(t));a.pos+=b;a.trailingSpace=!1}function ne(a,b,c){for(var d=this.line=b,t;d=Ka(d,!1);)d=d.find(1,!0).line,(t||
(t=[])).push(d);this.size=(this.rest=t)?M(y(this.rest))-c+1:1;this.node=this.text=null;this.hidden=Xa(a,b)}function Ac(a,b,c){var d=[],t;for(t=b;t<c;)b=new ne(a.doc,J(a.doc,t),t),t+=b.size,d.push(b);return d}function og(a,b){if(a=a.ownsGroup)try{var c=a.delayedCallbacks,d=0;do{for(;d<c.length;d++)c[d].call(null);for(var t=0;t<a.ops.length;t++){var f=a.ops[t];if(f.cursorActivityHandlers)for(;f.cursorActivityCalled<f.cursorActivityHandlers.length;)f.cursorActivityHandlers[f.cursorActivityCalled++].call(null,
f.cm)}}while(d<c.length)}finally{qb=null,b(a)}}function la(a,b){var c=a._handlers&&a._handlers[b]||xc;if(c.length){var d=Array.prototype.slice.call(arguments,2);if(qb)var t=qb.delayedCallbacks;else Kb?t=Kb:(t=Kb=[],setTimeout(pg,0));for(var f=function(a){t.push(function(){return c[a].apply(null,d)})},e=0;e<c.length;++e)f(e)}}function pg(){var a=Kb;Kb=null;for(var b=0;b<a.length;++b)a[b]()}function oe(a,b,c,d){for(var t=0;t<b.changes.length;t++){var f=b.changes[t];if("text"==f){f=a;var e=b,A=e.text.className,
g=pe(f,e);e.text==e.node&&(e.node=g.pre);e.text.parentNode.replaceChild(g.pre,e.text);e.text=g.pre;g.bgClass!=e.bgClass||g.textClass!=e.textClass?(e.bgClass=g.bgClass,e.textClass=g.textClass,hd(f,e)):A&&(e.text.className=A)}else if("gutter"==f)qe(a,b,c,d);else if("class"==f)hd(a,b);else if("widget"==f){f=a;e=b;A=d;e.alignable&&(e.alignable=null);g=e.node.firstChild;for(var h;g;g=h)h=g.nextSibling,"CodeMirror-linewidget"==g.className&&e.node.removeChild(g);re(f,e,A)}}b.changes=null}function Lb(b){b.node==
b.text&&(b.node=a("div",null,null,"position: relative"),b.text.parentNode&&b.text.parentNode.replaceChild(b.node,b.text),b.node.appendChild(b.text),X&&8>ba&&(b.node.style.zIndex=2));return b.node}function pe(a,b){var c=a.display.externalMeasured;return c&&c.line==b.line?(a.display.externalMeasured=null,b.measure=c.measure,c.built):le(a,b)}function hd(b,c){var d=c.bgClass?c.bgClass+" "+(c.line.bgClass||""):c.line.bgClass;d&&(d+=" CodeMirror-linebackground");if(c.background)d?c.background.className=
d:(c.background.parentNode.removeChild(c.background),c.background=null);else if(d){var t=Lb(c);c.background=t.insertBefore(a("div",null,d),t.firstChild);b.display.input.setUneditable(c.background)}c.line.wrapClass?Lb(c).className=c.line.wrapClass:c.node!=c.text&&(c.node.className="");c.text.className=(c.textClass?c.textClass+" "+(c.line.textClass||""):c.line.textClass)||""}function qe(b,c,d,f){c.gutter&&(c.node.removeChild(c.gutter),c.gutter=null);c.gutterBackground&&(c.node.removeChild(c.gutterBackground),
c.gutterBackground=null);if(c.line.gutterClass){var t=Lb(c);c.gutterBackground=a("div",null,"CodeMirror-gutter-background "+c.line.gutterClass,"left: "+(b.options.fixedGutter?f.fixedPos:-f.gutterTotalWidth)+"px; width: "+f.gutterTotalWidth+"px");b.display.input.setUneditable(c.gutterBackground);t.insertBefore(c.gutterBackground,c.text)}t=c.line.gutterMarkers;if(b.options.lineNumbers||t){var e=Lb(c),g=c.gutter=a("div",null,"CodeMirror-gutter-wrapper","left: "+(b.options.fixedGutter?f.fixedPos:-f.gutterTotalWidth)+
"px");b.display.input.setUneditable(g);e.insertBefore(g,c.text);c.line.gutterClass&&(g.className+=" "+c.line.gutterClass);!b.options.lineNumbers||t&&t["CodeMirror-linenumbers"]||(c.lineNumber=g.appendChild(a("div",ha(b.options,d),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+f.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+b.display.lineNumInnerWidth+"px")));if(t)for(c=0;c<b.options.gutters.length;++c)d=b.options.gutters[c],(e=t.hasOwnProperty(d)&&t[d])&&g.appendChild(a("div",[e],"CodeMirror-gutter-elt",
"left: "+f.gutterLeft[d]+"px; width: "+f.gutterWidth[d]+"px"))}}function qg(a,b,c,d){var t=pe(a,b);b.text=b.node=t.pre;t.bgClass&&(b.bgClass=t.bgClass);t.textClass&&(b.textClass=t.textClass);hd(a,b);qe(a,b,c,d);re(a,b,d);return b.node}function re(a,b,c){se(a,b.line,b,c,!0);if(b.rest)for(var d=0;d<b.rest.length;d++)se(a,b.rest[d],b,c,!1)}function se(b,c,d,f,e){if(c.widgets){var t=Lb(d),g=0;for(c=c.widgets;g<c.length;++g){var A=c[g],h=a("div",[A.node],"CodeMirror-linewidget");A.handleMouseEvents||h.setAttribute("cm-ignore-events",
"true");var L=A,k=h,S=f;if(L.noHScroll){(d.alignable||(d.alignable=[])).push(k);var l=S.wrapperWidth;k.style.left=S.fixedPos+"px";L.coverGutter||(l-=S.gutterTotalWidth,k.style.paddingLeft=S.gutterTotalWidth+"px");k.style.width=l+"px"}L.coverGutter&&(k.style.zIndex=5,k.style.position="relative",L.noHScroll||(k.style.marginLeft=-S.gutterTotalWidth+"px"));b.display.input.setUneditable(h);e&&A.above?t.insertBefore(h,d.gutter||d.text):t.appendChild(h);la(A,"redraw")}}}function Mb(b){if(null!=b.height)return b.height;
var c=b.doc.cm;if(!c)return 0;if(!l(document.body,b.node)){var d="position: relative;";b.coverGutter&&(d+="margin-left: -"+c.display.gutters.offsetWidth+"px;");b.noHScroll&&(d+="width: "+c.display.wrapper.clientWidth+"px;");r(c.display.measure,a("div",[b.node],null,d))}return b.height=b.node.parentNode.offsetHeight}function Ma(a,b){for(b=b.target||b.srcElement;b!=a.wrapper;b=b.parentNode)if(!b||1==b.nodeType&&"true"==b.getAttribute("cm-ignore-events")||b.parentNode==a.sizer&&b!=a.mover)return!0}function id(a){return a.mover.offsetHeight-
a.lineSpace.offsetHeight}function te(b){if(b.cachedPaddingH)return b.cachedPaddingH;var c=r(b.measure,a("pre","x"));c=window.getComputedStyle?window.getComputedStyle(c):c.currentStyle;c={left:parseInt(c.paddingLeft),right:parseInt(c.paddingRight)};isNaN(c.left)||isNaN(c.right)||(b.cachedPaddingH=c);return c}function Ha(a){return 30-a.display.nativeBarWidth}function Za(a){return a.display.scroller.clientWidth-Ha(a)-a.display.barWidth}function jd(a){return a.display.scroller.clientHeight-Ha(a)-a.display.barHeight}
function ue(a,b,c){if(a.line==b)return{map:a.measure.map,cache:a.measure.cache};for(var d=0;d<a.rest.length;d++)if(a.rest[d]==b)return{map:a.measure.maps[d],cache:a.measure.caches[d]};for(b=0;b<a.rest.length;b++)if(M(a.rest[b])>c)return{map:a.measure.maps[b],cache:a.measure.caches[b],before:!0}}function kd(a,b){if(b>=a.display.viewFrom&&b<a.display.viewTo)return a.display.view[$a(a,b)];if((a=a.display.externalMeasured)&&b>=a.lineN&&b<a.lineN+a.size)return a}function ab(a,b){var c=M(b),d=kd(a,c);d&&
!d.text?d=null:d&&d.changes&&(oe(a,d,c,ld(a)),a.curOp.forceUpdate=!0);if(!d){var t=Ea(b);d=M(t);t=a.display.externalMeasured=new ne(a.doc,t,d);t.lineN=d;d=t.built=le(a,t);t.text=d.pre;r(a.display.lineMeasure,d.pre);d=t}a=ue(d,b,c);return{line:b,view:d,rect:null,map:a.map,cache:a.cache,before:a.before,hasHeights:!1}}function Aa(b,c,d,f,e){c.before&&(d=-1);var t=d+(f||"");if(c.cache.hasOwnProperty(t))b=c.cache[t];else{c.rect||(c.rect=c.view.text.getBoundingClientRect());if(!c.hasHeights){var g=c.view,
A=c.rect,h=b.options.lineWrapping,k=h&&Za(b);if(!g.measure.heights||h&&g.measure.width!=k){var L=g.measure.heights=[];if(h)for(g.measure.width=k,g=g.text.firstChild.getClientRects(),h=0;h<g.length-1;h++){k=g[h];var S=g[h+1];2<Math.abs(k.bottom-S.bottom)&&L.push((k.bottom+S.top)/2-A.top)}L.push(A.bottom-A.top)}c.hasHeights=!0}L=f;g=ve(c.map,d,L);f=g.node;A=g.start;h=g.end;d=g.collapse;if(3==f.nodeType){for(var l=0;4>l;l++){for(;A&&H(c.line.text.charAt(g.coverStart+A));)--A;for(;g.coverStart+h<g.coverEnd&&
H(c.line.text.charAt(g.coverStart+h));)++h;if(X&&9>ba&&0==A&&h==g.coverEnd-g.coverStart)var N=f.parentNode.getBoundingClientRect();else{N=Jb(f,A,h).getClientRects();h=we;if("left"==L)for(k=0;k<N.length&&(h=N[k]).left==h.right;k++);else for(k=N.length-1;0<=k&&(h=N[k]).left==h.right;k--);N=h}if(N.left||N.right||0==A)break;h=A;--A;d="right"}X&&11>ba&&((l=!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI)||(null!=md?l=md:(L=r(b.display.measure,a("span","x")),l=L.getBoundingClientRect(),
L=Jb(L,0,1).getBoundingClientRect(),l=md=1<Math.abs(l.left-L.left)),l=!l),l||(l=screen.logicalXDPI/screen.deviceXDPI,L=screen.logicalYDPI/screen.deviceYDPI,N={left:N.left*l,right:N.right*l,top:N.top*L,bottom:N.bottom*L}))}else 0<A&&(d=L="right"),N=b.options.lineWrapping&&1<(l=f.getClientRects()).length?l["right"==L?l.length-1:0]:f.getBoundingClientRect();!(X&&9>ba)||A||N&&(N.left||N.right)||(N=(N=f.parentNode.getClientRects()[0])?{left:N.left,right:N.left+Nb(b.display),top:N.top,bottom:N.bottom}:
we);f=N.top-c.rect.top;A=N.bottom-c.rect.top;l=(f+A)/2;L=c.view.measure.heights;for(g=0;g<L.length-1&&!(l<L[g]);g++);d={left:("right"==d?N.right:N.left)-c.rect.left,right:("left"==d?N.left:N.right)-c.rect.left,top:g?L[g-1]:0,bottom:L[g]};N.left||N.right||(d.bogus=!0);b.options.singleCursorHeightPerLine||(d.rtop=f,d.rbottom=A);b=d;b.bogus||(c.cache[t]=b)}return{left:b.left,right:b.right,top:e?b.rtop:b.top,bottom:e?b.rbottom:b.bottom}}function ve(a,b,c){for(var d,t,f,e,g,A,h=0;h<a.length;h+=3){g=a[h];
A=a[h+1];if(b<g)t=0,f=1,e="left";else if(b<A)t=b-g,f=t+1;else if(h==a.length-3||b==A&&a[h+3]>b)f=A-g,t=f-1,b>=A&&(e="right");if(null!=t){d=a[h+2];g==A&&c==(d.insertLeft?"left":"right")&&(e=c);if("left"==c&&0==t)for(;h&&a[h-2]==a[h-3]&&a[h-1].insertLeft;)d=a[(h-=3)+2],e="left";if("right"==c&&t==A-g)for(;h<a.length-3&&a[h+3]==a[h+4]&&!a[h+5].insertLeft;)d=a[(h+=3)+2],e="right";break}}return{node:d,start:t,end:f,collapse:e,coverStart:g,coverEnd:A}}function xe(a){if(a.measure&&(a.measure.cache={},a.measure.heights=
null,a.rest))for(var b=0;b<a.rest.length;b++)a.measure.caches[b]={}}function ye(a){a.display.externalMeasure=null;e(a.display.lineMeasure);for(var b=0;b<a.display.view.length;b++)xe(a.display.view[b])}function Ob(a){ye(a);a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=null;a.options.lineWrapping||(a.display.maxLineChanged=!0);a.display.lineNumChars=null}function ze(){return Bc&&Cc?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):
window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Ae(){return Bc&&Cc?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function nd(a){var b=0;if(a.widgets)for(var c=0;c<a.widgets.length;++c)a.widgets[c].above&&(b+=Mb(a.widgets[c]));return b}function Dc(a,b,c,d,f){f||(f=nd(b),c.top+=f,c.bottom+=f);if("line"==d)return c;d||(d="local");b=Fa(b);b="local"==
d?b+a.display.lineSpace.offsetTop:b-a.display.viewOffset;if("page"==d||"window"==d)a=a.display.lineSpace.getBoundingClientRect(),b+=a.top+("window"==d?0:Ae()),d=a.left+("window"==d?0:ze()),c.left+=d,c.right+=d;c.top+=b;c.bottom+=b;return c}function Be(a,b,c){if("div"==c)return b;var d=b.left;b=b.top;"page"==c?(d-=ze(),b-=Ae()):"local"!=c&&c||(c=a.display.sizer.getBoundingClientRect(),d+=c.left,b+=c.top);a=a.display.lineSpace.getBoundingClientRect();return{left:d-a.left,top:b-a.top}}function od(a,
b,c,d,f){d||(d=J(a.doc,b.line));var t=d;b=b.ch;d=Aa(a,ab(a,d),b,f);return Dc(a,t,d,c)}function Ba(a,b,c,d,f,e){function t(b,t){b=Aa(a,f,b,t?"right":"left",e);t?b.left=b.right:b.right=b.left;return Dc(a,d,b,c)}function g(a,b,c){return t(c?a-1:a,1==A[b].level!=c)}d=d||J(a.doc,b.line);f||(f=ab(a,d));var A=La(d,a.doc.direction),h=b.ch;b=b.sticky;h>=d.text.length?(h=d.text.length,b="before"):0>=h&&(h=0,b="after");if(!A)return t("before"==b?h-1:h,"before"==b);var k=Fb(A,h,b),L=Gb;k=g(h,k,"before"==b);null!=
L&&(k.other=g(h,L,"before"!=b));return k}function Ce(a,b){var c=0;b=U(a.doc,b);a.options.lineWrapping||(c=Nb(a.display)*b.ch);b=J(a.doc,b.line);a=Fa(b)+a.display.lineSpace.offsetTop;return{left:c,right:c,top:a,bottom:a+b.height}}function pd(a,b,c,d,f){a=I(a,b,c);a.xRel=f;d&&(a.outside=!0);return a}function qd(a,b,c){var d=a.doc;c+=a.display.viewOffset;if(0>c)return pd(d.first,0,null,!0,-1);var t=Q(d,c),f=d.first+d.size-1;if(t>f)return pd(d.first+d.size-1,J(d,f).text.length,null,!0,1);0>b&&(b=0);for(d=
J(d,t);;)if(t=rg(a,d,t,b,c),f=(d=Ka(d,!1))&&d.find(0,!0),d&&(t.ch>f.from.ch||t.ch==f.from.ch&&0<t.xRel))t=M(d=f.to.line);else return t}function De(a,b,c,d){d-=nd(b);b=b.text.length;var t=F(function(b){return Aa(a,c,b-1).bottom<=d},b,0);b=F(function(b){return Aa(a,c,b).top>d},t,b);return{begin:t,end:b}}function Ee(a,b,c,d){c||(c=ab(a,b));d=Dc(a,b,Aa(a,c,d),"line").top;return De(a,b,c,d)}function rd(a,b,c,d){return a.bottom<=c?!1:a.top>c?!0:(d?a.left:a.right)>b}function rg(a,b,c,d,f){f-=Fa(b);var t=
ab(a,b),e=nd(b),g=0,A=b.text.length,h=!0,k=La(b,a.doc.direction);k&&(k=(a.options.lineWrapping?sg:tg)(a,b,c,t,k,d,f),g=(h=1!=k.level)?k.from:k.to-1,A=h?k.to:k.from-1);var L=null,l=null;k=F(function(b){var c=Aa(a,t,b);c.top+=e;c.bottom+=e;if(!rd(c,d,f,!1))return!1;c.top<=f&&c.left<=d&&(L=b,l=c);return!0},g,A);var S=!1;l?(g=d-l.left<l.right-d,h=g==h,k=L+(h?0:1),h=h?"after":"before",g=g?l.left:l.right):(h||k!=A&&k!=g||k++,h=0==k?"after":k==b.text.length?"before":Aa(a,t,k-(h?1:0)).bottom+e<=f==h?"after":
"before",S=Ba(a,I(c,k,h),"line",b,t),g=S.left,S=f<S.top||f>=S.bottom);k=K(b.text,k,1);return pd(c,k,h,S,d-g)}function tg(a,b,c,d,f,e,g){var t=F(function(t){t=f[t];var A=1!=t.level;return rd(Ba(a,I(c,A?t.to:t.from,A?"before":"after"),"line",b,d),e,g,!0)},0,f.length-1),A=f[t];if(0<t){var h=1!=A.level;h=Ba(a,I(c,h?A.from:A.to,h?"after":"before"),"line",b,d);rd(h,e,g,!0)&&h.top>g&&(A=f[t-1])}return A}function sg(a,b,c,d,f,e,g){g=De(a,b,d,g);c=g.begin;g=g.end;/\s/.test(b.text.charAt(g-1))&&g--;for(var t=
b=null,A=0;A<f.length;A++){var h=f[A];if(!(h.from>=g||h.to<=c)){var k=Aa(a,d,1!=h.level?Math.min(g,h.to)-1:Math.max(c,h.from)).right;k=k<e?e-k+1E9:k-e;if(!b||t>k)b=h,t=k}}b||(b=f[f.length-1]);b.from<c&&(b={from:c,to:b.to,level:b.level});b.to>g&&(b={from:b.from,to:g,level:b.level});return b}function bb(b){if(null!=b.cachedTextHeight)return b.cachedTextHeight;if(null==cb){cb=a("pre");for(var c=0;49>c;++c)cb.appendChild(document.createTextNode("x")),cb.appendChild(a("br"));cb.appendChild(document.createTextNode("x"))}r(b.measure,
cb);c=cb.offsetHeight/50;3<c&&(b.cachedTextHeight=c);e(b.measure);return c||1}function Nb(b){if(null!=b.cachedCharWidth)return b.cachedCharWidth;var c=a("span","xxxxxxxxxx"),d=a("pre",[c]);r(b.measure,d);c=c.getBoundingClientRect();c=(c.right-c.left)/10;2<c&&(b.cachedCharWidth=c);return c||10}function ld(a){for(var b=a.display,c={},d={},t=b.gutters.clientLeft,f=b.gutters.firstChild,e=0;f;f=f.nextSibling,++e)c[a.options.gutters[e]]=f.offsetLeft+f.clientLeft+t,d[a.options.gutters[e]]=f.clientWidth;
return{fixedPos:sd(b),gutterTotalWidth:b.gutters.offsetWidth,gutterLeft:c,gutterWidth:d,wrapperWidth:b.wrapper.clientWidth}}function sd(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function Fe(a){var b=bb(a.display),c=a.options.lineWrapping,d=c&&Math.max(5,a.display.scroller.clientWidth/Nb(a.display)-3);return function(t){if(Xa(a.doc,t))return 0;var f=0;if(t.widgets)for(var e=0;e<t.widgets.length;e++)t.widgets[e].height&&(f+=t.widgets[e].height);return c?
f+(Math.ceil(t.text.length/d)||1)*b:f+b}}function td(a){var b=a.doc,c=Fe(a);b.iter(function(a){var b=c(a);b!=a.height&&V(a,b)})}function db(a,b,c,d){var t=a.display;if(!c&&"true"==(b.target||b.srcElement).getAttribute("cm-not-content"))return null;c=t.lineSpace.getBoundingClientRect();try{var f=b.clientX-c.left;var e=b.clientY-c.top}catch(Zd){return null}b=qd(a,f,e);var A;d&&1==b.xRel&&(A=J(a.doc,b.line).text).length==b.ch&&(d=g(A,A.length,a.options.tabSize)-A.length,b=I(b.line,Math.max(0,Math.round((f-
te(a.display).left)/Nb(a.display))-d)));return b}function $a(a,b){if(b>=a.display.viewTo)return null;b-=a.display.viewFrom;if(0>b)return null;a=a.display.view;for(var c=0;c<a.length;c++)if(b-=a[c].size,0>b)return c}function Pb(a){a.display.input.showSelection(a.display.input.prepareSelection())}function Ge(a,b){void 0===b&&(b=!0);for(var c=a.doc,d={},t=d.cursors=document.createDocumentFragment(),f=d.selection=document.createDocumentFragment(),e=0;e<c.sel.ranges.length;e++)if(b||e!=c.sel.primIndex){var g=
c.sel.ranges[e];if(!(g.from().line>=a.display.viewTo||g.to().line<a.display.viewFrom)){var A=g.empty();(A||a.options.showCursorWhenSelecting)&&He(a,g.head,t);A||ug(a,g,f)}}return d}function He(b,c,d){c=Ba(b,c,"div",null,null,!b.options.singleCursorHeightPerLine);var t=d.appendChild(a("div","\u00a0","CodeMirror-cursor"));t.style.left=c.left+"px";t.style.top=c.top+"px";t.style.height=Math.max(0,c.bottom-c.top)*b.options.cursorHeight+"px";c.other&&(b=d.appendChild(a("div","\u00a0","CodeMirror-cursor CodeMirror-secondarycursor")),
b.style.display="",b.style.left=c.other.left+"px",b.style.top=c.other.top+"px",b.style.height=.85*(c.other.bottom-c.other.top)+"px")}function Ec(a,b){return a.top-b.top||a.left-b.left}function ug(b,c,d){function t(b,c,d,t){0>c&&(c=0);c=Math.round(c);t=Math.round(t);h.appendChild(a("div",null,"CodeMirror-selected","position: absolute; left: "+b+"px;\n                             top: "+c+"px; width: "+(null==d?l-b:d)+"px;\n                             height: "+(t-c)+"px"))}function f(a,c,d){function f(c,
d){return od(b,I(a,c),"div",h,d)}function e(a,c,d){a=Ee(b,h,null,a);c="ltr"==c==("after"==d)?"left":"right";d="after"==d?a.begin:a.end-(/\s/.test(h.text.charAt(a.end-1))?2:1);return f(d,c)[c]}var h=J(g,a),A=h.text.length,L,N,p=La(h,g.direction);cg(p,c||0,null==d?A:d,function(a,b,g,h){var v="ltr"==g,u=f(a,v?"left":"right"),m=f(b-1,v?"right":"left"),q=null==c&&0==a,w=null==d&&b==A,x=0==h;h=!p||h==p.length-1;3>=m.top-u.top?(b=(S?q:w)&&x?k:(v?u:m).left,t(b,u.top,((S?w:q)&&h?l:(v?m:u).right)-b,u.bottom)):
(v?(v=S&&q&&x?k:u.left,q=S?l:e(a,g,"before"),a=S?k:e(b,g,"after"),w=S&&w&&h?l:m.right):(v=S?e(a,g,"before"):k,q=!S&&q&&x?l:u.right,a=!S&&w&&h?k:m.left,w=S?e(b,g,"after"):l),t(v,u.top,q-v,u.bottom),u.bottom<m.top&&t(k,u.bottom,null,m.top),t(a,m.top,w-a,m.bottom));if(!L||0>Ec(u,L))L=u;0>Ec(m,L)&&(L=m);if(!N||0>Ec(u,N))N=u;0>Ec(m,N)&&(N=m)});return{start:L,end:N}}var e=b.display,g=b.doc,h=document.createDocumentFragment(),A=te(b.display),k=A.left,l=Math.max(e.sizerWidth,Za(b)-e.sizer.offsetLeft)-A.right,
S="ltr"==g.direction;e=c.from();c=c.to();if(e.line==c.line)f(e.line,e.ch,c.ch);else{var p=J(g,e.line);A=J(g,c.line);A=Ea(p)==Ea(A);e=f(e.line,e.ch,A?p.text.length+1:null).end;c=f(c.line,A?0:null,c.ch).start;A&&(e.top<c.top-2?(t(e.right,e.top,null,e.bottom),t(k,c.top,c.left,c.bottom)):t(e.right,e.top,c.left-e.right,e.bottom));e.bottom<c.top&&t(k,e.bottom,null,c.top)}d.appendChild(h)}function ud(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursorDiv.style.visibility="";
0<a.options.cursorBlinkRate?b.blinker=setInterval(function(){return b.cursorDiv.style.visibility=(c=!c)?"":"hidden"},a.options.cursorBlinkRate):0>a.options.cursorBlinkRate&&(b.cursorDiv.style.visibility="hidden")}}function Ie(a){a.state.focused||(a.display.input.focus(),vd(a))}function Je(a){a.state.delayingBlurEvent=!0;setTimeout(function(){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1,Qb(a))},100)}function vd(a,b){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1);"nocursor"!=
a.options.readOnly&&(a.state.focused||(da(a,"focus",a,b),a.state.focused=!0,u(a.display.wrapper,"CodeMirror-focused"),a.curOp||a.display.selForContextMenu==a.doc.sel||(a.display.input.reset(),na&&setTimeout(function(){return a.display.input.reset(!0)},20)),a.display.input.receivedFocus()),ud(a))}function Qb(a,b){a.state.delayingBlurEvent||(a.state.focused&&(da(a,"blur",a,b),a.state.focused=!1,eb(a.display.wrapper,"CodeMirror-focused")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||
(a.display.shift=!1)},150))}function Fc(a){a=a.display;for(var b=a.lineDiv.offsetTop,c=0;c<a.view.length;c++){var d=a.view[c];if(!d.hidden){if(X&&8>ba){var t=d.node.offsetTop+d.node.offsetHeight;var f=t-b;b=t}else f=d.node.getBoundingClientRect(),f=f.bottom-f.top;t=d.line.height-f;2>f&&(f=bb(a));if(.005<t||-.005>t)if(V(d.line,f),Ke(d.line),d.rest)for(f=0;f<d.rest.length;f++)Ke(d.rest[f])}}}function Ke(a){if(a.widgets)for(var b=0;b<a.widgets.length;++b)a.widgets[b].height=a.widgets[b].node.parentNode.offsetHeight}
function wd(a,b,c){var d=c&&null!=c.top?Math.max(0,c.top):a.scroller.scrollTop;d=Math.floor(d-a.lineSpace.offsetTop);var t=c&&null!=c.bottom?c.bottom:d+a.wrapper.clientHeight;d=Q(b,d);t=Q(b,t);if(c&&c.ensure){var f=c.ensure.from.line;c=c.ensure.to.line;f<d?(d=f,t=Q(b,Fa(J(b,f))+a.wrapper.clientHeight)):Math.min(c,b.lastLine())>=t&&(d=Q(b,Fa(J(b,c))-a.wrapper.clientHeight),t=c)}return{from:d,to:Math.max(t,d+1)}}function Le(a){var b=a.display,c=b.view;if(b.alignWidgets||b.gutters.firstChild&&a.options.fixedGutter){for(var d=
sd(b)-b.scroller.scrollLeft+a.doc.scrollLeft,t=b.gutters.offsetWidth,f=d+"px",e=0;e<c.length;e++)if(!c[e].hidden){a.options.fixedGutter&&(c[e].gutter&&(c[e].gutter.style.left=f),c[e].gutterBackground&&(c[e].gutterBackground.style.left=f));var g=c[e].alignable;if(g)for(var h=0;h<g.length;h++)g[h].style.left=f}a.options.fixedGutter&&(b.gutters.style.left=d+t+"px")}}function Me(b){if(!b.options.lineNumbers)return!1;var c=b.doc;c=ha(b.options,c.first+c.size-1);var d=b.display;if(c.length!=d.lineNumChars){var t=
d.measure.appendChild(a("div",[a("div",c)],"CodeMirror-linenumber CodeMirror-gutter-elt")),f=t.firstChild.offsetWidth;t=t.offsetWidth-f;d.lineGutter.style.width="";d.lineNumInnerWidth=Math.max(f,d.lineGutter.offsetWidth-t)+1;d.lineNumWidth=d.lineNumInnerWidth+t;d.lineNumChars=d.lineNumInnerWidth?c.length:-1;d.lineGutter.style.width=d.lineNumWidth+"px";xd(b);return!0}return!1}function yd(a,b){var c=a.display,d=bb(a.display);0>b.top&&(b.top=0);var t=a.curOp&&null!=a.curOp.scrollTop?a.curOp.scrollTop:
c.scroller.scrollTop,f=jd(a),e={};b.bottom-b.top>f&&(b.bottom=b.top+f);var g=a.doc.height+id(c),h=b.top<d;d=b.bottom>g-d;b.top<t?e.scrollTop=h?0:b.top:b.bottom>t+f&&(f=Math.min(b.top,(d?g:b.bottom)-f),f!=t&&(e.scrollTop=f));t=a.curOp&&null!=a.curOp.scrollLeft?a.curOp.scrollLeft:c.scroller.scrollLeft;a=Za(a)-(a.options.fixedGutter?c.gutters.offsetWidth:0);if(c=b.right-b.left>a)b.right=b.left+a;10>b.left?e.scrollLeft=0:b.left<t?e.scrollLeft=Math.max(0,b.left-(c?0:10)):b.right>a+t-3&&(e.scrollLeft=b.right+
(c?0:10)-a);return e}function Gc(a,b){null!=b&&(Hc(a),a.curOp.scrollTop=(null==a.curOp.scrollTop?a.doc.scrollTop:a.curOp.scrollTop)+b)}function rb(a){Hc(a);var b=a.getCursor();a.curOp.scrollToPos={from:b,to:b,margin:a.options.cursorScrollMargin}}function Rb(a,b,c){null==b&&null==c||Hc(a);null!=b&&(a.curOp.scrollLeft=b);null!=c&&(a.curOp.scrollTop=c)}function Hc(a){var b=a.curOp.scrollToPos;if(b){a.curOp.scrollToPos=null;var c=Ce(a,b.from),d=Ce(a,b.to);Ne(a,c,d,b.margin)}}function Ne(a,b,c,d){b=yd(a,
{left:Math.min(b.left,c.left),top:Math.min(b.top,c.top)-d,right:Math.max(b.right,c.right),bottom:Math.max(b.bottom,c.bottom)+d});Rb(a,b.scrollLeft,b.scrollTop)}function Sb(a,b){2>Math.abs(a.doc.scrollTop-b)||(Oa||zd(a,{top:b}),Oe(a,b,!0),Oa&&zd(a),Tb(a,100))}function Oe(a,b,c){b=Math.min(a.display.scroller.scrollHeight-a.display.scroller.clientHeight,b);if(a.display.scroller.scrollTop!=b||c)a.doc.scrollTop=b,a.display.scrollbars.setScrollTop(b),a.display.scroller.scrollTop!=b&&(a.display.scroller.scrollTop=
b)}function fb(a,b,c,d){b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth);(c?b==a.doc.scrollLeft:2>Math.abs(a.doc.scrollLeft-b))&&!d||(a.doc.scrollLeft=b,Le(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbars.setScrollLeft(b))}function Ub(a){var b=a.display,c=b.gutters.offsetWidth,d=Math.round(a.doc.height+id(a.display));return{clientHeight:b.scroller.clientHeight,viewHeight:b.wrapper.clientHeight,scrollWidth:b.scroller.scrollWidth,
clientWidth:b.scroller.clientWidth,viewWidth:b.wrapper.clientWidth,barLeft:a.options.fixedGutter?c:0,docHeight:d,scrollHeight:d+Ha(a)+b.barHeight,nativeBarWidth:b.nativeBarWidth,gutterWidth:c}}function sb(a,b){b||(b=Ub(a));var c=a.display.barWidth,d=a.display.barHeight;Pe(a,b);for(b=0;4>b&&c!=a.display.barWidth||d!=a.display.barHeight;b++)c!=a.display.barWidth&&a.options.lineWrapping&&Fc(a),Pe(a,Ub(a)),c=a.display.barWidth,d=a.display.barHeight}function Pe(a,b){var c=a.display,d=c.scrollbars.update(b);
c.sizer.style.paddingRight=(c.barWidth=d.right)+"px";c.sizer.style.paddingBottom=(c.barHeight=d.bottom)+"px";c.heightForcer.style.borderBottom=d.bottom+"px solid transparent";d.right&&d.bottom?(c.scrollbarFiller.style.display="block",c.scrollbarFiller.style.height=d.bottom+"px",c.scrollbarFiller.style.width=d.right+"px"):c.scrollbarFiller.style.display="";d.bottom&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?(c.gutterFiller.style.display="block",c.gutterFiller.style.height=d.bottom+
"px",c.gutterFiller.style.width=b.gutterWidth+"px"):c.gutterFiller.style.display=""}function Qe(a){a.display.scrollbars&&(a.display.scrollbars.clear(),a.display.scrollbars.addClass&&eb(a.display.wrapper,a.display.scrollbars.addClass));a.display.scrollbars=new Re[a.options.scrollbarStyle](function(b){a.display.wrapper.insertBefore(b,a.display.scrollbarFiller);O(b,"mousedown",function(){a.state.focused&&setTimeout(function(){return a.display.input.focus()},0)});b.setAttribute("cm-not-content","true")},
function(b,c){"horizontal"==c?fb(a,b):Sb(a,b)},a);a.display.scrollbars.addClass&&u(a.display.wrapper,a.display.scrollbars.addClass)}function gb(a){a.curOp={cm:a,viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++vg};a=a.curOp;qb?qb.ops.push(a):a.ownsGroup=qb={ops:[a],delayedCallbacks:[]}}function hb(b){og(b.curOp,
function(b){for(var c=0;c<b.ops.length;c++)b.ops[c].cm.curOp=null;b=b.ops;for(c=0;c<b.length;c++){var d=b[c],f=d.cm,t=f.display,e=f.display;!e.scrollbarsClipped&&e.scroller.offsetWidth&&(e.nativeBarWidth=e.scroller.offsetWidth-e.scroller.clientWidth,e.heightForcer.style.height=Ha(f)+"px",e.sizer.style.marginBottom=-e.nativeBarWidth+"px",e.sizer.style.borderRightWidth=Ha(f)+"px",e.scrollbarsClipped=!0);d.updateMaxLine&&Zc(f);d.mustUpdate=d.viewChanged||d.forceUpdate||null!=d.scrollTop||d.scrollToPos&&
(d.scrollToPos.from.line<t.viewFrom||d.scrollToPos.to.line>=t.viewTo)||t.maxLineChanged&&f.options.lineWrapping;d.update=d.mustUpdate&&new Ic(f,d.mustUpdate&&{top:d.scrollTop,ensure:d.scrollToPos},d.forceUpdate)}for(c=0;c<b.length;c++)d=b[c],d.updatedDisplay=d.mustUpdate&&Ad(d.cm,d.update);for(c=0;c<b.length;c++)if(d=b[c],f=d.cm,t=f.display,d.updatedDisplay&&Fc(f),d.barMeasure=Ub(f),t.maxLineChanged&&!f.options.lineWrapping&&(e=t.maxLine.text.length,e=Aa(f,ab(f,t.maxLine),e,void 0),d.adjustWidthTo=
e.left+3,f.display.sizerWidth=d.adjustWidthTo,d.barMeasure.scrollWidth=Math.max(t.scroller.clientWidth,t.sizer.offsetLeft+d.adjustWidthTo+Ha(f)+f.display.barWidth),d.maxScrollLeft=Math.max(0,t.sizer.offsetLeft+d.adjustWidthTo-Za(f))),d.updatedDisplay||d.selectionChanged)d.preparedSelection=t.input.prepareSelection();for(c=0;c<b.length;c++)d=b[c],f=d.cm,null!=d.adjustWidthTo&&(f.display.sizer.style.minWidth=d.adjustWidthTo+"px",d.maxScrollLeft<f.doc.scrollLeft&&fb(f,Math.min(f.display.scroller.scrollLeft,
d.maxScrollLeft),!0),f.display.maxLineChanged=!1),t=d.focus&&d.focus==w(),d.preparedSelection&&f.display.input.showSelection(d.preparedSelection,t),(d.updatedDisplay||d.startHeight!=f.doc.height)&&sb(f,d.barMeasure),d.updatedDisplay&&Bd(f,d.barMeasure),d.selectionChanged&&ud(f),f.state.focused&&d.updateInput&&f.display.input.reset(d.typing),t&&Ie(d.cm);for(c=0;c<b.length;c++){var g=void 0;d=b[c];f=d.cm;t=f.display;e=f.doc;d.updatedDisplay&&Se(f,d.update);null==t.wheelStartX||null==d.scrollTop&&null==
d.scrollLeft&&!d.scrollToPos||(t.wheelStartX=t.wheelStartY=null);null!=d.scrollTop&&Oe(f,d.scrollTop,d.forceScroll);null!=d.scrollLeft&&fb(f,d.scrollLeft,!0,!0);if(d.scrollToPos){var h=U(e,d.scrollToPos.from),A=U(e,d.scrollToPos.to),k=d.scrollToPos.margin;null==k&&(k=0);f.options.lineWrapping||h!=A||(h=h.ch?I(h.line,"before"==h.sticky?h.ch-1:h.ch,"after"):h,A="before"==h.sticky?I(h.line,h.ch+1,"before"):h);for(var l=0;5>l;l++){var p=!1;g=Ba(f,h);var v=A&&A!=h?Ba(f,A):g;g={left:Math.min(g.left,v.left),
top:Math.min(g.top,v.top)-k,right:Math.max(g.left,v.left),bottom:Math.max(g.bottom,v.bottom)+k};v=yd(f,g);var u=f.doc.scrollTop,m=f.doc.scrollLeft;null!=v.scrollTop&&(Sb(f,v.scrollTop),1<Math.abs(f.doc.scrollTop-u)&&(p=!0));null!=v.scrollLeft&&(fb(f,v.scrollLeft),1<Math.abs(f.doc.scrollLeft-m)&&(p=!0));if(!p)break}A=g;ia(f,"scrollCursorIntoView")||(k=f.display,l=k.sizer.getBoundingClientRect(),h=null,0>A.top+l.top?h=!0:A.bottom+l.top>(window.innerHeight||document.documentElement.clientHeight)&&(h=
!1),null==h||wg||(A=a("div","\u200b",null,"position: absolute;\n                         top: "+(A.top-k.viewOffset-f.display.lineSpace.offsetTop)+"px;\n                         height: "+(A.bottom-A.top+Ha(f)+k.barHeight)+"px;\n                         left: "+A.left+"px; width: "+Math.max(2,A.right-A.left)+"px;"),f.display.lineSpace.appendChild(A),A.scrollIntoView(h),f.display.lineSpace.removeChild(A)))}A=d.maybeHiddenMarkers;h=d.maybeUnhiddenMarkers;if(A)for(k=0;k<A.length;++k)A[k].lines.length||
da(A[k],"hide");if(h)for(A=0;A<h.length;++A)h[A].lines.length&&da(h[A],"unhide");t.wrapper.offsetHeight&&(e.scrollTop=f.display.scroller.scrollTop);d.changeObjs&&da(f,"changes",f,d.changeObjs);d.update&&d.update.finish()}})}function ta(a,b){if(a.curOp)return b();gb(a);try{return b()}finally{hb(a)}}function ja(a,b){return function(){if(a.curOp)return b.apply(a,arguments);gb(a);try{return b.apply(a,arguments)}finally{hb(a)}}}function pa(a){return function(){if(this.curOp)return a.apply(this,arguments);
gb(this);try{return a.apply(this,arguments)}finally{hb(this)}}}function ka(a){return function(){var b=this.cm;if(!b||b.curOp)return a.apply(this,arguments);gb(b);try{return a.apply(this,arguments)}finally{hb(b)}}}function ra(a,b,c,d){null==b&&(b=a.doc.first);null==c&&(c=a.doc.first+a.doc.size);d||(d=0);var f=a.display;d&&c<f.viewTo&&(null==f.updateLineNumbers||f.updateLineNumbers>b)&&(f.updateLineNumbers=b);a.curOp.viewChanged=!0;if(b>=f.viewTo)Pa&&Xc(a.doc,b)<f.viewTo&&Qa(a);else if(c<=f.viewFrom)Pa&&
Yd(a.doc,c+d)>f.viewFrom?Qa(a):(f.viewFrom+=d,f.viewTo+=d);else if(b<=f.viewFrom&&c>=f.viewTo)Qa(a);else if(b<=f.viewFrom){var e=Jc(a,c,c+d,1);e?(f.view=f.view.slice(e.index),f.viewFrom=e.lineN,f.viewTo+=d):Qa(a)}else if(c>=f.viewTo)(e=Jc(a,b,b,-1))?(f.view=f.view.slice(0,e.index),f.viewTo=e.lineN):Qa(a);else{e=Jc(a,b,b,-1);var t=Jc(a,c,c+d,1);e&&t?(f.view=f.view.slice(0,e.index).concat(Ac(a,e.lineN,t.lineN)).concat(f.view.slice(t.index)),f.viewTo+=d):Qa(a)}if(a=f.externalMeasured)c<a.lineN?a.lineN+=
d:b<a.lineN+a.size&&(f.externalMeasured=null)}function Ra(a,b,c){a.curOp.viewChanged=!0;var f=a.display,e=a.display.externalMeasured;e&&b>=e.lineN&&b<e.lineN+e.size&&(f.externalMeasured=null);b<f.viewFrom||b>=f.viewTo||(a=f.view[$a(a,b)],null!=a.node&&(a=a.changes||(a.changes=[]),-1==d(a,c)&&a.push(c)))}function Qa(a){a.display.viewFrom=a.display.viewTo=a.doc.first;a.display.view=[];a.display.viewOffset=0}function Jc(a,b,c,d){var f=$a(a,b),e=a.display.view;if(!Pa||c==a.doc.first+a.doc.size)return{index:f,
lineN:c};for(var t=a.display.viewFrom,g=0;g<f;g++)t+=e[g].size;if(t!=b){if(0<d){if(f==e.length-1)return null;b=t+e[f].size-b;f++}else b=t-b;c+=b}for(;Xc(a.doc,c)!=c;){if(f==(0>d?0:e.length-1))return null;c+=d*e[f-(0>d?1:0)].size;f+=d}return{index:f,lineN:c}}function Te(a){a=a.display.view;for(var b=0,c=0;c<a.length;c++){var d=a[c];d.hidden||d.node&&!d.changes||++b}return b}function Tb(a,b){a.doc.highlightFrontier<a.display.viewTo&&a.state.highlight.set(b,k(xg,a))}function xg(a){var b=a.doc;if(!(b.highlightFrontier>=
a.display.viewTo)){var c=+new Date+a.options.workTime,d=Ib(a,b.highlightFrontier),f=[];b.iter(d.line,Math.min(b.first+b.size,a.display.viewTo+500),function(e){if(d.line>=a.display.viewFrom){var t=e.styles,g=e.text.length>a.options.maxHighlightLength?Ya(b.mode,d.state):null,h=de(a,e,d,!0);g&&(d.state=g);e.styles=h.styles;g=e.styleClasses;(h=h.classes)?e.styleClasses=h:g&&(e.styleClasses=null);h=!t||t.length!=e.styles.length||g!=h&&(!g||!h||g.bgClass!=h.bgClass||g.textClass!=h.textClass);for(g=0;!h&&
g<t.length;++g)h=t[g]!=e.styles[g];h&&f.push(d.line);e.stateAfter=d.save()}else e.text.length<=a.options.maxHighlightLength&&ed(a,e.text,d),e.stateAfter=0==d.line%5?d.save():null;d.nextLine();if(+new Date>c)return Tb(a,a.options.workDelay),!0});b.highlightFrontier=d.line;b.modeFrontier=Math.max(b.modeFrontier,d.line);f.length&&ta(a,function(){for(var b=0;b<f.length;b++)Ra(a,f[b],"text")})}}function Ad(a,b){var c=a.display,d=a.doc;if(b.editorIsHidden)return Qa(a),!1;if(!b.force&&b.visible.from>=c.viewFrom&&
b.visible.to<=c.viewTo&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo)&&c.renderedView==c.view&&0==Te(a))return!1;Me(a)&&(Qa(a),b.dims=ld(a));var f=d.first+d.size,t=Math.max(b.visible.from-a.options.viewportMargin,d.first),g=Math.min(f,b.visible.to+a.options.viewportMargin);c.viewFrom<t&&20>t-c.viewFrom&&(t=Math.max(d.first,c.viewFrom));c.viewTo>g&&20>c.viewTo-g&&(g=Math.min(f,c.viewTo));Pa&&(t=Xc(a.doc,t),g=Yd(a.doc,g));d=t!=c.viewFrom||g!=c.viewTo||c.lastWrapHeight!=b.wrapperHeight||
c.lastWrapWidth!=b.wrapperWidth;f=a.display;0==f.view.length||t>=f.viewTo||g<=f.viewFrom?(f.view=Ac(a,t,g),f.viewFrom=t):(f.viewFrom>t?f.view=Ac(a,t,f.viewFrom).concat(f.view):f.viewFrom<t&&(f.view=f.view.slice($a(a,t))),f.viewFrom=t,f.viewTo<g?f.view=f.view.concat(Ac(a,f.viewTo,g)):f.viewTo>g&&(f.view=f.view.slice(0,$a(a,g))));f.viewTo=g;c.viewOffset=Fa(J(a.doc,c.viewFrom));a.display.mover.style.top=c.viewOffset+"px";g=Te(a);if(!d&&0==g&&!b.force&&c.renderedView==c.view&&(null==c.updateLineNumbers||
c.updateLineNumbers>=c.viewTo))return!1;a.hasFocus()?t=null:(t=w())&&l(a.display.lineDiv,t)?(t={activeElt:t},window.getSelection&&(f=window.getSelection(),f.anchorNode&&f.extend&&l(a.display.lineDiv,f.anchorNode)&&(t.anchorNode=f.anchorNode,t.anchorOffset=f.anchorOffset,t.focusNode=f.focusNode,t.focusOffset=f.focusOffset))):t=null;4<g&&(c.lineDiv.style.display="none");yg(a,c.updateLineNumbers,b.dims);4<g&&(c.lineDiv.style.display="");c.renderedView=c.view;(g=t)&&g.activeElt&&g.activeElt!=w()&&(g.activeElt.focus(),
g.anchorNode&&l(document.body,g.anchorNode)&&l(document.body,g.focusNode)&&(t=window.getSelection(),f=document.createRange(),f.setEnd(g.anchorNode,g.anchorOffset),f.collapse(!1),t.removeAllRanges(),t.addRange(f),t.extend(g.focusNode,g.focusOffset)));e(c.cursorDiv);e(c.selectionDiv);c.gutters.style.height=c.sizer.style.minHeight=0;d&&(c.lastWrapHeight=b.wrapperHeight,c.lastWrapWidth=b.wrapperWidth,Tb(a,400));c.updateLineNumbers=null;return!0}function Se(a,b){for(var c=b.viewport,d=!0;;d=!1){if(!d||
!a.options.lineWrapping||b.oldDisplayWidth==Za(a))if(c&&null!=c.top&&(c={top:Math.min(a.doc.height+id(a.display)-jd(a),c.top)}),b.visible=wd(a.display,a.doc,c),b.visible.from>=a.display.viewFrom&&b.visible.to<=a.display.viewTo)break;if(!Ad(a,b))break;Fc(a);d=Ub(a);Pb(a);sb(a,d);Bd(a,d);b.force=!1}b.signal(a,"update",a);if(a.display.viewFrom!=a.display.reportedViewFrom||a.display.viewTo!=a.display.reportedViewTo)b.signal(a,"viewportChange",a,a.display.viewFrom,a.display.viewTo),a.display.reportedViewFrom=
a.display.viewFrom,a.display.reportedViewTo=a.display.viewTo}function zd(a,b){b=new Ic(a,b);if(Ad(a,b)){Fc(a);Se(a,b);var c=Ub(a);Pb(a);sb(a,c);Bd(a,c);b.finish()}}function yg(a,b,c){function f(b){var c=b.nextSibling;na&&za&&a.display.currentWheelTarget==b?b.style.display="none":b.parentNode.removeChild(b);return c}var t=a.display,g=a.options.lineNumbers,h=t.lineDiv,A=h.firstChild,k=t.view;t=t.viewFrom;for(var l=0;l<k.length;l++){var p=k[l];if(!p.hidden)if(p.node&&p.node.parentNode==h){for(;A!=p.node;)A=
f(A);A=g&&null!=b&&b<=t&&p.lineNumber;p.changes&&(-1<d(p.changes,"gutter")&&(A=!1),oe(a,p,t,c));A&&(e(p.lineNumber),p.lineNumber.appendChild(document.createTextNode(ha(a.options,t))));A=p.node.nextSibling}else{var v=qg(a,p,t,c);h.insertBefore(v,A)}t+=p.size}for(;A;)A=f(A)}function xd(a){a.display.sizer.style.marginLeft=a.display.gutters.offsetWidth+"px"}function Bd(a,b){a.display.sizer.style.minHeight=b.docHeight+"px";a.display.heightForcer.style.top=b.docHeight+"px";a.display.gutters.style.height=
b.docHeight+a.display.barHeight+Ha(a)+"px"}function Ue(b){var c=b.display.gutters,d=b.options.gutters;e(c);for(var f=0;f<d.length;++f){var t=d[f],g=c.appendChild(a("div",null,"CodeMirror-gutter "+t));"CodeMirror-linenumbers"==t&&(b.display.lineGutter=g,g.style.width=(b.display.lineNumWidth||1)+"px")}c.style.display=f?"":"none";xd(b)}function Cd(a){var b=d(a.gutters,"CodeMirror-linenumbers");-1==b&&a.lineNumbers?a.gutters=a.gutters.concat(["CodeMirror-linenumbers"]):-1<b&&!a.lineNumbers&&(a.gutters=
a.gutters.slice(0),a.gutters.splice(b,1))}function Ve(a){var b=a.wheelDeltaX,c=a.wheelDeltaY;null==b&&a.detail&&a.axis==a.HORIZONTAL_AXIS&&(b=a.detail);null==c&&a.detail&&a.axis==a.VERTICAL_AXIS?c=a.detail:null==c&&(c=a.wheelDelta);return{x:b,y:c}}function zg(a){a=Ve(a);a.x*=wa;a.y*=wa;return a}function We(a,b){var c=Ve(b),d=c.x;c=c.y;var f=a.display,e=f.scroller,t=e.scrollWidth>e.clientWidth,g=e.scrollHeight>e.clientHeight;if(d&&t||c&&g){if(c&&za&&na){t=b.target;var h=f.view;a:for(;t!=e;t=t.parentNode)for(var A=
0;A<h.length;A++)if(h[A].node==t){a.display.currentWheelTarget=t;break a}}!d||Oa||Ca||null==wa?(c&&null!=wa&&(b=c*wa,g=a.doc.scrollTop,t=g+f.wrapper.clientHeight,0>b?g=Math.max(0,g+b-50):t=Math.min(a.doc.height,t+b+50),zd(a,{top:g,bottom:t})),20>Kc&&(null==f.wheelStartX?(f.wheelStartX=e.scrollLeft,f.wheelStartY=e.scrollTop,f.wheelDX=d,f.wheelDY=c,setTimeout(function(){if(null!=f.wheelStartX){var a=e.scrollLeft-f.wheelStartX,b=e.scrollTop-f.wheelStartY;a=b&&f.wheelDY&&b/f.wheelDY||a&&f.wheelDX&&a/
f.wheelDX;f.wheelStartX=f.wheelStartY=null;a&&(wa=(wa*Kc+a)/(Kc+1),++Kc)}},200)):(f.wheelDX+=d,f.wheelDY+=c))):(c&&g&&Sb(a,Math.max(0,e.scrollTop+c*wa)),fb(a,Math.max(0,e.scrollLeft+d*wa)),(!c||c&&g)&&oa(b),f.wheelStartX=null)}}function Da(a,b){b=a[b];a.sort(function(a,b){return P(a.from(),b.from())});b=d(a,b);for(var c=1;c<a.length;c++){var f=a[c],e=a[c-1];if(0<=P(e.to(),f.from())){var t=rc(e.from(),f.from()),g=tc(e.to(),f.to());f=e.empty()?f.from()==f.head:e.from()==e.head;c<=b&&--b;a.splice(--c,
2,new Y(f?g:t,f?t:g))}}return new xa(a,b)}function Na(a,b){return new xa([new Y(a,b||a)],0)}function Sa(a){return a.text?I(a.from.line+a.text.length-1,y(a.text).length+(1==a.text.length?a.from.ch:0)):a.to}function Xe(a,b){if(0>P(a,b.from))return a;if(0>=P(a,b.to))return Sa(b);var c=a.line+b.text.length-(b.to.line-b.from.line)-1,d=a.ch;a.line==b.to.line&&(d+=Sa(b).ch-b.to.ch);return I(c,d)}function Dd(a,b){for(var c=[],d=0;d<a.sel.ranges.length;d++){var f=a.sel.ranges[d];c.push(new Y(Xe(f.anchor,b),
Xe(f.head,b)))}return Da(c,a.sel.primIndex)}function Ye(a,b,c){return a.line==b.line?I(c.line,a.ch-b.ch+c.ch):I(c.line+(a.line-b.line),a.ch)}function Ed(a){a.doc.mode=cd(a.options,a.doc.modeOption);Vb(a)}function Vb(a){a.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null)});a.doc.modeFrontier=a.doc.highlightFrontier=a.doc.first;Tb(a,100);a.state.modeGen++;a.curOp&&ra(a)}function Ze(a,b){return 0==b.from.ch&&0==b.to.ch&&""==y(b.text)&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}
function Fd(a,b,c,d){function f(a,c,f){a.text=c;a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null);null!=a.order&&(a.order=null);mb(a);Wd(a,f);c=d?d(a):1;c!=a.height&&V(a,c);la(a,"change",a,b)}function e(a,b){for(var f=[];a<b;++a)f.push(new tb(h[a],c?c[a]:null,d));return f}var t=b.from,g=b.to,h=b.text,k=J(a,t.line),A=J(a,g.line),l=y(h),L=c?c[h.length-1]:null,p=g.line-t.line;b.full?(a.insert(0,e(0,h.length)),a.remove(h.length,a.size-h.length)):Ze(a,b)?(g=e(0,h.length-1),f(A,A.text,L),p&&a.remove(t.line,
p),g.length&&a.insert(t.line,g)):k==A?1==h.length?f(k,k.text.slice(0,t.ch)+l+k.text.slice(g.ch),L):(p=e(1,h.length-1),p.push(new tb(l+k.text.slice(g.ch),L,d)),f(k,k.text.slice(0,t.ch)+h[0],c?c[0]:null),a.insert(t.line+1,p)):1==h.length?(f(k,k.text.slice(0,t.ch)+h[0]+A.text.slice(g.ch),c?c[0]:null),a.remove(t.line+1,p)):(f(k,k.text.slice(0,t.ch)+h[0],c?c[0]:null),f(A,l+A.text.slice(g.ch),L),L=e(1,h.length-1),1<p&&a.remove(t.line+1,p-1),a.insert(t.line+1,L));la(a,"change",a,b)}function ib(a,b,c){function d(a,
f,e){if(a.linked)for(var t=0;t<a.linked.length;++t){var g=a.linked[t];if(g.doc!=f){var h=e&&g.sharedHist;if(!c||h)b(g.doc,h),d(g.doc,a,h)}}}d(a,null,!0)}function $e(a,b){if(b.cm)throw Error("This document is already in use.");a.doc=b;b.cm=a;td(a);Ed(a);af(a);a.options.lineWrapping||Zc(a);a.options.mode=b.modeOption;ra(a)}function af(a){("rtl"==a.doc.direction?u:eb)(a.display.lineDiv,"CodeMirror-rtl")}function Ag(a){ta(a,function(){af(a);ra(a)})}function Lc(a){this.done=[];this.undone=[];this.undoDepth=
Infinity;this.lastModTime=this.lastSelTime=0;this.lastOrigin=this.lastSelOrigin=this.lastOp=this.lastSelOp=null;this.generation=this.maxGeneration=a||1}function Gd(a,b){var c={from:Wa(b.from),to:Sa(b),text:R(a,b.from,b.to)};bf(a,c,b.from.line,b.to.line+1);ib(a,function(a){return bf(a,c,b.from.line,b.to.line+1)},!0);return c}function cf(a){for(;a.length;)if(y(a).ranges)a.pop();else break}function df(a,b,c,d){var f=a.history;f.undone.length=0;var e=+new Date,t;if(t=f.lastOp==d||f.lastOrigin==b.origin&&
b.origin&&("+"==b.origin.charAt(0)&&a.cm&&f.lastModTime>e-a.cm.options.historyEventDelay||"*"==b.origin.charAt(0))){if(f.lastOp==d){cf(f.done);var g=y(f.done)}else f.done.length&&!y(f.done).ranges?g=y(f.done):1<f.done.length&&!f.done[f.done.length-2].ranges?(f.done.pop(),g=y(f.done)):g=void 0;t=g}if(t){var h=y(g.changes);0==P(b.from,b.to)&&0==P(b.from,h.to)?h.to=Sa(b):g.changes.push(Gd(a,b))}else for((g=y(f.done))&&g.ranges||Mc(a.sel,f.done),g={changes:[Gd(a,b)],generation:f.generation},f.done.push(g);f.done.length>
f.undoDepth;)f.done.shift(),f.done[0].ranges||f.done.shift();f.done.push(c);f.generation=++f.maxGeneration;f.lastModTime=f.lastSelTime=e;f.lastOp=f.lastSelOp=d;f.lastOrigin=f.lastSelOrigin=b.origin;h||da(a,"historyAdded")}function Mc(a,b){var c=y(b);c&&c.ranges&&c.equals(a)||b.push(a)}function bf(a,b,c,d){var f=b["spans_"+a.id],e=0;a.iter(Math.max(a.first,c),Math.min(a.first+a.size,d),function(c){c.markedSpans&&((f||(f=b["spans_"+a.id]={}))[e]=c.markedSpans);++e})}function Bg(a){if(!a)return null;
for(var b,c=0;c<a.length;++c)a[c].marker.explicitlyCleared?b||(b=a.slice(0,c)):b&&b.push(a[c]);return b?b.length?b:null:a}function ef(a,b){var c;if(c=b["spans_"+a.id]){for(var d=[],f=0;f<b.text.length;++f)d.push(Bg(c[f]));c=d}else c=null;a=qc(a,b);if(!c)return a;if(!a)return c;for(b=0;b<c.length;++b)if(d=c[b],f=a[b],d&&f){var e=0;a:for(;e<f.length;++e){for(var g=f[e],t=0;t<d.length;++t)if(d[t].marker==g.marker)continue a;d.push(g)}}else f&&(c[b]=f);return c}function ub(a,b,c){for(var f=[],e=0;e<a.length;++e){var g=
a[e];if(g.ranges)f.push(c?xa.prototype.deepCopy.call(g):g);else{g=g.changes;var t=[];f.push({changes:t});for(var h=0;h<g.length;++h){var k=g[h],A;t.push({from:k.from,to:k.to,text:k.text});if(b)for(var l in k)(A=l.match(/^spans_(\d+)$/))&&-1<d(b,Number(A[1]))&&(y(t)[l]=k[l],delete k[l])}}}return f}function Hd(a,b,c,d){return d?(a=a.anchor,c&&(d=0>P(b,a),d!=0>P(c,a)?(a=b,b=c):d!=0>P(b,c)&&(b=c)),new Y(a,b)):new Y(c||b,b)}function Nc(a,b,c,d,f){null==f&&(f=a.cm&&(a.cm.display.shift||a.extend));ma(a,
new xa([Hd(a.sel.primary(),b,c,f)],0),d)}function ff(a,b,c){for(var d=[],f=a.cm&&(a.cm.display.shift||a.extend),e=0;e<a.sel.ranges.length;e++)d[e]=Hd(a.sel.ranges[e],b[e],null,f);b=Da(d,a.sel.primIndex);ma(a,b,c)}function Id(a,b,c,d){var f=a.sel.ranges.slice(0);f[b]=c;ma(a,Da(f,a.sel.primIndex),d)}function Cg(a,b,c){c={ranges:b.ranges,update:function(b){this.ranges=[];for(var c=0;c<b.length;c++)this.ranges[c]=new Y(U(a,b[c].anchor),U(a,b[c].head))},origin:c&&c.origin};da(a,"beforeSelectionChange",
a,c);a.cm&&da(a.cm,"beforeSelectionChange",a.cm,c);return c.ranges!=b.ranges?Da(c.ranges,c.ranges.length-1):b}function gf(a,b,c){var d=a.history.done,f=y(d);f&&f.ranges?(d[d.length-1]=b,Oc(a,b,c)):ma(a,b,c)}function ma(a,b,c){Oc(a,b,c);b=a.sel;var d=a.cm?a.cm.curOp.id:NaN,f=a.history,e=c&&c.origin,g;if(!(g=d==f.lastSelOp)&&(g=e&&f.lastSelOrigin==e)&&!(g=f.lastModTime==f.lastSelTime&&f.lastOrigin==e)){g=y(f.done);var t=e.charAt(0);g="*"==t||"+"==t&&g.ranges.length==b.ranges.length&&g.somethingSelected()==
b.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}g?f.done[f.done.length-1]=b:Mc(b,f.done);f.lastSelTime=+new Date;f.lastSelOrigin=e;f.lastSelOp=d;c&&!1!==c.clearRedo&&cf(f.undone)}function Oc(a,b,c){if(ya(a,"beforeSelectionChange")||a.cm&&ya(a.cm,"beforeSelectionChange"))b=Cg(a,b,c);var d=c&&c.bias||(0>P(b.primary().head,a.sel.primary().head)?-1:1);hf(a,jf(a,b,d,!0));c&&!1===c.scroll||!a.cm||rb(a.cm)}function hf(a,b){b.equals(a.sel)||(a.sel=b,a.cm&&
(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=!0,$d(a.cm)),la(a,"cursorActivity",a))}function kf(a){hf(a,jf(a,a.sel,null,!1))}function jf(a,b,c,d){for(var f,e=0;e<b.ranges.length;e++){var g=b.ranges[e],t=b.ranges.length==a.sel.ranges.length&&a.sel.ranges[e],h=Jd(a,g.anchor,t&&t.anchor,c,d);t=Jd(a,g.head,t&&t.head,c,d);if(f||h!=g.anchor||t!=g.head)f||(f=b.ranges.slice(0,e)),f[e]=new Y(h,t)}return f?Da(f,b.primIndex):b}function vb(a,b,c,d,f){var e=J(a,b.line);if(e.markedSpans)for(var g=0;g<e.markedSpans.length;++g){var t=
e.markedSpans[g],h=t.marker;if((null==t.from||(h.inclusiveLeft?t.from<=b.ch:t.from<b.ch))&&(null==t.to||(h.inclusiveRight?t.to>=b.ch:t.to>b.ch))){if(f&&(da(h,"beforeCursorEnter"),h.explicitlyCleared))if(e.markedSpans){--g;continue}else break;if(h.atomic){if(c){g=h.find(0>d?1:-1);t=void 0;if(0>d?h.inclusiveRight:h.inclusiveLeft)g=lf(a,g,-d,g&&g.line==b.line?e:null);if(g&&g.line==b.line&&(t=P(g,c))&&(0>d?0>t:0<t))return vb(a,g,b,d,f)}c=h.find(0>d?-1:1);if(0>d?h.inclusiveLeft:h.inclusiveRight)c=lf(a,
c,d,c.line==b.line?e:null);return c?vb(a,c,b,d,f):null}}}return b}function Jd(a,b,c,d,f){d=d||1;b=vb(a,b,c,d,f)||!f&&vb(a,b,c,d,!0)||vb(a,b,c,-d,f)||!f&&vb(a,b,c,-d,!0);return b?b:(a.cantEdit=!0,I(a.first,0))}function lf(a,b,c,d){return 0>c&&0==b.ch?b.line>a.first?U(a,I(b.line-1)):null:0<c&&b.ch==(d||J(a,b.line)).text.length?b.line<a.first+a.size-1?I(b.line+1,0):null:new I(b.line,b.ch+c)}function mf(a){a.setSelection(I(a.firstLine(),0),I(a.lastLine()),Ia)}function nf(a,b,c){var d={canceled:!1,from:b.from,
to:b.to,text:b.text,origin:b.origin,cancel:function(){return d.canceled=!0}};c&&(d.update=function(b,c,f,e){b&&(d.from=U(a,b));c&&(d.to=U(a,c));f&&(d.text=f);void 0!==e&&(d.origin=e)});da(a,"beforeChange",a,d);a.cm&&da(a.cm,"beforeChange",a.cm,d);return d.canceled?null:{from:d.from,to:d.to,text:d.text,origin:d.origin}}function wb(a,b,c){if(a.cm){if(!a.cm.curOp)return ja(a.cm,wb)(a,b,c);if(a.cm.state.suppressEdits)return}if(ya(a,"beforeChange")||a.cm&&ya(a.cm,"beforeChange"))if(b=nf(a,b,!0),!b)return;
if(c=of&&!c&&$f(a,b.from,b.to))for(var d=c.length-1;0<=d;--d)pf(a,{from:c[d].from,to:c[d].to,text:d?[""]:b.text,origin:b.origin});else pf(a,b)}function pf(a,b){if(1!=b.text.length||""!=b.text[0]||0!=P(b.from,b.to)){var c=Dd(a,b);df(a,b,c,a.cm?a.cm.curOp.id:NaN);Wb(a,b,c,qc(a,b));var f=[];ib(a,function(a,c){c||-1!=d(f,a.history)||(qf(a.history,b),f.push(a.history));Wb(a,b,null,qc(a,b))})}}function Pc(a,b,c){if(!a.cm||!a.cm.state.suppressEdits||c){for(var f=a.history,e,g=a.sel,t="undo"==b?f.done:f.undone,
h="undo"==b?f.undone:f.done,k=0;k<t.length&&(e=t[k],c?!e.ranges||e.equals(a.sel):e.ranges);k++);if(k!=t.length){for(f.lastOrigin=f.lastSelOrigin=null;;)if(e=t.pop(),e.ranges){Mc(e,h);if(c&&!e.equals(a.sel)){ma(a,e,{clearRedo:!1});return}g=e}else break;var A=[];Mc(g,h);h.push({changes:A,generation:f.generation});f.generation=e.generation||++f.maxGeneration;var l=ya(a,"beforeChange")||a.cm&&ya(a.cm,"beforeChange");c=function(c){var f=e.changes[c];f.origin=b;if(l&&!nf(a,f,!1))return t.length=0,{};A.push(Gd(a,
f));var g=c?Dd(a,f):y(t);Wb(a,f,g,ef(a,f));!c&&a.cm&&a.cm.scrollIntoView({from:f.from,to:Sa(f)});var h=[];ib(a,function(a,b){b||-1!=d(h,a.history)||(qf(a.history,f),h.push(a.history));Wb(a,f,null,ef(a,f))})};for(f=e.changes.length-1;0<=f;--f)if(g=c(f))return g.v}}}function rf(a,b){if(0!=b&&(a.first+=b,a.sel=new xa(n(a.sel.ranges,function(a){return new Y(I(a.anchor.line+b,a.anchor.ch),I(a.head.line+b,a.head.ch))}),a.sel.primIndex),a.cm)){ra(a.cm,a.first,a.first-b,b);for(var c=a.cm.display,d=c.viewFrom;d<
c.viewTo;d++)Ra(a.cm,d,"gutter")}}function Wb(a,b,c,d){if(a.cm&&!a.cm.curOp)return ja(a.cm,Wb)(a,b,c,d);if(b.to.line<a.first)rf(a,b.text.length-1-(b.to.line-b.from.line));else if(!(b.from.line>a.lastLine())){if(b.from.line<a.first){var f=b.text.length-1-(a.first-b.from.line);rf(a,f);b={from:I(a.first,0),to:I(b.to.line+f,b.to.ch),text:[y(b.text)],origin:b.origin}}f=a.lastLine();b.to.line>f&&(b={from:b.from,to:I(f,J(a,f).text.length),text:[b.text[0]],origin:b.origin});b.removed=R(a,b.from,b.to);c||
(c=Dd(a,b));a.cm?Dg(a.cm,b,d):Fd(a,b,d);Oc(a,c,Ia)}}function Dg(a,b,c){var d=a.doc,f=a.display,e=b.from,g=b.to,t=!1,h=e.line;a.options.lineWrapping||(h=M(Ea(J(d,e.line))),d.iter(h,g.line+1,function(a){if(a==f.maxLine)return t=!0}));-1<d.sel.contains(b.from,b.to)&&$d(a);Fd(d,b,c,Fe(a));a.options.lineWrapping||(d.iter(h,e.line+b.text.length,function(a){var b=wc(a);b>f.maxLineLength&&(f.maxLine=a,f.maxLineLength=b,f.maxLineChanged=!0,t=!1)}),t&&(a.curOp.updateMaxLine=!0));ig(d,e.line);Tb(a,400);c=b.text.length-
(g.line-e.line)-1;b.full?ra(a):e.line!=g.line||1!=b.text.length||Ze(a.doc,b)?ra(a,e.line,g.line+1,c):Ra(a,e.line,"text");c=ya(a,"changes");if((d=ya(a,"change"))||c)b={from:e,to:g,text:b.text,removed:b.removed,origin:b.origin},d&&la(a,"change",a,b),c&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(b);a.display.selForContextMenu=null}function xb(a,b,c,d,f){d||(d=c);if(0>P(d,c)){var e=[d,c];c=e[0];d=e[1];e}"string"==typeof b&&(b=a.splitLines(b));wb(a,{from:c,to:d,text:b,origin:f})}function sf(a,
b,c,d){c<a.line?a.line+=d:b<a.line&&(a.line=b,a.ch=0)}function tf(a,b,c,d){for(var f=0;f<a.length;++f){var e=a[f],g=!0;if(e.ranges)for(e.copied||(e=a[f]=e.deepCopy(),e.copied=!0),g=0;g<e.ranges.length;g++)sf(e.ranges[g].anchor,b,c,d),sf(e.ranges[g].head,b,c,d);else{for(var t=0;t<e.changes.length;++t){var h=e.changes[t];if(c<h.from.line)h.from=I(h.from.line+d,h.from.ch),h.to=I(h.to.line+d,h.to.ch);else if(b<=h.to.line){g=!1;break}}g||(a.splice(0,f+1),f=0)}}}function qf(a,b){var c=b.from.line,d=b.to.line;
b=b.text.length-(d-c)-1;tf(a.done,c,d,b);tf(a.undone,c,d,b)}function Xb(a,b,c,d){var f=b,e=b;"number"==typeof b?e=J(a,Math.max(a.first,Math.min(b,a.first+a.size-1))):f=M(b);if(null==f)return null;d(e,f)&&a.cm&&Ra(a.cm,f,c);return e}function Yb(a){this.lines=a;this.parent=null;for(var b=0,c=0;c<a.length;++c)a[c].parent=this,b+=a[c].height;this.height=b}function Zb(a){this.children=a;for(var b=0,c=0,d=0;d<a.length;++d){var f=a[d];b+=f.chunkSize();c+=f.height;f.parent=this}this.size=b;this.height=c;
this.parent=null}function Eg(a,b,c,d){var f=new $b(a,c,d),e=a.cm;e&&f.noHScroll&&(e.display.alignWidgets=!0);Xb(a,b,"widget",function(b){var c=b.widgets||(b.widgets=[]);null==f.insertAt?c.push(f):c.splice(Math.min(c.length-1,Math.max(0,f.insertAt)),0,f);f.line=b;e&&!Xa(a,b)&&(c=Fa(b)<a.scrollTop,V(b,b.height+Mb(f)),c&&Gc(e,f.height),e.curOp.forceUpdate=!0);return!0});la(e,"lineWidgetAdded",e,f,"number"==typeof b?b:M(b));return f}function yb(a,c,d,f,e){if(f&&f.shared)return Fg(a,c,d,f,e);if(a.cm&&
!a.cm.curOp)return ja(a.cm,yb)(a,c,d,f,e);var g=new Ta(a,e);e=P(c,d);f&&h(f,g,!1);if(0<e||0==e&&!1!==g.clearWhenEmpty)return g;g.replacedWith&&(g.collapsed=!0,g.widgetNode=b("span",[g.replacedWith],"CodeMirror-widget"),f.handleMouseEvents||g.widgetNode.setAttribute("cm-ignore-events","true"),f.insertLeft&&(g.widgetNode.insertLeft=!0));if(g.collapsed){if(sc(a,c.line,c,d,g)||c.line!=d.line&&sc(a,d.line,c,d,g))throw Error("Inserting collapsed marker partially overlapping an existing one");Pa=!0}g.addToHistory&&
df(a,{from:c,to:d,origin:"markText"},a.sel,NaN);var t=c.line,k=a.cm,l;a.iter(t,d.line+1,function(a){k&&g.collapsed&&!k.options.lineWrapping&&Ea(a)==k.display.maxLine&&(l=!0);g.collapsed&&t!=c.line&&V(a,0);var b=new Db(g,t==c.line?c.ch:null,t==d.line?d.ch:null);a.markedSpans=a.markedSpans?a.markedSpans.concat([b]):[b];b.marker.attachLine(a);++t});g.collapsed&&a.iter(c.line,d.line+1,function(b){Xa(a,b)&&V(b,0)});g.clearOnEnter&&O(g,"beforeCursorEnter",function(){return g.clear()});g.readOnly&&(of=!0,
(a.history.done.length||a.history.undone.length)&&a.clearHistory());g.collapsed&&(g.id=++uf,g.atomic=!0);if(k){l&&(k.curOp.updateMaxLine=!0);if(g.collapsed)ra(k,c.line,d.line+1);else if(g.className||g.title||g.startStyle||g.endStyle||g.css)for(f=c.line;f<=d.line;f++)Ra(k,f,"text");g.atomic&&kf(k.doc);la(k,"markerAdded",k,g)}return g}function Fg(a,b,c,d,f){d=h(d);d.shared=!1;var e=[yb(a,b,c,d,f)],g=e[0],t=d.widgetNode;ib(a,function(a){t&&(d.widgetNode=t.cloneNode(!0));e.push(yb(a,U(a,b),U(a,c),d,f));
for(var h=0;h<a.linked.length;++h)if(a.linked[h].isParent)return;g=y(e)});return new ac(e,g)}function vf(a){return a.findMarks(I(a.first,0),a.clipPos(I(a.lastLine())),function(a){return a.parent})}function Gg(a){for(var b=function(b){b=a[b];var c=[b.primary.doc];ib(b.primary.doc,function(a){return c.push(a)});for(var f=0;f<b.markers.length;f++){var e=b.markers[f];-1==d(c,e.doc)&&(e.parent=null,b.markers.splice(f--,1))}},c=0;c<a.length;c++)b(c)}function Hg(a){var b=this;wf(b);if(!ia(b,a)&&!Ma(b.display,
a)){oa(a);X&&(xf=+new Date);var c=db(b,a,!0),f=a.dataTransfer.files;if(c&&!b.isReadOnly())if(f&&f.length&&window.FileReader&&window.File)for(var e=f.length,g=Array(e),t=0,h=function(a,f){if(!b.options.allowDropFileTypes||-1!=d(b.options.allowDropFileTypes,a.type)){var h=new FileReader;h.onload=ja(b,function(){var a=h.result;/[\x00-\x08\x0e-\x1f]{2}/.test(a)&&(a="");g[f]=a;++t==e&&(c=U(b.doc,c),a={from:c,to:c,text:b.doc.splitLines(g.join(b.doc.lineSeparator())),origin:"paste"},wb(b.doc,a),gf(b.doc,
Na(c,Sa(a))))});h.readAsText(a)}},k=0;k<e;++k)h(f[k],k);else if(b.state.draggingText&&-1<b.doc.sel.contains(c))b.state.draggingText(a),setTimeout(function(){return b.display.input.focus()},20);else try{if(h=a.dataTransfer.getData("Text")){b.state.draggingText&&!b.state.draggingText.copy&&(k=b.listSelections());Oc(b.doc,Na(c,c));if(k)for(f=0;f<k.length;++f)xb(b.doc,"",k[f].anchor,k[f].head,"drag");b.replaceSelection(h,"around","paste");b.display.input.focus()}}catch(mh){}}}function wf(a){a.display.dragCursor&&
(a.display.lineSpace.removeChild(a.display.dragCursor),a.display.dragCursor=null)}function yf(a){if(document.getElementsByClassName)for(var b=document.getElementsByClassName("CodeMirror"),c=0;c<b.length;c++){var d=b[c].CodeMirror;d&&a(d)}}function Ig(){var a;O(window,"resize",function(){null==a&&(a=setTimeout(function(){a=null;yf(Jg)},100))});O(window,"blur",function(){return yf(Qb)})}function Jg(a){var b=a.display;if(b.lastWrapHeight!=b.wrapper.clientHeight||b.lastWrapWidth!=b.wrapper.clientWidth)b.cachedCharWidth=
b.cachedTextHeight=b.cachedPaddingH=null,b.scrollbarsClipped=!1,a.setSize()}function Kg(a){var b=a.split(/-(?!$)/);a=b[b.length-1];for(var c,d,f,e,g=0;g<b.length-1;g++){var t=b[g];if(/^(cmd|meta|m)$/i.test(t))e=!0;else if(/^a(lt)?$/i.test(t))c=!0;else if(/^(c|ctrl|control)$/i.test(t))d=!0;else if(/^s(hift)?$/i.test(t))f=!0;else throw Error("Unrecognized modifier name: "+t);}c&&(a="Alt-"+a);d&&(a="Ctrl-"+a);e&&(a="Cmd-"+a);f&&(a="Shift-"+a);return a}function Lg(a){var b={},c;for(c in a)if(a.hasOwnProperty(c)){var d=
a[c];if(!/^(name|fallthrough|(de|at)tach)$/.test(c)){if("..."!=d)for(var f=n(c.split(" "),Kg),e=0;e<f.length;e++){if(e==f.length-1){var g=f.join(" ");var t=d}else g=f.slice(0,e+1).join(" "),t="...";var h=b[g];if(!h)b[g]=t;else if(h!=t)throw Error("Inconsistent bindings for "+g);}delete a[c]}}for(var k in b)a[k]=b[k];return a}function zb(a,b,c,d){b=Qc(b);var f=b.call?b.call(a,d):b[a];if(!1===f)return"nothing";if("..."===f)return"multi";if(null!=f&&c(f))return"handled";if(b.fallthrough){if("[object Array]"!=
Object.prototype.toString.call(b.fallthrough))return zb(a,b.fallthrough,c,d);for(f=0;f<b.fallthrough.length;f++){var e=zb(a,b.fallthrough[f],c,d);if(e)return e}}}function zf(a){a="string"==typeof a?a:Ua[a.keyCode];return"Ctrl"==a||"Alt"==a||"Shift"==a||"Mod"==a}function Af(a,b,c){var d=a;b.altKey&&"Alt"!=d&&(a="Alt-"+a);(Bf?b.metaKey:b.ctrlKey)&&"Ctrl"!=d&&(a="Ctrl-"+a);(Bf?b.ctrlKey:b.metaKey)&&"Cmd"!=d&&(a="Cmd-"+a);!c&&b.shiftKey&&"Shift"!=d&&(a="Shift-"+a);return a}function Cf(a,b){if(Ca&&34==
a.keyCode&&a["char"])return!1;var c=Ua[a.keyCode];return null==c||a.altGraphKey?!1:Af(c,a,b)}function Qc(a){return"string"==typeof a?bc[a]:a}function Ab(a,b){for(var c=a.doc.sel.ranges,d=[],f=0;f<c.length;f++){for(var e=b(c[f]);d.length&&0>=P(e.from,y(d).to);){var g=d.pop();if(0>P(g.from,e.from)){e.from=g.from;break}}d.push(e)}ta(a,function(){for(var b=d.length-1;0<=b;b--)xb(a.doc,"",d[b].from,d[b].to,"+delete");rb(a)})}function Kd(a,b,c){b=K(a.text,b+c,c);return 0>b||b>a.text.length?null:b}function Ld(a,
b,c){a=Kd(a,b.ch,c);return null==a?null:new I(b.line,a,0>c?"after":"before")}function Md(a,b,c,d,f){if(a&&(a=La(c,b.doc.direction))){a=0>f?y(a):a[0];var e=0>f==(1==a.level)?"after":"before";if(0<a.level||"rtl"==b.doc.direction){var g=ab(b,c);var h=0>f?c.text.length-1:0;var t=Aa(b,g,h).top;h=F(function(a){return Aa(b,g,a).top==t},0>f==(1==a.level)?a.from:a.to-1,h);"before"==e&&(h=Kd(c,h,1))}else h=0>f?a.to:a.from;return new I(d,h,e)}return new I(d,0>f?c.text.length:0,0>f?"before":"after")}function Mg(a,
b,c,d){var f=La(b,a.doc.direction);if(!f)return Ld(b,c,d);c.ch>=b.text.length?(c.ch=b.text.length,c.sticky="before"):0>=c.ch&&(c.ch=0,c.sticky="after");var e=Fb(f,c.ch,c.sticky),g=f[e];if("ltr"==a.doc.direction&&0==g.level%2&&(0<d?g.to>c.ch:g.from<c.ch))return Ld(b,c,d);var h=function(a,c){return Kd(b,a instanceof I?a.ch:a,c)},t,k=function(c){if(!a.options.lineWrapping)return{begin:0,end:b.text.length};t=t||ab(a,b);return Ee(a,b,t,c)},l=k("before"==c.sticky?h(c,-1):c.ch);if("rtl"==a.doc.direction||
1==g.level){var A=1==g.level==0>d,p=h(c,A?1:-1);if(null!=p&&(A?p<=g.to&&p<=l.end:p>=g.from&&p>=l.begin))return new I(c.line,p,A?"before":"after")}g=function(a,b,d){for(var e=function(a,b){return b?new I(c.line,h(a,1),"before"):new I(c.line,a,"after")};0<=a&&a<f.length;a+=b){var g=f[a],t=0<b==(1!=g.level),k=t?d.begin:h(d.end,-1);if(g.from<=k&&k<g.to)return e(k,t);k=t?g.from:h(g.to,-1);if(d.begin<=k&&k<d.end)return e(k,t)}};if(e=g(e+d,d,l))return e;l=0<d?l.end:h(l.begin,-1);return null==l||0<d&&l==
b.text.length||!(e=g(0<d?0:f.length-1,d,k(l)))?null:e}function Df(a,b){var c=J(a.doc,b),d=Ea(c);d!=c&&(b=M(d));return Md(!0,a,d,b,1)}function Ef(a,b){var c=Df(a,b.line),d=J(a.doc,c.line);a=La(d,a.doc.direction);return a&&0!=a[0].level?c:(d=Math.max(0,d.text.search(/\S/)),I(c.line,b.line==c.line&&b.ch<=d&&b.ch?0:d,c.sticky))}function Rc(a,b,c){if("string"==typeof b&&(b=cc[b],!b))return!1;a.display.input.ensurePolled();var d=a.display.shift,f=!1;try{a.isReadOnly()&&(a.state.suppressEdits=!0),c&&(a.display.shift=
!1),f=b(a)!=Sc}finally{a.display.shift=d,a.state.suppressEdits=!1}return f}function Ng(a,b,c){for(var d=0;d<a.state.keyMaps.length;d++){var f=zb(b,a.state.keyMaps[d],c,a);if(f)return f}return a.options.extraKeys&&zb(b,a.options.extraKeys,c,a)||zb(b,a.options.keyMap,c,a)}function dc(a,b,c,d){var f=a.state.keySeq;if(f){if(zf(b))return"handled";Og.set(50,function(){a.state.keySeq==f&&(a.state.keySeq=null,a.display.input.reset())});b=f+" "+b}d=Ng(a,b,d);"multi"==d&&(a.state.keySeq=b);"handled"==d&&la(a,
"keyHandled",a,b,c);if("handled"==d||"multi"==d)oa(c),ud(a);return f&&!d&&/\'$/.test(b)?(oa(c),!0):!!d}function Ff(a,b){var c=Cf(b,!0);return c?b.shiftKey&&!a.state.keySeq?dc(a,"Shift-"+c,b,function(b){return Rc(a,b,!0)})||dc(a,c,b,function(b){if("string"==typeof b?/^go[A-Z]/.test(b):b.motion)return Rc(a,b)}):dc(a,c,b,function(b){return Rc(a,b)}):!1}function Pg(a,b,c){return dc(a,"'"+c+"'",b,function(b){return Rc(a,b,!0)})}function Gf(a){this.curOp.focus=w();if(!ia(this,a)){X&&11>ba&&27==a.keyCode&&
(a.returnValue=!1);var b=a.keyCode;this.display.shift=16==b||a.shiftKey;var c=Ff(this,a);Ca&&(Nd=c?b:null,!c&&88==b&&!Qg&&(za?a.metaKey:a.ctrlKey)&&this.replaceSelection("",null,"cut"));18!=b||/\bCodeMirror-crosshair\b/.test(this.display.lineDiv.className)||Rg(this)}}function Rg(a){function b(a){18!=a.keyCode&&a.altKey||(eb(c,"CodeMirror-crosshair"),va(document,"keyup",b),va(document,"mouseover",b))}var c=a.display.lineDiv;u(c,"CodeMirror-crosshair");O(document,"keyup",b);O(document,"mouseover",b)}
function Hf(a){16==a.keyCode&&(this.doc.sel.shift=!1);ia(this,a)}function If(a){if(!(Ma(this.display,a)||ia(this,a)||a.ctrlKey&&!a.altKey||za&&a.metaKey)){var b=a.keyCode,c=a.charCode;if(Ca&&b==Nd)Nd=null,oa(a);else if(!Ca||a.which&&!(10>a.which)||!Ff(this,a))if(b=String.fromCharCode(null==c?b:c),"\b"!=b&&!Pg(this,a,b))this.display.input.onKeyPress(a)}}function Sg(a,b){var c=+new Date;if(ec&&ec.compare(c,a,b))return fc=ec=null,"triple";if(fc&&fc.compare(c,a,b))return ec=new Od(c,a,b),fc=null,"double";
fc=new Od(c,a,b);ec=null;return"single"}function Jf(a){var b=this.display;if(!(ia(this,a)||b.activeTouch&&b.input.supportsTouch()))if(b.input.ensurePolled(),b.shift=a.shiftKey,Ma(b,a))na||(b.scroller.draggable=!1,setTimeout(function(){return b.scroller.draggable=!0},100));else if(!Tc(this,a,"gutterClick",!0)){var c=db(this,a),d=be(a),f=c?Sg(c,d):"single";window.focus();1==d&&this.state.selectingText&&this.state.selectingText(a);c&&Tg(this,d,c,f,a)||(1==d?c?Ug(this,c,f,a):(a.target||a.srcElement)==
b.scroller&&oa(a):2==d?(c&&Nc(this.doc,c),setTimeout(function(){return b.input.focus()},20)):3==d&&(Pd?Kf(this,a):Je(this)))}}function Tg(a,b,c,d,f){var e="Click";"double"==d?e="Double"+e:"triple"==d&&(e="Triple"+e);return dc(a,Af((1==b?"Left":2==b?"Middle":"Right")+e,f),f,function(b){"string"==typeof b&&(b=cc[b]);if(!b)return!1;var d=!1;try{a.isReadOnly()&&(a.state.suppressEdits=!0),d=b(a,c)!=Sc}finally{a.state.suppressEdits=!1}return d})}function Ug(a,b,c,d){X?setTimeout(k(Ie,a),0):a.curOp.focus=
w();var f=a.getOption("configureMouse");f=f?f(a,c,d):{};null==f.unit&&(f.unit=(Vg?d.shiftKey&&d.metaKey:d.altKey)?"rectangle":"single"==c?"char":"double"==c?"word":"line");if(null==f.extend||a.doc.extend)f.extend=a.doc.extend||d.shiftKey;null==f.addNew&&(f.addNew=za?d.metaKey:d.ctrlKey);null==f.moveOnDrag&&(f.moveOnDrag=!(za?d.altKey:d.ctrlKey));var e=a.doc.sel,g;a.options.dragDrop&&Wg&&!a.isReadOnly()&&"single"==c&&-1<(g=e.contains(b))&&(0>P((g=e.ranges[g]).from(),b)||0<b.xRel)&&(0<P(g.to(),b)||
0>b.xRel)?Xg(a,d,b,f):Yg(a,d,b,f)}function Xg(a,b,c,d){var f=a.display,e=!1,g=ja(a,function(b){na&&(f.scroller.draggable=!1);a.state.draggingText=!1;va(document,"mouseup",g);va(document,"mousemove",h);va(f.scroller,"dragstart",t);va(f.scroller,"drop",g);e||(oa(b),d.addNew||Nc(a.doc,c,null,null,d.extend),na||X&&9==ba?setTimeout(function(){document.body.focus();f.input.focus()},20):f.input.focus())}),h=function(a){e=e||10<=Math.abs(b.clientX-a.clientX)+Math.abs(b.clientY-a.clientY)},t=function(){return e=
!0};na&&(f.scroller.draggable=!0);a.state.draggingText=g;g.copy=!d.moveOnDrag;f.scroller.dragDrop&&f.scroller.dragDrop();O(document,"mouseup",g);O(document,"mousemove",h);O(f.scroller,"dragstart",t);O(f.scroller,"drop",g);Je(a);setTimeout(function(){return f.input.focus()},20)}function Lf(a,b,c){if("char"==c)return new Y(b,b);if("word"==c)return a.findWordAt(b);if("line"==c)return new Y(I(b.line,0),U(a.doc,I(b.line+1,0)));a=c(a,b);return new Y(a.from,a.to)}function Yg(a,b,c,d){function e(b){if(0!=
P(m,b))if(m=b,"rectangle"==d.unit){var e=[],h=a.options.tabSize,t=g(J(l,c.line).text,c.ch,h),k=g(J(l,b.line).text,b.ch,h),A=Math.min(t,k);t=Math.max(t,k);k=Math.min(c.line,b.line);for(var q=Math.min(a.lastLine(),Math.max(c.line,b.line));k<=q;k++){var w=J(l,k).text,x=f(w,A,h);A==t?e.push(new Y(I(k,x),I(k,x))):w.length>x&&e.push(new Y(I(k,x),I(k,f(w,t,h))))}e.length||e.push(new Y(c,c));ma(l,Da(p.ranges.slice(0,v).concat(e),v),{origin:"*mouse",scroll:!1});a.scrollIntoView(b)}else e=u,A=Lf(a,b,d.unit),
b=e.anchor,0<P(A.anchor,b)?(h=A.head,b=rc(e.from(),A.anchor)):(h=A.anchor,b=tc(e.to(),A.head)),e=p.ranges.slice(0),e[v]=Zg(a,new Y(U(l,b),h)),ma(l,Da(e,v),Qd)}function h(b){var c=++x,f=db(a,b,!0,"rectangle"==d.unit);if(f)if(0!=P(f,m)){a.curOp.focus=w();e(f);var g=wd(k,l);(f.line>=g.to||f.line<g.from)&&setTimeout(ja(a,function(){x==c&&h(b)}),150)}else{var t=b.clientY<q.top?-20:b.clientY>q.bottom?20:0;t&&setTimeout(ja(a,function(){x==c&&(k.scroller.scrollTop+=t,h(b))}),50)}}function t(b){a.state.selectingText=
!1;x=Infinity;oa(b);k.input.focus();va(document,"mousemove",y);va(document,"mouseup",r);l.history.lastSelOrigin=null}var k=a.display,l=a.doc;oa(b);var p=l.sel,A=p.ranges;if(d.addNew&&!d.extend){var v=l.sel.contains(c);var u=-1<v?A[v]:new Y(c,c)}else u=l.sel.primary(),v=l.sel.primIndex;"rectangle"==d.unit?(d.addNew||(u=new Y(c,c)),c=db(a,b,!0,!0),v=-1):(b=Lf(a,c,d.unit),u=d.extend?Hd(u,b.anchor,b.head,d.extend):b);d.addNew?-1==v?(v=A.length,ma(l,Da(A.concat([u]),v),{scroll:!1,origin:"*mouse"})):1<
A.length&&A[v].empty()&&"char"==d.unit&&!d.extend?(ma(l,Da(A.slice(0,v).concat(A.slice(v+1)),0),{scroll:!1,origin:"*mouse"}),p=l.sel):Id(l,v,u,Qd):(v=0,ma(l,new xa([u],0),Qd),p=l.sel);var m=c,q=k.wrapper.getBoundingClientRect(),x=0,y=ja(a,function(a){be(a)?h(a):t(a)}),r=ja(a,t);a.state.selectingText=r;O(document,"mousemove",y);O(document,"mouseup",r)}function Zg(a,b){var c=b.anchor,d=b.head,f=J(a.doc,c.line);if(0==P(c,d)&&c.sticky==d.sticky)return b;f=La(f);if(!f)return b;var e=Fb(f,c.ch,c.sticky),
g=f[e];if(g.from!=c.ch&&g.to!=c.ch)return b;var h=e+(g.from==c.ch==(1!=g.level)?0:1);if(0==h||h==f.length)return b;d.line!=c.line?a=0<(d.line-c.line)*("ltr"==a.doc.direction?1:-1):(a=Fb(f,d.ch,d.sticky),e=a-e||(d.ch-c.ch)*(1==g.level?-1:1),a=a==h-1||a==h?0>e:0<e);f=f[h+(a?-1:0)];f=(h=a==(1==f.level))?f.from:f.to;h=h?"after":"before";return c.ch==f&&c.sticky==h?b:new Y(new I(c.line,f,h),d)}function Tc(a,b,c,d){if(b.touches){var f=b.touches[0].clientX;var e=b.touches[0].clientY}else try{f=b.clientX,
e=b.clientY}catch(Zd){return!1}if(f>=Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;d&&oa(b);d=a.display;var g=d.lineDiv.getBoundingClientRect();if(e>g.bottom||!ya(a,c))return $c(b);e-=g.top-d.viewOffset;for(g=0;g<a.options.gutters.length;++g){var h=d.gutters.childNodes[g];if(h&&h.getBoundingClientRect().right>=f)return f=Q(a.doc,e),da(a,c,a,f,a.options.gutters[g],b),$c(b)}}function Kf(a,b){var c;(c=Ma(a.display,b))||(c=ya(a,"gutterContextMenu")?Tc(a,b,"gutterContextMenu",!1):
!1);if(!c&&!ia(a,b,"contextmenu"))a.display.input.onContextMenu(b)}function Mf(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-");Ob(a)}function gc(a){Ue(a);ra(a);Le(a)}function $g(a,b,c){!b!=!(c&&c!=Bb)&&(c=a.display.dragFunctions,b=b?O:va,b(a.display.scroller,"dragstart",c.start),b(a.display.scroller,"dragenter",c.enter),b(a.display.scroller,"dragover",c.over),b(a.display.scroller,"dragleave",c.leave),b(a.display.scroller,
"drop",c.drop))}function ah(a){a.options.lineWrapping?(u(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth="",a.display.sizerWidth=null):(eb(a.display.wrapper,"CodeMirror-wrap"),Zc(a));td(a);ra(a);Ob(a);setTimeout(function(){return sb(a)},100)}function ca(a,b){var c=this;if(!(this instanceof ca))return new ca(a,b);this.options=b=b?h(b):{};h(Nf,b,!1);Cd(b);var d=b.value;"string"==typeof d&&(d=new sa(d,b.mode,null,b.lineSeparator,b.direction));this.doc=d;var f=new ca.inputStyles[b.inputStyle](this);
a=this.display=new T(a,d,f);a.wrapper.CodeMirror=this;Ue(this);Mf(this);b.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");Qe(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new jb,keySeq:null,specialChars:null};b.autofocus&&!Eb&&a.input.focus();X&&11>ba&&setTimeout(function(){return c.display.input.reset(!0)},20);bh(this);Of||(Ig(),Of=!0);gb(this);
this.curOp.forceUpdate=!0;$e(this,d);b.autofocus&&!Eb||this.hasFocus()?setTimeout(k(vd,this),20):Qb(this);for(var e in Uc)if(Uc.hasOwnProperty(e))Uc[e](c,b[e],Bb);Me(this);b.finishInit&&b.finishInit(this);for(d=0;d<Rd.length;++d)Rd[d](c);hb(this);na&&b.lineWrapping&&"optimizelegibility"==getComputedStyle(a.lineDiv).textRendering&&(a.lineDiv.style.textRendering="auto")}function bh(b){function c(){f.activeTouch&&(e=setTimeout(function(){return f.activeTouch=null},1E3),g=f.activeTouch,g.end=+new Date)}
function d(a,b){if(null==b.left)return!0;var c=b.left-a.left;a=b.top-a.top;return 400<c*c+a*a}var f=b.display;O(f.scroller,"mousedown",ja(b,Jf));X&&11>ba?O(f.scroller,"dblclick",ja(b,function(a){if(!ia(b,a)){var c=db(b,a);!c||Tc(b,a,"gutterClick",!0)||Ma(b.display,a)||(oa(a),a=b.findWordAt(c),Nc(b.doc,a.anchor,a.head))}})):O(f.scroller,"dblclick",function(a){return ia(b,a)||oa(a)});Pd||O(f.scroller,"contextmenu",function(a){return Kf(b,a)});var e,g={end:0};O(f.scroller,"touchstart",function(a){var c;
if(c=!ia(b,a))1!=a.touches.length?c=!1:(c=a.touches[0],c=1>=c.radiusX&&1>=c.radiusY),c=!c;c&&!Tc(b,a,"gutterClick",!0)&&(f.input.ensurePolled(),clearTimeout(e),c=+new Date,f.activeTouch={start:c,moved:!1,prev:300>=c-g.end?g:null},1==a.touches.length&&(f.activeTouch.left=a.touches[0].pageX,f.activeTouch.top=a.touches[0].pageY))});O(f.scroller,"touchmove",function(){f.activeTouch&&(f.activeTouch.moved=!0)});O(f.scroller,"touchend",function(a){var e=f.activeTouch;if(e&&!Ma(f,a)&&null!=e.left&&!e.moved&&
300>new Date-e.start){var g=b.coordsChar(f.activeTouch,"page");e=!e.prev||d(e,e.prev)?new Y(g,g):!e.prev.prev||d(e,e.prev.prev)?b.findWordAt(g):new Y(I(g.line,0),U(b.doc,I(g.line+1,0)));b.setSelection(e.anchor,e.head);b.focus();oa(a)}c()});O(f.scroller,"touchcancel",c);O(f.scroller,"scroll",function(){f.scroller.clientHeight&&(Sb(b,f.scroller.scrollTop),fb(b,f.scroller.scrollLeft,!0),da(b,"scroll",b))});O(f.scroller,"mousewheel",function(a){return We(b,a)});O(f.scroller,"DOMMouseScroll",function(a){return We(b,
a)});O(f.wrapper,"scroll",function(){return f.wrapper.scrollTop=f.wrapper.scrollLeft=0});f.dragFunctions={enter:function(a){ia(b,a)||Hb(a)},over:function(c){if(!ia(b,c)){var d=db(b,c);if(d){var f=document.createDocumentFragment();He(b,d,f);b.display.dragCursor||(b.display.dragCursor=a("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),b.display.lineSpace.insertBefore(b.display.dragCursor,b.display.cursorDiv));r(b.display.dragCursor,f)}Hb(c)}},start:function(c){if(X&&(!b.state.draggingText||100>
+new Date-xf))Hb(c);else if(!ia(b,c)&&!Ma(b.display,c)&&(c.dataTransfer.setData("Text",b.getSelection()),c.dataTransfer.effectAllowed="copyMove",c.dataTransfer.setDragImage&&!Pf)){var d=a("img",null,null,"position: fixed; left: 0; top: 0;");d.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";Ca&&(d.width=d.height=1,b.display.wrapper.appendChild(d),d._top=d.offsetTop);c.dataTransfer.setDragImage(d,0,0);Ca&&d.parentNode.removeChild(d)}},drop:ja(b,Hg),leave:function(a){ia(b,
a)||wf(b)}};var h=f.input.getField();O(h,"keyup",function(a){return Hf.call(b,a)});O(h,"keydown",ja(b,Gf));O(h,"keypress",ja(b,If));O(h,"focus",function(a){return vd(b,a)});O(h,"blur",function(a){return Qb(b,a)})}function hc(a,b,c,d){var f=a.doc,e;null==c&&(c="add");"smart"==c&&(f.mode.indent?e=Ib(a,b).state:c="prev");var h=a.options.tabSize,t=J(f,b),k=g(t.text,null,h);t.stateAfter&&(t.stateAfter=null);var l=t.text.match(/^\s*/)[0];if(!d&&!/\S/.test(t.text)){var p=0;c="not"}else if("smart"==c&&(p=
f.mode.indent(e,t.text.slice(l.length),t.text),p==Sc||150<p)){if(!d)return;c="prev"}"prev"==c?p=b>f.first?g(J(f,b-1).text,null,h):0:"add"==c?p=k+a.options.indentUnit:"subtract"==c?p=k-a.options.indentUnit:"number"==typeof c&&(p=k+c);p=Math.max(0,p);c="";d=0;if(a.options.indentWithTabs)for(a=Math.floor(p/h);a;--a)d+=h,c+="\t";d<p&&(c+=v(p-d));if(c!=l)return xb(f,c,I(b,0),I(b,l.length),"+input"),t.stateAfter=null,!0;for(h=0;h<f.sel.ranges.length;h++)if(t=f.sel.ranges[h],t.head.line==b&&t.head.ch<l.length){b=
I(b,l.length);Id(f,h,new Y(b,b));break}}function Sd(a,b,c,d,f){var e=a.doc;a.display.shift=!1;d||(d=e.sel);var g=a.state.pasteIncoming||"paste"==f,h=Td(b),t=null;if(g&&1<d.ranges.length)if(ua&&ua.text.join("\n")==b){if(0==d.ranges.length%ua.text.length){t=[];for(var k=0;k<ua.text.length;k++)t.push(e.splitLines(ua.text[k]))}}else h.length==d.ranges.length&&a.options.pasteLinesPerSelection&&(t=n(h,function(a){return[a]}));for(k=d.ranges.length-1;0<=k;k--){var l=d.ranges[k];var p=l.from(),v=l.to();l.empty()&&
(c&&0<c?p=I(p.line,p.ch-c):a.state.overwrite&&!g?v=I(v.line,Math.min(J(e,v.line).text.length,v.ch+y(h).length)):ua&&ua.lineWise&&ua.text.join("\n")==b&&(p=v=I(p.line,0)));l=a.curOp.updateInput;p={from:p,to:v,text:t?t[k%t.length]:h,origin:f||(g?"paste":a.state.cutIncoming?"cut":"+input")};wb(a.doc,p);la(a,"inputRead",a,p)}b&&!g&&Qf(a,b);rb(a);a.curOp.updateInput=l;a.curOp.typing=!0;a.state.pasteIncoming=a.state.cutIncoming=!1}function Rf(a,b){var c=a.clipboardData&&a.clipboardData.getData("Text");
if(c)return a.preventDefault(),b.isReadOnly()||b.options.disableInput||ta(b,function(){return Sd(b,c,0,null,"paste")}),!0}function Qf(a,b){if(a.options.electricChars&&a.options.smartIndent)for(var c=a.doc.sel,d=c.ranges.length-1;0<=d;d--){var f=c.ranges[d];if(!(100<f.head.ch||d&&c.ranges[d-1].head.line==f.head.line)){var e=a.getModeAt(f.head),g=!1;if(e.electricChars)for(var h=0;h<e.electricChars.length;h++){if(-1<b.indexOf(e.electricChars.charAt(h))){g=hc(a,f.head.line,"smart");break}}else e.electricInput&&
e.electricInput.test(J(a.doc,f.head.line).text.slice(0,f.head.ch))&&(g=hc(a,f.head.line,"smart"));g&&la(a,"electricInput",a,f.head.line)}}}function Sf(a){for(var b=[],c=[],d=0;d<a.doc.sel.ranges.length;d++){var f=a.doc.sel.ranges[d].head.line;f={anchor:I(f,0),head:I(f+1,0)};c.push(f);b.push(a.getRange(f.anchor,f.head))}return{text:b,ranges:c}}function Tf(a,b){a.setAttribute("autocorrect","off");a.setAttribute("autocapitalize","off");a.setAttribute("spellcheck",!!b)}function Uf(){var b=a("textarea",
null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),c=a("div",[b],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");na?b.style.width="1000px":b.setAttribute("wrap","off");ic&&(b.style.border="1px solid black");Tf(b);return c}function Ud(a,b,c,d,f){function e(d){var e=f?Mg(a.cm,t,b,c):Ld(t,b,c);if(null==e){if(d=!d)d=b.line+c,d<a.first||d>=a.first+a.size?d=!1:(b=new I(d,b.ch,b.sticky),d=t=J(a,d));if(d)b=Md(f,a.cm,t,b.line,c);else return!1}else b=
e;return!0}var g=b,h=c,t=J(a,b.line);if("char"==d)e();else if("column"==d)e(!0);else if("word"==d||"group"==d){var k=null;d="group"==d;for(var l=a.cm&&a.cm.getHelper(b,"wordChars"),p=!0;!(0>c)||e(!p);p=!1){var v=t.text.charAt(b.ch)||"\n";v=x(v,l)?"w":d&&"\n"==v?"n":!d||/\s/.test(v)?null:"p";!d||p||v||(v="s");if(k&&k!=v){0>c&&(c=1,e(),b.sticky="after");break}v&&(k=v);if(0<c&&!e(!p))break}}h=Jd(a,b,g,h,!0);Va(g,h)&&(h.hitSide=!0);return h}function Vf(a,b,c,d){var f=a.doc,e=b.left;if("page"==d){var g=
Math.max(Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight)-.5*bb(a.display),3);g=(0<c?b.bottom:b.top)+c*g}else"line"==d&&(g=0<c?b.bottom+3:b.top-3);for(;;){b=qd(a,e,g);if(!b.outside)break;if(0>c?0>=g:g>=f.height){b.hitSide=!0;break}g+=5*c}return b}function Wf(a,b){var c=kd(a,b.line);if(!c||c.hidden)return null;var d=J(a.doc,b.line);c=ue(c,d,b.line);a=La(d,a.doc.direction);d="left";a&&(d=Fb(a,b.ch)%2?"right":"left");b=ve(c.map,b.ch,d);b.offset="right"==
b.collapse?b.end:b.start;return b}function ch(a){for(;a;a=a.parentNode)if(/CodeMirror-gutter-wrapper/.test(a.className))return!0;return!1}function Cb(a,b){b&&(a.bad=!0);return a}function dh(a,b,c,d,f){function e(a){return function(b){return b.id==a}}function g(a){a&&(t&&(k+=l,t=!1),k+=a)}function h(b){if(1==b.nodeType){var c=b.getAttribute("cm-text");if(null!=c)g(c||b.textContent.replace(/\u200b/g,""));else{c=b.getAttribute("cm-marker");var p;if(c)b=a.findMarks(I(d,0),I(f+1,0),e(+c)),b.length&&(p=
b[0].find(0))&&g(R(a.doc,p.from,p.to).join(l));else if("false"!=b.getAttribute("contenteditable")){(p=/^(pre|div|p)$/i.test(b.nodeName))&&t&&(k+=l,t=!1);for(c=0;c<b.childNodes.length;c++)h(b.childNodes[c]);p&&(t=!0)}}}else 3==b.nodeType&&g(b.nodeValue)}for(var k="",t=!1,l=a.doc.lineSeparator();;){h(b);if(b==c)break;b=b.nextSibling}return k}function Vc(a,b,c){if(b==a.display.lineDiv){var d=a.display.lineDiv.childNodes[c];if(!d)return Cb(a.clipPos(I(a.display.viewTo-1)),!0);b=null;c=0}else for(d=b;;d=
d.parentNode){if(!d||d==a.display.lineDiv)return null;if(d.parentNode&&d.parentNode==a.display.lineDiv)break}for(var f=0;f<a.display.view.length;f++){var e=a.display.view[f];if(e.node==d)return eh(e,b,c)}}function eh(a,b,c){function d(b,c,d){for(var f=-1;f<(t?t.length:0);f++)for(var e=0>f?k.map:t[f],g=0;g<e.length;g+=3){var h=e[g+2];if(h==b||h==c){c=M(0>f?a.line:a.rest[f]);f=e[g]+d;if(0>d||h!=b)f=e[g+(d?1:0)];return I(c,f)}}}var f=a.text.firstChild,e=!1;if(!b||!l(f,b))return Cb(I(M(a.line),0),!0);
if(b==f&&(e=!0,b=f.childNodes[c],c=0,!b))return c=a.rest?y(a.rest):a.line,Cb(I(M(c),c.text.length),e);var g=3==b.nodeType?b:null,h=b;g||1!=b.childNodes.length||3!=b.firstChild.nodeType||(g=b.firstChild,c&&(c=g.nodeValue.length));for(;h.parentNode!=f;)h=h.parentNode;var k=a.measure,t=k.maps;if(b=d(g,h,c))return Cb(b,e);f=h.nextSibling;for(g=g?g.nodeValue.length-c:0;f;f=f.nextSibling){if(b=d(f,f.firstChild,0))return Cb(I(b.line,b.ch-g),e);g+=f.textContent.length}for(h=h.previousSibling;h;h=h.previousSibling){if(b=
d(h,h.firstChild,-1))return Cb(I(b.line,b.ch+c),e);c+=h.textContent.length}}var qa=navigator.userAgent,Xf=navigator.platform,Oa=/gecko\/\d/i.test(qa),Yf=/MSIE \d/.test(qa),Zf=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(qa),jc=/Edge\/(\d+)/.exec(qa),X=Yf||Zf||jc,ba=X&&(Yf?document.documentMode||6:+(jc||Zf)[1]),na=!jc&&/WebKit\//.test(qa),fh=na&&/Qt\/\d+\.\d+/.test(qa),Bc=!jc&&/Chrome\//.test(qa),Ca=/Opera\//.test(qa),Pf=/Apple Computer/.test(navigator.vendor),gh=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(qa),
wg=/PhantomJS/.test(qa),ic=!jc&&/AppleWebKit/.test(qa)&&/Mobile\/\w+/.test(qa),Cc=/Android/.test(qa),Eb=ic||Cc||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(qa),za=ic||/Mac/.test(Xf),Vg=/\bCrOS\b/.test(qa),hh=/win/i.test(Xf),kb=Ca&&qa.match(/Version\/(\d*\.\d*)/);kb&&(kb=Number(kb[1]));kb&&15<=kb&&(Ca=!1,na=!0);var Bf=za&&(fh||Ca&&(null==kb||12.11>kb)),Pd=Oa||X&&9<=ba,eb=function(a,b){var d=a.className;if(b=c(b).exec(d)){var f=d.slice(b.index+b[0].length);a.className=d.slice(0,b.index)+
(f?b[1]+f:"")}};var Jb=document.createRange?function(a,b,c,d){var f=document.createRange();f.setEnd(d||a,c);f.setStart(a,b);return f}:function(a,b,c){var d=document.body.createTextRange();try{d.moveToElementText(a.parentNode)}catch(N){return d}d.collapse(!0);d.moveEnd("character",c);d.moveStart("character",b);return d};var kc=function(a){a.select()};ic?kc=function(a){a.selectionStart=0;a.selectionEnd=a.value.length}:X&&(kc=function(a){try{a.select()}catch(A){}});var jb=function(){this.id=null};jb.prototype.set=
function(a,b){clearTimeout(this.id);this.id=setTimeout(b,a)};var Sc={toString:function(){return"CodeMirror.Pass"}},Ia={scroll:!1},Qd={origin:"*mouse"},lc={origin:"+move"},vc=[""],ag=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,bg=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,
of=!1,Pa=!1,Gb=null,dg=function(){function a(a){return 247>=a?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(a):1424<=a&&1524>=a?"R":1536<=a&&1785>=a?"nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111".charAt(a-
1536):1774<=a&&2220>=a?"r":8192<=a&&8203>=a?"w":8204==a?"b":"L"}function b(a,b,c){this.level=a;this.from=b;this.to=c}var c=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,d=/[stwN]/,f=/[LRr]/,e=/[Lb1n]/,g=/[1n]/;return function(h,k){var t="ltr"==k?"L":"R";if(0==h.length||"ltr"==k&&!c.test(h))return!1;for(var l=h.length,p=[],v=0;v<l;++v)p.push(a(h.charCodeAt(v)));v=0;for(var u=t;v<l;++v){var m=p[v];"m"==m?p[v]=u:u=m}v=0;for(u=t;v<l;++v)m=p[v],"1"==m&&"r"==u?p[v]="n":f.test(m)&&(u=m,"r"==m&&(p[v]="R"));
v=1;for(u=p[0];v<l-1;++v)m=p[v],"+"==m&&"1"==u&&"1"==p[v+1]?p[v]="1":","!=m||u!=p[v+1]||"1"!=u&&"n"!=u||(p[v]=u),u=m;for(v=0;v<l;++v)if(u=p[v],","==u)p[v]="N";else if("%"==u){for(u=v+1;u<l&&"%"==p[u];++u);for(m=v&&"!"==p[v-1]||u<l&&"1"==p[u]?"1":"N";v<u;++v)p[v]=m;v=u-1}v=0;for(u=t;v<l;++v)m=p[v],"L"==u&&"1"==m?p[v]="L":f.test(m)&&(u=m);for(u=0;u<l;++u)if(d.test(p[u])){for(v=u+1;v<l&&d.test(p[v]);++v);m="L"==(u?p[u-1]:t);for(m=m==("L"==(v<l?p[v]:t))?m?"L":"R":t;u<v;++u)p[u]=m;u=v-1}t=[];var q;for(v=
0;v<l;)if(e.test(p[v])){u=v;for(++v;v<l&&e.test(p[v]);++v);t.push(new b(0,u,v))}else{var w=v;u=t.length;for(++v;v<l&&"L"!=p[v];++v);for(m=w;m<v;)if(g.test(p[m])){w<m&&t.splice(u,0,new b(1,w,m));w=m;for(++m;m<v&&g.test(p[m]);++m);t.splice(u,0,new b(2,w,m));w=m}else++m;w<v&&t.splice(u,0,new b(1,w,v))}"ltr"==k&&(1==t[0].level&&(q=h.match(/^\s+/))&&(t[0].from=q[0].length,t.unshift(new b(0,0,q[0].length))),1==y(t).level&&(q=h.match(/\s+$/))&&(y(t).to-=q[0].length,t.push(new b(0,l-q[0].length,l))));return"rtl"==
k?t.reverse():t}}(),xc=[],O=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):(a=a._handlers||(a._handlers={}),a[b]=(a[b]||xc).concat(c))},Wg=function(){if(X&&9>ba)return!1;var b=a("div");return"draggable"in b||"dragDrop"in b}(),ad,gd,Td=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;b<=d;){var f=a.indexOf("\n",b);-1==f&&(f=a.length);var e=a.slice(b,"\r"==a.charAt(f-1)?f-1:f),g=e.indexOf("\r");-1!=g?(c.push(e.slice(0,g)),b+=
g+1):(c.push(e),b=f+1)}return c}:function(a){return a.split(/\r\n?|\n/)},ih=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(A){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(S){}return b&&b.parentElement()==a?0!=b.compareEndPoints("StartToEnd",b):!1},Qg=function(){var b=a("div");if("oncopy"in b)return!0;b.setAttribute("oncopy","return;");return"function"==typeof b.oncopy}(),md=null,bd={},ob={},pb={},ea=function(a,b,c){this.pos=this.start=
0;this.string=a;this.tabSize=b||8;this.lineStart=this.lastColumnPos=this.lastColumnValue=0;this.lineOracle=c};ea.prototype.eol=function(){return this.pos>=this.string.length};ea.prototype.sol=function(){return this.pos==this.lineStart};ea.prototype.peek=function(){return this.string.charAt(this.pos)||void 0};ea.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)};ea.prototype.eat=function(a){var b=this.string.charAt(this.pos);if("string"==typeof a?b==a:b&&
(a.test?a.test(b):a(b)))return++this.pos,b};ea.prototype.eatWhile=function(a){for(var b=this.pos;this.eat(a););return this.pos>b};ea.prototype.eatSpace=function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a};ea.prototype.skipToEnd=function(){this.pos=this.string.length};ea.prototype.skipTo=function(a){a=this.string.indexOf(a,this.pos);if(-1<a)return this.pos=a,!0};ea.prototype.backUp=function(a){this.pos-=a};ea.prototype.column=function(){this.lastColumnPos<
this.start&&(this.lastColumnValue=g(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start);return this.lastColumnValue-(this.lineStart?g(this.string,this.lineStart,this.tabSize):0)};ea.prototype.indentation=function(){return g(this.string,null,this.tabSize)-(this.lineStart?g(this.string,this.lineStart,this.tabSize):0)};ea.prototype.match=function(a,b,c){if("string"==typeof a){var d=function(a){return c?a.toLowerCase():a},f=this.string.substr(this.pos,
a.length);if(d(f)==d(a))return!1!==b&&(this.pos+=a.length),!0}else{if((a=this.string.slice(this.pos).match(a))&&0<a.index)return null;a&&!1!==b&&(this.pos+=a[0].length);return a}};ea.prototype.current=function(){return this.string.slice(this.start,this.pos)};ea.prototype.hideFirstChars=function(a,b){this.lineStart+=a;try{return b()}finally{this.lineStart-=a}};ea.prototype.lookAhead=function(a){var b=this.lineOracle;return b&&b.lookAhead(a)};ea.prototype.baseToken=function(){var a=this.lineOracle;
return a&&a.baseToken(this.pos)};var zc=function(a,b){this.state=a;this.lookAhead=b},Ga=function(a,b,c,d){this.state=b;this.doc=a;this.line=c;this.maxLookAhead=d||0;this.baseTokens=null;this.baseTokenPos=1};Ga.prototype.lookAhead=function(a){var b=this.doc.getLine(this.line+a);null!=b&&a>this.maxLookAhead&&(this.maxLookAhead=a);return b};Ga.prototype.baseToken=function(a){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=a;)this.baseTokenPos+=2;var b=this.baseTokens[this.baseTokenPos+
1];return{type:b&&b.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-a}};Ga.prototype.nextLine=function(){this.line++;0<this.maxLookAhead&&this.maxLookAhead--};Ga.fromSaved=function(a,b,c){return b instanceof zc?new Ga(a,Ya(a.mode,b.state),c,b.lookAhead):new Ga(a,Ya(a.mode,b),c)};Ga.prototype.save=function(a){a=!1!==a?Ya(this.doc.mode,this.state):this.state;return 0<this.maxLookAhead?new zc(a,this.maxLookAhead):a};var ie=function(a,b,c){this.start=a.start;this.end=a.pos;this.string=
a.current();this.type=b||null;this.state=c},tb=function(a,b,c){this.text=a;Wd(this,b);this.height=c?c(this):1};tb.prototype.lineNo=function(){return M(this)};nb(tb);var kg={},jg={},qb=null,Kb=null,we={left:0,right:0,top:0,bottom:0},cb,lb=function(b,c,d){this.cm=d;var f=this.vert=a("div",[a("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),e=this.horiz=a("div",[a("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");b(f);b(e);O(f,"scroll",function(){f.clientHeight&&c(f.scrollTop,
"vertical")});O(e,"scroll",function(){e.clientWidth&&c(e.scrollLeft,"horizontal")});this.checkedZeroWidth=!1;X&&8>ba&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};lb.prototype.update=function(a){var b=a.scrollWidth>a.clientWidth+1,c=a.scrollHeight>a.clientHeight+1,d=a.nativeBarWidth;c?(this.vert.style.display="block",this.vert.style.bottom=b?d+"px":"0",this.vert.firstChild.style.height=Math.max(0,a.scrollHeight-a.clientHeight+(a.viewHeight-(b?d:0)))+"px"):(this.vert.style.display=
"",this.vert.firstChild.style.height="0");b?(this.horiz.style.display="block",this.horiz.style.right=c?d+"px":"0",this.horiz.style.left=a.barLeft+"px",this.horiz.firstChild.style.width=Math.max(0,a.scrollWidth-a.clientWidth+(a.viewWidth-a.barLeft-(c?d:0)))+"px"):(this.horiz.style.display="",this.horiz.firstChild.style.width="0");!this.checkedZeroWidth&&0<a.clientHeight&&(0==d&&this.zeroWidthHack(),this.checkedZeroWidth=!0);return{right:c?d:0,bottom:b?d:0}};lb.prototype.setScrollLeft=function(a){this.horiz.scrollLeft!=
a&&(this.horiz.scrollLeft=a);this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")};lb.prototype.setScrollTop=function(a){this.vert.scrollTop!=a&&(this.vert.scrollTop=a);this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")};lb.prototype.zeroWidthHack=function(){this.horiz.style.height=this.vert.style.width=za&&!gh?"12px":"18px";this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none";this.disableHoriz=new jb;this.disableVert=new jb};lb.prototype.enableZeroWidthBar=
function(a,b,c){function d(){var f=a.getBoundingClientRect();("vert"==c?document.elementFromPoint(f.right-1,(f.top+f.bottom)/2):document.elementFromPoint((f.right+f.left)/2,f.bottom-1))!=a?a.style.pointerEvents="none":b.set(1E3,d)}a.style.pointerEvents="auto";b.set(1E3,d)};lb.prototype.clear=function(){var a=this.horiz.parentNode;a.removeChild(this.horiz);a.removeChild(this.vert)};var mc=function(){};mc.prototype.update=function(){return{bottom:0,right:0}};mc.prototype.setScrollLeft=function(){};
mc.prototype.setScrollTop=function(){};mc.prototype.clear=function(){};var Re={"native":lb,"null":mc},vg=0,Ic=function(a,b,c){var d=a.display;this.viewport=b;this.visible=wd(d,a.doc,b);this.editorIsHidden=!d.wrapper.offsetWidth;this.wrapperHeight=d.wrapper.clientHeight;this.wrapperWidth=d.wrapper.clientWidth;this.oldDisplayWidth=Za(a);this.force=c;this.dims=ld(a);this.events=[]};Ic.prototype.signal=function(a,b){ya(a,b)&&this.events.push(arguments)};Ic.prototype.finish=function(){for(var a=0;a<this.events.length;a++)da.apply(null,
this.events[a])};var Kc=0,wa=null;X?wa=-.53:Oa?wa=15:Bc?wa=-.7:Pf&&(wa=-1/3);var xa=function(a,b){this.ranges=a;this.primIndex=b};xa.prototype.primary=function(){return this.ranges[this.primIndex]};xa.prototype.equals=function(a){if(a==this)return!0;if(a.primIndex!=this.primIndex||a.ranges.length!=this.ranges.length)return!1;for(var b=0;b<this.ranges.length;b++){var c=this.ranges[b],d=a.ranges[b];if(!Va(c.anchor,d.anchor)||!Va(c.head,d.head))return!1}return!0};xa.prototype.deepCopy=function(){for(var a=
[],b=0;b<this.ranges.length;b++)a[b]=new Y(Wa(this.ranges[b].anchor),Wa(this.ranges[b].head));return new xa(a,this.primIndex)};xa.prototype.somethingSelected=function(){for(var a=0;a<this.ranges.length;a++)if(!this.ranges[a].empty())return!0;return!1};xa.prototype.contains=function(a,b){b||(b=a);for(var c=0;c<this.ranges.length;c++){var d=this.ranges[c];if(0<=P(b,d.from())&&0>=P(a,d.to()))return c}return-1};var Y=function(a,b){this.anchor=a;this.head=b};Y.prototype.from=function(){return rc(this.anchor,
this.head)};Y.prototype.to=function(){return tc(this.anchor,this.head)};Y.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};Yb.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=a,d=a+b;c<d;++c){var f=this.lines[c];this.height-=f.height;var e=f;e.parent=null;mb(e);la(f,"delete")}this.lines.splice(a,b)},collapse:function(a){a.push.apply(a,this.lines)},insertInner:function(a,b,c){this.height+=c;this.lines=this.lines.slice(0,
a).concat(b).concat(this.lines.slice(a));for(a=0;a<b.length;++a)b[a].parent=this},iterN:function(a,b,c){for(b=a+b;a<b;++a)if(c(this.lines[a]))return!0}};Zb.prototype={chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=0;c<this.children.length;++c){var d=this.children[c],f=d.chunkSize();if(a<f){var e=Math.min(b,f-a),g=d.height;d.removeInner(a,e);this.height-=g-d.height;f==e&&(this.children.splice(c--,1),d.parent=null);if(0==(b-=e))break;a=0}else a-=f}25>this.size-
b&&(1<this.children.length||!(this.children[0]instanceof Yb))&&(a=[],this.collapse(a),this.children=[new Yb(a)],this.children[0].parent=this)},collapse:function(a){for(var b=0;b<this.children.length;++b)this.children[b].collapse(a)},insertInner:function(a,b,c){this.size+=b.length;this.height+=c;for(var d=0;d<this.children.length;++d){var f=this.children[d],e=f.chunkSize();if(a<=e){f.insertInner(a,b,c);if(f.lines&&50<f.lines.length){for(b=a=f.lines.length%25+25;b<f.lines.length;)c=new Yb(f.lines.slice(b,
b+=25)),f.height-=c.height,this.children.splice(++d,0,c),c.parent=this;f.lines=f.lines.slice(0,a);this.maybeSpill()}break}a-=e}},maybeSpill:function(){if(!(10>=this.children.length)){var a=this;do{var b=a.children.splice(a.children.length-5,5);b=new Zb(b);if(a.parent){a.size-=b.size;a.height-=b.height;var c=d(a.parent.children,a);a.parent.children.splice(c+1,0,b)}else c=new Zb(a.children),c.parent=a,a.children=[c,b],a=c;b.parent=a.parent}while(10<a.children.length);a.parent.maybeSpill()}},iterN:function(a,
b,c){for(var d=0;d<this.children.length;++d){var f=this.children[d],e=f.chunkSize();if(a<e){e=Math.min(b,e-a);if(f.iterN(a,e,c))return!0;if(0==(b-=e))break;a=0}else a-=e}}};var $b=function(a,b,c){if(c)for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d]);this.doc=a;this.node=b};$b.prototype.clear=function(){var a=this.doc.cm,b=this.line.widgets,c=this.line,d=M(c);if(null!=d&&b){for(var f=0;f<b.length;++f)b[f]==this&&b.splice(f--,1);b.length||(c.widgets=null);var e=Mb(this);V(c,Math.max(0,c.height-e));
a&&(ta(a,function(){var b=-e;Fa(c)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&Gc(a,b);Ra(a,d,"widget")}),la(a,"lineWidgetCleared",a,this,d))}};$b.prototype.changed=function(){var a=this,b=this.height,c=this.doc.cm,d=this.line;this.height=null;var f=Mb(this)-b;f&&(V(d,d.height+f),c&&ta(c,function(){c.curOp.forceUpdate=!0;Fa(d)<(c.curOp&&c.curOp.scrollTop||c.doc.scrollTop)&&Gc(c,f);la(c,"lineWidgetChanged",c,a,M(d))}))};nb($b);var uf=0,Ta=function(a,b){this.lines=[];this.type=b;this.doc=a;this.id=
++uf};Ta.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;b&&gb(a);if(ya(this,"clear")){var c=this.find();c&&la(this,"clear",c.from,c.to)}for(var d=c=null,f=0;f<this.lines.length;++f){var e=this.lines[f],g=Ja(e.markedSpans,this);a&&!this.collapsed?Ra(a,M(e),"text"):a&&(null!=g.to&&(d=M(e)),null!=g.from&&(c=M(e)));for(var h=e,k=void 0,l=e.markedSpans,p=g,v=0;v<l.length;++v)l[v]!=p&&(k||(k=[])).push(l[v]);h.markedSpans=k;null==g.from&&this.collapsed&&!Xa(this.doc,
e)&&a&&V(e,bb(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(f=0;f<this.lines.length;++f)e=Ea(this.lines[f]),g=wc(e),g>a.display.maxLineLength&&(a.display.maxLine=e,a.display.maxLineLength=g,a.display.maxLineChanged=!0);null!=c&&a&&this.collapsed&&ra(a,c,d+1);this.lines.length=0;this.explicitlyCleared=!0;this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&kf(a.doc));a&&la(a,"markerCleared",a,this,c,d);b&&hb(a);this.parent&&this.parent.clear()}};Ta.prototype.find=function(a,b){null==
a&&"bookmark"==this.type&&(a=1);for(var c,d,f=0;f<this.lines.length;++f){var e=this.lines[f],g=Ja(e.markedSpans,this);if(null!=g.from&&(c=I(b?e:M(e),g.from),-1==a))return c;if(null!=g.to&&(d=I(b?e:M(e),g.to),1==a))return d}return c&&{from:c,to:d}};Ta.prototype.changed=function(){var a=this,b=this.find(-1,!0),c=this,d=this.doc.cm;b&&d&&ta(d,function(){var f=b.line,e=M(b.line);if(e=kd(d,e))xe(e),d.curOp.selectionChanged=d.curOp.forceUpdate=!0;d.curOp.updateMaxLine=!0;Xa(c.doc,f)||null==c.height||(e=
c.height,c.height=null,(e=Mb(c)-e)&&V(f,f.height+e));la(d,"markerChanged",d,a)})};Ta.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;b.maybeHiddenMarkers&&-1!=d(b.maybeHiddenMarkers,this)||(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)};Ta.prototype.detachLine=function(a){this.lines.splice(d(this.lines,a),1);!this.lines.length&&this.doc.cm&&(a=this.doc.cm.curOp,(a.maybeHiddenMarkers||(a.maybeHiddenMarkers=[])).push(this))};
nb(Ta);var ac=function(a,b){this.markers=a;this.primary=b;for(b=0;b<a.length;++b)a[b].parent=this};ac.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();la(this,"clear")}};ac.prototype.find=function(a,b){return this.primary.find(a,b)};nb(ac);var jh=0,sa=function(a,b,c,d,f){if(!(this instanceof sa))return new sa(a,b,c,d,f);null==c&&(c=0);Zb.call(this,[new Yb([new tb("",null)])]);this.first=c;this.scrollTop=
this.scrollLeft=0;this.cantEdit=!1;this.cleanGeneration=1;this.modeFrontier=this.highlightFrontier=c;c=I(c,0);this.sel=Na(c);this.history=new Lc(null);this.id=++jh;this.modeOption=b;this.lineSep=d;this.direction="rtl"==f?"rtl":"ltr";this.extend=!1;"string"==typeof a&&(a=this.splitLines(a));Fd(this,{from:c,to:c,text:a});ma(this,Na(c),Ia)};sa.prototype=z(Zb.prototype,{constructor:sa,iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):this.iterN(this.first,this.first+this.size,a)},insert:function(a,
b){for(var c=0,d=0;d<b.length;++d)c+=b[d].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=W(this,this.first,this.first+this.size);return!1===a?b:b.join(a||this.lineSeparator())},setValue:ka(function(a){var b=I(this.first,0),c=this.first+this.size-1;wb(this,{from:b,to:I(c,J(this,c).text.length),text:this.splitLines(a),origin:"setValue",full:!0},!0);this.cm&&Rb(this.cm,0,0);ma(this,Na(b),Ia)}),replaceRange:function(a,b,c,d){b=
U(this,b);c=c?U(this,c):b;xb(this,a,b,c,d)},getRange:function(a,b,c){a=R(this,U(this,a),U(this,b));return!1===c?a:a.join(c||this.lineSeparator())},getLine:function(a){return(a=this.getLineHandle(a))&&a.text},getLineHandle:function(a){if(aa(this,a))return J(this,a)},getLineNumber:function(a){return M(a)},getLineHandleVisualStart:function(a){"number"==typeof a&&(a=J(this,a));return Ea(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+
this.size-1},clipPos:function(a){return U(this,a)},getCursor:function(a){var b=this.sel.primary();return null==a||"head"==a?b.head:"anchor"==a?b.anchor:"end"==a||"to"==a||!1===a?b.to():b.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:ka(function(a,b,c){a=U(this,"number"==typeof a?I(a,b||0):a);ma(this,Na(a,null),c)}),setSelection:ka(function(a,b,c){var d=U(this,a);a=U(this,b||a);ma(this,Na(d,a),c)}),extendSelection:ka(function(a,
b,c){Nc(this,U(this,a),b&&U(this,b),c)}),extendSelections:ka(function(a,b){ff(this,uc(this,a),b)}),extendSelectionsBy:ka(function(a,b){a=n(this.sel.ranges,a);ff(this,uc(this,a),b)}),setSelections:ka(function(a,b,c){if(a.length){for(var d=[],f=0;f<a.length;f++)d[f]=new Y(U(this,a[f].anchor),U(this,a[f].head));null==b&&(b=Math.min(a.length-1,this.sel.primIndex));ma(this,Da(d,b),c)}}),addSelection:ka(function(a,b,c){var d=this.sel.ranges.slice(0);d.push(new Y(U(this,a),U(this,b||a)));ma(this,Da(d,d.length-
1),c)}),getSelection:function(a){for(var b=this.sel.ranges,c,d=0;d<b.length;d++){var f=R(this,b[d].from(),b[d].to());c=c?c.concat(f):f}return!1===a?c:c.join(a||this.lineSeparator())},getSelections:function(a){for(var b=[],c=this.sel.ranges,d=0;d<c.length;d++){var f=R(this,c[d].from(),c[d].to());!1!==a&&(f=f.join(a||this.lineSeparator()));b[d]=f}return b},replaceSelection:function(a,b,c){for(var d=[],f=0;f<this.sel.ranges.length;f++)d[f]=a;this.replaceSelections(d,b,c||"+input")},replaceSelections:ka(function(a,
b,c){for(var d=[],f=this.sel,e=0;e<f.ranges.length;e++){var g=f.ranges[e];d[e]={from:g.from(),to:g.to(),text:this.splitLines(a[e]),origin:c}}if(a=b&&"end"!=b){a=[];f=c=I(this.first,0);for(e=0;e<d.length;e++){var h=d[e];g=Ye(h.from,c,f);var k=Ye(Sa(h),c,f);c=h.to;f=k;"around"==b?(h=this.sel.ranges[e],h=0>P(h.head,h.anchor),a[e]=new Y(h?k:g,h?g:k)):a[e]=new Y(g,g)}a=new xa(a,this.sel.primIndex)}b=a;for(a=d.length-1;0<=a;a--)wb(this,d[a]);b?gf(this,b):this.cm&&rb(this.cm)}),undo:ka(function(){Pc(this,
"undo")}),redo:ka(function(){Pc(this,"redo")}),undoSelection:ka(function(){Pc(this,"undo",!0)}),redoSelection:ka(function(){Pc(this,"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=this.history,b=0,c=0,d=0;d<a.done.length;d++)a.done[d].ranges||++b;for(d=0;d<a.undone.length;d++)a.undone[d].ranges||++c;return{undo:b,redo:c}},clearHistory:function(){this.history=new Lc(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=
this.changeGeneration(!0)},changeGeneration:function(a){a&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null);return this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:ub(this.history.done),undone:ub(this.history.undone)}},setHistory:function(a){var b=this.history=new Lc(this.history.maxGeneration);b.done=ub(a.done.slice(0),null,!0);b.undone=ub(a.undone.slice(0),null,!0)},setGutterMarker:ka(function(a,
b,c){return Xb(this,a,"gutter",function(a){var d=a.gutterMarkers||(a.gutterMarkers={});d[b]=c;!c&&C(d)&&(a.gutterMarkers=null);return!0})}),clearGutter:ka(function(a){var b=this;this.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&Xb(b,c,"gutter",function(){c.gutterMarkers[a]=null;C(c.gutterMarkers)&&(c.gutterMarkers=null);return!0})})}),lineInfo:function(a){if("number"==typeof a){if(!aa(this,a))return null;var b=a;a=J(this,a);if(!a)return null}else if(b=M(a),null==b)return null;return{line:b,
handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},addLineClass:ka(function(a,b,d){return Xb(this,a,"gutter"==b?"gutter":"class",function(a){var f="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass";if(a[f]){if(c(d).test(a[f]))return!1;a[f]+=" "+d}else a[f]=d;return!0})}),removeLineClass:ka(function(a,b,d){return Xb(this,a,"gutter"==b?"gutter":"class",function(a){var f="text"==b?"textClass":
"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass",e=a[f];if(e)if(null==d)a[f]=null;else{var g=e.match(c(d));if(!g)return!1;var h=g.index+g[0].length;a[f]=e.slice(0,g.index)+(g.index&&h!=e.length?" ":"")+e.slice(h)||null}else return!1;return!0})}),addLineWidget:ka(function(a,b,c){return Eg(this,a,b,c)}),removeLineWidget:function(a){a.clear()},markText:function(a,b,c){return yb(this,U(this,a),U(this,b),c,c&&c.type||"range")},setBookmark:function(a,b){b={replacedWith:b&&(null==b.nodeType?
b.widget:b),insertLeft:b&&b.insertLeft,clearWhenEmpty:!1,shared:b&&b.shared,handleMouseEvents:b&&b.handleMouseEvents};a=U(this,a);return yb(this,a,a,b,"bookmark")},findMarksAt:function(a){a=U(this,a);var b=[],c=J(this,a.line).markedSpans;if(c)for(var d=0;d<c.length;++d){var f=c[d];(null==f.from||f.from<=a.ch)&&(null==f.to||f.to>=a.ch)&&b.push(f.marker.parent||f.marker)}return b},findMarks:function(a,b,c){a=U(this,a);b=U(this,b);var d=[],f=a.line;this.iter(a.line,b.line+1,function(e){if(e=e.markedSpans)for(var g=
0;g<e.length;g++){var h=e[g];null!=h.to&&f==a.line&&a.ch>=h.to||null==h.from&&f!=a.line||null!=h.from&&f==b.line&&h.from>=b.ch||c&&!c(h.marker)||d.push(h.marker.parent||h.marker)}++f});return d},getAllMarks:function(){var a=[];this.iter(function(b){if(b=b.markedSpans)for(var c=0;c<b.length;++c)null!=b[c].from&&a.push(b[c].marker)});return a},posFromIndex:function(a){var b,c=this.first,d=this.lineSeparator().length;this.iter(function(f){f=f.text.length+d;if(f>a)return b=a,!0;a-=f;++c});return U(this,
I(c,b))},indexFromPos:function(a){a=U(this,a);var b=a.ch;if(a.line<this.first||0>a.ch)return 0;var c=this.lineSeparator().length;this.iter(this.first,a.line,function(a){b+=a.text.length+c});return b},copy:function(a){var b=new sa(W(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);b.scrollTop=this.scrollTop;b.scrollLeft=this.scrollLeft;b.sel=this.sel;b.extend=!1;a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory()));return b},linkedDoc:function(a){a||
(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&(b=a.from);null!=a.to&&a.to<c&&(c=a.to);b=new sa(W(this,b,c),a.mode||this.modeOption,b,this.lineSep,this.direction);a.sharedHist&&(b.history=this.history);(this.linked||(this.linked=[])).push({doc:b,sharedHist:a.sharedHist});b.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}];a=vf(this);for(c=0;c<a.length;c++){var d=a[c],f=d.find(),e=b.clipPos(f.from);f=b.clipPos(f.to);P(e,f)&&(e=yb(b,e,f,d.primary,d.primary.type),d.markers.push(e),
e.parent=d)}return b},unlinkDoc:function(a){a instanceof ca&&(a=a.doc);if(this.linked)for(var b=0;b<this.linked.length;++b)if(this.linked[b].doc==a){this.linked.splice(b,1);a.unlinkDoc(this);Gg(vf(this));break}if(a.history==this.history){var c=[a.id];ib(a,function(a){return c.push(a.id)},!0);a.history=new Lc(null);a.history.done=ub(this.history.done,c);a.history.undone=ub(this.history.undone,c)}},iterLinkedDocs:function(a){ib(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm},
splitLines:function(a){return this.lineSep?a.split(this.lineSep):Td(a)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:ka(function(a){"rtl"!=a&&(a="ltr");a!=this.direction&&(this.direction=a,this.iter(function(a){return a.order=null}),this.cm&&Ag(this.cm))})});sa.prototype.eachLine=sa.prototype.iter;for(var xf=0,Of=!1,Ua={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",
37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},nc=0;10>nc;nc++)Ua[nc+48]=Ua[nc+96]=String(nc);for(var Wc=65;90>=Wc;Wc++)Ua[Wc]=String.fromCharCode(Wc);
for(var oc=1;12>=oc;oc++)Ua[oc+111]=Ua[oc+63235]="F"+oc;var bc={basic:{Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},pcDefault:{"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo",
"Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection",
"Alt-U":"redoSelection",fallthrough:"basic"},emacsy:{"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},macDefault:{"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo",
"Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft",
"Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]}};bc["default"]=za?bc.macDefault:bc.pcDefault;var cc={selectAll:mf,singleSelection:function(a){return a.setSelection(a.getCursor("anchor"),a.getCursor("head"),Ia)},killLine:function(a){return Ab(a,function(b){if(b.empty()){var c=J(a.doc,b.head.line).text.length;return b.head.ch==c&&b.head.line<a.lastLine()?{from:b.head,to:I(b.head.line+
1,0)}:{from:b.head,to:I(b.head.line,c)}}return{from:b.from(),to:b.to()}})},deleteLine:function(a){return Ab(a,function(b){return{from:I(b.from().line,0),to:U(a.doc,I(b.to().line+1,0))}})},delLineLeft:function(a){return Ab(a,function(a){return{from:I(a.from().line,0),to:a.from()}})},delWrappedLineLeft:function(a){return Ab(a,function(b){var c=a.charCoords(b.head,"div").top+5;return{from:a.coordsChar({left:0,top:c},"div"),to:b.from()}})},delWrappedLineRight:function(a){return Ab(a,function(b){var c=
a.charCoords(b.head,"div").top+5;c=a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div");return{from:b.from(),to:c}})},undo:function(a){return a.undo()},redo:function(a){return a.redo()},undoSelection:function(a){return a.undoSelection()},redoSelection:function(a){return a.redoSelection()},goDocStart:function(a){return a.extendSelection(I(a.firstLine(),0))},goDocEnd:function(a){return a.extendSelection(I(a.lastLine()))},goLineStart:function(a){return a.extendSelectionsBy(function(b){return Df(a,
b.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(a){return a.extendSelectionsBy(function(b){return Ef(a,b.head)},{origin:"+move",bias:1})},goLineEnd:function(a){return a.extendSelectionsBy(function(b){b=b.head.line;var c=J(a.doc,b);var d=c;for(var f;f=Ka(d,!1);)d=f.find(1,!0).line;d!=c&&(b=M(d));return Md(!0,a,c,b,-1)},{origin:"+move",bias:-1})},goLineRight:function(a){return a.extendSelectionsBy(function(b){b=a.cursorCoords(b.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+
100,top:b},"div")},lc)},goLineLeft:function(a){return a.extendSelectionsBy(function(b){b=a.cursorCoords(b.head,"div").top+5;return a.coordsChar({left:0,top:b},"div")},lc)},goLineLeftSmart:function(a){return a.extendSelectionsBy(function(b){var c=a.cursorCoords(b.head,"div").top+5;c=a.coordsChar({left:0,top:c},"div");return c.ch<a.getLine(c.line).search(/\S/)?Ef(a,b.head):c},lc)},goLineUp:function(a){return a.moveV(-1,"line")},goLineDown:function(a){return a.moveV(1,"line")},goPageUp:function(a){return a.moveV(-1,
"page")},goPageDown:function(a){return a.moveV(1,"page")},goCharLeft:function(a){return a.moveH(-1,"char")},goCharRight:function(a){return a.moveH(1,"char")},goColumnLeft:function(a){return a.moveH(-1,"column")},goColumnRight:function(a){return a.moveH(1,"column")},goWordLeft:function(a){return a.moveH(-1,"word")},goGroupRight:function(a){return a.moveH(1,"group")},goGroupLeft:function(a){return a.moveH(-1,"group")},goWordRight:function(a){return a.moveH(1,"word")},delCharBefore:function(a){return a.deleteH(-1,
"char")},delCharAfter:function(a){return a.deleteH(1,"char")},delWordBefore:function(a){return a.deleteH(-1,"word")},delWordAfter:function(a){return a.deleteH(1,"word")},delGroupBefore:function(a){return a.deleteH(-1,"group")},delGroupAfter:function(a){return a.deleteH(1,"group")},indentAuto:function(a){return a.indentSelection("smart")},indentMore:function(a){return a.indentSelection("add")},indentLess:function(a){return a.indentSelection("subtract")},insertTab:function(a){return a.replaceSelection("\t")},
insertSoftTab:function(a){for(var b=[],c=a.listSelections(),d=a.options.tabSize,f=0;f<c.length;f++){var e=c[f].from();e=g(a.getLine(e.line),e.ch,d);b.push(v(d-e%d))}a.replaceSelections(b)},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.execCommand("insertTab")},transposeChars:function(a){return ta(a,function(){for(var b=a.listSelections(),c=[],d=0;d<b.length;d++)if(b[d].empty()){var f=b[d].head,e=J(a.doc,f.line).text;if(e)if(f.ch==e.length&&(f=new I(f.line,f.ch-1)),0<f.ch)f=
new I(f.line,f.ch+1),a.replaceRange(e.charAt(f.ch-1)+e.charAt(f.ch-2),I(f.line,f.ch-2),f,"+transpose");else if(f.line>a.doc.first){var g=J(a.doc,f.line-1).text;g&&(f=new I(f.line,1),a.replaceRange(e.charAt(0)+a.doc.lineSeparator()+g.charAt(g.length-1),I(f.line-1,g.length-1),f,"+transpose"))}c.push(new Y(f,f))}a.setSelections(c)})},newlineAndIndent:function(a){return ta(a,function(){for(var b=a.listSelections(),c=b.length-1;0<=c;c--)a.replaceRange(a.doc.lineSeparator(),b[c].anchor,b[c].head,"+input");
b=a.listSelections();for(c=0;c<b.length;c++)a.indentLine(b[c].from().line,null,!0);rb(a)})},openLine:function(a){return a.replaceSelection("\n","start")},toggleOverwrite:function(a){return a.toggleOverwrite()}},Og=new jb,Nd=null,Od=function(a,b,c){this.time=a;this.pos=b;this.button=c};Od.prototype.compare=function(a,b,c){return this.time+400>a&&0==P(b,this.pos)&&c==this.button};var fc,ec,Bb={toString:function(){return"CodeMirror.Init"}},Nf={},Uc={};ca.defaults=Nf;ca.optionHandlers=Uc;var Rd=[];ca.defineInitHook=
function(a){return Rd.push(a)};var ua=null,Z=function(a){this.cm=a;this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new jb;this.composing=null;this.gracePeriod=!1;this.readDOMTimeout=null};Z.prototype.init=function(a){function b(a){if(!ia(f,a)){if(f.somethingSelected())ua={lineWise:!1,text:f.getSelections()},"cut"==a.type&&f.replaceSelection("",null,"cut");else if(f.options.lineWiseCopyCut){var b=Sf(f);ua={lineWise:!0,text:b.text};"cut"==a.type&&
f.operation(function(){f.setSelections(b.ranges,0,Ia);f.replaceSelection("",null,"cut")})}else return;if(a.clipboardData){a.clipboardData.clearData();var c=ua.text.join("\n");a.clipboardData.setData("Text",c);if(a.clipboardData.getData("Text")==c){a.preventDefault();return}}var g=Uf();a=g.firstChild;f.display.lineSpace.insertBefore(g,f.display.lineSpace.firstChild);a.value=ua.text.join("\n");var h=document.activeElement;kc(a);setTimeout(function(){f.display.lineSpace.removeChild(g);h.focus();h==e&&
d.showPrimarySelection()},50)}}var c=this,d=this,f=d.cm,e=d.div=a.lineDiv;Tf(e,f.options.spellcheck);O(e,"paste",function(a){ia(f,a)||Rf(a,f)||11>=ba&&setTimeout(ja(f,function(){return c.updateFromDOM()}),20)});O(e,"compositionstart",function(a){c.composing={data:a.data,done:!1}});O(e,"compositionupdate",function(a){c.composing||(c.composing={data:a.data,done:!1})});O(e,"compositionend",function(a){c.composing&&(a.data!=c.composing.data&&c.readFromDOMSoon(),c.composing.done=!0)});O(e,"touchstart",
function(){return d.forceCompositionEnd()});O(e,"input",function(){c.composing||c.readFromDOMSoon()});O(e,"copy",b);O(e,"cut",b)};Z.prototype.prepareSelection=function(){var a=Ge(this.cm,!1);a.focus=this.cm.state.focused;return a};Z.prototype.showSelection=function(a,b){a&&this.cm.display.view.length&&((a.focus||b)&&this.showPrimarySelection(),this.showMultipleSelections(a))};Z.prototype.showPrimarySelection=function(){var a=window.getSelection(),b=this.cm,c=b.doc.sel.primary(),d=c.from();c=c.to();
if(b.display.viewTo==b.display.viewFrom||d.line>=b.display.viewTo||c.line<b.display.viewFrom)a.removeAllRanges();else{var f=Vc(b,a.anchorNode,a.anchorOffset),e=Vc(b,a.focusNode,a.focusOffset);if(!f||f.bad||!e||e.bad||0!=P(rc(f,e),d)||0!=P(tc(f,e),c))if(f=b.display.view,d=d.line>=b.display.viewFrom&&Wf(b,d)||{node:f[0].measure.map[2],offset:0},c=c.line<b.display.viewTo&&Wf(b,c),c||(c=f[f.length-1].measure,c=c.maps?c.maps[c.maps.length-1]:c.map,c={node:c[c.length-1],offset:c[c.length-2]-c[c.length-
3]}),d&&c){f=a.rangeCount&&a.getRangeAt(0);try{var g=Jb(d.node,d.offset,c.offset,c.node)}catch(lh){}g&&(!Oa&&b.state.focused?(a.collapse(d.node,d.offset),g.collapsed||(a.removeAllRanges(),a.addRange(g))):(a.removeAllRanges(),a.addRange(g)),f&&null==a.anchorNode?a.addRange(f):Oa&&this.startGracePeriod());this.rememberSelection()}else a.removeAllRanges()}};Z.prototype.startGracePeriod=function(){var a=this;clearTimeout(this.gracePeriod);this.gracePeriod=setTimeout(function(){a.gracePeriod=!1;a.selectionChanged()&&
a.cm.operation(function(){return a.cm.curOp.selectionChanged=!0})},20)};Z.prototype.showMultipleSelections=function(a){r(this.cm.display.cursorDiv,a.cursors);r(this.cm.display.selectionDiv,a.selection)};Z.prototype.rememberSelection=function(){var a=window.getSelection();this.lastAnchorNode=a.anchorNode;this.lastAnchorOffset=a.anchorOffset;this.lastFocusNode=a.focusNode;this.lastFocusOffset=a.focusOffset};Z.prototype.selectionInEditor=function(){var a=window.getSelection();if(!a.rangeCount)return!1;
a=a.getRangeAt(0).commonAncestorContainer;return l(this.div,a)};Z.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()||this.showSelection(this.prepareSelection(),!0),this.div.focus())};Z.prototype.blur=function(){this.div.blur()};Z.prototype.getField=function(){return this.div};Z.prototype.supportsTouch=function(){return!0};Z.prototype.receivedFocus=function(){function a(){b.cm.state.focused&&(b.pollSelection(),b.polling.set(b.cm.options.pollInterval,a))}var b=
this;this.selectionInEditor()?this.pollSelection():ta(this.cm,function(){return b.cm.curOp.selectionChanged=!0});this.polling.set(this.cm.options.pollInterval,a)};Z.prototype.selectionChanged=function(){var a=window.getSelection();return a.anchorNode!=this.lastAnchorNode||a.anchorOffset!=this.lastAnchorOffset||a.focusNode!=this.lastFocusNode||a.focusOffset!=this.lastFocusOffset};Z.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var a=window.getSelection(),
b=this.cm;if(Cc&&Bc&&this.cm.options.gutters.length&&ch(a.anchorNode))this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),this.focus();else if(!this.composing){this.rememberSelection();var c=Vc(b,a.anchorNode,a.anchorOffset),d=Vc(b,a.focusNode,a.focusOffset);c&&d&&ta(b,function(){ma(b.doc,Na(c,d),Ia);if(c.bad||d.bad)b.curOp.selectionChanged=!0})}}};Z.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=
null);var a=this.cm,b=a.display,c=a.doc.sel.primary(),d=c.from(),f=c.to();0==d.ch&&d.line>a.firstLine()&&(d=I(d.line-1,J(a.doc,d.line-1).length));f.ch==J(a.doc,f.line).text.length&&f.line<a.lastLine()&&(f=I(f.line+1,0));if(d.line<b.viewFrom||f.line>b.viewTo-1)return!1;var e;d.line==b.viewFrom||0==(e=$a(a,d.line))?(c=M(b.view[0].line),e=b.view[0].node):(c=M(b.view[e].line),e=b.view[e-1].node.nextSibling);var g=$a(a,f.line);g==b.view.length-1?(f=b.viewTo-1,b=b.lineDiv.lastChild):(f=M(b.view[g+1].line)-
1,b=b.view[g+1].node.previousSibling);if(!e)return!1;b=a.doc.splitLines(dh(a,e,b,c,f));for(e=R(a.doc,I(c,0),I(f,J(a.doc,f).text.length));1<b.length&&1<e.length;)if(y(b)==y(e))b.pop(),e.pop(),f--;else if(b[0]==e[0])b.shift(),e.shift(),c++;else break;var h=0;g=0;for(var k=b[0],l=e[0],p=Math.min(k.length,l.length);h<p&&k.charCodeAt(h)==l.charCodeAt(h);)++h;k=y(b);l=y(e);for(p=Math.min(k.length-(1==b.length?h:0),l.length-(1==e.length?h:0));g<p&&k.charCodeAt(k.length-g-1)==l.charCodeAt(l.length-g-1);)++g;
if(1==b.length&&1==e.length&&c==d.line)for(;h&&h>d.ch&&k.charCodeAt(k.length-g-1)==l.charCodeAt(l.length-g-1);)h--,g++;b[b.length-1]=k.slice(0,k.length-g).replace(/^\u200b+/,"");b[0]=b[0].slice(h).replace(/\u200b+$/,"");d=I(c,h);c=I(f,e.length?y(e).length-g:0);if(1<b.length||b[0]||P(d,c))return xb(a.doc,b,d,c,"+input"),!0};Z.prototype.ensurePolled=function(){this.forceCompositionEnd()};Z.prototype.reset=function(){this.forceCompositionEnd()};Z.prototype.forceCompositionEnd=function(){this.composing&&
(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())};Z.prototype.readFromDOMSoon=function(){var a=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(function(){a.readDOMTimeout=null;if(a.composing)if(a.composing.done)a.composing=null;else return;a.updateFromDOM()},80))};Z.prototype.updateFromDOM=function(){var a=this;!this.cm.isReadOnly()&&this.pollContent()||ta(this.cm,function(){return ra(a.cm)})};Z.prototype.setUneditable=function(a){a.contentEditable=
"false"};Z.prototype.onKeyPress=function(a){0!=a.charCode&&(a.preventDefault(),this.cm.isReadOnly()||ja(this.cm,Sd)(this.cm,String.fromCharCode(null==a.charCode?a.keyCode:a.charCode),0))};Z.prototype.readOnlyChanged=function(a){this.div.contentEditable=String("nocursor"!=a)};Z.prototype.onContextMenu=function(){};Z.prototype.resetPosition=function(){};Z.prototype.needsContentAttribute=!0;var fa=function(a){this.cm=a;this.prevInput="";this.pollingFast=!1;this.polling=new jb;this.hasSelection=!1;this.composing=
null};fa.prototype.init=function(a){function b(a){if(!ia(f,a)){if(f.somethingSelected())ua={lineWise:!1,text:f.getSelections()};else if(f.options.lineWiseCopyCut){var b=Sf(f);ua={lineWise:!0,text:b.text};"cut"==a.type?f.setSelections(b.ranges,null,Ia):(d.prevInput="",g.value=b.text.join("\n"),kc(g))}else return;"cut"==a.type&&(f.state.cutIncoming=!0)}}var c=this,d=this,f=this.cm,e=this.wrapper=Uf(),g=this.textarea=e.firstChild;a.wrapper.insertBefore(e,a.wrapper.firstChild);ic&&(g.style.width="0px");
O(g,"input",function(){X&&9<=ba&&c.hasSelection&&(c.hasSelection=null);d.poll()});O(g,"paste",function(a){ia(f,a)||Rf(a,f)||(f.state.pasteIncoming=!0,d.fastPoll())});O(g,"cut",b);O(g,"copy",b);O(a.scroller,"paste",function(b){Ma(a,b)||ia(f,b)||(f.state.pasteIncoming=!0,d.focus())});O(a.lineSpace,"selectstart",function(b){Ma(a,b)||oa(b)});O(g,"compositionstart",function(){var a=f.getCursor("from");d.composing&&d.composing.range.clear();d.composing={start:a,range:f.markText(a,f.getCursor("to"),{className:"CodeMirror-composing"})}});
O(g,"compositionend",function(){d.composing&&(d.poll(),d.composing.range.clear(),d.composing=null)})};fa.prototype.prepareSelection=function(){var a=this.cm,b=a.display,c=a.doc,d=Ge(a);if(a.options.moveInputWithCursor){a=Ba(a,c.sel.primary().head,"div");c=b.wrapper.getBoundingClientRect();var f=b.lineDiv.getBoundingClientRect();d.teTop=Math.max(0,Math.min(b.wrapper.clientHeight-10,a.top+f.top-c.top));d.teLeft=Math.max(0,Math.min(b.wrapper.clientWidth-10,a.left+f.left-c.left))}return d};fa.prototype.showSelection=
function(a){var b=this.cm.display;r(b.cursorDiv,a.cursors);r(b.selectionDiv,a.selection);null!=a.teTop&&(this.wrapper.style.top=a.teTop+"px",this.wrapper.style.left=a.teLeft+"px")};fa.prototype.reset=function(a){if(!this.contextMenuPending&&!this.composing){var b=this.cm;b.somethingSelected()?(this.prevInput="",a=b.getSelection(),this.textarea.value=a,b.state.focused&&kc(this.textarea),X&&9<=ba&&(this.hasSelection=a)):a||(this.prevInput=this.textarea.value="",X&&9<=ba&&(this.hasSelection=null))}};
fa.prototype.getField=function(){return this.textarea};fa.prototype.supportsTouch=function(){return!1};fa.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!Eb||w()!=this.textarea))try{this.textarea.focus()}catch(t){}};fa.prototype.blur=function(){this.textarea.blur()};fa.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0};fa.prototype.receivedFocus=function(){this.slowPoll()};fa.prototype.slowPoll=function(){var a=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,
function(){a.poll();a.cm.state.focused&&a.slowPoll()})};fa.prototype.fastPoll=function(){function a(){c.poll()||b?(c.pollingFast=!1,c.slowPoll()):(b=!0,c.polling.set(60,a))}var b=!1,c=this;c.pollingFast=!0;c.polling.set(20,a)};fa.prototype.poll=function(){var a=this,b=this.cm,c=this.textarea,d=this.prevInput;if(this.contextMenuPending||!b.state.focused||ih(c)&&!d&&!this.composing||b.isReadOnly()||b.options.disableInput||b.state.keySeq)return!1;var f=c.value;if(f==d&&!b.somethingSelected())return!1;
if(X&&9<=ba&&this.hasSelection===f||za&&/[\uf700-\uf7ff]/.test(f))return b.display.input.reset(),!1;if(b.doc.sel==b.display.selForContextMenu){var e=f.charCodeAt(0);8203!=e||d||(d="\u200b");if(8666==e)return this.reset(),this.cm.execCommand("undo")}var g=0;for(e=Math.min(d.length,f.length);g<e&&d.charCodeAt(g)==f.charCodeAt(g);)++g;ta(b,function(){Sd(b,f.slice(g),d.length-g,null,a.composing?"*compose":null);1E3<f.length||-1<f.indexOf("\n")?c.value=a.prevInput="":a.prevInput=f;a.composing&&(a.composing.range.clear(),
a.composing.range=b.markText(a.composing.start,b.getCursor("to"),{className:"CodeMirror-composing"}))});return!0};fa.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)};fa.prototype.onKeyPress=function(){X&&9<=ba&&(this.hasSelection=null);this.fastPoll()};fa.prototype.onContextMenu=function(a){function b(){if(null!=g.selectionStart){var a=f.somethingSelected(),b="\u200b"+(a?g.value:"");g.value="\u21da";g.value=b;d.prevInput=a?"":"\u200b";g.selectionStart=1;g.selectionEnd=
b.length;e.selForContextMenu=f.doc.sel}}function c(){d.contextMenuPending=!1;d.wrapper.style.cssText=p;g.style.cssText=l;X&&9>ba&&e.scrollbars.setScrollTop(e.scroller.scrollTop=k);if(null!=g.selectionStart){(!X||X&&9>ba)&&b();var a=0,c=function(){e.selForContextMenu==f.doc.sel&&0==g.selectionStart&&0<g.selectionEnd&&"\u200b"==d.prevInput?ja(f,mf)(f):10>a++?e.detectingSelectAll=setTimeout(c,500):(e.selForContextMenu=null,e.input.reset())};e.detectingSelectAll=setTimeout(c,200)}}var d=this,f=d.cm,e=
f.display,g=d.textarea,h=db(f,a),k=e.scroller.scrollTop;if(h&&!Ca){f.options.resetSelectionOnContextMenu&&-1==f.doc.sel.contains(h)&&ja(f,ma)(f.doc,Na(h),Ia);var l=g.style.cssText,p=d.wrapper.style.cssText;d.wrapper.style.cssText="position: absolute";h=d.wrapper.getBoundingClientRect();g.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(a.clientY-h.top-5)+"px; left: "+(a.clientX-h.left-5)+"px;\n      z-index: 1000; background: "+(X?"rgba(255, 255, 255, .05)":"transparent")+
";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";if(na)var v=window.scrollY;e.input.focus();na&&window.scrollTo(null,v);e.input.reset();f.somethingSelected()||(g.value=d.prevInput=" ");d.contextMenuPending=!0;e.selForContextMenu=f.doc.sel;clearTimeout(e.detectingSelectAll);X&&9<=ba&&b();if(Pd){Hb(a);var u=function(){va(window,"mouseup",u);setTimeout(c,20)};O(window,"mouseup",u)}else setTimeout(c,50)}};fa.prototype.readOnlyChanged=
function(a){a||this.reset();this.textarea.disabled="nocursor"==a};fa.prototype.setUneditable=function(){};fa.prototype.needsContentAttribute=!1;(function(a){function b(b,d,f,e){a.defaults[b]=d;f&&(c[b]=e?function(a,b,c){c!=Bb&&f(a,b,c)}:f)}var c=a.optionHandlers;a.defineOption=b;a.Init=Bb;b("value","",function(a,b){return a.setValue(b)},!0);b("mode",null,function(a,b){a.doc.modeOption=b;Ed(a)},!0);b("indentUnit",2,Ed,!0);b("indentWithTabs",!1);b("smartIndent",!0);b("tabSize",4,function(a){Vb(a);Ob(a);
ra(a)},!0);b("lineSeparator",null,function(a,b){if(a.doc.lineSep=b){var c=[],d=a.doc.first;a.doc.iter(function(a){for(var f=0;;){var e=a.text.indexOf(b,f);if(-1==e)break;f=e+b.length;c.push(I(d,e))}d++});for(var f=c.length-1;0<=f;f--)xb(a.doc,b,c[f],I(c[f].line,c[f].ch+b.length))}});b("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(a,b,c){a.state.specialChars=new RegExp(b.source+(b.test("\t")?"":"|\t"),"g");c!=Bb&&a.refresh()});b("specialCharPlaceholder",
ng,function(a){return a.refresh()},!0);b("electricChars",!0);b("inputStyle",Eb?"contenteditable":"textarea",function(){throw Error("inputStyle can not (yet) be changed in a running editor");},!0);b("spellcheck",!1,function(a,b){return a.getInputField().spellcheck=b},!0);b("rtlMoveVisually",!hh);b("wholeLineUpdateBefore",!0);b("theme","default",function(a){Mf(a);gc(a)},!0);b("keyMap","default",function(a,b,c){b=Qc(b);(c=c!=Bb&&Qc(c))&&c.detach&&c.detach(a,b);b.attach&&b.attach(a,c||null)});b("extraKeys",
null);b("configureMouse",null);b("lineWrapping",!1,ah,!0);b("gutters",[],function(a){Cd(a.options);gc(a)},!0);b("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?sd(a.display)+"px":"0";a.refresh()},!0);b("coverGutterNextToScrollbar",!1,function(a){return sb(a)},!0);b("scrollbarStyle","native",function(a){Qe(a);sb(a);a.display.scrollbars.setScrollTop(a.doc.scrollTop);a.display.scrollbars.setScrollLeft(a.doc.scrollLeft)},!0);b("lineNumbers",!1,function(a){Cd(a.options);gc(a)},!0);b("firstLineNumber",
1,gc,!0);b("lineNumberFormatter",function(a){return a},gc,!0);b("showCursorWhenSelecting",!1,Pb,!0);b("resetSelectionOnContextMenu",!0);b("lineWiseCopyCut",!0);b("pasteLinesPerSelection",!0);b("readOnly",!1,function(a,b){"nocursor"==b&&(Qb(a),a.display.input.blur());a.display.input.readOnlyChanged(b)});b("disableInput",!1,function(a,b){b||a.display.input.reset()},!0);b("dragDrop",!0,$g);b("allowDropFileTypes",null);b("cursorBlinkRate",530);b("cursorScrollMargin",0);b("cursorHeight",1,Pb,!0);b("singleCursorHeightPerLine",
!0,Pb,!0);b("workTime",100);b("workDelay",100);b("flattenSpans",!0,Vb,!0);b("addModeClass",!1,Vb,!0);b("pollInterval",100);b("undoDepth",200,function(a,b){return a.doc.history.undoDepth=b});b("historyEventDelay",1250);b("viewportMargin",10,function(a){return a.refresh()},!0);b("maxHighlightLength",1E4,Vb,!0);b("moveInputWithCursor",!0,function(a,b){b||a.display.input.resetPosition()});b("tabindex",null,function(a,b){return a.display.input.getField().tabIndex=b||""});b("autofocus",null);b("direction",
"ltr",function(a,b){return a.doc.setDirection(b)},!0)})(ca);(function(a){var b=a.optionHandlers,c=a.helpers={};a.prototype={constructor:a,focus:function(){window.focus();this.display.input.focus()},setOption:function(a,c){var d=this.options,f=d[a];if(d[a]!=c||"mode"==a)d[a]=c,b.hasOwnProperty(a)&&ja(this,b[a])(this,c,f),da(this,"optionChange",this,a)},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a,b){this.state.keyMaps[b?"push":"unshift"](Qc(a))},
removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(b[c]==a||b[c].name==a)return b.splice(c,1),!0},addOverlay:pa(function(b,c){var d=b.token?b:a.getMode(this.options,b);if(d.startState)throw Error("Overlays may not be stateful.");E(this.state.overlays,{mode:d,modeSpec:b,opaque:c&&c.opaque,priority:c&&c.priority||0},function(a){return a.priority});this.state.modeGen++;ra(this)}),removeOverlay:pa(function(a){for(var b=this.state.overlays,c=0;c<b.length;++c){var d=b[c].modeSpec;
if(d==a||"string"==typeof a&&d.name==a){b.splice(c,1);this.state.modeGen++;ra(this);break}}}),indentLine:pa(function(a,b,c){"string"!=typeof b&&"number"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract");aa(this.doc,a)&&hc(this,a,b,c)}),indentSelection:pa(function(a){for(var b=this.doc.sel.ranges,c=-1,d=0;d<b.length;d++){var f=b[d];if(f.empty())f.head.line>c&&(hc(this,f.head.line,a,!0),c=f.head.line,d==this.doc.sel.primIndex&&rb(this));else{var e=f.from();f=f.to();var g=
Math.max(c,e.line);c=Math.min(this.lastLine(),f.line-(f.ch?0:1))+1;for(f=g;f<c;++f)hc(this,f,a);f=this.doc.sel.ranges;0==e.ch&&b.length==f.length&&0<f[d].from().ch&&Id(this.doc,d,new Y(e,f[d].to()),Ia)}}}),getTokenAt:function(a,b){return he(this,a,b)},getLineTokens:function(a,b){return he(this,I(a),b,!0)},getTokenTypeAt:function(a){a=U(this.doc,a);var b=fe(this,J(this.doc,a.line)),c=0,d=(b.length-1)/2;a=a.ch;if(0==a)b=b[2];else for(;;){var f=c+d>>1;if((f?b[2*f-1]:0)>=a)d=f;else if(b[2*f+1]<a)c=f+
1;else{b=b[2*f+2];break}}c=b?b.indexOf("overlay "):-1;return 0>c?b:0==c?null:b.slice(0,c-1)},getModeAt:function(b){var c=this.doc.mode;return c.innerMode?a.innerMode(c,this.getTokenAt(b).state).mode:c},getHelper:function(a,b){return this.getHelpers(a,b)[0]},getHelpers:function(a,b){var f=[];if(!c.hasOwnProperty(b))return f;var e=c[b];a=this.getModeAt(a);if("string"==typeof a[b])e[a[b]]&&f.push(e[a[b]]);else if(a[b])for(var g=0;g<a[b].length;g++){var h=e[a[b][g]];h&&f.push(h)}else a.helperType&&e[a.helperType]?
f.push(e[a.helperType]):e[a.name]&&f.push(e[a.name]);for(b=0;b<e._global.length;b++)g=e._global[b],g.pred(a,this)&&-1==d(f,g.val)&&f.push(g.val);return f},getStateAfter:function(a,b){var c=this.doc;a=Math.max(c.first,Math.min(null==a?c.first+c.size-1:a,c.first+c.size-1));return Ib(this,a+1,b).state},cursorCoords:function(a,b){var c=this.doc.sel.primary();a=null==a?c.head:"object"==typeof a?U(this.doc,a):a?c.from():c.to();return Ba(this,a,b||"page")},charCoords:function(a,b){return od(this,U(this.doc,
a),b||"page")},coordsChar:function(a,b){a=Be(this,a,b||"page");return qd(this,a.left,a.top)},lineAtHeight:function(a,b){a=Be(this,{top:a,left:0},b||"page").top;return Q(this.doc,a+this.display.viewOffset)},heightAtLine:function(a,b,c){var d=!1;if("number"==typeof a){var f=this.doc.first+this.doc.size-1;a<this.doc.first?a=this.doc.first:a>f&&(a=f,d=!0);a=J(this.doc,a)}return Dc(this,a,{top:0,left:0},b||"page",c||d).top+(d?this.doc.height-Fa(a):0)},defaultTextHeight:function(){return bb(this.display)},
defaultCharWidth:function(){return Nb(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(a,b,c,d,f){var e=this.display;a=Ba(this,U(this.doc,a));var g=a.bottom,h=a.left;b.style.position="absolute";b.setAttribute("cm-ignore-events","true");this.display.input.setUneditable(b);e.sizer.appendChild(b);if("over"==d)g=a.top;else if("above"==d||"near"==d){var k=Math.max(e.wrapper.clientHeight,this.doc.height),l=Math.max(e.sizer.clientWidth,e.lineSpace.clientWidth);
("above"==d||a.bottom+b.offsetHeight>k)&&a.top>b.offsetHeight?g=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=k&&(g=a.bottom);h+b.offsetWidth>l&&(h=l-b.offsetWidth)}b.style.top=g+"px";b.style.left=b.style.right="";"right"==f?(h=e.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==f?h=0:"middle"==f&&(h=(e.sizer.clientWidth-b.offsetWidth)/2),b.style.left=h+"px");c&&(a=yd(this,{left:h,top:g,right:h+b.offsetWidth,bottom:g+b.offsetHeight}),null!=a.scrollTop&&Sb(this,a.scrollTop),null!=a.scrollLeft&&
fb(this,a.scrollLeft))},triggerOnKeyDown:pa(Gf),triggerOnKeyPress:pa(If),triggerOnKeyUp:Hf,triggerOnMouseDown:pa(Jf),execCommand:function(a){if(cc.hasOwnProperty(a))return cc[a].call(null,this)},triggerElectric:pa(function(a){Qf(this,a)}),findPosH:function(a,b,c,d){var f=1;0>b&&(f=-1,b=-b);a=U(this.doc,a);for(var e=0;e<b&&(a=Ud(this.doc,a,f,c,d),!a.hitSide);++e);return a},moveH:pa(function(a,b){var c=this;this.extendSelectionsBy(function(d){return c.display.shift||c.doc.extend||d.empty()?Ud(c.doc,
d.head,a,b,c.options.rtlMoveVisually):0>a?d.from():d.to()},lc)}),deleteH:pa(function(a,b){var c=this.doc;this.doc.sel.somethingSelected()?c.replaceSelection("",null,"+delete"):Ab(this,function(d){var f=Ud(c,d.head,a,b,!1);return 0>a?{from:f,to:d.head}:{from:d.head,to:f}})}),findPosV:function(a,b,c,d){var f=1;0>b&&(f=-1,b=-b);var e=U(this.doc,a);for(a=0;a<b&&(e=Ba(this,e,"div"),null==d?d=e.left:e.left=d,e=Vf(this,e,f,c),!e.hitSide);++a);return e},moveV:pa(function(a,b){var c=this,d=this.doc,f=[],e=
!this.display.shift&&!d.extend&&d.sel.somethingSelected();d.extendSelectionsBy(function(g){if(e)return 0>a?g.from():g.to();var h=Ba(c,g.head,"div");null!=g.goalColumn&&(h.left=g.goalColumn);f.push(h.left);var k=Vf(c,h,a,b);"page"==b&&g==d.sel.primary()&&Gc(c,od(c,k,"div").top-h.top);return k},lc);if(f.length)for(var g=0;g<d.sel.ranges.length;g++)d.sel.ranges[g].goalColumn=f[g]}),findWordAt:function(a){var b=J(this.doc,a.line).text,c=a.ch,d=a.ch;if(b){var f=this.getHelper(a,"wordChars");"before"!=
a.sticky&&d!=b.length||!c?++d:--c;var e=b.charAt(c);for(e=x(e,f)?function(a){return x(a,f)}:/\s/.test(e)?function(a){return/\s/.test(a)}:function(a){return!/\s/.test(a)&&!x(a)};0<c&&e(b.charAt(c-1));)--c;for(;d<b.length&&e(b.charAt(d));)++d}return new Y(I(a.line,c),I(a.line,d))},toggleOverwrite:function(a){if(null==a||a!=this.state.overwrite)(this.state.overwrite=!this.state.overwrite)?u(this.display.cursorDiv,"CodeMirror-overwrite"):eb(this.display.cursorDiv,"CodeMirror-overwrite"),da(this,"overwriteToggle",
this,this.state.overwrite)},hasFocus:function(){return this.display.input.getField()==w()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:pa(function(a,b){Rb(this,a,b)}),getScrollInfo:function(){var a=this.display.scroller;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-Ha(this)-this.display.barHeight,width:a.scrollWidth-Ha(this)-this.display.barWidth,clientHeight:jd(this),clientWidth:Za(this)}},scrollIntoView:pa(function(a,b){null==a?(a={from:this.doc.sel.primary().head,
to:null},null==b&&(b=this.options.cursorScrollMargin)):"number"==typeof a?a={from:I(a,0),to:null}:null==a.from&&(a={from:a,to:null});a.to||(a.to=a.from);a.margin=b||0;null!=a.from.line?(Hc(this),this.curOp.scrollToPos=a):Ne(this,a.from,a.to,a.margin)}),setSize:pa(function(a,b){var c=this,d=function(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a};null!=a&&(this.display.wrapper.style.width=d(a));null!=b&&(this.display.wrapper.style.height=d(b));this.options.lineWrapping&&ye(this);var f=
this.display.viewFrom;this.doc.iter(f,this.display.viewTo,function(a){if(a.widgets)for(var b=0;b<a.widgets.length;b++)if(a.widgets[b].noHScroll){Ra(c,f,"widget");break}++f});this.curOp.forceUpdate=!0;da(this,"refresh",this)}),operation:function(a){return ta(this,a)},startOperation:function(){return gb(this)},endOperation:function(){return hb(this)},refresh:pa(function(){var a=this.display.cachedTextHeight;ra(this);this.curOp.forceUpdate=!0;Ob(this);Rb(this,this.doc.scrollLeft,this.doc.scrollTop);
xd(this);(null==a||.5<Math.abs(a-bb(this.display)))&&td(this);da(this,"refresh",this)}),swapDoc:pa(function(a){var b=this.doc;b.cm=null;$e(this,a);Ob(this);this.display.input.reset();Rb(this,a.scrollLeft,a.scrollTop);this.curOp.forceScroll=!0;la(this,"swapDoc",this,b);return b}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};
nb(a);a.registerHelper=function(b,d,f){c.hasOwnProperty(b)||(c[b]=a[b]={_global:[]});c[b][d]=f};a.registerGlobalHelper=function(b,d,f,e){a.registerHelper(b,d,e);c[b]._global.push({pred:f,val:e})}})(ca);var kh="iter insert remove copy getEditor constructor".split(" "),pc;for(pc in sa.prototype)sa.prototype.hasOwnProperty(pc)&&0>d(kh,pc)&&(ca.prototype[pc]=function(a){return function(){return a.apply(this.doc,arguments)}}(sa.prototype[pc]));nb(sa);ca.inputStyles={textarea:fa,contenteditable:Z};ca.defineMode=
function(a){ca.defaults.mode||"null"==a||(ca.defaults.mode=a);fg.apply(this,arguments)};ca.defineMIME=function(a,b){ob[a]=b};ca.defineMode("null",function(){return{token:function(a){return a.skipToEnd()}}});ca.defineMIME("text/plain","null");ca.defineExtension=function(a,b){ca.prototype[a]=b};ca.defineDocExtension=function(a,b){sa.prototype[a]=b};ca.fromTextArea=function(a,b){function c(){a.value=k.getValue()}b=b?h(b):{};b.value=a.value;!b.tabindex&&a.tabIndex&&(b.tabindex=a.tabIndex);!b.placeholder&&
a.placeholder&&(b.placeholder=a.placeholder);if(null==b.autofocus){var d=w();b.autofocus=d==a||null!=a.getAttribute("autofocus")&&d==document.body}if(a.form&&(O(a.form,"submit",c),!b.leaveSubmitMethodAlone)){var f=a.form;var e=f.submit;try{var g=f.submit=function(){c();f.submit=e;f.submit();f.submit=g}}catch(Zd){}}b.finishInit=function(b){b.save=c;b.getTextArea=function(){return a};b.toTextArea=function(){b.toTextArea=isNaN;c();a.parentNode.removeChild(b.getWrapperElement());a.style.display="";a.form&&
(va(a.form,"submit",c),"function"==typeof a.form.submit&&(a.form.submit=e))}};a.style.display="none";var k=ca(function(b){return a.parentNode.insertBefore(b,a.nextSibling)},b);return k};(function(a){a.off=va;a.on=O;a.wheelEventPixels=zg;a.Doc=sa;a.splitLines=Td;a.countColumn=g;a.findColumn=f;a.isWordChar=D;a.Pass=Sc;a.signal=da;a.Line=tb;a.changeEnd=Sa;a.scrollbarModel=Re;a.Pos=I;a.cmpPos=P;a.modes=bd;a.mimeModes=ob;a.resolveMode=yc;a.getMode=cd;a.modeExtensions=pb;a.extendMode=gg;a.copyState=Ya;
a.startState=ce;a.innerMode=dd;a.commands=cc;a.keyMap=bc;a.keyName=Cf;a.isModifierKey=zf;a.lookupKey=zb;a.normalizeKeyMap=Lg;a.StringStream=ea;a.SharedTextMarker=ac;a.TextMarker=Ta;a.LineWidget=$b;a.e_preventDefault=oa;a.e_stopPropagation=ae;a.e_stop=Hb;a.addClass=u;a.contains=l;a.rmClass=eb;a.keyNames=Ua})(ca);ca.version="5.31.0";return ca})},function(n,e){},function(n,e){},function(n,e,c){e.a=function(c){return new q.a(void 0===c?1:c,m.o)};var q=c(4),m=c(2)},function(n,e,c){e.a=function(a){a=void 0===
a?q.p.create():a;return new b(a,a)};var q=c(1),m=c(2),r=c(3),a=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),b=function(){function b(a,c){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.value_=a;this.defaultValue=c;this.changed=new r.a}a(b,[{key:"toJSON",value:function(){if(this.value_!==
this.defaultValue)return this.value_.toString()}},{key:"restoreState",value:function(a){try{this.value=Object(m.l)(a.split(","))}catch(u){this.value=this.defaultValue}}},{key:"reset",value:function(){this.value=this.defaultValue}},{key:"value",get:function(){return this.value_},set:function(a){a!==this.value_&&(this.value_=a,this.changed.dispatch())}}]);return b}()},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a){return a-
Math.floor(a)}c.d(e,"b",function(){return p});c.d(e,"a",function(){return g});var r=c(61),a=c(102),b=c(179),l=c(3),w=c(7),u=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),p=function(){function b(a){q(this,b);this.prefix=a;this.aName=this.prefix+"_a";this.bName=this.prefix+"_b"}u(b,[{key:"defineShader",value:function(b){var c=
this.aName,d=this.bName;b.addUniform("highp vec4",c,4);b.addUniform("highp float",d,4);b.addFragmentCode(w.l);b.addFragmentCode(a.d);b.addFragmentCode(w.g);for(var f="\nvec3 "+this.prefix+"(uint64_t x) {\n  vec2 v;\n  float primeModulus = float("+r.b+");\n",e=0;2>e;++e){var g=2*e,h=2*e;f+="\n  v["+e+"] = computeHash(x,\n                        "+c+"["+h+"], "+c+"["+(h+1)+"],\n                        "+d+"["+g+"], "+d+"["+(g+1)+"],\n                        primeModulus, 1.0 / 256.0);\n"}b.addFragmentCode(f+
"\n  vec3 hsv = vec3(v.x, 0.5 + v.y * 0.5, 1.0);\n  return hsvToRgb(hsv);\n}\n")}},{key:"enable",value:function(a,b,c){a.uniform4fv(b.uniform(this.aName),c.a_);a.uniform1fv(b.uniform(this.bName),c.b_)}}]);return b}(),k=new Float32Array(2),h=new Float32Array(3),g=function(){function a(b){q(this,a);this.a_=new Float32Array(16);this.b_=new Float32Array(4);this.changed=new l.a;null==b?(this.hashFunctions=Array(2),this.randomize_()):this.hashFunctions=b;this.computeGPUCoefficients_()}u(a,[{key:"compute",
value:function(a,c){var d=c.low;c=c.high;for(var f=this.hashFunctions,e=0;2>e;++e)k[e]=m(f[e].compute(d,c)/256);Object(b.a)(a,k[0],.5+.5*k[1],1);return a}},{key:"computeCssColor",value:function(a){this.compute(h,a);return"rgb("+100*h[0]+"%,"+100*h[1]+"%,"+100*h[2]+"%)"}},{key:"debugCompute",value:function(a,b){var c=b.low;b=b.high;for(var d=this.b_,f=r.b,e=0;2>e;++e){for(var g=2*e,h=2*e,k=new Float32Array(2),l=0;4>l;++l)k[0]+=this.a_[4*h+l]*(c>>8*l&255),k[1]+=this.a_[4*(h+1)+l]*(b>>8*l&255);h=(k[0]+
k[1])%f;l=h*h%f;var p=l*d[g+1]%f,v=(d[g]+h+p)%f;console.log("b = "+d[g]+", sums="+k[0]+" "+k[1]+", dotResult="+h+", "+("prod = "+h*h+" dotResult2="+l+", y="+p+", ")+("modResult="+v));a[e]=m(1/256*v)}return a}},{key:"randomize_",value:function(){for(var a=0;2>a;++a)this.hashFunctions[a]=r.a.generate()}},{key:"randomize",value:function(){this.randomize_();this.computeGPUCoefficients_();this.changed.dispatch()}},{key:"toString",value:function(){return"new SegmentColorHash(["+this.hashFunctions+"])"}},
{key:"computeGPUCoefficients_",value:function(){for(var a=this.hashFunctions,b=this.a_,c=this.b_,d=0;2>d;++d){var e=a[d],g=2*d,h=8*d;c[g]=1*e.b;c[g+1]=1*e.c;for(g=0;4>g;++g)b[h+g]=1*e.a0[g],b[h+4+g]=1*e.a1[g]}}}],[{key:"getDefault",value:function(){return new a([new r.a(Float32Array.of(609,2364,3749,2289),Float32Array.of(2840,1186,3660,1833),1718,1109),new r.a(Float32Array.of(3466,3835,3345,2040),Float32Array.of(3382,901,18,3444),1534,1432)])}}]);return a}()},function(n,e,c){function q(a,b){if(!(a instanceof
b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,
b):a.__proto__=b)}c.d(e,"a",function(){return h});c.d(e,"c",function(){return g});c.d(e,"b",function(){return d});var a=c(61),b=c(62);n=c(0);var l=c(7),w=c(40),u=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),p=function v(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);
if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return v(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},k=[l.o,l.l,l.d,l.h,"\nfloat computeHash(uint64_t x, vec4 a0, vec4 a1, float b, float c, float modulus, float scalar) {\n  x.low = unnormalizeUint8(x.low);\n  x.high = unnormalizeUint8(x.high);\n  float dotResult = imod(exactDot(a0, x.low) + exactDot(a1, x.high), modulus);\n  float dotResult2 = imod(dotResult * dotResult, modulus);\n  float y = imod(dotResult2 * c, modulus);\n  float modResult = imod(dotResult + y + b, modulus);\n  return fract(modResult * scalar);\n}\n"];
e.d=k;var h=function(b){function c(a,b){q(this,c);var d=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));d.gl=a;d.hashTable=b;d.hashFunctions=null;d.generation=-1;d.texture=null;b=b.hashFunctions.length;d.a=new Float32Array(16*b);d.b=new Float32Array(4*b+5);d.texture=a.createTexture();return d}r(c,b);u(c,[{key:"computeCoefficients",value:function(){var b=this.hashTable,c=b.hashFunctions;if(this.hashFunctions!==c){this.hashFunctions=c;for(var d=this.a,e=this.b,g=c.length,h=b.width,k=[1/h,
1/b.height],l=0;2>l;++l)e[4*g+l]=a.b,e[4*g+3+l]=k[l];e[4*g+2]=1/(b.entryStride*h);for(h=0;h<g;++h)for(k=c[h],l=0;2>l;++l){var p=k[l],v=4*h+2*l,u=4*(4*h+2*l);e[v]=p.b+(0===l?.5/b.entryStride:.5);e[v+1]=p.c;for(v=0;4>v;++v)d[u+v]=p.a0[v],d[u+4+v]=p.a1[v]}}}},{key:"copyToGPU",value:function(){this.computeCoefficients();var a=this.hashTable,b=a.generation;if(this.generation!==b){this.generation=b;var c=a.width,d=a.height,e=this.gl;b=this.texture;e.activeTexture(e.TEXTURE0+e.tempTextureUnit);e.bindTexture(e.TEXTURE_2D,
b);e.pixelStorei(e.UNPACK_ALIGNMENT,1);Object(w.b)(e);var g=e.RGBA;a.tableWithMungedEmptyKey(function(b){e.texImage2D(e.TEXTURE_2D,0,g,c*a.entryStride,d,0,g,e.UNSIGNED_BYTE,new Uint8Array(b.buffer))});e.bindTexture(e.TEXTURE_2D,null)}}},{key:"disposed",value:function(){this.gl.deleteTexture(this.texture);this.texture=null;this.hashTable=this.gl=void 0;this.hashFunctions=null;p(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}}],[{key:"get",value:function(a,b){var c=
this;return a.memoize.get(b,function(){return new c(a,b)})}}]);return c}(n.a),g=function(){function a(c,d){d=void 0===d?b.c:d;q(this,a);this.prefix=c;this.numAlternatives=d;$jscomp.initSymbol();this.textureUnitSymbol=Symbol.for("gpuhashtable:"+this.prefix);this.aName=this.prefix+"_a";this.bName=this.prefix+"_b";this.samplerName=this.prefix+"_sampler"}u(a,[{key:"defineShader",value:function(a){var b=this.aName,c=this.bName,d=this.samplerName,e=this.numAlternatives;a.addUniform("highp vec4",b,4*e);
a.addUniform("highp float",c,4*e+5);a.addTextureSampler2D(d,this.textureUnitSymbol);a.addFragmentCode(k);for(var g="",h=0;h<e;++h){for(var l=0;2>l;++l){var p=4*h+2*l,v=4*h+2*l;g+="\nfloat "+this.prefix+"_computeHash_"+h+"_"+l+"(uint64_t x) {\n  float primeModulus = "+c+"["+(4*e+l)+"];\n  float scalar = "+c+"["+(4*e+3+l)+"];\n  return computeHash(x,\n                     "+b+"["+v+"], "+b+"["+(v+1)+"],\n                     "+c+"["+p+"], "+c+"["+(p+1)+"],\n                     primeModulus, scalar);\n}\n"}g+=
"\nvec2 "+this.prefix+"_computeHash_"+h+"(uint64_t x) {\n  vec2 v;\n  v[0] = "+this.prefix+"_computeHash_"+h+"_0(x);\n  v[1] = "+this.prefix+"_computeHash_"+h+"_1(x);\n  return v;\n}\n"}g+="\nbool "+this.hasFunctionName+"(uint64_t x) {\n  float highOffset = "+c+"["+(4*e+2)+"];\n";for(b=0;b<e;++b)g+="\n  {\n    vec2 v = "+this.prefix+"_computeHash_"+b+"(x);\n    vec4 lowResult = texture2D("+d+", v);\n    vec4 highResult = texture2D("+d+", vec2(v.x + highOffset, v.y));\n    if (lowResult == x.low && highResult == x.high) {\n      return true;\n    }\n  }\n";
a.addFragmentCode(g+"\n  return false;\n}\n")}},{key:"enable",value:function(a,b,c){c.copyToGPU();var d=b.textureUnit(this.textureUnitSymbol);a.activeTexture(a.TEXTURE0+d);a.bindTexture(a.TEXTURE_2D,c.texture);a.uniform4fv(b.uniform(this.aName),c.a);a.uniform1fv(b.uniform(this.bName),c.b)}},{key:"disable",value:function(a,b){b=b.textureUnit(this.textureUnitSymbol);a.activeTexture(a.TEXTURE0+b);a.bindTexture(a.TEXTURE_2D,null)}},{key:"hasFunctionName",get:function(){return this.prefix+"_has"}}]);return a}(),
d=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);u(b,[{key:"defineShader",value:function(a){p(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"defineShader",this).call(this,a);for(var c=this.samplerName,d=this.numAlternatives,e="\nbool "+this.getFunctionName+"(uint64_t x, out uint64_t value) {\n  float highOffset = "+this.bName+"["+(4*d+2)+"];\n",g=0;g<d;++g)e+="\n  {\n    vec2 v = "+this.prefix+"_computeHash_"+g+"(x);\n    vec4 lowResult = texture2D("+
c+", v);\n    vec4 highResult = texture2D("+c+", vec2(v.x + highOffset, v.y));\n    if (lowResult == x.low && highResult == x.high) {\n      value.low = texture2D("+c+", vec2(v.x + 2.0 * highOffset, v.y));\n      value.high = texture2D("+c+", vec2(v.x + 3.0 * highOffset, v.y));\n      return true;\n    }\n  }\n";a.addFragmentCode(e+"\n  return false;\n}\n")}},{key:"getFunctionName",get:function(){return this.prefix+"_get"}}]);return b}(g)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}e.c=function(a,b,c){c=void 0===c?!1:c;b=b.attribute("aIndexRaw");0<=b&&(c&&a.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(b,0),a.disableVertexAttribArray(b))};e.d=function(a){return a.memoize.get("IndexBuffer",
function(){return new w(a)})};e.b=function(a){a.addAttribute("highp vec3","aIndexRaw");a.addVertexCode(b.k);a.addVertexCode("\nuint32_t getPrimitiveIndex() {\n  uint32_t result;\n  result.value = vec4(aIndexRaw, 0.0);\n  return result;\n}\n")};c.d(e,"a",function(){return u});e.e=function(b,c){return r.a.fromData(b,new Uint8Array(c.buffer,c.byteOffset,c.byteLength),a.a,a.k)};n=c(0);var r=c(17),a=c(20),b=c(7),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||
!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),w=function(b){function c(a){q(this,c);var b=(c.__proto__||Object.getPrototypeOf(c)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");b=!b||"object"!==typeof b&&"function"!==typeof b?this:b;b.gl=a;b.buffer=b.registerDisposer(new r.a(a));return b}m(c,b);l(c,[{key:"resize",value:function(a){var b;
if(256>a){var c=b=new Uint8Array(a);for(var f=0;f<a;++f)c[f]=f;c=1}else if(65536>a){c=b=new Uint8Array(2*a);f=0;for(var e=2*a,h=0;h<e;h+=2)c[h]=f,c[h+1]=f>>8,++f;c=2}else if(16777216>a){c=b=new Uint8Array(3*a);f=3*a;for(h=e=0;h<f;h+=3)c[h]=e,c[h+1]=e>>8,c[h+2]=e>>16,++e;c=3}else throw Error("Length of index buffer must not exceed 2^24.");this.buffer.setData(b);this.numComponents=c;this.length=a}},{key:"ensure",value:function(a){(void 0===this.length||this.length<a)&&this.resize(a);return this}},{key:"bindToVertexAttrib",
value:function(b){this.buffer.bindToVertexAttrib(b,this.numComponents,a.t,!0)}},{key:"bind",value:function(a,b){b=void 0===b?0:b;a=a.attribute("aIndexRaw");0<=a&&(this.bindToVertexAttrib(a),0!==b&&this.gl.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(a,b))}}]);return c}(n.a),u=function(){function b(a){q(this,b);this.name=a;this.attributeName="a"+this.name;this.getterName="get"+this.name}l(b,[{key:"defineShader",value:function(a){a.addAttribute("highp vec4",this.attributeName);a.addVertexCode("\nfloat "+
this.getterName+" () {\n  vec4 temp = "+this.attributeName+";\n  return temp.x + temp.y * 256.0 + temp.z * 65536.0;\n}\n")}},{key:"bind",value:function(b,c){b.bindToVertexAttrib(c.attribute(this.attributeName),4,a.t,!1)}},{key:"disable",value:function(a){a.gl.disableVertexAttribArray(a.attribute(this.attributeName))}}]);return b}()},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return u});c.d(e,"b",function(){return p});n=c(18);c=c(0);var a=function h(a,b,c){null===a&&(a=Function.prototype);
var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return h(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},b=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}();$jscomp.initSymbol();var l=Symbol("SingleTextureVolumeChunk.textureUnit");
$jscomp.initSymbol();var w=Symbol("SingleTextureVolumeChunk.textureLayout"),u=function(a){function c(a){q(this,c);var b=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));b.shaderKey=a;return b}r(c,a);b(c,[{key:"defineShader",value:function(a){a.addTextureSampler2D("uVolumeChunkSampler",l)}},{key:"beginDrawing",value:function(a,b){var c=b.textureUnit(l);a.activeTexture(a.TEXTURE0+c);b[w]=null}},{key:"endDrawing",value:function(a,b){a.bindTexture(a.TEXTURE_2D,null);b[w]=null}},{key:"bindChunk",
value:function(a,b,c){var d=c.textureLayout;b[w]!==d&&(b[w]=d,this.setupTextureLayout(a,b,d));a.bindTexture(a.TEXTURE_2D,c.texture)}},{key:"beginSource",value:function(a,b){}}]);return c}(c.a),p=function(c){function e(a,b){q(this,e);a=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a,b));a.texture=null;a.data=b.data;return a}r(e,c);b(e,[{key:"copyToGPU",value:function(b){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"copyToGPU",this).call(this,b);var c=this.texture=b.createTexture();
b.bindTexture(b.TEXTURE_2D,c);this.setTextureData(b);b.bindTexture(b.TEXTURE_2D,null)}},{key:"freeGPUMemory",value:function(b){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"freeGPUMemory",this).call(this,b);b.deleteTexture(this.texture);this.texture=null;this.textureLayout.dispose();this.textureLayout=null}}]);return e}(n.a)},function(n,e,c){e.a=function(c,e,r,a,b,l){for(var m=0,u=0,p=1,k=1,h=0;3>h;++h){var g=b[h],d=a[h],f=g%d;m+=Math.floor(g/d)*p;p*=Math.ceil(r[h]/d);u+=f*k;k*=d}a=
e+2*m;r=c[a];a=c[a+1];b=r&16777215;r=r>>24&255;0<r&&(b+=l*(c[(e+a&16777215)+Math.floor(u*r/32)]>>u*r%32&(1<<r)-1));return b}},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,
enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function a(a,b){b=void 0===b?a.navigationState:new f.e(new f.g(a.navigationState.pose.position,f.f.makeRelative(a.navigationState.pose.orientation,b)),a.navigationState.zoomFactor);return new y.a(a.chunkManager,a.layerManager,b)}function b(b){return new Map([["xy",a(b,K.get("xy"))],["xz",a(b,
K.get("xz"))],["yz",a(b,K.get("yz"))]])}function l(a){return{mouseState:a.mouseState,layerManager:a.layerManager,showAxisLines:a.showAxisLines,visibility:a.visibility,editorState:a.editorState}}function w(a){return Object.assign({},l(a),{navigationState:a.perspectiveNavigationState,inputEventMap:a.inputEventBindings.perspectiveView})}function u(a){return Object.assign({},l(a),{navigationState:a.navigationState,inputEventMap:a.inputEventBindings.sliceView})}function p(a,b,c){for(var d={},f=0;2>f;d=
{relatedLayout:d.relatedLayout},++f)d.relatedLayout=c[Math.min(c.length-1,f)],a.registerDisposer(Object(D.c)(b.element,0===f?"toggle-layout":"toggle-layout-alternative",function(b){return function(c){a.container.name=b.relatedLayout;c.stopPropagation()}}(d)))}function k(a){var b=W.get(a);if(void 0===b)throw Error("Invalid layout name: "+JSON.stringify(a)+".");return b}function h(a){k(a);return a}c.d(e,"b",function(){return H});c.d(e,"a",function(){return M});n=c(13);var g=c.n(n),d=c(211),f=c(43),
v=c(213),y=c(35),G=c(51),E=c(42),B=c(4);n=c(0);var z=c(5),D=c(15);e=c(1);var x=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),C=function aa(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return aa(a,b,c)}else{if("value"in
d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};c(44);var H=function ha(){r(this,ha);this.perspectiveView=new D.a;this.sliceView=new D.a},K=new Map([["xy",void 0],["xz",e.l.rotateX(e.l.create(),e.l.create(),Math.PI/2)],["yz",e.l.rotateY(e.l.create(),e.l.create(),Math.PI/2)]]),F=function(a){function c(a,f,e){r(this,c);var g=q(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));g.container=a;g.rootElement=f;g.viewer=e;var h=b(e),k=e.display,l=Object.assign({},w(e),{showSliceViews:e.showPerspectiveSliceViews,
showSliceViewsCheckbox:!0}),m=Object.assign({},u(e),{showScaleBar:e.showScaleBar}),x=Object.assign({},u(e),{showScaleBar:new E.a(!1,!1)}),n=function(a,b,c){b=g.registerDisposer(new G.a(k,b,h.get(a),c));p(g,b,[a,a+"-3d"]);return b};a=[d.b(1,d.a("column",[d.b(1,d.a("row",[d.b(1,function(a){n("xy",a,m)}),d.b(1,function(a){n("xz",a,x)})])),d.b(1,d.a("row",[d.b(1,function(a){a=g.registerDisposer(new v.a(k,a,l));for(var b=$jscomp.makeIterator(h.values()),c=b.next();!c.done;c=b.next())a.sliceViews.add(c.value.addRef());
p(g,a,["3d"])}),d.b(1,function(a){n("yz",a,x)})]))]))];d.a("row",a)(f);k.onResize();return g}m(c,a);x(c,[{key:"disposed",value:function(){Object(z.a)(this.rootElement);C(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}}]);return c}(n.a),T=function(b){function c(b,f,e,g,h){r(this,c);var k=q(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));k.container=b;k.rootElement=f;k.viewer=e;k.direction=g;var l=a(e,K.get(h)),m=e.display,x=Object.assign({},w(e),{showSliceViews:e.showPerspectiveSliceViews,
showSliceViewsCheckbox:!0}),n=Object.assign({},u(e),{showScaleBar:e.showScaleBar});d.b(1,d.a(g,[d.b(1,function(a){a=k.registerDisposer(new G.a(m,a,l,n));p(k,a,[h,"4panel"])}),d.b(1,function(a){a=k.registerDisposer(new v.a(m,a,x));a.sliceViews.add(l.addRef());p(k,a,["3d","4panel"])})]))(f);m.onResize();return k}m(c,b);x(c,[{key:"disposed",value:function(){Object(z.a)(this.rootElement);C(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}}]);return c}(n.a),J=function(b){function c(b,
f,e,g){r(this,c);var h=q(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));h.container=b;h.rootElement=f;h.viewer=e;var k=a(e,K.get(g)),l=Object.assign({},u(e),{showScaleBar:e.showScaleBar});d.a("row",[d.b(1,function(a){a=h.registerDisposer(new G.a(e.display,a,k,l));p(h,a,["4panel",g+"-3d"])})])(f);e.display.onResize();return h}m(c,b);x(c,[{key:"disposed",value:function(){Object(z.a)(this.rootElement);C(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}}]);
return c}(n.a),R=function(a){function b(a,c,f){r(this,b);var e=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));e.container=a;e.rootElement=c;e.viewer=f;var g=Object.assign({},w(f),{showSliceViews:new E.a(!1,!1)});d.a("row",[d.b(1,function(a){a=e.registerDisposer(new v.a(f.display,a,g));p(e,a,["4panel"])})])(c);f.display.onResize();return e}m(b,a);x(b,[{key:"disposed",value:function(){Object(z.a)(this.rootElement);C(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"disposed",this).call(this)}}]);
return b}(n.a),W=new Map([["4panel",{factory:function(a,b,c){return new F(a,b,c)}}],["3d",{factory:function(a,b,c){return new R(a,b,c)}}]]);c={};e=$jscomp.makeIterator(K.keys());for(var V=e.next();!V.done;c={axes:c.axes},V=e.next())c.axes=V.value,W.set(c.axes,{factory:function(a){return function(b,c,d){return new J(b,c,d,a.axes)}}(c)}),W.set(c.axes+"-3d",{factory:function(a){return function(b,c,d){return new T(b,c,d,"row",a.axes)}}(c)});var M=function(a){function b(a,c){c=void 0===c?"xy":c;r(this,
b);var d=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));d.viewer=a;d.element=document.createElement("div");d.element.style.flex="1";d.layoutName=new B.a(c,h);var f=d.registerCancellable(g()(function(){return d.updateLayout()},0));d.layoutName.changed.add(f);d.registerDisposer(d.viewer.display.updateStarted.add(function(){return f.flush()}));f();return d}m(b,a);x(b,[{key:"toJSON",value:function(){return this.layoutName.toJSON()}},{key:"restoreState",value:function(a){this.layoutName.restoreState(a)}},
{key:"reset",value:function(){this.layoutName.reset()}},{key:"disposeLayout",value:function(){var a=this.layout;void 0!==a&&(a.dispose(),this.layout=void 0)}},{key:"updateLayout",value:function(){this.disposeLayout();this.layout=k(this.layoutName.value).factory(this,this.element,this.viewer)}},{key:"disposed",value:function(){this.disposeLayout();C(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"disposed",this).call(this)}},{key:"name",get:function(){return this.layoutName.value},set:function(a){this.layoutName.value=
a}},{key:"changed",get:function(){return this.layoutName.changed}}]);return b}(n.a)},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});
b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return k});var r=c(9);n=c(29);var a=c(8),b=c(14),l=c(108),w=c(217),u=c(222),p=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}();c(223);var k=function(c){function e(a,b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");
var c=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));c.manager=a;c.existingLayer=b;c.statusElement=document.createElement("div");c.submitElement=document.createElement("button");c.namePromptElement=document.createElement("label");c.nameInputElement=document.createElement("input");c.volumeCancellationSource=void 0;c.sourceValid=!1;c.nameValid=!0;var d=c.content;d.classList.add("add-layer-overlay");var f=document.createElement("form");f.className="source-form";c.registerEventListener(f,
"submit",function(a){a.preventDefault();c.validateSource(!0)});var g=document.createElement("label");g.textContent="Source:";a=c.sourceInput=c.registerDisposer(new w.a({completer:function(a,b){return c.manager.dataSourceProvider.volumeCompleter(a,c.manager.chunkManager,b).then(function(a){return{completions:a.completions,makeElement:w.b,offset:a.offset,showSingleResult:!0}})},delay:0}));a.element.classList.add("add-layer-source");a.inputElement.addEventListener("blur",function(){c.validateSource(!1)});
c.submitElement.disabled=!0;a.inputChanged.add(function(){var a=c.volumeCancellationSource;void 0!==a&&(a.cancel(),c.volumeCancellationSource=void 0);c.sourceValid=!1;c.submitElement.disabled=!0;c.statusElement.textContent=""});f.appendChild(g);f.appendChild(a.element);Object(l.a)(g,a.inputElement);g=Object(u.a)();f.appendChild(g);d.appendChild(f);var h=c.statusElement,k=c.namePromptElement,p=c.nameInputElement;f=c.submitElement;h.className="dialog-status";g=document.createElement("form");g.className=
"name-form";k.textContent="Name:";p.className="add-layer-name";p.autocomplete="off";p.spellcheck=!1;p.type="text";c.registerEventListener(p,"input",function(){c.validateName()});f.type="submit";Object(l.a)(k,p);g.appendChild(k);g.appendChild(p);g.appendChild(f);d.appendChild(g);d.appendChild(h);void 0!==b?(void 0!==b.sourceUrl?(a.value=b.sourceUrl,c.validateSource()):c.sourceValid=!0,a.disabled=!0,p.value=b.name,c.validateName(),f.textContent="Save",p.focus()):(b=c.manager.layerManager.managedLayers,
0<b.length&&(b=b[b.length-1],b instanceof r.b&&(b=b.sourceUrl,void 0!==b&&(d=c.manager.dataSourceProvider.findSourceGroup(b),a.value=b.substring(0,d),a.inputElement.setSelectionRange(0,d)))),a.inputElement.focus(),f.textContent="Add Layer");c.registerEventListener(g,"submit",function(a){a.preventDefault();c.submit()});return c}m(e,c);p(e,[{key:"isNameValid",value:function(){var a=this.nameInputElement.value;if(""===a)return!1;a=this.manager.layerManager.getLayerByName(a);return void 0===a||a===this.existingLayer}},
{key:"submit",value:function(){this.sourceValid&&this.isNameValid()&&(this.existingLayer?(this.existingLayer.name=this.nameInputElement.value,this.manager.layerManager.layersChanged.dispatch()):this.manager.add(this.manager.getLayer(this.nameInputElement.value,this.sourceInput.value)),this.dispose())}},{key:"validateName",value:function(){var a=this.nameInputElement;(this.nameValid=this.isNameValid())?(a.classList.add("valid-input"),a.classList.remove("invalid-input")):(a.classList.remove("valid-input"),
a.classList.add("invalid-input"));this.validityChanged()}},{key:"validityChanged",value:function(){this.submitElement.disabled=!(this.nameValid&&this.sourceValid)}},{key:"validateSource",value:function(c){var d=this;c=void 0===c?!1:c;var e=this.sourceInput.value;if(""!==e){try{var g=this.manager.dataSourceProvider.suggestLayerName(e),h=this.nameInputElement;if(""===this.nameInputElement.value){var k=this.manager.layerManager.getUniqueLayerName(g);h.value=k;h.setSelectionRange(0,k.length);this.validateName()}c&&
h.focus()}catch(z){this.setError(z.message);return}this.setInfo("Validating volume source...");var l=this.volumeCancellationSource=new b.b;this.manager.dataSourceProvider.getVolume(this.manager.chunkManager,e,void 0,l).then(function(b){l.isCanceled||(d.volumeCancellationSource=void 0,d.sourceValid=!0,d.setInfo(a.d[b.volumeType].toLowerCase()+": "+(b.numChannels+"-channel "+a.a[b.dataType].toLowerCase())),d.validityChanged())}).catch(function(a){l.isCanceled||(d.volumeCancellationSource=void 0,d.setError(a.message))})}}},
{key:"setInfo",value:function(a){this.statusElement.className="dialog-status dialog-status-info";this.statusElement.textContent=a}},{key:"setError",value:function(a){this.statusElement.className="dialog-status dialog-status-error";this.statusElement.textContent=a}}]);return e}(n.a)},function(n,e,c){e.a=function(c,e){""===e.id&&(e.id="unique-id-for-association-"+q++);c.setAttribute("for",e.id)};var q=0},function(n,e,c){e.a=function(c){var e=-1;return Object.assign(function(){-1===e&&(e=requestAnimationFrame(function(){e=
-1;c()}))},{flush:function(){-1!==e&&(e=-1,c())},cancel:function(){-1!==e&&(cancelAnimationFrame(e),e=-1)}})}},function(n,e,c){e.a=function(c){if(!window.getSelection().isCollapsed)return!0;c=c.target.tagName;return"TEXTAREA"===c||"INPUT"===c?!0:!1};e.b=function(c,e){e=void 0===e?"text/plain":e;var a=!1,b=Object(q.c)(document,"copy",function(b){b.clipboardData.setData(e,c);a=!0;b.stopPropagation();b.preventDefault()},!0);try{document.execCommand("copy")}finally{b()}return a};var q=c(0)},function(n,
e,c){e.a=function(c,a){var b=Object(q.c)(c,"drop",function(b){b.preventDefault();if(-1!==b.dataTransfer.types.indexOf(m.d)){var c=JSON.parse(b.dataTransfer.getData(m.d));a.restoreState(c);b.stopPropagation()}}),e=Object(q.c)(c,"dragover",function(a){-1!==a.dataTransfer.types.indexOf(m.d)&&(a.dataTransfer.dropEffect="link",a.preventDefault(),a.stopPropagation())});return function(){e();b()}};var q=c(0),m=c(67)},function(n,e,c){c(68);c(147);c(151);c(41);c(152);c(88);c(154);c(89);c(156);c(91);c(157);
c(92);c(159);c(93);c(161);c(162);c(163);c(164);c(173);c(177);c(190);c(194);n.exports=c(201)},function(n,e,c){c(16)},function(n,e,c){c(16)},function(n,e,c){function q(a,b,c){var e=b[0],l=b[1],p=b[2],k=b[3],h=b[4],g=b[5],d=b[6],f=b[7],v=b[8],m=b[9],q=b[10],r=b[11],n=b[12],z=b[13],D=b[14];b=b[15];var x=c[0],C=c[1],H=c[2],K=c[3];a[0]=x*e+C*h+H*v+K*n;a[1]=x*l+C*g+H*m+K*z;a[2]=x*p+C*d+H*q+K*D;a[3]=x*k+C*f+H*r+K*b;x=c[4];C=c[5];H=c[6];K=c[7];a[4]=x*e+C*h+H*v+K*n;a[5]=x*l+C*g+H*m+K*z;a[6]=x*p+C*d+H*q+K*D;
a[7]=x*k+C*f+H*r+K*b;x=c[8];C=c[9];H=c[10];K=c[11];a[8]=x*e+C*h+H*v+K*n;a[9]=x*l+C*g+H*m+K*z;a[10]=x*p+C*d+H*q+K*D;a[11]=x*k+C*f+H*r+K*b;x=c[12];C=c[13];H=c[14];K=c[15];a[12]=x*e+C*h+H*v+K*n;a[13]=x*l+C*g+H*m+K*z;a[14]=x*p+C*d+H*q+K*D;a[15]=x*k+C*f+H*r+K*b;return a}function m(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];a[7]=b[7]-c[7];a[8]=b[8]-c[8];a[9]=b[9]-c[9];a[10]=b[10]-c[10];a[11]=b[11]-c[11];a[12]=b[12]-c[12];a[13]=b[13]-c[13];
a[14]=b[14]-c[14];a[15]=b[15]-c[15];return a}Object.defineProperty(e,"__esModule",{value:!0});e.create=function(){var a=new r.a(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};e.clone=function(a){var b=new r.a(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};e.copy=function(a,b){a[0]=
b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};e.fromValues=function(a,b,c,e,u,p,k,h,g,d,f,m,q,n,E,B){var l=new r.a(16);l[0]=a;l[1]=b;l[2]=c;l[3]=e;l[4]=u;l[5]=p;l[6]=k;l[7]=h;l[8]=g;l[9]=d;l[10]=f;l[11]=m;l[12]=q;l[13]=n;l[14]=E;l[15]=B;return l};e.set=function(a,b,c,e,u,p,k,h,g,d,f,m,q,r,n,B,z){a[0]=b;a[1]=c;a[2]=e;a[3]=u;a[4]=p;a[5]=k;a[6]=h;a[7]=g;a[8]=d;a[9]=f;a[10]=
m;a[11]=q;a[12]=r;a[13]=n;a[14]=B;a[15]=z;return a};e.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};e.transpose=function(a,b){if(a===b){var c=b[1],e=b[2],u=b[3],p=b[6],k=b[7],h=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=e;a[9]=p;a[11]=b[14];a[12]=u;a[13]=k;a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],
a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};e.invert=function(a,b){var c=b[0],e=b[1],u=b[2],p=b[3],k=b[4],h=b[5],g=b[6],d=b[7],f=b[8],m=b[9],q=b[10],r=b[11],n=b[12],B=b[13],z=b[14];b=b[15];var D=c*h-e*k,x=c*g-u*k,C=c*d-p*k,H=e*g-u*h,K=e*d-p*h,F=u*d-p*g,T=f*B-m*n,J=f*z-q*n,R=f*b-r*n,W=m*z-q*B,V=m*b-r*B,M=q*b-r*z,Q=D*M-x*V+C*W+H*R-K*J+F*T;if(!Q)return null;Q=1/Q;a[0]=(h*M-g*V+d*W)*Q;a[1]=(u*V-e*M-p*W)*Q;a[2]=(B*F-z*K+b*H)*Q;a[3]=(q*K-m*F-r*H)*Q;a[4]=(g*R-k*M-d*J)*
Q;a[5]=(c*M-u*R+p*J)*Q;a[6]=(z*C-n*F-b*x)*Q;a[7]=(f*F-q*C+r*x)*Q;a[8]=(k*V-h*R+d*T)*Q;a[9]=(e*R-c*V-p*T)*Q;a[10]=(n*K-B*C+b*D)*Q;a[11]=(m*C-f*K-r*D)*Q;a[12]=(h*J-k*W-g*T)*Q;a[13]=(c*W-e*J+u*T)*Q;a[14]=(B*x-n*H-z*D)*Q;a[15]=(f*H-m*x+q*D)*Q;return a};e.adjoint=function(a,b){var c=b[0],e=b[1],u=b[2],p=b[3],k=b[4],h=b[5],g=b[6],d=b[7],f=b[8],m=b[9],q=b[10],r=b[11],n=b[12],B=b[13],z=b[14];b=b[15];a[0]=h*(q*b-r*z)-m*(g*b-d*z)+B*(g*r-d*q);a[1]=-(e*(q*b-r*z)-m*(u*b-p*z)+B*(u*r-p*q));a[2]=e*(g*b-d*z)-h*(u*
b-p*z)+B*(u*d-p*g);a[3]=-(e*(g*r-d*q)-h*(u*r-p*q)+m*(u*d-p*g));a[4]=-(k*(q*b-r*z)-f*(g*b-d*z)+n*(g*r-d*q));a[5]=c*(q*b-r*z)-f*(u*b-p*z)+n*(u*r-p*q);a[6]=-(c*(g*b-d*z)-k*(u*b-p*z)+n*(u*d-p*g));a[7]=c*(g*r-d*q)-k*(u*r-p*q)+f*(u*d-p*g);a[8]=k*(m*b-r*B)-f*(h*b-d*B)+n*(h*r-d*m);a[9]=-(c*(m*b-r*B)-f*(e*b-p*B)+n*(e*r-p*m));a[10]=c*(h*b-d*B)-k*(e*b-p*B)+n*(e*d-p*h);a[11]=-(c*(h*r-d*m)-k*(e*r-p*m)+f*(e*d-p*h));a[12]=-(k*(m*z-q*B)-f*(h*z-g*B)+n*(h*q-g*m));a[13]=c*(m*z-q*B)-f*(e*z-u*B)+n*(e*q-u*m);a[14]=-(c*
(h*z-g*B)-k*(e*z-u*B)+n*(e*g-u*h));a[15]=c*(h*q-g*m)-k*(e*q-u*m)+f*(e*g-u*h);return a};e.determinant=function(a){var b=a[0],c=a[1],e=a[2],m=a[3],p=a[4],k=a[5],h=a[6],g=a[7],d=a[8],f=a[9],v=a[10],q=a[11],r=a[12],n=a[13],B=a[14];a=a[15];return(b*k-c*p)*(v*a-q*B)-(b*h-e*p)*(f*a-q*n)+(b*g-m*p)*(f*B-v*n)+(c*h-e*k)*(d*a-q*r)-(c*g-m*k)*(d*B-v*r)+(e*g-m*h)*(d*n-f*r)};e.multiply=q;e.translate=function(a,b,c){var e=c[0],l=c[1];c=c[2];if(b===a)a[12]=b[0]*e+b[4]*l+b[8]*c+b[12],a[13]=b[1]*e+b[5]*l+b[9]*c+b[13],
a[14]=b[2]*e+b[6]*l+b[10]*c+b[14],a[15]=b[3]*e+b[7]*l+b[11]*c+b[15];else{var p=b[0];var k=b[1];var h=b[2];var g=b[3];var d=b[4];var f=b[5];var m=b[6];var q=b[7];var r=b[8];var n=b[9];var B=b[10];var z=b[11];a[0]=p;a[1]=k;a[2]=h;a[3]=g;a[4]=d;a[5]=f;a[6]=m;a[7]=q;a[8]=r;a[9]=n;a[10]=B;a[11]=z;a[12]=p*e+d*l+r*c+b[12];a[13]=k*e+f*l+n*c+b[13];a[14]=h*e+m*l+B*c+b[14];a[15]=g*e+q*l+z*c+b[15]}return a};e.scale=function(a,b,c){var e=c[0],l=c[1];c=c[2];a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=
b[4]*l;a[5]=b[5]*l;a[6]=b[6]*l;a[7]=b[7]*l;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};e.rotate=function(a,b,c,e){var l=e[0],p=e[1];e=e[2];var k=Math.sqrt(l*l+p*p+e*e);if(Math.abs(k)<r.b)return null;k=1/k;l*=k;p*=k;e*=k;var h=Math.sin(c);var g=Math.cos(c);var d=1-g;c=b[0];k=b[1];var f=b[2];var m=b[3];var q=b[4];var n=b[5];var w=b[6];var B=b[7];var z=b[8];var D=b[9];var x=b[10];var C=b[11];var H=l*l*d+g;var K=p*l*d+e*h;var F=e*l*d-p*
h;var T=l*p*d-e*h;var J=p*p*d+g;var R=e*p*d+l*h;var W=l*e*d+p*h;l=p*e*d-l*h;p=e*e*d+g;a[0]=c*H+q*K+z*F;a[1]=k*H+n*K+D*F;a[2]=f*H+w*K+x*F;a[3]=m*H+B*K+C*F;a[4]=c*T+q*J+z*R;a[5]=k*T+n*J+D*R;a[6]=f*T+w*J+x*R;a[7]=m*T+B*J+C*R;a[8]=c*W+q*l+z*p;a[9]=k*W+n*l+D*p;a[10]=f*W+w*l+x*p;a[11]=m*W+B*l+C*p;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a};e.rotateX=function(a,b,c){var e=Math.sin(c);c=Math.cos(c);var l=b[4],p=b[5],k=b[6],h=b[7],g=b[8],d=b[9],f=b[10],m=b[11];b!==a&&(a[0]=b[0],a[1]=
b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=l*c+g*e;a[5]=p*c+d*e;a[6]=k*c+f*e;a[7]=h*c+m*e;a[8]=g*c-l*e;a[9]=d*c-p*e;a[10]=f*c-k*e;a[11]=m*c-h*e;return a};e.rotateY=function(a,b,c){var e=Math.sin(c);c=Math.cos(c);var l=b[0],p=b[1],k=b[2],h=b[3],g=b[8],d=b[9],f=b[10],m=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=l*c-g*e;a[1]=p*c-d*e;a[2]=k*c-f*e;a[3]=h*c-m*e;a[8]=l*e+g*c;a[9]=p*e+d*c;a[10]=k*e+f*c;a[11]=
h*e+m*c;return a};e.rotateZ=function(a,b,c){var e=Math.sin(c);c=Math.cos(c);var l=b[0],p=b[1],k=b[2],h=b[3],g=b[4],d=b[5],f=b[6],m=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=l*c+g*e;a[1]=p*c+d*e;a[2]=k*c+f*e;a[3]=h*c+m*e;a[4]=g*c-l*e;a[5]=d*c-p*e;a[6]=f*c-k*e;a[7]=m*c-h*e;return a};e.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];
a[15]=1;return a};e.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};e.fromRotation=function(a,b,c){var e=c[0],l=c[1];c=c[2];var p=Math.sqrt(e*e+l*l+c*c);if(Math.abs(p)<r.b)return null;p=1/p;e*=p;l*=p;c*=p;p=Math.sin(b);b=Math.cos(b);var k=1-b;a[0]=e*e*k+b;a[1]=l*e*k+c*p;a[2]=c*e*k-l*p;a[3]=0;a[4]=e*l*k-c*p;a[5]=l*l*k+b;a[6]=c*l*k+e*p;a[7]=0;a[8]=e*c*k+l*p;a[9]=l*c*k-e*p;a[10]=c*c*k+b;
a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};e.fromXRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=c;a[7]=0;a[8]=0;a[9]=-c;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};e.fromYRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=0;a[2]=-c;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=c;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};e.fromZRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;
a[1]=c;a[2]=0;a[3]=0;a[4]=-c;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};e.fromRotationTranslation=function(a,b,c){var e=b[0],l=b[1],p=b[2],k=b[3],h=e+e,g=l+l,d=p+p;b=e*h;var f=e*g;e*=d;var m=l*g;l*=d;p*=d;h*=k;g*=k;k*=d;a[0]=1-(m+p);a[1]=f+k;a[2]=e-g;a[3]=0;a[4]=f-k;a[5]=1-(b+p);a[6]=l+h;a[7]=0;a[8]=e+g;a[9]=l-h;a[10]=1-(b+m);a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};e.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];
return a};e.getScaling=function(a,b){var c=b[0],e=b[1],m=b[2],p=b[4],k=b[5],h=b[6],g=b[8],d=b[9];b=b[10];a[0]=Math.sqrt(c*c+e*e+m*m);a[1]=Math.sqrt(p*p+k*k+h*h);a[2]=Math.sqrt(g*g+d*d+b*b);return a};e.getRotation=function(a,b){var c=b[0]+b[5]+b[10];0<c?(c=2*Math.sqrt(c+1),a[3]=.25*c,a[0]=(b[6]-b[9])/c,a[1]=(b[8]-b[2])/c,a[2]=(b[1]-b[4])/c):b[0]>b[5]&b[0]>b[10]?(c=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/c,a[0]=.25*c,a[1]=(b[1]+b[4])/c,a[2]=(b[8]+b[2])/c):b[5]>b[10]?(c=2*Math.sqrt(1+b[5]-b[0]-
b[10]),a[3]=(b[8]-b[2])/c,a[0]=(b[1]+b[4])/c,a[1]=.25*c,a[2]=(b[6]+b[9])/c):(c=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/c,a[0]=(b[8]+b[2])/c,a[1]=(b[6]+b[9])/c,a[2]=.25*c);return a};e.fromRotationTranslationScale=function(a,b,c,e){var l=b[0],p=b[1],k=b[2],h=b[3],g=l+l,d=p+p,f=k+k;b=l*g;var m=l*d;l*=f;var q=p*d;p*=f;k*=f;g*=h;d*=h;h*=f;f=e[0];var r=e[1];e=e[2];a[0]=(1-(q+k))*f;a[1]=(m+h)*f;a[2]=(l-d)*f;a[3]=0;a[4]=(m-h)*r;a[5]=(1-(b+k))*r;a[6]=(p+g)*r;a[7]=0;a[8]=(l+d)*e;a[9]=(p-g)*e;a[10]=
(1-(b+q))*e;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};e.fromRotationTranslationScaleOrigin=function(a,b,c,e,m){var l=b[0],k=b[1],h=b[2],g=b[3],d=l+l,f=k+k,q=h+h;b=l*d;var u=l*f;l*=q;var r=k*f;k*=q;h*=q;d*=g;f*=g;g*=q;q=e[0];var n=e[1];e=e[2];var w=m[0],z=m[1];m=m[2];a[0]=(1-(r+h))*q;a[1]=(u+g)*q;a[2]=(l-f)*q;a[3]=0;a[4]=(u-g)*n;a[5]=(1-(b+h))*n;a[6]=(k+d)*n;a[7]=0;a[8]=(l+f)*e;a[9]=(k-d)*e;a[10]=(1-(b+r))*e;a[11]=0;a[12]=c[0]+w-(a[0]*w+a[4]*z+a[8]*m);a[13]=c[1]+z-(a[1]*w+a[5]*z+a[9]*
m);a[14]=c[2]+m-(a[2]*w+a[6]*z+a[10]*m);a[15]=1;return a};e.fromQuat=function(a,b){var c=b[0],e=b[1],m=b[2];b=b[3];var p=c+c,k=e+e,h=m+m;c*=p;var g=e*p;e*=k;var d=m*p,f=m*k;m*=h;p*=b;k*=b;b*=h;a[0]=1-e-m;a[1]=g+b;a[2]=d-k;a[3]=0;a[4]=g-b;a[5]=1-c-m;a[6]=f+p;a[7]=0;a[8]=d+k;a[9]=f-p;a[10]=1-c-e;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};e.frustum=function(a,b,c,e,m,p,k){var h=1/(c-b),g=1/(m-e),d=1/(p-k);a[0]=2*p*h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*p*g;a[6]=0;a[7]=0;a[8]=(c+b)*h;a[9]=(m+e)*
g;a[10]=(k+p)*d;a[11]=-1;a[12]=0;a[13]=0;a[14]=k*p*2*d;a[15]=0;return a};e.perspective=function(a,b,c,e,m){b=1/Math.tan(b/2);var l=1/(e-m);a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(m+e)*l;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*m*e*l;a[15]=0;return a};e.perspectiveFromFieldOfView=function(a,b,c,e){var l=Math.tan(b.upDegrees*Math.PI/180),p=Math.tan(b.downDegrees*Math.PI/180),k=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*Math.PI/180);var h=2/(k+b),g=2/
(l+p);a[0]=h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=g;a[6]=0;a[7]=0;a[8]=-((k-b)*h*.5);a[9]=(l-p)*g*.5;a[10]=e/(c-e);a[11]=-1;a[12]=0;a[13]=0;a[14]=e*c/(c-e);a[15]=0;return a};e.ortho=function(a,b,c,e,m,p,k){var h=1/(b-c),g=1/(e-m),d=1/(p-k);a[0]=-2*h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*g;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*d;a[11]=0;a[12]=(b+c)*h;a[13]=(m+e)*g;a[14]=(k+p)*d;a[15]=1;return a};e.lookAt=function(a,b,c,e){var l=b[0],p=b[1];b=b[2];var k=e[0];var h=e[1];var g=e[2];var d=c[0];e=c[1];var f=c[2];
if(Math.abs(l-d)<r.b&&Math.abs(p-e)<r.b&&Math.abs(b-f)<r.b)return mat4.identity(a);c=l-d;e=p-e;d=b-f;var m=1/Math.sqrt(c*c+e*e+d*d);c*=m;e*=m;d*=m;f=h*d-g*e;g=g*c-k*d;k=k*e-h*c;(m=Math.sqrt(f*f+g*g+k*k))?(m=1/m,f*=m,g*=m,k*=m):k=g=f=0;h=e*k-d*g;var q=d*f-c*k;var n=c*g-e*f;(m=Math.sqrt(h*h+q*q+n*n))?(m=1/m,h*=m,q*=m,n*=m):n=q=h=0;a[0]=f;a[1]=h;a[2]=c;a[3]=0;a[4]=g;a[5]=q;a[6]=e;a[7]=0;a[8]=k;a[9]=n;a[10]=d;a[11]=0;a[12]=-(f*l+g*p+k*b);a[13]=-(h*l+q*p+n*b);a[14]=-(c*l+e*p+d*b);a[15]=1;return a};e.targetTo=
function(a,b,c,e){var l=b[0],p=b[1];b=b[2];var k=e[0],h=e[1],g=e[2];e=l-c[0];var d=p-c[1];c=b-c[2];var f=e*e+d*d+c*c;0<f&&(f=1/Math.sqrt(f),e*=f,d*=f,c*=f);f=h*c-g*d;g=g*e-k*c;k=k*d-h*e;a[0]=f;a[1]=g;a[2]=k;a[3]=0;a[4]=d*k-c*g;a[5]=c*f-e*k;a[6]=e*g-d*f;a[7]=0;a[8]=e;a[9]=d;a[10]=c;a[11]=0;a[12]=l;a[13]=p;a[14]=b;a[15]=1;return a};e.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+
", "+a[14]+", "+a[15]+")"};e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};e.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];a[9]=
b[9]+c[9];a[10]=b[10]+c[10];a[11]=b[11]+c[11];a[12]=b[12]+c[12];a[13]=b[13]+c[13];a[14]=b[14]+c[14];a[15]=b[15]+c[15];return a};e.subtract=m;e.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12]*c;a[13]=b[13]*c;a[14]=b[14]*c;a[15]=b[15]*c;return a};e.multiplyScalarAndAdd=function(a,b,c,e){a[0]=b[0]+c[0]*e;a[1]=b[1]+c[1]*e;a[2]=b[2]+c[2]*e;a[3]=b[3]+c[3]*e;a[4]=
b[4]+c[4]*e;a[5]=b[5]+c[5]*e;a[6]=b[6]+c[6]*e;a[7]=b[7]+c[7]*e;a[8]=b[8]+c[8]*e;a[9]=b[9]+c[9]*e;a[10]=b[10]+c[10]*e;a[11]=b[11]+c[11]*e;a[12]=b[12]+c[12]*e;a[13]=b[13]+c[13]*e;a[14]=b[14]+c[14]*e;a[15]=b[15]+c[15]*e;return a};e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};e.equals=function(a,
b){var c=a[0],e=a[1],m=a[2],p=a[3],k=a[4],h=a[5],g=a[6],d=a[7],f=a[8],q=a[9],n=a[10],G=a[11],E=a[12],B=a[13],z=a[14];a=a[15];var D=b[0],x=b[1],C=b[2],H=b[3],K=b[4],F=b[5],T=b[6],J=b[7],R=b[8],W=b[9],V=b[10],M=b[11],Q=b[12],aa=b[13],ha=b[14];b=b[15];return Math.abs(c-D)<=r.b*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(e-x)<=r.b*Math.max(1,Math.abs(e),Math.abs(x))&&Math.abs(m-C)<=r.b*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(p-H)<=r.b*Math.max(1,Math.abs(p),Math.abs(H))&&Math.abs(k-K)<=r.b*Math.max(1,
Math.abs(k),Math.abs(K))&&Math.abs(h-F)<=r.b*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(g-T)<=r.b*Math.max(1,Math.abs(g),Math.abs(T))&&Math.abs(d-J)<=r.b*Math.max(1,Math.abs(d),Math.abs(J))&&Math.abs(f-R)<=r.b*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(q-W)<=r.b*Math.max(1,Math.abs(q),Math.abs(W))&&Math.abs(n-V)<=r.b*Math.max(1,Math.abs(n),Math.abs(V))&&Math.abs(G-M)<=r.b*Math.max(1,Math.abs(G),Math.abs(M))&&Math.abs(E-Q)<=r.b*Math.max(1,Math.abs(E),Math.abs(Q))&&Math.abs(B-aa)<=r.b*Math.max(1,
Math.abs(B),Math.abs(aa))&&Math.abs(z-ha)<=r.b*Math.max(1,Math.abs(z),Math.abs(ha))&&Math.abs(a-b)<=r.b*Math.max(1,Math.abs(a),Math.abs(b))};var r=c(16);e.mul=q;e.sub=m},function(n,e,c){function q(){var a=new l.a(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}function m(a,b,c){c*=.5;var d=Math.sin(c);a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=Math.cos(c);return a}function r(a,b,c){var d=b[0],f=b[1],e=b[2];b=b[3];var g=c[0],h=c[1],k=c[2];c=c[3];a[0]=d*c+b*g+f*k-e*h;a[1]=f*c+b*h+e*g-d*k;a[2]=e*c+b*k+d*h-f*g;
a[3]=b*c-d*g-f*h-e*k;return a}function a(a,b,c,d){var f=b[0],e=b[1],g=b[2];b=b[3];var h=c[0],k=c[1],l=c[2];c=c[3];var p=f*h+e*k+g*l+b*c;0>p&&(p=-p,h=-h,k=-k,l=-l,c=-c);if(1E-6<1-p){var m=Math.acos(p);var q=Math.sin(m);p=Math.sin((1-d)*m)/q;d=Math.sin(d*m)/q}else p=1-d;a[0]=p*f+d*h;a[1]=p*e+d*k;a[2]=p*g+d*l;a[3]=p*b+d*c;return a}function b(a,b){var c=b[0]+b[4]+b[8];if(0<c)c=Math.sqrt(c+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{var d=0;b[4]>b[0]&&(d=1);b[8]>b[3*
d+d]&&(d=2);var f=(d+1)%3,e=(d+2)%3;c=Math.sqrt(b[3*d+d]-b[3*f+f]-b[3*e+e]+1);a[d]=.5*c;c=.5/c;a[3]=(b[3*f+e]-b[3*e+f])*c;a[f]=(b[3*f+d]+b[3*d+f])*c;a[e]=(b[3*e+d]+b[3*d+e])*c}return a}Object.defineProperty(e,"__esModule",{value:!0});e.create=q;e.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};e.setAxisAngle=m;e.getAxisAngle=function(a,b){var c=2*Math.acos(b[3]),d=Math.sin(c/2);0!=d?(a[0]=b[0]/d,a[1]=b[1]/d,a[2]=b[2]/d):(a[0]=1,a[1]=0,a[2]=0);return c};e.multiply=r;e.rotateX=function(a,
b,c){c*=.5;var d=b[0],f=b[1],e=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c+b*g;a[1]=f*c+e*g;a[2]=e*c-f*g;a[3]=b*c-d*g;return a};e.rotateY=function(a,b,c){c*=.5;var d=b[0],f=b[1],e=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c-e*g;a[1]=f*c+b*g;a[2]=e*c+d*g;a[3]=b*c-f*g;return a};e.rotateZ=function(a,b,c){c*=.5;var d=b[0],f=b[1],e=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c+f*g;a[1]=f*c-d*g;a[2]=e*c+b*g;a[3]=b*c-e*g;return a};e.calculateW=function(a,b){var c=b[0],d=b[1];b=b[2];
a[0]=c;a[1]=d;a[2]=b;a[3]=Math.sqrt(Math.abs(1-c*c-d*d-b*b));return a};e.slerp=a;e.invert=function(a,b){var c=b[0],d=b[1],f=b[2];b=b[3];var e=c*c+d*d+f*f+b*b;e=e?1/e:0;a[0]=-c*e;a[1]=-d*e;a[2]=-f*e;a[3]=b*e;return a};e.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a};e.fromMat3=b;e.fromEuler=function(a,b,c,d){var f=.5*Math.PI/180;b*=f;c*=f;d*=f;f=Math.sin(b);b=Math.cos(b);var e=Math.sin(c);c=Math.cos(c);var g=Math.sin(d);d=Math.cos(d);a[0]=f*c*d-b*e*g;a[1]=b*e*d+f*c*g;
a[2]=b*c*g-f*e*d;a[3]=b*c*d+f*e*g;return a};e.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};var l=c(16),w=c(70),u=c(71);n=c(72);e.clone=n.clone;e.fromValues=n.fromValues;e.copy=n.copy;e.set=n.set;e.add=n.add;e.mul=r;e.scale=n.scale;e.dot=n.dot;e.lerp=n.lerp;c=n.length;e.length=c;e.len=c;c=n.squaredLength;e.squaredLength=c;e.sqrLen=c;var p=n.normalize;e.normalize=p;e.exactEquals=n.exactEquals;e.equals=n.equals;n=function(){var a=u.create(),b=u.fromValues(1,0,0),c=u.fromValues(0,
1,0);return function(d,f,e){var g=u.dot(f,e);if(-.999999>g)return u.cross(a,b,f),1E-6>u.len(a)&&u.cross(a,c,f),u.normalize(a,a),m(d,a,Math.PI),d;if(.999999<g)return d[0]=0,d[1]=0,d[2]=0,d[3]=1,d;u.cross(a,f,e);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=1+g;return p(d,d)}}();e.rotationTo=n;n=function(){var b=q(),c=q();return function(e,d,f,h,k,l){a(b,d,k,l);a(c,f,h,l);a(e,b,c,2*l*(1-l));return e}}();e.sqlerp=n;n=function(){var a=w.create();return function(c,e,d,f){a[0]=d[0];a[3]=d[1];a[6]=d[2];a[1]=f[0];a[4]=
f[1];a[7]=f[2];a[2]=-e[0];a[5]=-e[1];a[8]=-e[2];return p(c,b(c,a))}}();e.setAxes=n},function(n,e,c){function q(){var c=new m.a(2);c[0]=0;c[1]=0;return c}var m=c(16);(function(){var c=q();return function(a,b,e,m,q,p){b||(b=2);e||(e=0);for(m=m?Math.min(m*b+e,a.length):a.length;e<m;e+=b)c[0]=a[e],c[1]=a[e+1],q(c,c,p),a[e]=c[0],a[e+1]=c[1];return a}})()},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);
a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function m(b,c){var e=b.memoize.get({type:"getSharedCredentialsProvider",credentialsProvider:Object(a.a)(c)},function(){return new r.a(c.addRef(),b.rpc)}),k=e.addCounterpartRef();e.dispose();return k}e.a=function(){return function(c){return function(c){function e(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];
if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var d;c=(d=e.__proto__||Object.getPrototypeOf(e)).call.apply(d,[].concat([this],$jscomp.arrayFromIterable(b)));if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");d=!c||"object"!==typeof c&&"function"!==typeof c?this:c;d.credentialsProvider=b[1].credentialsProvider.addRef();return d}q(e,c);b(e,[{key:"initializeCounterpart",value:function(a,b){b.credentialsProvider=m(this.chunkManager,
this.credentialsProvider);l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"initializeCounterpart",this).call(this,a,b)}}],[{key:"encodeOptions",value:function(b){var c=l(e.__proto__||Object.getPrototypeOf(e),"encodeOptions",this).call(this,b);c.credentialsProvider=Object(a.a)(b.credentialsProvider);return c}}]);return e}(c)}};var r=c(119),a=c(19),b=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=
!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),l=function u(a,b,c){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,b);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==a)return u(a,b,c)}else{if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(c)}}},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);
a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return r});n=c(120);c=c(6);var m=function(){function a(a,c){for(var b=0;b<c.length;b++){var e=c[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}();e=this&&this.__decorate||function(a,
b,c,e){var l=arguments.length,m=3>l?b:null===e?e=Object.getOwnPropertyDescriptor(b,c):e,k;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)m=Reflect.decorate(a,b,c,e);else for(var h=a.length-1;0<=h;h--)if(k=a[h])m=(3>l?k(m):3<l?k(b,c,m):k(b,c))||m;return 3<l&&m&&Object.defineProperty(b,c,m),m};var r=function(a){function b(a,c){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var e=(b.__proto__||Object.getPrototypeOf(b)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
e=!e||"object"!==typeof e&&"function"!==typeof e?this:e;e.provider=a;e.registerDisposer(a);e.initializeCounterpart(c);return e}q(b,a);m(b,[{key:"get",value:function(a,b){return this.provider.get(a,b)}}]);return b}(c.b);r=e([Object(c.g)(n.b)],r);Object(c.d)(n.a,function(a,b){return this.get(a.providerId).get(a.invalidCredentials,b).then(function(a){return{value:a}})})},function(n,e,c){e.b="CredentialsProvider";e.a="CredentialsProvider.get"},function(n,e,c){e.a=function(c){for(var e=0,q=c.length,a=
0;a<q;++a)e=31*e+c.charCodeAt(a)|0;return e}},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(e,"c",function(){return r});
c.d(e,"d",function(){return a});c.d(e,"a",function(){return b});c.d(e,"b",function(){return l});var r;(function(a){a[a.RAW=0]="RAW";a[a.JPEG=1]="JPEG";a[a.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION"})(r||(r={}));var a=function u(){m(this,u)};a.RPC_ID="brainmaps/VolumeChunkSource";var b=function p(){m(this,p)};b.RPC_ID="brainmaps/MeshSource";var l=function(a){function b(){m(this,b);var a=(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!a||"object"!==typeof a&&"function"!==typeof a?this:a}q(b,a);return b}(b);l.RPC_ID="brainmaps/SkeletonSource"},function(n,e,c){e.b="mesh/MeshLayer";e.a="mesh/FragmentSource"},function(n,e,c){var q=c(73);n.exports=function(){return q.Date.now()}},function(n,e,c){e=c(126);n.exports="object"==typeof e&&e&&e.Object===Object&&e},function(n,e){e=function(){return this}();try{e=e||Function("return this")()||(0,eval)("this")}catch(c){"object"===typeof window&&(e=window)}n.exports=e},function(n,e,c){var q=
c(50),m=c(128),r=0/0,a=/^\s+|\s+$/g,b=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,w=/^0o[0-7]+$/i,u=parseInt;n.exports=function(c){if("number"==typeof c)return c;if(m(c))return r;q(c)&&(c="function"==typeof c.valueOf?c.valueOf():c,c=q(c)?c+"":c);if("string"!=typeof c)return 0===c?c:+c;c=c.replace(a,"");var e=l.test(c);return e||w.test(c)?u(c.slice(2),e?2:8):b.test(c)?r:+c}},function(n,e,c){var q=c(129),m=c(132);n.exports=function(c){return"symbol"==typeof c||m(c)&&"[object Symbol]"==q(c)}},function(n,e,c){e=
c(74);var q=c(130),m=c(131),r=e?e.toStringTag:void 0;n.exports=function(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":r&&r in Object(a)?q(a):m(a)}},function(n,e,c){e=c(74);c=Object.prototype;var q=c.hasOwnProperty,m=c.toString,r=e?e.toStringTag:void 0;n.exports=function(a){var b=q.call(a,r),c=a[r];try{a[r]=void 0;var e=!0}catch(p){}var n=m.call(a);e&&(b?a[r]=c:delete a[r]);return n}},function(n,e){var c=Object.prototype.toString;n.exports=function(e){return c.call(e)}},function(n,
e){n.exports=function(c){return null!=c&&"object"==typeof c}},function(n,e,c){var q=c(13),m=c(50);n.exports=function(c,a,b){var e=!0,n=!0;if("function"!=typeof c)throw new TypeError("Expected a function");m(b)&&(e="leading"in b?!!b.leading:e,n="trailing"in b?!!b.trailing:n);return q(c,a,{leading:e,maxWait:a,trailing:n})}},function(n,e,c){function q(c){return void 0!==c.handleEditorAction}e.a=q;e.b=function(c){if(q(c))return c}},function(n,e,c){e.b=function(c,e){c.remove(e)};e.a=function(c,e){c.add(e)}},
function(n,e,c){e.b=function(c,e){return c.low+","+c.high+(e?"_"+e.center.toString()+"_"+e.size.toString():"")};e.a=function(c,e){var m=c.segmentEquivalences;c=$jscomp.makeIterator(c.visibleSegments);for(var a=c.next();!a.done;a=c.next())if(a=a.value,m.disjointSets.isMinElement(a))for(var b=$jscomp.makeIterator(m.setElements(a)),l=b.next();!l.done;l=b.next())e(l.value,a)}},function(n,e,c){c.d(e,"b",function(){return q});var q;(function(c){c[c.LITTLE=0]="LITTLE";c[c.BIG=1]="BIG"})(q||(q={}));n=function(){var c=
Uint16Array.of(4386);return 17===(new Uint8Array(c.buffer))[0]?q.BIG:q.LITTLE}();e.a=n},function(n,e,c){e.a="skeleton/SkeletonLayer"},function(n,e,c){e.a=function(c){var e={antialias:!1,stencil:!0};c=c.getContext("webgl",e)||c.getContext("experimental-webgl",e);if(null==c)throw Error("WebGL not supported.");c.memoize=new q.a;c.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE);c.maxTextureImageUnits=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS);c.tempTextureUnit=c.maxTextureImageUnits-1;c.WEBGL_draw_buffers=
c.getExtension("WEBGL_draw_buffers");if(!c.WEBGL_draw_buffers)throw Error("WEBGL_draw_buffers extension not available");c.ANGLE_instanced_arrays=c.getExtension("ANGLE_instanced_arrays");if(!c.ANGLE_instanced_arrays)throw Error("ANGLE_instanced_ararys extension not available");e=$jscomp.makeIterator(["OES_texture_float","OES_element_index_uint"]);for(var a=e.next();!a.done;a=e.next())if(a=a.value,!c.getExtension(a))throw Error(a+" extension not available");return c};var q=c(47)},function(n,e,c){var q=
function(){function c(c,a){for(var b=0;b<a.length;b++){var e=a[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(c,e.key,e)}}return function(e,a,b){a&&c(e.prototype,a);b&&c(e,b);return e}}();n=function(){function c(){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");}q(c,null,[{key:"insertAfter",value:function(c,a){var b=c.next0;a.next0=b;a.prev0=c;c.next0=a;b.prev0=a}},{key:"insertBefore",value:function(c,a){var b=
c.prev0;a.prev0=b;a.next0=c;c.prev0=a;b.next0=a}},{key:"front",value:function(c){var a=c.next0;return a===c?null:a}},{key:"back",value:function(c){var a=c.prev0;return a===c?null:a}},{key:"pop",value:function(c){var a=c.next0,b=c.prev0;a.prev0=b;b.next0=a;c.next0=null;c.prev0=null;return c}},{key:"iterator",value:function(c){function a(a,l){for(;;)switch(b){case 0:e=c.next0;case 1:if(e===c){b=3;break}b=4;return{value:e,done:!1};case 4:if(void 0===l){b=5;break}b=-1;throw l;case 5:case 2:e=e.next0;
b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,e,m={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();m[Symbol.iterator]=function(){return this};return m}},{key:"reverseIterator",value:function(c){function a(a,l){for(;;)switch(b){case 0:e=c.prev0;case 1:if(e===c){b=3;break}b=4;return{value:e,done:!1};case 4:if(void 0===l){b=5;break}b=-1;throw l;case 5:case 2:e=e.prev0;
b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,e,m={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();m[Symbol.iterator]=function(){return this};return m}},{key:"initializeHead",value:function(c){c.next0=c.prev0=c}}]);return c}();e.a=n},function(n,e,c){c.d(e,"a",function(){return m});var q=function(){function c(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=
e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,b,e){b&&c(a.prototype,b);e&&c(a,e);return a}}(),m=function(){function c(a){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this.parents=[];this.parentPriorities=[];this.bindings=new Map;if(void 0!==a){this.parents.push.apply(this.parents,[].concat($jscomp.arrayFromIterable(a.parents)));this.parentPriorities.push.apply(this.parentPriorities,[].concat($jscomp.arrayFromIterable(a.parentPriorities)));
a=$jscomp.makeIterator(a.bindings);for(var b=a.next();!b.done;b=a.next()){var e=$jscomp.makeIterator(b.value);b=e.next().value;e=e.next().value;this.bindings.set(b,e)}}}q(c,[{key:"addParent",value:function(a,b){for(var c=this,e=this.parents,m=this.parentPriorities,p=0,k=e.length;p<k&&b<m[p];)++p;e.splice(p,0,a);m.splice(p,0,b);return function(){c.removeParent(a)}}},{key:"removeParent",value:function(a){a=this.parents.indexOf(a);if(-1===a)throw Error("Attempt to remove non-existent parent map.");this.parents.splice(a,
1);this.parentPriorities.splice(a,1)}},{key:"set",value:function(a,b){this.bindings.set(a,b)}},{key:"delete",value:function(a){this.bindings.delete(a)}},{key:"clear",value:function(){this.bindings.clear();this.parents.length=0;this.parentPriorities.length=0}},{key:"get",value:function(a){for(var b=this.parents,c=this.parentPriorities,e=c.length,m=0,p;m<e&&0<c[m];++m)if(p=b[m].get(a),void 0!==p)return p;p=this.bindings.get(a);if(void 0!==p)return p;for(;m<e;++m)if(p=b[m].get(a),void 0!==p)return p}},
{key:"getAll",value:function(a){function b(b,f){for(;;)switch(c){case 0:g=d,h=g.parents,k=g.parentPriorities,p=k.length,m=0;case 1:if(!(m<p&&0<k[m])){c=2;break}e=h[m].get(a);if(void 0===e){c=3;break}c=4;return{value:e,done:!1};case 4:if(void 0===f){c=5;break}c=-1;throw f;case 5:case 3:c=1;break;case 2:e=d.bindings.get(a);if(void 0===e){c=6;break}c=7;return{value:e,done:!1};case 7:if(void 0===f){c=8;break}c=-1;throw f;case 8:case 6:case 9:if(!(m<p)){c=10;break}e=h[m].get(a);if(void 0===e){c=11;break}c=
12;return{value:e,done:!1};case 12:if(void 0===f){c=13;break}c=-1;throw f;case 13:case 11:c=9;break;case 10:c=-1;default:return{value:void 0,done:!0}}}var c=0,e,m,p,k,h,g,d=this,f={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();f[Symbol.iterator]=function(){return this};return f}}]);return c}()},function(n,e,c){e.a=function(c){var e=0;switch(c.deltaMode){case 0:e=.005;break;case 1:e=.1;
break;case 2:e=2}return Math.exp(c.deltaY*e)}},function(n,e){},function(n,e,c){c.d(e,"a",function(){return r});var q=c(1),m=function(){function a(a,c){for(var b=0;b<c.length;b++){var e=c[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),r=function(){function a(b,c){c=void 0===c?q.d:c;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.size=
q.p.clone(b);this.transform=q.j.clone(c);this.invTransform=q.j.invert(q.j.create(),c)}m(a,[{key:"toObject",value:function(a){a.size=this.size;a.transform=this.transform}},{key:"localSpatialToGlobal",value:function(a,c){return q.p.transformMat4(a,c,this.transform)}},{key:"globalToLocalSpatial",value:function(a,c){return q.p.transformMat4(a,c,this.invTransform)}},{key:"globalToLocalGrid",value:function(a,c){this.globalToLocalSpatial(a,c);q.p.divide(a,a,this.size);return a}},{key:"localSpatialVectorToGlobal",
value:function(a,c){return Object(q.n)(a,c,this.transform)}},{key:"globalToLocalSpatialVector",value:function(a,c){return Object(q.n)(a,c,this.invTransform)}},{key:"assignLocalSpatialToGlobalMat4",value:function(a){return q.j.copy(a,this.transform)}}],[{key:"get",value:function(b,c){c=void 0===c?q.d:c;var e=a.cache,l=JSON.stringify([Array.from(b),Array.from(c)]),m=e.get(l);void 0===m&&(m=new a(b,c),e.set(l,m));return m}},{key:"fromObject",value:function(b){return a.get(b.size,b.transform)}}]);return a}();
r.cache=new Map},function(n,e,c){e.a=function(c,e){return c===e?!0:1E-6>Math.abs(c-e)/Math.min(Math.abs(c),Math.abs(e))}},function(n,e){},function(n,e,c){Object.defineProperty(e,"__esModule",{value:!0});n=c(85);e=c(48);var q=c(148);n.a.register(e.a,function(){return new q.a})},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&
null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return w});var r=c(86),a=c(26),b=c(14),l=c(149),w=function(c){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var c=q(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,
arguments));c.get=Object(r.c)(function(c){var e=new a.a(!0),d;return new Promise(function(a,g){function f(a,b){b=void 0===b?"Request authorization.":b;e.setText((void 0===a?"Brain Maps authorization required.":a)+"  ");a=document.createElement("button");a.textContent=b;e.element.appendChild(a);a.addEventListener("click",function(){h(!1)});e.setVisible(!0)}function h(c){void 0!==d&&d.cancel();d=new b.b;f("Waiting for Brain Maps authorization...","Retry");Object(l.a)({clientId:"639403125587-4k5hgdfumtrvur8v48e3pr7oo91d765k.apps.googleusercontent.com",
scopes:["https://www.googleapis.com/auth/brainmaps"],immediate:c,authUser:0},d).then(function(b){void 0!==d&&(d=void 0,e.dispose(),a(b))},function(a){void 0!==d&&(d=void 0,c?f():f("Brain Maps authorization failed: "+a+".","Retry"))})}c.add(function(){void 0!==d&&(d.cancel(),d=void 0,e.dispose(),g(b.a))});h(!0)})});return c}m(e,c);return e}(r.b)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){var c=document.createElement("iframe");
c.style.display="none";c.id=a;c.name=a;c.src="https://accounts.google.com/o/oauth2/postmessageRelay?"+("parent="+encodeURIComponent(location.origin)+"#rpctoken="+b);document.body.appendChild(c)}e.a=function(b,c){c=void 0===c?r.e:c;var d=Object(l.a)();void 0===h&&(h=new k);var e=h,g=e.makeAuthRequestUrl({state:d,clientId:b.clientId,scopes:b.scopes,approvalPrompt:b.approvalPrompt,loginHint:b.loginHint,immediate:b.immediate,authUser:b.authUser}),m=e.addPendingRequest(d);d=new Promise(function(a,b){m.finished.add(function(c,
d){void 0!==c?a(c):b(d)})});m.finished.add(c.add(function(){m.finished.dispatch(void 0,r.a)}));if(b.immediate)e.relayReadyPromise.then(function(){if(!c.isCanceled){var b=document.createElement("iframe");b.src=g;b.style.display="none";document.body.appendChild(b);m.finished.add(function(){Object(a.b)(b)})}});else if(!c.isCanceled){var p=open(g);null!==p&&m.finished.add(function(){p.close()})}return d};var r=c(14),a=c(5),b=c(2),l=c(150),w=c(3),u=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=
b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),p=function d(){q(this,d);this.finished=new w.b},k=function(){function a(){var c=this;q(this,a);this.proxyName="postmessageRelay"+Object(l.a)();this.rpcToken=""+Object(l.a)();this.relayReadyService="oauth2relayReady:"+this.rpcToken;this.oauth2CallbackService="oauth2callback:"+this.rpcToken;this.pendingRequests=new Map;
m(this.proxyName,this.rpcToken);this.relayReadyPromise=new Promise(function(a){addEventListener("message",function(d){if("https://accounts.google.com"===d.origin)try{var e=Object(b.u)(JSON.parse(d.data)),f=Object(b.B)(e.s);f===c.relayReadyService&&a();if(f===c.oauth2CallbackService){var h=Object(b.a)(e.a,function(a){return a}),k=Object(b.B)(h[0]),l=location.origin;if(!k.startsWith(l+"#")&&!k.startsWith(l+"?"))throw Error("oauth2callback: URL "+JSON.stringify(k)+" "+("does not match current origin "+
l+"."));for(var m=k.substring(l.length+1).split("&"),p=new Map,q=$jscomp.makeIterator(m),n=q.next();!n.done;n=q.next()){var v=n.value.match("^([a-z_]+)=(.*)$");if(null===v)throw Error("oauth2callback: URL part "+JSON.stringify(v)+" does not match expected pattern.");p.set(v[1],v[2])}var r=p.get("state");if(void 0===r)throw Error("oauth2callback: State argument is missing.");var u=c.pendingRequests.get(r);if(void 0!==u){var y=p.get("error");if(void 0!==y){var w=p.get("error_subtype");e=y;void 0!==
w&&(e+=": "+w);u.finished.dispatch(void 0,Error("Error obtaining Google OAuth2 token: "+e))}else{var V=p.get("access_token"),M=p.get("token_type"),Q=p.get("expires_in"),aa=p.get("scope");if(void 0===V||void 0===M||void 0===Q||void 0===aa)throw Error("oauth2callback: URL lacks expected parameters.");u.finished.dispatch({accessToken:V,tokenType:M,expiresIn:Q,scope:aa})}}}}catch(ha){throw Error("Invalid message received from https://accounts.google.com: "+JSON.stringify(d.data)+": "+(ha.message+"."));
}})})}u(a,[{key:"addPendingRequest",value:function(a){var b=this,c=new p;this.pendingRequests.set(a,c);c.finished.add(function(){b.pendingRequests.delete(a)});return c}},{key:"makeAuthRequestUrl",value:function(a){var b="https://accounts.google.com/o/oauth2/auth?client_id="+encodeURIComponent(a.clientId);b=b+"&redirect_uri=postmessage&response_type=token"+("&origin="+encodeURIComponent(void 0===a.origin?location.origin:a.origin));b+="&proxy="+this.proxyName;b=b+"&include_granted_scopes=true"+("&scope="+
encodeURIComponent(a.scopes.join(" ")));a.state&&(b+="&state="+a.state);a.approvalPrompt&&(b+="&approval_prompt="+encodeURIComponent(a.approvalPrompt));a.loginHint&&(b+="&login_hint="+encodeURIComponent(a.loginHint));a.immediate&&(b+="&immediate=true");void 0!==a.authUser&&(b+="&authuser="+a.authUser);return b}}]);return a}(),h},function(n,e,c){e.a=function(c){c=Math.ceil((void 0===c?128:c)/32);var e=new Uint32Array(c);crypto.getRandomValues(e);for(var q="",a=0;a<c;++a)q+=("00000000"+e[a].toString(16)).slice(-8);
return q}},function(n,e,c){Object.defineProperty(e,"__esModule",{value:!0});var q=c(68),m=c(48);n=c(22);Object(n.b)("brainmaps",function(c){return new q.BrainmapsDataSource(q.productionInstance,c.credentialsManager.getCredentialsProvider(m.a))})},function(n,e,c){Object.defineProperty(e,"__esModule",{value:!0});var q=c(41);n=c(22);Object(n.b)("ndstore",function(){return new q.NDStoreDataSource})},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(e,"c",function(){return a});c.d(e,
"d",function(){return b});c.d(e,"b",function(){return l});c.d(e,"a",function(){return w});var a;(function(a){a[a.JPEG=0]="JPEG";a[a.COMPRESSED_SEGMENTATION=1]="COMPRESSED_SEGMENTATION"})(a||(a={}));n=function p(){r(this,p)};var b=function(a){function b(){r(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}m(b,a);return b}(n);b.RPC_ID="dvid/VolumeChunkSource";var l;(function(a){a[a.JPEG=0]="JPEG"})(l||(l={}));var w=function(a){function b(){r(this,b);return q(this,
(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}m(b,a);return b}(n);w.RPC_ID="dvid/TileChunkSource"},function(n,e,c){Object.defineProperty(e,"__esModule",{value:!0});var q=c(88);n=c(22);Object(n.b)("dvid",function(){return new q.DVIDDataSource})},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(e,"b",function(){return a});c.d(e,"a",function(){return b});n=function(a){function b(){r(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}m(b,a);return b}(function w(){r(this,w)});
var a=function(a){function b(){r(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}m(b,a);return b}(n);a.RPC_ID="render/TileChunkSource";var b=function(a){function b(){r(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}m(b,a);return b}(n);b.RPC_ID="render/PointMatchSource"},function(n,e,c){Object.defineProperty(e,"__esModule",{value:!0});n=c(22);var q=c(89);Object(n.b)("render",function(){return new q.RenderDataSource})},function(n,
e,c){Object.defineProperty(e,"__esModule",{value:!0});var q=c(91);n=c(22);Object(n.b)("openconnectome",function(){return new q.OpenConnectomeDataSource})},function(n,e,c){function q(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function");}c.d(e,"b",function(){return m});c.d(e,"c",function(){return r});c.d(e,"a",function(){return a});var m;(function(a){a[a.RAW=0]="RAW";a[a.JPEG=1]="JPEG";a[a.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION"})(m||(m={}));var r=function l(){q(this,
l)};r.RPC_ID="precomputed/VolumeChunkSource";var a=function w(){q(this,w)};a.RPC_ID="precomputed/MeshSource"},function(n,e,c){Object.defineProperty(e,"__esModule",{value:!0});var q=c(92);n=c(22);Object(n.b)("precomputed",function(){return new q.PrecomputedDataSource})},function(n,e,c){c.d(e,"b",function(){return m});e.a="nifti/getNiftiVolumeInfo";var q;(function(c){c[c.NONE=0]="NONE";c[c.BINARY=1]="BINARY";c[c.UINT8=2]="UINT8";c[c.INT16=4]="INT16";c[c.INT32=8]="INT32";c[c.FLOAT32=16]="FLOAT32";c[c.COMPLEX64=
32]="COMPLEX64";c[c.FLOAT64=64]="FLOAT64";c[c.RGB24=128]="RGB24";c[c.INT8=256]="INT8";c[c.UINT16=512]="UINT16";c[c.UINT32=768]="UINT32";c[c.INT64=1024]="INT64";c[c.UINT64=1280]="UINT64";c[c.FLOAT128=1536]="FLOAT128";c[c.COMPLEX128=1792]="COMPLEX128";c[c.COMPLEX256=2048]="COMPLEX256"})(q||(q={}));var m=function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");};m.RPC_ID="nifti/VolumeChunkSource"},function(n,e,c){Object.defineProperty(e,"__esModule",{value:!0});var q=
c(93);n=c(22);Object(n.b)("nifti",function(){return new q.NiftiDataSource})},function(n,e){},function(n,e){},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){return new f.a({shaderError:a.shaderError,fragmentMain:a.fragmentMain,fragmentMainStartLine:u.a})}Object.defineProperty(e,"__esModule",{value:!0});c.d(e,"ImageUserLayer",function(){return y});var b=c(57);n=c(12);var l=c(9);e=c(29);var w=c(8),u=c(166),p=c(36),k=c(95),h=c(1),g=c(28),d=c(58),f=c(59),v=function(){function a(a,
b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();c(97);c(60);c(98);var y=function(a){function c(a,d){q(this,c);var e=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));e.opacity=Object(p.a)(.5);e.blendMode=Object(k.c)();e.fragmentMain=Object(u.c)();e.shaderError=Object(g.b)();e.transform=new b.a;var f=d.source;if("string"!==
typeof f)throw Error("Invalid image layer specification");e.opacity.restoreState(d.opacity);e.blendMode.restoreState(d.blend);e.fragmentMain.restoreState(d.shader);e.transform.restoreState(d.transform);e.registerDisposer(e.fragmentMain.changed.add(function(){e.specificationChanged.dispatch()}));e.volumePath=f;Object(l.d)(a.dataSourceProvider,a.chunkManager,f).then(function(a){e.wasDisposed||(a=e.renderLayer=new u.b(a,{opacity:e.opacity,blendMode:e.blendMode,fragmentMain:e.fragmentMain,shaderError:e.shaderError,
sourceOptions:{transform:h.j.clone(e.transform.transform)}}),e.addRenderLayer(a),e.shaderError.changed.dispatch())});return e}r(c,a);v(c,[{key:"toJSON",value:function(){var a={type:"image"};a.source=this.volumePath;a.opacity=this.opacity.toJSON();a.blend=this.blendMode.toJSON();a.shader=this.fragmentMain.toJSON();a.transform=this.transform.toJSON();return a}},{key:"makeDropdown",value:function(a){return new G(a,this)}}]);return c}(n.f),G=function(b){function c(b,e){q(this,c);var f=m(this,(c.__proto__||
Object.getPrototypeOf(c)).call(this));f.element=b;f.layer=e;f.opacityWidget=f.registerDisposer(new d.a(f.layer.opacity));f.codeWidget=f.registerDisposer(a(f.layer));b.classList.add("image-dropdown");var g=f.opacityWidget;e=document.createElement("div");e.className="image-dropdown-top-row";g.promptElement.textContent="Opacity";g=document.createElement("div");g.style.flex="1";var h=document.createElement("a"),k=document.createElement("button");k.type="button";k.textContent="?";k.className="help-link";
h.appendChild(k);h.title="Documentation on image layer rendering";h.target="_blank";h.href="https://github.com/google/neuroglancer/blob/master/src/neuroglancer/sliceview/image_layer_rendering.md";k=document.createElement("button");k.innerHTML="&square;";k.className="maximize-button";k.title="Show larger editor view";f.registerEventListener(k,"click",function(){new E(f.layer)});e.appendChild(f.opacityWidget.element);e.appendChild(g);e.appendChild(k);e.appendChild(h);b.appendChild(e);b.appendChild(f.codeWidget.element);
f.codeWidget.textEditor.refresh();return f}r(c,b);v(c,[{key:"onShow",value:function(){this.codeWidget.textEditor.refresh()}}]);return c}(n.g),E=function(b){function c(b){q(this,c);var d=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));d.layer=b;d.codeWidget=d.registerDisposer(a(d.layer));d.content.classList.add("image-layer-shader-overlay");d.content.appendChild(d.codeWidget.element);d.codeWidget.textEditor.refresh();return d}r(c,b);return c}(e.a);Object(l.e)("image",y);Object(l.f)(w.d.IMAGE,
y)},function(n,e){},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):
a.__proto__=b)}function r(a){return Object(w.a)(void 0===a?"void main() {\n  emitGrayscale(toNormalized(getDataValue()));\n}\n":a)}e.c=r;c.d(e,"b",function(){return h});n=c(94);var a=c(36),b=c(95),l=c(2),w=c(28),u=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),p=function d(a,b,c){null===a&&(a=Function.prototype);
var e=Object.getOwnPropertyDescriptor(a,b);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==a)return d(a,b,c)}else{if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(c)}};e.a="//NEUROGLANCER_IMAGE_RENDERLAYER_FRAGMENT_MAIN_START";var k=c(55),h=function(c){function d(c,e){var f=void 0===e?{}:e;e=void 0===f.opacity?Object(a.a)(.5):f.opacity;var h=void 0===f.blendMode?Object(b.c)():f.blendMode,k=void 0===f.fragmentMain?r():f.fragmentMain,m=void 0===f.shaderError?Object(w.b)():f.shaderError;
f=void 0===f.sourceOptions?{}:f.sourceOptions;if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");var l=q(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,c,{shaderError:m,sourceOptions:f}));l.fragmentMain=k;l.opacity=e;l.blendMode=h;l.registerDisposer(e.changed.add(function(){l.redrawNeeded.dispatch()}));l.registerDisposer(k.changed.add(function(){l.shaderUpdated=!0;l.redrawNeeded.dispatch()}));return l}m(d,c);u(d,[{key:"getShaderKey",value:function(){return"volume.ImageRenderLayer:"+
JSON.stringify(this.fragmentMain.value)}},{key:"getValueAt",value:function(a){for(var b=$jscomp.makeIterator(this.sources),c=b.next();!c.done;c=b.next()){c=$jscomp.makeIterator(c.value);for(var d=c.next();!d.done;d=c.next())if(d=d.value.getValueAt(a),null!=d)return d}return null}},{key:"defineShader",value:function(a){p(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"defineShader",this).call(this,a);a.addUniform("highp float","uOpacity");a.addFragmentCode("\nvoid emitRGBA(vec4 rgba) {\n  emit(vec4(rgba.rgb, rgba.a * uOpacity));\n}\nvoid emitRGB(vec3 rgb) {\n  emit(vec4(rgb, uOpacity));\n}\nvoid emitGrayscale(float value) {\n  emit(vec4(value, value, value, uOpacity));\n}\nvoid emitTransparent() {\n  emit(vec4(0.0, 0.0, 0.0, 0.0));\n}\n");
a.addFragmentCode(k);a.setFragmentMainFunction("//NEUROGLANCER_IMAGE_RENDERLAYER_FRAGMENT_MAIN_START\n"+this.fragmentMain.value)}},{key:"beginSlice",value:function(a){a=p(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"beginSlice",this).call(this,a);this.gl.uniform1f(a.uniform("uOpacity"),this.opacity.value);return a}},{key:"setGLBlendMode",value:function(a,c){var d=Object(l.n)(this.blendMode.value,b.b);if(d===b.b.ADDITIVE||0<c)a.enable(a.BLEND),b.a.get(d)(a)}}]);return d}(n.a)},function(n,
e){},function(n,e,c){(function(c){function e(a,b){function d(a){if(!e.parentNode)return c.off(document,"mousemove",d);e.style.top=Math.max(0,a.clientY-e.offsetHeight-5)+"px";e.style.left=a.clientX+5+"px"}var e=document.createElement("div");e.className="CodeMirror-lint-tooltip";e.appendChild(b.cloneNode(!0));document.body.appendChild(e);c.on(document,"mousemove",d);d(a);null!=e.style.opacity&&(e.style.opacity=1);return e}function q(a){a.parentNode&&(null==a.style.opacity&&a.parentNode&&a.parentNode.removeChild(a),
a.style.opacity=0,setTimeout(function(){a.parentNode&&a.parentNode.removeChild(a)},600))}function a(a,b,g){function d(){c.off(g,"mouseout",d);f&&(q(f),f=null)}var f=e(a,b),h=setInterval(function(){if(f)for(var a=g;;a=a.parentNode){a&&11==a.nodeType&&(a=a.host);if(a==document.body)return;if(!a){d();break}}if(!f)return clearInterval(h)},400);c.on(g,"mouseout",d)}function b(b,c,e){this.marked=[];this.options=c;this.timeout=null;this.hasGutter=e;this.onMouseOver=function(c){var d=c.target||c.srcElement;
if(/\bCodeMirror-lint-mark-/.test(d.className)){d=d.getBoundingClientRect();var e=b.findMarksAt(b.coordsChar({left:(d.left+d.right)/2,top:(d.top+d.bottom)/2},"client"));d=[];for(var f=0;f<e.length;++f){var g=e[f].__annotation;g&&d.push(g)}if(d.length){e=c.target||c.srcElement;f=document.createDocumentFragment();for(g=0;g<d.length;g++)f.appendChild(u(d[g]));a(c,f,e)}}};this.waitingFor=0}function l(a){var b=a.state.lint;b.hasGutter&&a.clearGutter("CodeMirror-lint-markers");for(a=0;a<b.marked.length;++a)b.marked[a].clear();
b.marked.length=0}function n(b,e,g,h){var d=document.createElement("div"),f=d;d.className="CodeMirror-lint-marker-"+e;g&&(f=d.appendChild(document.createElement("div")),f.className="CodeMirror-lint-marker-multiple");if(0!=h)c.on(f,"mouseover",function(c){a(c,b,f)});return d}function u(a){var b=a.severity;b||(b="error");var c=document.createElement("div");c.className="CodeMirror-lint-message-"+b;"undefined"!=typeof a.messageHTML?c.innerHTML=a.messageHTML:c.appendChild(document.createTextNode(a.message));
return c}function p(a,b,e){function d(){g=-1;a.off("change",d)}var f=a.state.lint,g=++f.waitingFor;a.on("change",d);b(a.getValue(),function(b,e){a.off("change",d);f.waitingFor==g&&(e&&b instanceof c&&(b=e),h(a,b))},e,a)}function k(a){var b=a.state.lint.options,d=b.options||b,e=b.getAnnotations||a.getHelper(c.Pos(0,0),"lint");e&&(b.async||e.async?p(a,e,d):(b=e(a.getValue(),d,a))&&(b.then?b.then(function(b){h(a,b)}):h(a,b)))}function h(a,b){l(a);for(var c=a.state.lint,d=c.options,e=[],f=0;f<b.length;++f){var g=
b[f],h=g.from.line;(e[h]||(e[h]=[])).push(g)}for(f=0;f<e.length;++f)if(g=e[f]){h=null;for(var k=c.hasGutter&&document.createDocumentFragment(),m=0;m<g.length;++m){var p=g[m],q=p.severity;q||(q="error");"error"!=h&&(h=q);d.formatAnnotation&&(p=d.formatAnnotation(p));c.hasGutter&&k.appendChild(u(p));p.to&&c.marked.push(a.markText(p.from,p.to,{className:"CodeMirror-lint-mark-"+q,__annotation:p}))}c.hasGutter&&a.setGutterMarker(f,"CodeMirror-lint-markers",n(k,h,1<g.length,c.options.tooltips))}if(d.onUpdateLinting)d.onUpdateLinting(b,
e,a)}function g(a){var b=a.state.lint;b&&(clearTimeout(b.timeout),b.timeout=setTimeout(function(){k(a)},b.options.delay||500))}c.defineOption("lint",!1,function(a,e,h){h&&h!=c.Init&&(l(a),!1!==a.state.lint.options.lintOnChange&&a.off("change",g),c.off(a.getWrapperElement(),"mouseover",a.state.lint.onMouseOver),clearTimeout(a.state.lint.timeout),delete a.state.lint);if(e){var d=a.getOption("gutters");h=!1;for(var f=0;f<d.length;++f)"CodeMirror-lint-markers"==d[f]&&(h=!0);d=a.state;e instanceof Function?
e={getAnnotations:e}:e&&!0!==e||(e={});h=d.lint=new b(a,e,h);if(!1!==h.options.lintOnChange)a.on("change",g);if(0!=h.options.tooltips&&"gutter"!=h.options.tooltips)c.on(a.getWrapperElement(),"mouseover",h.onMouseOver);k(a)}});c.defineExtension("performLint",function(){this.state.lint&&k(this)})})(c(96))},function(n,e){},function(n,e){},function(n,e){},function(n,e){n.exports=function(c){function e(a){var b={};a=a.split(" ");for(var c=0;c<a.length;++c)b[a[c]]=!0;return b}c.defineMode("glsl",function(a,
b){function c(a,b){var c=a.next();if(G[c]){var e=G[c](a,b);if(!1!==e)return e}if('"'==c||"'"==c)return b.tokenize=q(c),b.tokenize(a,b);if(/[\[\]{}\(\),;\:\.]/.test(c))return z=c,"bracket";if(/\d/.test(c))return a.eatWhile(/[\w\.]/),"number";if("/"==c){if(a.eat("*"))return b.tokenize=u,u(a,b);if(a.eat("/"))return a.skipToEnd(),"comment"}if("#"==c)return a.eatWhile(/[\S]+/),a.eatWhile(/[\s]+/),a.eatWhile(/[\S]+/),a.eatWhile(/[\s]+/),"comment";if(B.test(c))return a.eatWhile(B),"operator";a.eatWhile(/[\w\$_]/);
a=a.current();return d.propertyIsEnumerable(a)?(v.propertyIsEnumerable(a)&&(z="newstatement"),"keyword"):f.propertyIsEnumerable(a)?"builtin":r.propertyIsEnumerable(a)?"atom":"word"}function q(a){return function(b,d){for(var e=!1,f,g=!1;null!=(f=b.next());){if(f==a&&!e){g=!0;break}e=!e&&"\\"==f}if(g||!e&&!E)d.tokenize=c;return"string"}}function u(a,b){for(var d=!1,e;e=a.next();){if("/"==e&&d){b.tokenize=c;break}d="*"==e}return"comment"}function p(a,b,c,d,e){this.indented=a;this.column=b;this.type=
c;this.align=d;this.prev=e}function k(a,b,c){return a.context=new p(a.indented,b,c,null,a.context)}function h(a){var b=a.context.type;if(")"==b||"]"==b||"}"==b)a.indented=a.context.indented;return a.context=a.context.prev}var g=a.indentUnit,d=b.keywords||e(m),f=b.builtins||e(n),v=b.blockKeywords||e("case do else for if switch while struct"),r=b.atoms||e("null"),G=b.hooks||{},E=b.multiLineStrings,B=/[+\-*&%=<>!?|\/]/,z;return{startState:function(a){return{tokenize:null,context:new p((a||0)-g,0,"top",
!1),indented:0,startOfLine:!0}},token:function(a,b){var d=b.context;a.sol()&&(null==d.align&&(d.align=!1),b.indented=a.indentation(),b.startOfLine=!0);if(a.eatSpace())return null;z=null;var e=(b.tokenize||c)(a,b);if("comment"==e||"meta"==e)return e;null==d.align&&(d.align=!0);if(";"!=z&&":"!=z||"statement"!=d.type)if("{"==z)k(b,a.column(),"}");else if("["==z)k(b,a.column(),"]");else if("("==z)k(b,a.column(),")");else if("}"==z){for(;"statement"==d.type;)d=h(b);for("}"==d.type&&(d=h(b));"statement"==
d.type;)d=h(b)}else z==d.type?h(b):("}"==d.type||"top"==d.type||"statement"==d.type&&"newstatement"==z)&&k(b,a.column(),"statement");else h(b);b.startOfLine=!1;return e},indent:function(a,b){if(a.tokenize!=c&&null!=a.tokenize)return 0;b=b&&b.charAt(0);a=a.context;var d=b==a.type;return"statement"==a.type?a.indented+("{"==b?0:g):a.align?a.column+(d?0:1):a.indented+(d?0:g)},electricChars:"{}"}});var m="attribute const uniform varying break continue do for while if else in out inout float int void bool true false lowp mediump highp precision invariant discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler2D samplerCube struct gl_FragCoord gl_FragColor",
n="radians degrees sin cos tan asin acos atan pow exp log exp2 log2 sqrt inversesqrt abs sign floor ceil fract mod min max clamp mix step smoothstep length distance dot cross normalize faceforward reflect refract matrixCompMult lessThan lessThanEqual greaterThan greaterThanEqual equal notEqual any all not dFdx dFdy fwidth texture2D texture2DProj texture2DLod texture2DProjLod textureCube textureCubeLod require export";c.defineMIME("text/x-glsl",{name:"glsl",keywords:e(m),builtins:e(n),blockKeywords:e("case do else for if switch while struct"),
atoms:e("null"),hooks:{"#":function(a,b){if(!b.startOfLine)return!1;a.skipToEnd();return"meta"}}})}},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b,c,d){d=void 0===d?{}:d;return w.a.forPromise(new Promise(function(e){e(a.getVectorGraphicsSource(b,c,d))}),{initialMessage:"Retrieving metadata for vector graphics source "+c+".",delay:!0,errorPrefix:"Error retrieving metadata for vector graphics source "+c+": "})}Object.defineProperty(e,"__esModule",
{value:!0});c.d(e,"VectorGraphicsUserLayer",function(){return y});n=c(12);e=c(9);var b=c(56),l=c(174),w=c(26),u=c(36),p=c(99),k=c(100),h=c(1),g=c(2),d=c(58),f=c(175),v=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();c(97);c(60);c(98);var y=function(c){function d(c,e){q(this,d);var f=m(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));
f.opacity=Object(u.a)(.5);f.lineWidth=Object(p.a)(10);f.color=Object(k.a)(h.p.fromValues(1,1,1));f.opacity.restoreState(e.opacity);f.lineWidth.restoreState(e.linewidth);f.color.restoreState(e.color);f.lineWidth.changed.add(function(){f.specificationChanged.dispatch()});f.color.changed.add(function(){f.specificationChanged.dispatch()});f.vectorGraphicsLayerType=Object(g.n)(e.type,b.c);e=f.vectorGraphicsPath=Object(g.z)(e.source);void 0!==e&&f.vectorGraphicsLayerType===b.c.LINE&&a(c.dataSourceProvider,
c.chunkManager,e).then(function(a){f.wasDisposed||(a=f.renderLayer=new l.a(a,{opacity:f.opacity,lineWidth:f.lineWidth,color:f.color,sourceOptions:{}}),f.addRenderLayer(a))});return f}r(d,c);v(d,[{key:"toJSON",value:function(){var a={type:this.getLayerType()};a.source=this.vectorGraphicsPath;a.opacity=this.opacity.toJSON();a.linewidth=this.lineWidth.toJSON();a.color=this.color.toJSON();return a}},{key:"getLayerType",value:function(){return b.c[this.vectorGraphicsLayerType].toLowerCase()}},{key:"makeDropdown",
value:function(a){return new G(a,this)}}]);return d}(n.f),G=function(a){function b(a,c){q(this,b);var e=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));e.element=a;e.layer=c;e.opacityWidget=e.registerDisposer(new d.a(e.layer.opacity));e.lineWidthWidget=e.registerDisposer(new d.a(e.layer.lineWidth,{min:0,max:50,step:1}));e.colorWidget=e.registerDisposer(new E(e.layer.color));a.classList.add("image-dropdown");var f=e.opacityWidget,g=e.lineWidthWidget,h=e.colorWidget;c=document.createElement("div");
c.className="image-dropdown-top-row";f.promptElement.textContent="Opacity";g.promptElement.textContent="Line Width";h.promptElement.textContent="Color";f=document.createElement("div");f.style.flex="1";g=document.createElement("a");h=document.createElement("button");h.type="button";h.textContent="?";h.className="help-link";g.appendChild(h);g.title="Documentation on vector graphics layer rendering";g.target="_blank";g.href="https://github.com/google/neuroglancer/blob/master/src/neuroglancer/sliceview/vectorgraphics_layer_rendering.md";
c.appendChild(f);c.appendChild(g);a.appendChild(c);a.appendChild(e.opacityWidget.element);a.appendChild(e.lineWidthWidget.element);a.appendChild(e.colorWidget.element);return e}r(b,a);return b}(n.g),E=function(a){function b(a){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}r(b,a);v(b,[{key:"verifyValue",value:function(a){a=Object(g.o)(a);a/=255;return 0>a?0:1<a?1:a}},{key:"updateInput",value:function(){this.inputx.valueAsNumber=Math.round(255*this.model.value[0]);this.inputy.valueAsNumber=
Math.round(255*this.model.value[1]);this.inputz.valueAsNumber=Math.round(255*this.model.value[2])}}]);return b}(f.a);Object(e.e)("line",y)},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,
{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return d});var r=c(23);n=c(90);var a=c(36),b=c(99),l=c(100),w=c(1),u=c(17),p=c(20),k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),h=function v(a,b,
c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return v(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},g=w.j.create(),d=function(c){function d(c,e){var g=void 0===e?{}:e;e=void 0===g.opacity?Object(a.a)(.5):g.opacity;var h=void 0===g.lineWidth?Object(b.a)(10):g.lineWidth,k=void 0===g.color?Object(l.a)(w.p.fromValues(255,255,255)):g.color;g=void 0===g.sourceOptions?{}:g.sourceOptions;
if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");var m=q(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,c,{sourceOptions:g}));m.opacity=e;m.registerDisposer(e.changed.add(function(){m.redrawNeeded.dispatch()}));m.lineWidth=h;m.registerDisposer(h.changed.add(function(){m.redrawNeeded.dispatch()}));m.color=k;m.registerDisposer(k.changed.add(function(){m.redrawNeeded.dispatch()}));c=m.gl;e=new Float32Array([1,0,0,1,1,0,0,1]);m.vertexIndexBuffer=u.a.fromData(c,
e,c.ARRAY_BUFFER,c.STATIC_DRAW);e=new Float32Array([1,1,-1,-1]);m.normalDirectionBuffer=u.a.fromData(c,e,c.ARRAY_BUFFER,c.STATIC_DRAW);return m}m(d,c);k(d,[{key:"getShaderKey",value:function(){return"vectorgraphics.VectorGraphicsLineRenderLayer"}},{key:"defineShader",value:function(a){h(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"defineShader",this).call(this,a);a.addUniform("highp float","uOpacity");a.addUniform("highp float","ulineWidth");a.addUniform("highp vec3","uColor");a.addVarying("vec3",
"vNormal");a.addAttribute("highp float","aNormalDirection");a.addAttribute("highp vec2","aVertexIndex");a.addAttribute("highp vec3","aVertexFirst");a.addAttribute("highp vec3","aVertexSecond");a.addUniform("highp mat4","uProjection");a.setFragmentMain("    \nfloat distance = length(vNormal);\n\nfloat antialiasing = 0.5;\n\nif (distance >= 1.0 - antialiasing) {\n  emitRGBA(vec4(uColor, (distance - 1.0) / -antialiasing )); \n}\nelse if (distance < 1.0 - antialiasing) {\n  emitRGB(uColor);\n}\n");a.setVertexMain("\nvec3 direction = vec3(0., 0., 0.); \ndirection.z = aNormalDirection;\n\nvec3 difference = aVertexSecond - aVertexFirst;\ndifference.z = 0.; \n\nvec3 normal = cross(difference, direction);\nnormal = normalize(normal); \nvNormal = normal; \n\nvec4 delta = vec4(normal * ulineWidth, 0.0);\nvec4 pos = vec4(aVertexFirst * aVertexIndex.x + aVertexSecond * aVertexIndex.y, 1.0);\n\ngl_Position = uProjection * (pos + delta);\n")}},
{key:"beginSlice",value:function(a){h(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"beginSlice",this).call(this,a);a=this.gl;var b=this.shader;a.uniform1f(b.uniform("uOpacity"),this.opacity.value);a.uniform1f(b.uniform("ulineWidth"),this.lineWidth.value);a.uniform3fv(b.uniform("uColor"),this.color.value);this.vertexIndexBuffer.bindToVertexAttrib(b.attribute("aVertexIndex"),2);this.normalDirectionBuffer.bindToVertexAttrib(b.attribute("aNormalDirection"),1);return b}},{key:"endSlice",value:function(a){var b=
this.gl;b.disableVertexAttribArray(a.attribute("aVertexIndex"));b.disableVertexAttribArray(a.attribute("aNormalDirection"));b.disableVertexAttribArray(a.attribute("aVertexFirst"));b.disableVertexAttribArray(a.attribute("aVertexSecond"))}},{key:"draw",value:function(a){var b=a.visibleLayers.get(this);if(0!==b.length)if(this.initializeShader(),void 0===this.shader)console.log("error: shader undefined");else{var c=this.gl,d=this.beginSlice(a);b=$jscomp.makeIterator(b);for(var e=b.next();!e.done;e=b.next()){var h=
e.value,k=h.spec.chunkLayout,m=h.spec.voxelSize;e=h.chunks;var l=g;w.j.identity(l);h.vectorGraphicsCoordinatesInVoxels&&w.j.scale(l,l,m);w.j.multiply(l,k.transform,l);c.uniformMatrix4fv(d.uniform("uProjection"),!1,w.j.multiply(g,a.dataToDevice,l));if(h=a.visibleChunks.get(k))for(h=$jscomp.makeIterator(h),k=h.next();!k.done;k=h.next())if((k=e.get(k.value))&&k.state===r.d.GPU_MEMORY){m=k.numPoints/2;l=d.attribute("aVertexFirst");k.vertexBuffer.bindToVertexAttrib(l,3,p.c,!1,24,0);c.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(l,
1);var q=d.attribute("aVertexSecond");k.vertexBuffer.bindToVertexAttrib(q,3,p.c,!1,24,12);c.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(q,1);c.ANGLE_instanced_arrays.drawArraysInstancedANGLE(c.TRIANGLE_STRIP,0,4,m);c.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(l,0);c.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(q,0)}}this.endSlice(d)}}}]);return d}(n.a)},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||
"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return u});n=c(0);var r=c(1),a=c(2),b=c(3),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=
d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),w=function k(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return k(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};c(176);var u=function(c){function e(a){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");
var c=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));c.model=a;c.promptElement=document.createElement("span");c.element=document.createElement("label");c.inputx=document.createElement("input");c.inputy=document.createElement("input");c.inputz=document.createElement("input");c.valueEntered=new b.b;a=c.inputx;var f=c.inputy,g=c.inputz,h=c.element,k=c.promptElement;h.className="vec3-input-row";k.className="vec3-input-label";h.appendChild(k);h.appendChild(a);h.appendChild(f);h.appendChild(g);
a.type=f.type=g.type="number";c.updateInput();h=function(){c.model.value=c.getVec3Values()};c.registerEventListener(a,"change",h);c.registerEventListener(f,"change",h);c.registerEventListener(g,"change",h);c.model.changed.add(function(){c.updateInput()});return c}m(e,c);l(e,[{key:"getVec3Values",value:function(){var a=r.p.create();a[0]=this.verifyValue(this.inputx.valueAsNumber);a[1]=this.verifyValue(this.inputy.valueAsNumber);a[2]=this.verifyValue(this.inputz.valueAsNumber);return a}},{key:"verifyValue",
value:function(b){return Object(a.o)(b)}},{key:"updateInput",value:function(){this.inputx.valueAsNumber=this.model.value[0];this.inputy.valueAsNumber=this.model.value[1];this.inputz.valueAsNumber=this.model.value[2]}},{key:"disposed",value:function(){var a=this.inputx,b=this.inputy,c=this.inputz,h=this.element;a.parentElement&&a.parentElement.removeChild(a);b.parentElement&&b.parentElement.removeChild(b);c.parentElement&&c.parentElement.removeChild(c);h.parentElement&&h.parentElement.removeChild(h);
w(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}}]);return e}(n.a)},function(n,e){},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){return new C.a({fragmentMain:a.displayState.fragmentMain,shaderError:a.displayState.shaderError,fragmentMainStartLine:g.a})}Object.defineProperty(e,"__esModule",{value:!0});c.d(e,"SegmentationUserLayer",function(){return R});var b=c(57);n=c(12);var l=c(9),w=c(49);e=c(29);var u=c(178),p=c(101),k=c(37),
h=c(180),g=c(75),d=c(8),f=c(182),v=c(36),y=c(42),G=c(183),E=c(2),B=c(11),z=c(28),D=c(58),x=c(184),C=c(59),H=c(186),K=c(46),F=c(188);c.n(F);var T=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),J=function Q(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=
Object.getPrototypeOf(a),null!==a)return Q(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};c(21);c(189);var R=function(a){function c(a,e){q(this,c);var n=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,[]));n.manager=a;n.displayState={segmentColorHash:p.a.getDefault(),segmentSelectionState:new k.a,selectedAlpha:Object(v.a)(.5),notSelectedAlpha:Object(v.a)(0),objectAlpha:Object(v.a)(1),clipBounds:K.a.make(n.manager.worker,void 0),hideSegmentZero:new y.a(!0,
!0),visibleSegments:G.a.makeWithCounterpart(n.manager.worker),segmentEquivalences:h.a.makeWithCounterpart(n.manager.worker),volumeSourceOptions:{},objectToDataTransform:new b.a,fragmentMain:Object(g.f)(),shaderError:Object(z.b)()};n.editorSocket=new F.EditorSocket(n);n.editorSource=Object(u.a)();n.displayState.visibleSegments.changed.add(function(){n.specificationChanged.dispatch()});n.displayState.segmentEquivalences.changed.add(function(){n.specificationChanged.dispatch()});n.displayState.segmentSelectionState.bindTo(a.layerSelectedValues,
n);n.displayState.selectedAlpha.changed.add(function(){n.specificationChanged.dispatch()});n.displayState.notSelectedAlpha.changed.add(function(){n.specificationChanged.dispatch()});n.displayState.objectAlpha.changed.add(function(){n.specificationChanged.dispatch()});n.displayState.hideSegmentZero.changed.add(function(){n.specificationChanged.dispatch()});n.displayState.fragmentMain.changed.add(function(){n.specificationChanged.dispatch()});n.displayState.selectedAlpha.restoreState(e.selectedAlpha);
n.displayState.notSelectedAlpha.restoreState(e.notSelectedAlpha);n.displayState.objectAlpha.restoreState(e.objectAlpha);n.displayState.hideSegmentZero.restoreState(e.hideSegmentZero);n.displayState.objectToDataTransform.restoreState(e.transform);n.displayState.volumeSourceOptions.transform=n.displayState.objectToDataTransform.transform;n.displayState.fragmentMain.restoreState(e.skeletonShader);var r=n.volumePath=Object(E.z)(e.source),x=n.meshPath=null===e.mesh?null:Object(E.z)(e.mesh),C=n.skeletonsPath=
Object(E.z)(e.skeletons);void 0!==r&&Object(l.d)(a.dataSourceProvider,a.chunkManager,r,{volumeType:d.d.SEGMENTATION}).then(function(a){if(!n.wasDisposed&&(n.addRenderLayer(new f.a(a,n.displayState)),void 0===x)){var b=a.getMeshSource();null!=b&&n.addMesh(b)}n.editorSource=Object(u.a)(a);new Promise(function(a,b){n.editorSocket.open(a,b)})});null!=x&&n.manager.dataSourceProvider.getMeshSource(a.chunkManager,x).then(function(a){n.wasDisposed||n.addMesh(a)});void 0!==C&&n.manager.dataSourceProvider.getSkeletonSource(a.chunkManager,
C).then(function(b){n.wasDisposed||(b=new g.c(a.chunkManager,b,a.voxelSize,n.displayState),n.addRenderLayer(new g.b(b.addRef())),n.addRenderLayer(new g.e(b)))});Object(E.w)(e,"equivalences",function(a){n.displayState.segmentEquivalences.restoreState(a)});Object(E.w)(e,"segments",function(a){if(void 0!==a){var b=n.displayState,c=b.visibleSegments,d=b.segmentEquivalences;Object(E.a)(a,function(a){a=B.a.parseString(String(a),10);c.add(d.get(a))})}});Object(E.w)(e,"clipBounds",function(a){if(void 0!==
a){var b,c;Object(E.w)(a,"center",function(a){return b=Object(E.l)(a)});Object(E.w)(a,"size",function(a){return c=Object(E.l)(a)});b&&c&&(n.displayState.clipBounds.value={center:b,size:c})}});return n}r(c,a);T(c,[{key:"addMesh",value:function(a){this.meshLayer=new w.a(this.manager.chunkManager,a,this.displayState);this.addRenderLayer(this.meshLayer)}},{key:"disposed",value:function(){this.editorSocket.close();J(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}},
{key:"toJSON",value:function(){var a={type:"segmentation"};a.source=this.volumePath;a.mesh=this.meshPath;a.skeletons=this.skeletonsPath;a.selectedAlpha=this.displayState.selectedAlpha.toJSON();a.notSelectedAlpha=this.displayState.notSelectedAlpha.toJSON();a.objectAlpha=this.displayState.objectAlpha.toJSON();a.hideSegmentZero=this.displayState.hideSegmentZero.toJSON();var b=this.displayState.visibleSegments;0<b.size&&(a.segments=b.toJSON());b=this.displayState.segmentEquivalences;0<b.size&&(a.equivalences=
b.toJSON());b.hasSplits&&(a.splits=b.splitJSON());b=this.displayState.clipBounds;b.value&&(a.clipBounds={center:b.value.center,size:b.value.size});a.transform=this.displayState.objectToDataTransform.toJSON();a.skeletonShader=this.displayState.fragmentMain.toJSON();return a}},{key:"transformPickedValue",value:function(a){if(null==a)return a;var b=this.displayState.segmentEquivalences;if(0===b.size)return a;"number"===typeof a&&(a=new B.a(a,0));b=b.get(a);return B.a.equal(b,a)?a:new k.c(a,b)}},{key:"makeDropdown",
value:function(a){return new W(a,this)}},{key:"mergeOne",value:function(a,b){this.displayState.segmentEquivalences.link(a,b)}},{key:"splitOne",value:function(){this.displayState.segmentEquivalences.split()}},{key:"currentMerges",value:function(){return this.displayState.segmentEquivalences.toJSON()}},{key:"currentSplits",value:function(){return this.displayState.segmentEquivalences.splitJSON()}},{key:"restoreSaved",value:function(a){void 0!==a&&this.displayState.segmentEquivalences.restoreSaved(a)}},
{key:"handleMessage",value:function(a){a=JSON.parse(a);switch(a.action){case "restore":this.restoreSaved(a.merge);break;case "save":Object(l.h)(this,"Successfully saved"),this.restoreSaved(a.merge)}}},{key:"handleSplitAction",value:function(a,b){var c=this.displayState.segmentSelectionState,d=c.selectedSegment;switch(a){case "select":if(c.hasSelectedSegment&&void 0===b.segment){b.segment=d.clone();b.voxelSize.voxelFromSpatial(b.startPoint,b.mouseState.position);break}b.segment=void 0;break;case "edit":b.segment&&
(b.voxelSize.voxelFromSpatial(b.endPoint,b.mouseState.position),console.log(b.startPoint,b.endPoint),this.splitOne());break;default:this.handleAction(a)}}},{key:"handleMergeAction",value:function(a,b){var c=this.displayState.segmentSelectionState,d=c.hasSelectedSegment;switch(a){case "select":if(d){a=c.selectedSegment;if(void 0===b.segment){b.segment=a.clone();break}b.segment=void 0;break}case "edit":d&&b.segment&&(a=c.selectedSegment,B.a.equal(b.segment,a)||this.mergeOne(b.segment,a));break;default:this.handleAction(a)}}},
{key:"handleEditorAction",value:function(a,b){switch(b.editor.value){case 1:this.handleMergeAction(a,b);break;case 2:this.handleSplitAction(a,b);break;default:this.handleAction(a)}}},{key:"handleAction",value:function(a){switch(a){case "recolor":this.displayState.segmentColorHash.randomize();break;case "clear-segments":this.displayState.visibleSegments.clear();break;case "save":a=this.currentMerges();var b=this.currentSplits();a=JSON.stringify({action:"save",merge:a,split:b});Object(l.g)(this,a);
case "select":a=this.displayState.segmentSelectionState,a.hasSelectedSegment&&(a=a.selectedSegment,b=this.displayState.visibleSegments,b.has(a)?b.delete(a):b.add(a))}}}]);return c}(n.f),W=function(b){function c(b,d){q(this,c);var e=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));e.element=b;e.layer=d;e.visibleSegmentWidget=e.registerDisposer(new x.a(e.layer.displayState));e.addSegmentWidget=e.registerDisposer(new H.a);e.selectedAlphaWidget=e.registerDisposer(new D.a(e.layer.displayState.selectedAlpha));
e.notSelectedAlphaWidget=e.registerDisposer(new D.a(e.layer.displayState.notSelectedAlpha));e.objectAlphaWidget=e.registerDisposer(new D.a(e.layer.displayState.objectAlpha));b.classList.add("segmentation-dropdown");var f=e.notSelectedAlphaWidget,g=e.objectAlphaWidget;e.selectedAlphaWidget.promptElement.textContent="Opacity (on)";f.promptElement.textContent="Opacity (off)";g.promptElement.textContent="Opacity (3d)";b.appendChild(e.selectedAlphaWidget.element);b.appendChild(e.notSelectedAlphaWidget.element);
b.appendChild(e.objectAlphaWidget.element);d=e.registerDisposer(new y.b(d.displayState.hideSegmentZero));d.element.className="neuroglancer-segmentation-dropdown-hide-segment-zero neuroglancer-noselect";f=document.createElement("label");f.className="neuroglancer-segmentation-dropdown-hide-segment-zero neuroglancer-noselect";f.appendChild(document.createTextNode("Hide segment ID 0"));f.appendChild(d.element);b.appendChild(f);e.addSegmentWidget.element.classList.add("add-segment");e.addSegmentWidget.element.title=
"Add one or more segment IDs";b.appendChild(e.registerDisposer(e.addSegmentWidget).element);e.registerDisposer(e.addSegmentWidget.valuesEntered.add(function(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())e.layer.displayState.visibleSegments.add(b.value)}));b.appendChild(e.registerDisposer(e.visibleSegmentWidget).element);if(void 0!==e.layer.skeletonsPath){d=document.createElement("div");d.className="neuroglancer-segmentation-dropdown-skeleton-shader-header";f=document.createElement("div");
f.style.flex="1";f.textContent="Skeleton shader:";g=document.createElement("a");var h=document.createElement("button");h.type="button";h.textContent="?";h.className="help-link";g.appendChild(h);g.title="Documentation on skeleton rendering";g.target="_blank";g.href="https://github.com/google/neuroglancer/blob/master/src/neuroglancer/sliceview/image_layer_rendering.md";h=document.createElement("button");h.innerHTML="&square;";h.className="maximize-button";h.title="Show larger editor view";e.registerEventListener(h,
"click",function(){new V(e.layer)});d.appendChild(f);d.appendChild(h);d.appendChild(g);b.appendChild(d);d=e.codeWidget=e.registerDisposer(a(e.layer));b.appendChild(d.element);d.textEditor.refresh()}return e}r(c,b);T(c,[{key:"onShow",value:function(){void 0!==this.codeWidget&&this.codeWidget.textEditor.refresh()}}]);return c}(n.g),V=function(b){function c(b){q(this,c);var d=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));d.layer=b;d.codeWidget=d.registerDisposer(a(d.layer));d.content.classList.add("neuroglancer-segmentation-layer-skeleton-shader-overlay");
d.content.appendChild(d.codeWidget.element);d.codeWidget.textEditor.refresh();return d}r(c,b);return c}(e.a);Object(l.e)("segmentation",R);Object(l.f)(d.d.SEGMENTATION,R)},function(n,e,c){e.a=function(c){if(c instanceof q.MultiscaleVolumeChunkSource){var e=c.channel,a=c.key;c=c.baseUrls[0].split("://").pop();return{channel:e,host:c,key:a}}return{channel:void 0,host:void 0,key:void 0}};var q=c(41)},function(n,e,c){e.a=function(c,e,n,a){e*=6;var b=Math.floor(e),l=e-b;e=a*(1-n);var m=a*(1-n*l);n=a*(1-
n*(1-l));switch(b%6){case 0:c[0]=a;c[1]=n;c[2]=e;break;case 1:c[0]=m;c[1]=a;c[2]=e;break;case 2:c[0]=e;c[1]=a;c[2]=n;break;case 3:c[0]=e;c[1]=m;c[2]=a;break;case 4:c[0]=n;c[1]=e;c[2]=a;break;case 5:c[0]=a,c[1]=e,c[2]=m}return c}},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return u});var m=c(181),r=c(2),a=c(3),b=c(11);n=c(6);var l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),w=function g(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),
null!==a)return g(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};e=this&&this.__decorate||function(a,b,c,e){var d=arguments.length,f=3>d?b:null===e?e=Object.getOwnPropertyDescriptor(b,c):e,g;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)f=Reflect.decorate(a,b,c,e);else for(var k=a.length-1;0<=k;k--)if(g=a[k])f=(3>d?g(f):3<d?g(b,c,f):g(b,c))||f;return 3<d&&f&&Object.defineProperty(b,c,f),f};var u=function(c){function d(){if(!(this instanceof
d))throw new TypeError("Cannot call a class as a function");var b=(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");b=!b||"object"!==typeof b&&"function"!==typeof b?this:b;b.disjointSets=new m.a;b.changed=new a.a;return b}q(d,c);l(d,[{key:"disposed",value:function(){this.changed=this.disjointSets=void 0;w(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"disposed",this).call(this)}},
{key:"split",value:function(){this.disjointSets.split()}},{key:"link",value:function(a,b,c){this.disjointSets.link(a,b,void 0===c?!1:c)&&((c=this.rpc)&&c.invoke("DisjointUint64Sets.add",{id:this.rpcId,al:a.low,ah:a.high,bl:b.low,bh:b.high}),this.changed.dispatch())}},{key:"get",value:function(a){return this.disjointSets.get(a)}},{key:"clear",value:function(){if(this.disjointSets.clear()){var a=this.rpc;a&&a.invoke("DisjointUint64Sets.clear",{id:this.rpcId});this.changed.dispatch()}}},{key:"setElements",
value:function(a){return this.disjointSets.setElements(a)}},{key:"toJSON",value:function(){return this.disjointSets.toJSON()}},{key:"splitJSON",value:function(){return this.disjointSets.splitJSON()}},{key:"restoreState",value:function(a){var c=this;this.clear();if(void 0!==a){var d=[new b.a,new b.a];Object(r.a)(a,function(a){Object(r.a)(a,function(a,b){Object(m.b)(d[b%2],String(a));0!==b&&c.link(d[0],d[1])})})}this.changed.dispatch()}},{key:"restoreSaved",value:function(a){var c=this;if(void 0!==
a){var d=[new b.a,new b.a];Object(r.a)(a,function(a){Object(r.a)(a,function(a,b){Object(m.b)(d[b%2],String(a));0!==b&&c.link(d[0],d[1],!0)})})}this.changed.dispatch()}},{key:"size",get:function(){return this.disjointSets.size}},{key:"hasSplits",get:function(){return this.disjointSets.hasSplits}}],[{key:"makeWithCounterpart",value:function(a){var b=new this;b.initializeCounterpart(a);return b}}]);return d}(n.c);u=e([Object(n.f)("DisjointUint64Sets")],u);var p=new b.a,k=new b.a;Object(n.e)("DisjointUint64Sets.add",
function(a){var b=this.get(a.id);p.low=a.al;p.high=a.ah;k.low=a.bl;k.high=a.bh;b.disjointSets.link(p,k)&&b.changed.dispatch()});Object(n.e)("DisjointUint64Sets.clear",function(a){a=this.get(a.id);a.disjointSets.clear()&&a.changed.dispatch()})},function(n,e,c){function q(a){for(var b=a,c=a[u];c!==a;)a=c,c=a[u];for(a=b[u];c!==a;)b[u]=c,b=a,a=b[u];return c}function m(a){function b(b,f){for(;;)switch(c){case 0:e=!0,d=a;case 1:if(!e&&d===a){c=3;break}c=4;return{value:d,done:!1};case 4:if(void 0===f){c=
5;break}c=-1;throw f;case 5:d=d[p];case 2:e=!1;c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,d,e,f={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();f[Symbol.iterator]=function(){return this};return f}function r(a){var b=a.clone();b[u]=b;b[w]=0;b[g]=!1;b[p]=b[k]=b;b[h]=a[h]||0;return b}function a(a,b){var c=$jscomp.makeIterator(b.split(":"));b=c.next().value;c=c.next().value;
c=parseInt(c)||0;a.parseString(b,10)[h]=c}e.b=a;c.d(e,"a",function(){return f});var b=c(11),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();$jscomp.initSymbol();var w=Symbol("disjoint_sets:rank");$jscomp.initSymbol();var u=Symbol("disjoint_sets:parent");$jscomp.initSymbol();var p=Symbol("disjoint_sets:next");
$jscomp.initSymbol();var k=Symbol("disjoint_sets:prev");$jscomp.initSymbol();var h=Symbol("disjoint_sets:split");$jscomp.initSymbol();var g=Symbol("disjoint_sets:save");$jscomp.initSymbol();var d=Symbol("disjoint_sets:min");n=r(new b.a);e=r(new b.a);a(n,"0:1");a(e,"0:2");var f=function(){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.map=new Map;this.generation=0;this.splitState={zMap:new Map([["0:1",[0]]]),yMap:new Map([["1:2",[0]]]),xMap:new Map([["2:3",
[0]]]),mainMap:new Map([["45",[0]]]),subregions:[["45:1","2:3","1:2","0:1"]]}}$jscomp.initSymbol();$jscomp.initSymbolIterator();l(a,[{key:"get",value:function(a){var b=this.map.get(a.toString());return void 0===b?a:q(b)[d]}},{key:"isMinElement",value:function(a){var c=this.get(a);return c===a||b.a.equal(c,a)}},{key:"makeSet",value:function(a,b){b=void 0===b?!1:b;var c=a.toString(),e=this.map.get(c);if(void 0===e)return e=r(a),this.saveNode(e,b),e[d]=e,this.map.set(c,e),e;this.saveNode(e,b);return q(e)}},
{key:"saveNode",value:function(a,b){a[g]=void 0===b?!1:b}},{key:"isSaved",value:function(a){return a[g]}},{key:"split",value:function(){}},{key:"link",value:function(a,c,e){e=void 0===e?!1:e;a=this.makeSet(a,e);c=this.makeSet(c,e);if(a===c)return!1;this.generation++;e=a;var f=c,g=e[w],h=f[w];g>h?f[u]=e:(e[u]=f,g===h&&(f[w]=h+1),e=f);f=a;g=c;h=f[k];var l=g[k];g[k]=h;h[p]=g;f[k]=l;l[p]=f;e[d]=b.a.min(a[d],c[d]);return!0}},{key:"setElements",value:function(a){function b(b,k){for(;;)switch(c){case 0:g=
a.toString();f=h.map.get(g);if(void 0!==f){c=1;break}c=3;return{value:a,done:!1};case 3:if(void 0===k){c=4;break}c=-1;throw k;case 4:c=2;break;case 1:e=$jscomp.makeIterator(m(f));case 5:if((d=e.next(b)).done){c=6;break}c=7;return{value:d.value,done:!1};case 7:if(void 0===k){c=8;break}c=-1;throw k;case 8:c=5;break;case 6:case 2:c=-1;default:return{value:void 0,done:!0}}}var c=0,d,e,f,g,h=this,k={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");
}};$jscomp.initSymbolIterator();k[Symbol.iterator]=function(){return this};return k}},{key:"clear",value:function(){var a=this.map;if(0===a.size)return!1;++this.generation;a.clear();return!0}},{key:"mappings",value:function(a){function b(b,k){for(;;)switch(c){case 0:a=void 0===a?Array(2):a,g=$jscomp.makeIterator(h.map.values()),f=g.next();case 1:if(f.done){c=3;break}e=f.value;a[0]=e;a[1]=q(e)[d];c=4;return{value:a,done:!1};case 4:if(void 0===k){c=5;break}c=-1;throw k;case 5:case 2:f=g.next();c=1;
break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,e,f,g,h=this,k={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();k[Symbol.iterator]=function(){return this};return k}},{key:Symbol.iterator,value:function(){return this.mappings()}},{key:"toJSON",value:function(){for(var a=[],c=$jscomp.makeIterator(this.map.values()),d=c.next();!d.done;d=c.next())if(d=d.value,d[u]===d){for(var e=
[],f=$jscomp.makeIterator(m(d)),g=f.next();!g.done;g=f.next())g=g.value,this.isSaved(d)&&this.isSaved(g)||e.push(g);e.length&&(-1===e.indexOf(d)&&e.unshift(d),e.sort(b.a.compare),a.push(e))}a.sort(function(a,c){return b.a.compare(a[0],c[0])});return a.map(function(a){return a.map(function(a){var b=a[h];a=a.toString();b=b?a+":"+b.toString():a;return b})})}},{key:"splitJSON",value:function(){return this.splitState.subregions.map(function(a){return a.join(":")})}},{key:"size",get:function(){return this.map.size}},
{key:"hasSplits",get:function(){return 0<this.splitState.subregions.length}}]);return a}()},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,
configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(e,"a",function(){return d});var a=c(62),b=c(102),l=c(101),w=c(37);n=c(94);var u=c(7),p=function v(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return v(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:
b.call(c)}},k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),h=new Float32Array(8),g=function(){function b(c){r(this,b);this.disjointSets=c;this.generation=Number.NaN;this.hashMap=new a.a}k(b,[{key:"update",value:function(){var a=this.disjointSets,b=a.generation;if(this.generation!==b){this.generation=b;
b=this.hashMap;b.clear();a=$jscomp.makeIterator(a.mappings());for(var c=a.next();!c.done;c=a.next()){var d=$jscomp.makeIterator(c.value);c=d.next().value;d=d.next().value;b.set(c,d)}}}}]);return b}(),d=function(a){function c(a,d){r(this,c);var e=q(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,a,{sourceOptions:d.volumeSourceOptions}));e.displayState=d;e.segmentColorShaderManager=new l.b("segmentColorHash");e.hashTableManager=new b.c("visibleSegments");e.gpuHashTable=b.a.get(e.gl,e.displayState.visibleSegments.hashTable);
e.equivalencesShaderManager=new b.b("equivalences");e.equivalencesHashMap=new g(e.displayState.segmentEquivalences.disjointSets);e.gpuEquivalencesHashTable=b.a.get(e.gl,e.equivalencesHashMap.hashMap);Object(w.g)(d,e);e.registerDisposer(d.selectedAlpha.changed.add(function(){e.redrawNeeded.dispatch()}));e.registerDisposer(d.hideSegmentZero.changed.add(function(){e.redrawNeeded.dispatch();e.shaderUpdated=!0}));e.hasEquivalences=0!==e.displayState.segmentEquivalences.size;d.segmentEquivalences.changed.add(function(){var a=
0!==e.displayState.segmentEquivalences.size;a!==e.hasEquivalences&&(e.hasEquivalences=a,e.shaderUpdated=!0)});e.registerDisposer(d.notSelectedAlpha.changed.add(function(){e.redrawNeeded.dispatch()}));return e}m(c,a);k(c,[{key:"getValueAt",value:function(a){for(var b=$jscomp.makeIterator(this.sources),c=b.next();!c.done;c=b.next()){c=$jscomp.makeIterator(c.value);for(var d=c.next();!d.done;d=c.next())if(d=d.value.getValueAt(a),null!=d)return d}return null}},{key:"getShaderKey",value:function(){return"sliceview.SegmentationRenderLayer/"+
this.hasEquivalences+"/"+this.displayState.hideSegmentZero.value}},{key:"defineShader",value:function(a){p(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"defineShader",this).call(this,a);this.hashTableManager.defineShader(a);a.addFragmentCode("\nuint64_t getUint64DataValue() {\n  return toUint64(getDataValue());\n}\n");this.hasEquivalences?(this.equivalencesShaderManager.defineShader(a),a.addFragmentCode("\nuint64_t getMappedObjectId() {\n  uint64_t value = getUint64DataValue();\n  uint64_t mappedValue;\n  if ("+
this.equivalencesShaderManager.getFunctionName+"(value, mappedValue)) {\n    return mappedValue;\n  }\n  return value;\n}\n")):a.addFragmentCode("\nuint64_t getMappedObjectId() {\n  return getUint64DataValue();\n}\n");this.segmentColorShaderManager.defineShader(a);a.addUniform("highp vec4","uSelectedSegment",2);a.addUniform("highp float","uShowAllSegments");a.addUniform("highp float","uSelectedAlpha");a.addUniform("highp float","uNotSelectedAlpha");a.addFragmentCode(u.o);var b="\n  uint64_t value = getMappedObjectId();\n  \n  float alpha = uSelectedAlpha;\n  float saturation = 1.0;\n";
this.displayState.hideSegmentZero.value&&(b+="\n  if (value.low == vec4(0,0,0,0) && value.high == vec4(0,0,0,0)) {\n    emit(vec4(vec4(0, 0, 0, 0)));\n    return;\n  }\n");b+="\n  bool has = uShowAllSegments > 0.0 ? true : "+this.hashTableManager.hasFunctionName+"(value);\n  if (uSelectedSegment[0] == unnormalizeUint8(value.low) &&\n      uSelectedSegment[1] == unnormalizeUint8(value.high)) {\n    saturation = has ? 0.5 : 0.75;\n  } else if (!has) {\n    alpha = uNotSelectedAlpha;\n  }\n  vec3 rgb = segmentColorHash(value);\n  emit(vec4(mix(vec3(1.0,1.0,1.0), rgb, saturation), alpha));\n";
a.setFragmentMain(b)}},{key:"beginSlice",value:function(a){a=p(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"beginSlice",this).call(this,a);var b=this.gl,d=this.displayState,e=this.displayState,g=e.segmentSelectionState;e=e.visibleSegments;if(g.hasSelectedSegment){var k=g.selectedSegment;g=k.low;k=k.high;for(var l=0;4>l;++l)h[l]=g>>8*l&255,h[4+l]=k>>8*l&255}else h.fill(0);b.uniform1f(a.uniform("uSelectedAlpha"),this.displayState.selectedAlpha.value);b.uniform1f(a.uniform("uNotSelectedAlpha"),
this.displayState.notSelectedAlpha.value);b.uniform4fv(a.uniform("uSelectedSegment"),h);b.uniform1f(a.uniform("uShowAllSegments"),e.hashTable.size?0:1);this.hashTableManager.enable(b,a,this.gpuHashTable);this.hasEquivalences&&(this.equivalencesHashMap.update(),this.equivalencesShaderManager.enable(b,a,this.gpuEquivalencesHashTable));this.segmentColorShaderManager.enable(b,a,d.segmentColorHash);return a}},{key:"endSlice",value:function(a){this.hashTableManager.disable(this.gl,a);p(c.prototype.__proto__||
Object.getPrototypeOf(c.prototype),"endSlice",this).call(this,a)}}]);return c}(n.a)},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return l});var m=c(62),r=c(3);n=c(6);var a=function(){function a(a,
b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),b=function p(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return p(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};e=this&&this.__decorate||function(a,
b,c,e){var d=arguments.length,f=3>d?b:null===e?e=Object.getOwnPropertyDescriptor(b,c):e,g;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)f=Reflect.decorate(a,b,c,e);else for(var h=a.length-1;0<=h;h--)if(g=a[h])f=(3>d?g(f):3<d?g(b,c,f):g(b,c))||f;return 3<d&&f&&Object.defineProperty(b,c,f),f};var l=w=function(c){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var a=(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a.hashTable=new m.b;a.changed=new r.b;return a}q(e,c);$jscomp.initSymbol();$jscomp.initSymbolIterator();a(e,[{key:"disposed",value:function(){b(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"disposed",this).call(this);this.changed=this.hashTable=void 0}},{key:"add_",value:function(a){return this.hashTable.add(a)}},{key:"add",value:function(a){if(this.add_(a)){var b=this.rpc;b&&b.invoke("Uint64Set.add",{id:this.rpcId,value:a});this.changed.dispatch(a,
!0)}}},{key:"has",value:function(a){return this.hashTable.has(a)}},{key:Symbol.iterator,value:function(){return this.hashTable.keys()}},{key:"delete_",value:function(a){return this.hashTable.delete(a)}},{key:"delete",value:function(a){if(this.delete_(a)){var b=this.rpc;b&&b.invoke("Uint64Set.delete",{id:this.rpcId,value:a});this.changed.dispatch(a,!1)}}},{key:"clear",value:function(){if(this.hashTable.clear()){var a=this.rpc;a&&a.invoke("Uint64Set.clear",{id:this.rpcId});this.changed.dispatch(null,
!1)}}},{key:"toJSON",value:function(){for(var a=[],b=$jscomp.makeIterator(this),c=b.next();!c.done;c=b.next())a.push(c.value.toString());a.sort();return a}},{key:"size",get:function(){return this.hashTable.size}}],[{key:"makeWithCounterpart",value:function(a){var b=new w;b.initializeCounterpart(a);return b}}]);return e}(n.c);l=w=e([Object(n.f)("Uint64Set")],l);Object(n.e)("Uint64Set.add",function(a){var b=this.get(a.id);b.add_(a.value)&&b.changed.dispatch()});Object(n.e)("Uint64Set.delete",function(a){var b=
this.get(a.id);b.delete_(a.value)&&b.changed.dispatch()});Object(n.e)("Uint64Set.clear",function(a){a=this.get(a.id);a.hashTable.clear()&&a.changed.dispatch()});var w},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=
Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return l});n=c(0);e=c(11);var r=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),a=function u(a,b,c){null===a&&(a=Function.prototype);
var e=Object.getOwnPropertyDescriptor(a,b);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==a)return u(a,b,c)}else{if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(c)}};c(21);c(185);var b=new e.a,l=function(c){function e(a){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var b=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));b.displayState=a;b.element=document.createElement("div");b.clearButton=document.createElement("button");b.itemContainer=
document.createElement("span");b.items=new Map;var c=b.element,d=b.clearButton,f=b.itemContainer;c.className="segment-set-widget neuroglancer-noselect";d.className="clear-button";d.title="Remove all segment IDs";b.registerEventListener(d,"click",function(){b.visibleSegments.clear()});f.className="item-container";c.appendChild(f);f.appendChild(d);b.registerDisposer(a.visibleSegments.changed.add(function(a,c){b.handleSetChanged(a,c)}));b.registerDisposer(a.segmentColorHash.changed.add(function(){b.handleColorChanged()}));
a=$jscomp.makeIterator(a.visibleSegments);for(c=a.next();!c.done;c=a.next())b.addElement(c.value.toString());b.updateClearButtonVisibility();return b}m(e,c);r(e,[{key:"updateClearButtonVisibility",value:function(){this.clearButton.style.display=0<this.displayState.visibleSegments.size?"":"none"}},{key:"handleSetChanged",value:function(a,b){this.updateClearButtonVisibility();var c=this.items;if(null===a){a=this.itemContainer;for(b=this.clearButton;;){var d=a.lastElementChild;if(d===b)break;a.removeChild(d)}c.clear()}else b?
this.addElement(a.toString()):(a=a.toString(),b=c.get(a),b.parentElement.removeChild(b),c.delete(a))}},{key:"addElement",value:function(a){var c=document.createElement("button");c.className="segment-button";c.textContent=a;c.title="Remove segment ID "+a;var e=this;c.addEventListener("click",function(){b.tryParseString(this.textContent);e.visibleSegments.delete(b)});c.addEventListener("mouseenter",function(){b.tryParseString(this.textContent);e.segmentSelectionState.set(b)});c.addEventListener("mouseleave",
function(){b.tryParseString(this.textContent);e.segmentSelectionState.set(null)});this.setItemColor(c);this.itemContainer.appendChild(c);this.items.set(a,c)}},{key:"setItemColor",value:function(a){b.tryParseString(a.textContent);a.style.backgroundColor=this.segmentColorHash.computeCssColor(b)}},{key:"handleColorChanged",value:function(){var a=this;this.items.forEach(function(b){a.setItemColor(b)})}},{key:"disposed",value:function(){var b=this.element,c=b.parentElement;c&&c.removeChild(b);a(e.prototype.__proto__||
Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}},{key:"visibleSegments",get:function(){return this.displayState.visibleSegments}},{key:"segmentColorHash",get:function(){return this.displayState.segmentColorHash}},{key:"segmentSelectionState",get:function(){return this.displayState.segmentSelectionState}}]);return e}(n.a)},function(n,e){},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==
typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return u});n=c(0);var r=c(5),a=c(3),b=c(11),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||
!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),w=function k(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return k(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};c(21);c(187);var u=function(c){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");
var b=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));b.element=document.createElement("form");b.label=document.createElement("label");b.input=document.createElement("input");b.valuesEntered=new a.b;var c=b.element,f=b.label,h=b.input;c.className="uint64-entry neuroglancer-noselect";c.appendChild(f);f.appendChild(h);b.registerEventListener(c,"submit",function(a){a.preventDefault();a=b.validateInput();void 0!==a&&(b.input.value="",b.input.classList.remove("valid-input","invalid-input"),
b.valuesEntered.dispatch(a))});b.registerEventListener(c,"input",function(){""===b.input.value?b.input.classList.remove("valid-input","invalid-input"):b.validateInput()?b.input.classList.remove("invalid-input"):b.input.classList.add("invalid-input")});return b}m(e,c);l(e,[{key:"validateInput",value:function(){var a=this.input.value;a=a.replace(/[\s,\(\)\[\]\{\};]+/g," ");a=a.trim();var c=a.split(" ");if(0!==c.length){a=[];c=$jscomp.makeIterator(c);for(var e=c.next();!e.done;e=c.next()){e=e.value;
var h=new b.a;if(!h.tryParseString(e))return;a.push(h)}return a}}},{key:"disposed",value:function(){Object(r.b)(this.element);w(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}}]);return e}(n.a)},function(n,e){},function(n,e,c){e=function(c){this._socket=void 0;this._editorLayer=c};e.prototype.open=function(c,e){var m=this._formatPath();try{this._socket=new WebSocket(m),this._socket.onmessage=this.on_message.bind(this),this._socket.onopen=this.on_open.bind(this,
c),this._socket.onclose=this.on_close.bind(this,e)}catch(a){e("No open socket.")}};e.prototype.send=function(c,e,n){if(void 0===this._socket){var a=this.open.bind(this);c=this.send.bind(this,c,e,n);(new Promise(a)).then(c).catch(e)}else try{this._socket.send(n),c("Message sent.")}catch(b){e("Message error.")}};e.prototype.close=function(){this._socket.close()};e.prototype._formatPath=function(){var c=this._editorLayer.editorSource,e=c.host,n=c.key;c=c.channel;return"ws"+location.protocol.substr(4).split(":")[0]+
"://"+e+"/ws/"+n+"/"+c};e.prototype.on_message=function(c){this._editorLayer.handleMessage(c.data)};e.prototype.on_open=function(c,e){c("Established websocket.")};e.prototype.on_close=function(c){this._socket=void 0;c("Websocket dropped.")};n.exports={EditorSocket:e}},function(n,e){},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){return a.split(/[^a-zA-Z0-9]+/).filter(function(a){return a}).join("_")}function b(b){var c=new Set,d=[];b=$jscomp.makeIterator(b);
for(var e=b.next();!e.done;e=b.next()){e=a(e.value);for(var f="",g=0;c.has(e+f);)f=""+ ++g;d.push(e+f)}return d}function l(a){return new f.a({fragmentMain:a.displayState.fragmentMain,shaderError:a.displayState.shaderError,fragmentMainStartLine:k.a})}function w(a){return new G(a.displayState.attributeNames,function(){return a.meshSource&&a.meshSource.info.vertexAttributes})}Object.defineProperty(e,"__esModule",{value:!0});c.d(e,"SingleMeshUserLayer",function(){return y});n=c(13);var u=c.n(n);n=c(12);
e=c(9);var p=c(29),k=c(191),h=c(0),g=c(5),d=c(2),f=c(59),v=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();c(193);var y=function(a){function c(a,e){q(this,c);var f=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,[]));f.manager=a;f.displayState=new k.b;f.parameters={meshSourceUrl:Object(d.w)(e,"source",
d.B),attributeSourceUrls:Object(d.w)(e,"vertexAttributeSources",function(a){return void 0!==a?Object(d.a)(a,d.B):[]})};f.displayState.objectToDataTransform.restoreState(e.transform);f.displayState.fragmentMain.restoreState(e.shader);f.userSpecifiedAttributeNames=Object(d.w)(e,"vertexAttributeNames",function(a){if(void 0!==a)return Object(d.a)(a,function(a){if(a=Object(d.z)(a))return a})});Object(k.e)(a.chunkManager,f.parameters).then(function(a){if(!f.wasDisposed){f.meshSource=a;var c=f.defaultAttributeNames=
b(a.info.vertexAttributes.map(function(a){return a.name})),d=f.userSpecifiedAttributeNames;void 0!==d&&d.length===c.length?(c=d,f.userSpecifiedAttributeNames=void 0):c=Array.from(c);f.displayState.attributeNames.value=c;f.addRenderLayer(new k.c(a,f.displayState))}});f.registerDisposer(f.displayState.fragmentMain.changed.add(function(){f.specificationChanged.dispatch()}));f.registerDisposer(f.displayState.attributeNames.changed.add(function(){f.specificationChanged.dispatch()}));return f}r(c,a);v(c,
[{key:"toJSON",value:function(){var a={type:"mesh"},b=this.parameters.attributeSourceUrls;a.source=this.parameters.meshSourceUrl;b&&(a.vertexAttributeSources=b);a.shader=this.displayState.fragmentMain.toJSON();a.transform=this.displayState.objectToDataTransform.toJSON();if(void 0===this.meshSource)b=this.userSpecifiedAttributeNames;else{b=this.defaultAttributeNames;for(var c=this.displayState.attributeNames.value,d=!0,e=c.length,f=0;f<e;++f)if(c[f]!==b[f]){d=!1;break}b=d?void 0:Array.from(c)}a.vertexAttributeNames=
b;return a}},{key:"makeDropdown",value:function(a){return new E(a,this)}}]);return c}(n.f),G=function(a){function b(a,c){q(this,b);var d=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));d.attributeNames=a;d.getAttributeInfo=c;d.element=document.createElement("div");d.debouncedValueUpdater=u()(function(){d.updateAttributeNames()},500);d.element.className="neuroglancer-single-mesh-attribute-widget";d.updateInputElements();d.registerDisposer(a.changed.add(function(){d.updateInputElements()}));
return d}r(b,a);v(b,[{key:"updateInputElements",value:function(){var a=this.attributeNames,b=this.attributeNameElements;if(void 0===b){var c=this.getAttributeInfo();if(void 0===c)return;b=this.attributeNameElements=[];for(var d=void 0,e=a.value.length,f=this.element,g=0;g<e;++g){var h=c[g],l=h.source;if(l!==d&&void 0!==l){d=l;var m=document.createElement("div");m.className="neuroglancer-single-mesh-source-header";m.textContent=l;f.appendChild(m)}l=document.createElement("div");l.className="neuroglancer-single-mesh-attribute";
m=document.createElement("input");m.title=h.name;this.registerEventListener(m,"input",this.debouncedValueUpdater);m.type="text";l.textContent=Object(k.d)(h);l.appendChild(m);if(void 0!==h.min&&void 0!==h.max){var n=document.createElement("span");n.className="neuroglancer-single-mesh-attribute-range";n.textContent="["+h.min.toPrecision(6)+", "+h.max.toPrecision(6)+"]";l.appendChild(n)}b[g]=m;f.appendChild(l)}}a.value.forEach(function(a,c){b[c].value=a||""})}},{key:"disposed",value:function(){Object(g.b)(this.element)}},
{key:"updateAttributeNames",value:function(){var a=this.attributeNames.value,b=this.attributeNameElements,c=!1;a.forEach(function(d,e){var f=b[e].value;f||(f=void 0);f!==d&&(c=!0,a[e]=f)});c&&this.attributeNames.changed.dispatch()}}]);return b}(h.a),E=function(a){function b(a,c){q(this,b);var d=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));d.element=a;d.layer=c;d.attributeWidget=d.registerDisposer(w(d.layer));d.codeWidget=d.registerDisposer(l(d.layer));a.classList.add("neuroglancer-single-mesh-dropdown");
c=document.createElement("div");c.className="neuroglancer-single-mesh-dropdown-top-row";var e=document.createElement("div");e.style.flex="1";var f=document.createElement("a"),g=document.createElement("button");g.type="button";g.textContent="?";g.className="help-link";f.appendChild(g);f.title="Documentation on single mesh layer rendering";f.target="_blank";f.href="https://github.com/google/neuroglancer/blob/master/src/neuroglancer/sliceview/image_layer_rendering.md";g=document.createElement("button");
g.innerHTML="&square;";g.className="maximize-button";g.title="Show larger editor view";d.registerEventListener(g,"click",function(){new B(d.layer)});c.appendChild(e);c.appendChild(g);c.appendChild(f);a.appendChild(c);a.appendChild(d.attributeWidget.element);a.appendChild(d.codeWidget.element);d.codeWidget.textEditor.refresh();return d}r(b,a);v(b,[{key:"onShow",value:function(){this.codeWidget.textEditor.refresh()}}]);return b}(n.g),B=function(a){function b(a){q(this,b);var c=m(this,(b.__proto__||
Object.getPrototypeOf(b)).call(this));c.layer=a;c.attributeWidget=c.registerDisposer(w(c.layer));c.codeWidget=c.registerDisposer(l(c.layer));c.content.classList.add("neuroglancer-single-mesh-layer-shader-overlay");c.content.appendChild(c.attributeWidget.element);c.content.appendChild(c.codeWidget.element);c.codeWidget.textEditor.refresh();return c}r(b,a);return b}(p.a);Object(e.e)("mesh",y)},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function a(){return new g.a([],function(a){return Object(v.a)(a,
v.z)})}function b(a){return Object(x.a)(a.dataType,a.numComponents)}function l(a){return a.map(function(a){return Object(z.c)(new z.b,a.dataType,a.numComponents)})}function w(a,b){return a.memoize.getUncounted({type:"single_mesh:getMeshInfo",parameters:b},function(){return a.rpc.promiseInvoke(h.a,{chunkManager:a.addCounterpartRef(),parameters:b})})}c.d(e,"b",function(){return T});e.d=b;c.d(e,"c",function(){return ha});e.e=function(a,b){return w(a,b).then(function(c){return a.getChunkSource(Q,{parameters:Object.assign({},
b,{info:c})})})};var u=c(23);n=c(10);var p=c(57),k=c(32),h=c(192),g=c(4),d=c(27),f=c(1),v=c(2),y=c(19),G=c(33),E=c(28),B=c(103),z=c(63),D=c(25),x=c(7),C=c(6),H=function P(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return P(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},K=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;
d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();e.a="//NEUROGLANCER_SINGLE_MESH_LAYER_FRAGMENT_MAIN_START";var F=c(55),T=function Va(){r(this,Va);this.shaderError=Object(E.b)();var b=void 0;this.fragmentMain=new g.a(void 0===b?"void main() {\n  emitGray();\n}\n":b,v.B);this.attributeNames=a();this.objectToDataTransform=new p.a};$jscomp.initSymbol();var J=Symbol("SingleMeshShaderManager.vertexAttributeTextureUnit"),
R=Object(z.c)(new z.b,d.b.FLOAT32,3),W=function(){function a(b,c,d){r(this,a);this.attributeNames=b;this.attributeInfo=c;this.fragmentMain=d;this.tempLightVec=new Float32Array(4);this.tempPickID=new Float32Array(4);this.textureAccessHelper=new z.a("vertexData");this.indexBufferHelper=new B.a("VertexIndex")}K(a,[{key:"defineAttributeAccess",value:function(a,c){var e=this.textureAccessHelper;e.defineShader(a);a.addVertexCode(e.getAccessor("readVertexPosition","uVertexAttributeSampler[0]",d.b.FLOAT32,
3));a.addVertexCode(e.getAccessor("readVertexNormal","uVertexAttributeSampler[1]",d.b.FLOAT32,3));var f=2,g="\nvec3 vertexPosition = readVertexPosition("+c+");\nvec3 vertexNormal = readVertexNormal("+c+");\n",h=this.attributeNames;this.attributeInfo.forEach(function(d,k){if(void 0!==h[k]){var l=b(d);a.addVarying("highp "+l,"vCustom"+k);a.addFragmentCode("\n#define "+h[k]+" vCustom"+k+"\n");a.addVertexCode(e.getAccessor("readAttribute"+k,"uVertexAttributeSampler["+f+"]",d.dataType,d.numComponents));
g+="vCustom"+k+" = readAttribute"+k+"("+c+");\n";f+=1}});a.addTextureSampler2D("uVertexAttributeSampler",J,f);a.addVertexMain(g)}},{key:"defineShader",value:function(a){a.require(B.b);this.indexBufferHelper.defineShader(a);a.addVarying("highp float","vLightingFactor");a.addUniform("highp vec4","uLightDirection");a.addUniform("highp vec4","uColor");a.addUniform("highp mat4","uModelMatrix");a.addUniform("highp mat4","uProjection");a.addUniform("highp vec4","uPickID");a.addVarying("highp vec4","vPickID");
a.addVertexCode(x.b);a.addVertexCode(x.c);a.addVertexMain("\nfloat vertexIndex = getVertexIndex();\nuint32_t triangleIndex;\ndivmod(getPrimitiveIndex(), 3.0, triangleIndex);\nuint32_t pickID; pickID.value = uPickID;\nvPickID = add(pickID, triangleIndex).value;\n");a.addFragmentCode("\nvoid emitPremultipliedRGBA(vec4 color) {\n  emit(vec4(color.rgb * vLightingFactor, color.a), vPickID);\n}\nvoid emitRGBA(vec4 color) {\n  color = clamp(color, 0.0, 1.0);\n  color.xyz *= color.a;\n  emitPremultipliedRGBA(color);\n}\nvoid emitRGB(vec3 color) {\n  emitRGBA(vec4(color, 1.0));\n}\nvoid emitGray() {\n  emitRGB(vec3(1.0, 1.0, 1.0));\n}\n");
a.addFragmentCode(F);this.defineAttributeAccess(a,"vertexIndex");a.addVertexMain("\ngl_Position = uProjection * (uModelMatrix * vec4(vertexPosition, 1.0));\nvec3 normal = normalize((uModelMatrix * vec4(vertexNormal, 0.0)).xyz);\nvLightingFactor = abs(dot(normal, uLightDirection.xyz)) + uLightDirection.w;\n");a.setFragmentMainFunction("//NEUROGLANCER_SINGLE_MESH_LAYER_FRAGMENT_MAIN_START\n"+this.fragmentMain)}},{key:"beginLayer",value:function(a,b,c){var d=c.dataToDevice,e=c.lightDirection,g=c.ambientLighting;
c=c.directionalLighting;a.uniformMatrix4fv(b.uniform("uProjection"),!1,d);d=this.tempLightVec;f.p.scale(d,e,c);d[3]=g;a.uniform4fv(b.uniform("uLightDirection"),d)}},{key:"setPickID",value:function(a,b,c){a.uniform4fv(b.uniform("uPickID"),Object(x.p)(this.tempPickID,c))}},{key:"beginObject",value:function(a,b,c){a.uniformMatrix4fv(b.uniform("uModelMatrix"),!1,c)}},{key:"getShader",value:function(a,b){var c=this,d={attributeNames:this.attributeNames,attributeInfo:this.attributeInfo,fragmentMain:this.fragmentMain};
return a.memoize.get("single_mesh/SingleMeshShaderManager:"+Object(y.a)(b)+":"+Object(v.g)(d),function(){var d=new D.a(a);d.require(b);c.defineShader(d);return d.build()})}},{key:"bindVertexData",value:function(a,b,c){this.textureAccessHelper.setupTextureLayout(a,b,c);var d=b.textureUnit(J)+a.TEXTURE0,e=function(b){a.activeTexture(d++);a.bindTexture(a.TEXTURE_2D,b)};e(c.vertexTexture);e(c.normalTexture);var f=this.attributeNames;c.vertexAttributeTextures.forEach(function(a,b){void 0!==f[b]&&e(a)})}},
{key:"disableVertexData",value:function(a,b){for(var c=2,d=this.attributeInfo.length,e=this.attributeNames,f=0;f<d;++f)void 0!==e[f]&&++c;b=b.textureUnit(J)+a.TEXTURE0;for(d=0;d<c;++d)a.activeTexture(b++),a.bindTexture(a.TEXTURE_2D,null)}},{key:"drawFragment",value:function(a,b,c,d){d.ensure(c.numIndices).bind(b);this.bindVertexData(a,b,c.vertexData);this.indexBufferHelper.bind(c.indexBuffer,b);a.drawArrays(a.TRIANGLES,0,c.numIndices)}},{key:"endLayer",value:function(a,b){Object(B.c)(a,b);this.indexBufferHelper.disable(b);
this.disableVertexData(a,b)}}]);return a}(),V=function(){function a(){r(this,a)}K(a,[{key:"copyToGPU",value:function(a,b){var c=this;Object(z.d)(this,a,1,this.vertexPositions.length/3);var d=function(b,d){var e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e);Object(z.f)(a,c,d,b);return e};this.vertexTexture=d(this.vertexPositions,R);this.normalTexture=d(this.vertexNormals,R);this.vertexAttributeTextures=this.vertexAttributes.map(function(a,c){return d(a,b[c])});a.bindTexture(a.TEXTURE_2D,null)}},
{key:"freeGPUMemory",value:function(a){a.deleteTexture(this.vertexTexture);a.deleteTexture(this.normalTexture);for(var b=this.vertexAttributeTextures,c=$jscomp.makeIterator(b),d=c.next();!d.done;d=c.next())a.deleteTexture(d.value);b.length=0}}]);return a}(),M=function(a){function b(a,c){r(this,b);a=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));var d=a.vertexData=new V;d.vertexPositions=c.vertexPositions;d.vertexNormals=c.vertexNormals;d.vertexAttributes=c.vertexAttributes;c=a.indices=
c.indices;a.numIndices=c.length;return a}m(b,a);K(b,[{key:"copyToGPU",value:function(a){H(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"copyToGPU",this).call(this,a);this.vertexData.copyToGPU(a,this.source.attributeTextureFormats);this.indexBuffer=Object(B.e)(a,this.indices)}},{key:"freeGPUMemory",value:function(a){H(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"freeGPUMemory",this).call(this,a);this.vertexData.freeGPUMemory(a);this.indexBuffer.dispose()}}]);return b}(n.b),
Q=function(a){function b(){r(this,b);var a=q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments));a.attributeTextureFormats=l(a.info.vertexAttributes);return a}m(b,a);K(b,[{key:"getChunk",value:function(a){return new M(this,a)}},{key:"info",get:function(){return this.parameters.info}}]);return b}(Object(n.f)(n.e,h.d)),aa=function(a){function b(){r(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}m(b,a);return b}(Object(G.c)(C.b)),ha=function(a){function b(a,
c){r(this,b);var d=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));d.source=a;d.displayState=c;d.shaders=new Map;d.sharedObject=d.registerDisposer(new aa);d.fallbackFragmentMain="void main() {\n  emitGray();\n}\n";d.countingBuffer=d.registerDisposer(Object(B.d)(d.gl));d.displayState.shaderError.value=void 0;var e=function(){d.shaderManager=void 0;d.displayState.shaderError.value=void 0;d.disposeShaders();d.redrawNeeded.dispatch()};d.registerDisposer(c.fragmentMain.changed.add(e));d.registerDisposer(c.attributeNames.changed.add(e));
d.registerDisposer(c.objectToDataTransform.changed.add(function(){d.redrawNeeded.dispatch()}));d.displayState.shaderError.value=void 0;c=d.sharedObject;c.visibility.add(d.visibility);c.RPC_TYPE_ID=h.c;c.initializeCounterpart(a.chunkManager.rpc,{chunkManager:a.chunkManager.rpcId,source:a.addCounterpartRef()});d.setReady(!0);return d}m(b,a);K(b,[{key:"disposeShaders",value:function(){for(var a=this.shaders,b=$jscomp.makeIterator(a.values()),c=b.next();!c.done;c=b.next())c=c.value,null!==c&&c.dispose();
a.clear()}},{key:"disposed",value:function(){this.disposeShaders();H(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"disposed",this).call(this)}},{key:"makeShaderManager",value:function(a){a=void 0===a?this.displayState.fragmentMain.value:a;return new W(this.displayState.attributeNames.value,this.source.info.vertexAttributes,a)}},{key:"getShader",value:function(a){var b=this.shaders,c=b.get(a);if(void 0===c){c=null;var d=this.shaderManager;void 0===d&&(d=this.shaderManager=this.makeShaderManager());
var e=this.displayState.fragmentMain.value;try{c=d.getShader(this.gl,a),this.fallbackFragmentMain=e,this.displayState.shaderError.value=null}catch(Ja){if(this.displayState.shaderError.value=Ja,d=this.fallbackFragmentMain,d!==e){d=this.shaderManager=this.makeShaderManager(d);try{c=d.getShader(this.gl,a)}catch(qc){}}}b.set(a,c)}return c}},{key:"draw",value:function(a){if(a.emitColor||!a.alreadyEmittedPickID){var b=this.source.chunks.get(h.b);if(void 0!==b&&b.state===u.d.GPU_MEMORY){var c=this.getShader(a.emitter);
if(null!==c){var d=this.gl,e=this.shaderManager;c.bind();e.beginLayer(d,c,a);var f=a.pickIDs;e.beginObject(d,c,this.displayState.objectToDataTransform.transform);a.emitPickID&&e.setPickID(d,c,f.register(this,b.numIndices/3));e.drawFragment(d,c,b,this.countingBuffer);e.endLayer(d,c)}}}}},{key:"drawPicking",value:function(a){this.draw(a)}},{key:"transformPickedValue",value:function(a,b){a=this.source.chunks.get(h.b);if(void 0!==a){b*=3;var c=a.indices;if(!(b>=c.length)){var d=c[b],e=[],f=this.displayState.attributeNames.value;
a.vertexData.vertexAttributes.forEach(function(a,b){b=f[b];void 0!==b&&e.push(b+"="+a[d].toPrecision(6))});return e.join(", ")}}}},{key:"isTransparent",get:function(){return null!==this.displayState.fragmentMain.value.match(/emitRGBA|emitPremultipliedRGBA/)}},{key:"gl",get:function(){return this.source.gl}}]);return b}(k.a)},function(n,e,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&
b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function m(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(e,"d",function(){return r});e.c="single_mesh/SingleMeshLayer";e.a="single_mesh/getSingleMeshInfo";e.b="";var r=function(a){function b(){m(this,b);var a=(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!a||"object"!==typeof a&&"function"!==typeof a?this:a}q(b,a);return b}(function b(){m(this,b)});r.RPC_ID="single_mesh/SingleMeshSource"},function(n,e){},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(e,"__esModule",{value:!0});c.d(e,"AnnotationPointListUserLayer",function(){return h});var a=c(195),b=c(196);n=c(12);e=c(9);var l=c(4),w=c(1),u=c(198),p=function f(a,b,c){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,b);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==
a)return f(a,b,c)}else{if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(c)}},k=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}();c(200);var h=function(c){function e(c,f){q(this,e);var g=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,[]));g.manager=c;g.selectedIndex=new l.b(null);
g.layer=new a.a(g.manager.chunkManager,new b.a,g.manager.voxelSize,g.selectedIndex);g.layer.pointList.restoreState(f.points);g.registerDisposer(g.layer.pointList.changed.add(function(){g.specificationChanged.dispatch()}));g.addRenderLayer(new a.b(g.layer));g.addRenderLayer(new a.c(g.layer));var h=c.layerSelectedValues;g.registerDisposer(h.changed.add(function(){var a=h.get(g);g.selectedIndex.value="number"===typeof a?a:null}));return g}r(e,c);k(e,[{key:"toJSON",value:function(){var a={type:"pointAnnotation"};
a.points=this.layer.pointList.toJSON();return a}},{key:"handleAction",value:function(a){switch(a){case "annotate":a=this.manager.layerSelectedValues.get(this),void 0!==a?this.layer.pointList.delete(a):this.manager.layerSelectedValues.mouseState.active&&this.layer.pointList.append(this.manager.voxelSize.voxelFromSpatial(w.p.create(),this.manager.layerSelectedValues.mouseState.position))}}},{key:"makeDropdown",value:function(a){return new g(a,this)}}]);return e}(n.f),g=function(a){function b(a,c){q(this,
b);var e=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));e.element=a;e.layer=c;e.pointListWidget=e.registerDisposer(new u.a(e.layer.layer.pointList,e.layer.selectedIndex));a.classList.add("neuroglancer-annotation-point-list-dropdown");a.appendChild(e.pointListWidget.element);e.registerDisposer(e.pointListWidget.pointSelected.add(function(a){e.layer.manager.setVoxelCoordinates(e.layer.layer.pointList.get(a))}));return e}r(b,a);k(b,[{key:"onShow",value:function(){p(b.prototype.__proto__||
Object.getPrototypeOf(b.prototype),"onShow",this).call(this);this.pointListWidget.visible=!0}},{key:"onHide",value:function(){p(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"onHide",this).call(this);this.pointListWidget.visible=!1}}]);return b}(n.g);Object(e.e)("pointAnnotation",h)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return y});c.d(e,"b",function(){return E});c.d(e,"c",function(){return z});n=c(32);e=c(51);var a=c(0),b=c(1),
l=c(3),w=c(17),u=c(103),p=c(25),k=c(7),h=c(54),g=function x(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return x(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,
c);d&&a(b,d);return b}}(),f=b.j.create(),v=new Float32Array(4),y=function(a){function c(a,b,d,e){q(this,c);var f=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));f.chunkManager=a;f.pointList=b;f.voxelSizeObject=d;f.selectedIndex=e;f.generation=-1;f.redrawNeeded=new l.a;f.color=Float32Array.of(1,1,0,1);f.selectedColor=Float32Array.of(0,1,0,1);f.buffer=new w.a(a.gl);f.registerDisposer(b.changed.add(function(){f.selectedIndex.value=null;f.redrawNeeded.dispatch()}));f.registerDisposer(e.changed.add(function(){f.redrawNeeded.dispatch()}));
return f}r(c,a);d(c,[{key:"updateBuffer",value:function(){var a=this.pointList,b=a.generation;this.generation!==b&&(this.generation=b,this.buffer.setData(a.points.view))}},{key:"updateMouseState",value:function(a,c){b.p.multiply(a.position,this.pointList.get(c),this.voxelSizeObject.size)}},{key:"gl",get:function(){return this.chunkManager.gl}}]);return c}(a.a);c=function(a){function c(a){q(this,c);var b=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));b.gl=a;b.shaders=new Map;b.squareCornersBuffer=
Object(h.a)(b.gl);b.countingBuffer=b.registerDisposer(Object(u.d)(b.gl));return b}r(c,a);d(c,[{key:"defineShader",value:function(a){a.addAttribute("highp vec3","aVertexPosition");a.addAttribute("highp vec2","aCornerOffset");a.addUniform("highp vec2","uPointRadii");a.addUniform("highp vec4","uColor");a.addUniform("highp vec4","uColorSelected");a.addUniform("highp vec4","uSelectedIndex");a.addVarying("highp vec4","vColor");a.addUniform("highp mat4","uProjection");a.addUniform("highp vec4","uPickID");
a.addVarying("highp vec4","vPickID");a.addVarying("highp vec2","vPointCoord");a.require(u.b);a.addVertexCode(k.b);a.setVertexMain("\ngl_Position = uProjection * vec4(aVertexPosition, 1.0);\ngl_Position.xy += aCornerOffset * uPointRadii * gl_Position.w;\nvPointCoord = aCornerOffset;\n\nuint32_t primitiveIndex = getPrimitiveIndex();\n\nuint32_t pickID; pickID.value = uPickID;\nvPickID = add(pickID, primitiveIndex).value;\n\nif (uSelectedIndex == primitiveIndex.value) {\n  vColor = uColorSelected;\n} else {\n  vColor = uColor;\n}\n");
a.setFragmentMain("\nif (dot(vPointCoord, vPointCoord) > 1.0) {\n  discard;\n}\nemit(getColor(), vPickID);\n")}},{key:"getShader",value:function(a){var b=this.shaders,c=b.get(a);void 0===c&&(c=new p.a(this.gl),c.require(a),this.defineShader(c),c=this.registerDisposer(c.build()),b.set(a,c));return c}},{key:"draw",value:function(a,c,d){var e=this.getShader(d.emitter),g=this.gl;e.bind();c.updateBuffer();var h=c.pointList.length,l=e.attribute("aVertexPosition"),m=e.attribute("aCornerOffset");c.buffer.bindToVertexAttrib(l,
3);g.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(l,1);this.squareCornersBuffer.bindToVertexAttrib(m,2);this.countingBuffer.ensure(h).bind(e,1);b.j.identity(f);b.j.scale(f,f,c.voxelSizeObject.size);b.j.multiply(f,d.dataToDevice,f);g.uniformMatrix4fv(e.uniform("uProjection"),!1,f);g.uniform2f(e.uniform("uPointRadii"),8/d.viewportWidth,8/d.viewportHeight);d.emitPickID&&(a=d.pickIDs.register(a,h),g.uniform4fv(e.uniform("uPickID"),Object(k.p)(v,a)));d.emitColor&&(g.uniform4fv(e.uniform("uColor"),c.color),
g.uniform4fv(e.uniform("uColorSelected"),c.selectedColor),c=c.selectedIndex.value,null===c&&(c=4294967295),g.uniform4fv(e.uniform("uSelectedIndex"),Object(k.p)(v,c)));g.ANGLE_instanced_arrays.drawArraysInstancedANGLE(g.TRIANGLE_FAN,0,4,h);g.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(l,0);Object(u.c)(g,e,!0);g.disableVertexAttribArray(l)}}]);return c}(a.a);var G=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);d(b,[{key:"defineShader",
value:function(a){g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"defineShader",this).call(this,a);a.addFragmentCode("\nvec4 getColor () { return vColor; }\n")}}]);return b}(c),E=function(a){function b(a){q(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.base=a;c.renderHelper=c.registerDisposer(new G(c.gl));c.registerDisposer(a);c.registerDisposer(a.redrawNeeded.add(function(){c.redrawNeeded.dispatch()}));c.setReady(!0);return c}r(b,a);d(b,[{key:"draw",value:function(a){this.renderHelper.draw(this,
this.base,a)}},{key:"updateMouseState",value:function(a,b,c){this.base.updateMouseState(a,c)}},{key:"transformPickedValue",value:function(a,b){return b}},{key:"gl",get:function(){return this.base.chunkManager.gl}}]);return b}(n.a),B=function(a){function b(){q(this,b);return m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}r(b,a);d(b,[{key:"defineShader",value:function(a){g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"defineShader",this).call(this,a);a.addFragmentCode("\nvec4 getColor() {\n  float scalar = 1.0 - 2.0 * abs(0.5 - gl_FragCoord.z);\n  return vec4(vColor.xyz, scalar * vColor.a);\n}\n")}}]);
return b}(c),z=function(a){function b(a){q(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.base=a;c.renderHelper=c.registerDisposer(new B(c.gl));c.registerDisposer(a);c.registerDisposer(a.redrawNeeded.add(function(){c.redrawNeeded.dispatch()}));c.setReady(!0);return c}r(b,a);d(b,[{key:"draw",value:function(a){this.renderHelper.draw(this,this.base,a)}},{key:"updateMouseState",value:function(a,b,c){this.base.updateMouseState(a,c)}},{key:"transformPickedValue",value:function(a,
b){return b}},{key:"gl",get:function(){return this.base.chunkManager.gl}}]);return b}(e.b)},function(n,e,c){c.d(e,"a",function(){return b});var q=c(197),m=c(2),r=c(3),a=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),b=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");
this.points=new q.a;this.changed=new r.a;this.generation=0}a(b,[{key:"delete",value:function(a){this.points.eraseRange(3*a,3*a+3);++this.generation;this.changed.dispatch()}},{key:"get",value:function(a){return this.points.data.subarray(3*a,3*a+3)}},{key:"append",value:function(a){this.points.appendArray(a.subarray(0,3));++this.generation;this.changed.dispatch()}},{key:"reset",value:function(){this.points.clear();++this.generation;this.changed.dispatch()}},{key:"restoreState",value:function(a){try{if(Array.isArray(a)){var b=
a.length,c=this.points;c.resize(3*b);var e=c.data;for(c=0;c<b;++c){var h=3*c;Object(m.c)(e.subarray(h,h+3),a[c],m.o)}++this.generation;this.changed.dispatch()}}catch(g){this.reset()}}},{key:"toJSON",value:function(){for(var a=this.length,b=this.points.data,c=Array(a),e=0;e<a;++e){var h=3*e;c[e]=[b[h],b[h+1],b[h+2]]}return c}},{key:"length",get:function(){return this.points.length/3}}]);return b}()},function(n,e,c){c.d(e,"a",function(){return m});var q=function(){function c(a,b){for(var c=0;c<b.length;c++){var e=
b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,b,e){b&&c(a.prototype,b);e&&c(a,e);return a}}(),m=function(){function c(a){a=void 0===a?16:a;if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this.length=0;this.data=new Float32Array(a)}q(c,[{key:"resize",value:function(a){var b=this.data;if(a>b.length){var c=new Float32Array(Math.max(a,2*b.length));c.set(b.subarray(0,this.length));this.data=
c}this.length=a}},{key:"shrinkToFit",value:function(){this.data=new Float32Array(this.view)}},{key:"clear",value:function(){this.length=0}},{key:"appendArray",value:function(a){var b=this.length;this.resize(b+a.length);this.data.set(a,b)}},{key:"eraseRange",value:function(a,b){this.data.copyWithin(a,b,this.length);this.length-=b-a}},{key:"view",get:function(){var a=this.data;return new Float32Array(a.buffer,a.byteOffset,this.length)}}]);return c}()},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return w});n=c(0);var r=c(5),a=c(3),b=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=
e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),l=function p(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return p(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};c(21);c(199);var w=function(c){function e(b,c){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");
var d=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));d.pointList=b;d.selectionIndex=c;d.element=document.createElement("div");d.clearButton=document.createElement("button");d.itemContainer=document.createElement("div");d.generation=-1;d.pointSelected=new a.b;d.visible_=!1;c=d.element;var f=d.clearButton,g=d.itemContainer;c.className="neuroglancer-point-list-widget";f.className="neuroglancer-clear-button";f.textContent="Delete all points";d.registerEventListener(f,"click",function(){d.pointList.reset()});
g.className="neuroglancer-item-container neuroglancer-select-text";c.appendChild(f);c.appendChild(g);d.registerDisposer(b.changed.add(function(){d.maybeUpdate()}));return d}m(e,c);b(e,[{key:"maybeUpdate",value:function(){var a=this;if(this.visible_){var b=this.pointList;if(this.generation!==b.generation){this.generation=b.generation;var c=this.itemContainer;Object(r.a)(c);var e=b.length;b=b.points.data;for(var k={i:0};k.i<e;k={i:k.i},++k.i){var l=document.createElement("div");l.className="neuroglancer-point-list-item";
var m=3*k.i;l.textContent=Math.round(b[m])+" "+Math.round(b[m+1])+" "+Math.round(b[m+2]);l.addEventListener("click",function(b){return function(){a.pointSelected.dispatch(b.i)}}(k));l.addEventListener("mouseenter",function(b){return function(){a.selectionIndex.value=b.i}}(k));l.addEventListener("mouseleave",function(){a.selectionIndex.value=null});c.appendChild(l)}}}}},{key:"disposed",value:function(){Object(r.b)(this.element);this.clearButton=this.itemContainer=this.element=void 0;l(e.prototype.__proto__||
Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}},{key:"visible",get:function(){return this.visible_},set:function(a){this.visible_!==a&&(this.visible_=a,!0===a&&this.maybeUpdate())}}]);return e}(n.a)},function(n,e){},function(n,e){},function(n,e,c){Object.defineProperty(e,"__esModule",{value:!0});var q=c(202);window.addEventListener("DOMContentLoaded",function(){Object(q.a)()})},function(n,e,c){e.a=function(){var b=window.viewer=Object(q.a)();Object(r.a)(b.inputEventBindings);b.registerDisposer(new a.a(b.state)).updateFromUrlHash();
Object(m.a)(b);Object(m.b)(b);return b};var q=c(203),m=c(238),r=c(239),a=c(240)},function(n,e,c){e.a=function(b){Object(a.a)();Object(a.b)();try{var c=new m.a(document.getElementById("neuroglancer-container"));return new r.a(c,b)}catch(w){throw q.a.showMessage("Error: "+w.message),w;}};c(205);var q=c(26),m=c(80),r=c(210),a=c(237);c(204)},function(n,e){},function(n,e,c){c(206);c(207)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,
b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}n=c(104);var a=c(8);e=c(18);var b=
c(0),l=c(1),w=c(11),u=c(63),p=c(7),k=function G(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return G(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);
d&&a(b,d);return b}}(),g=function(a){function b(a,c,d,e){q(this,b);var f=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));f.chunkDataSize=c;f.channelStride=c[0]*c[1]*c[2];Object(u.e)(f,a,d,c[0],c[1],c[2]*e);return f}r(b,a);h(b,null,[{key:"get",value:function(a,c,d,e){return a.memoize.get("sliceview.UncompressedTextureLayout:"+Object(l.q)(c)+","+(d+","+e),function(){return new b(a,c,d,e)})}}]);return b}(b.a),d=function(a){function b(a,c,d,e){q(this,b);a=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,
e));a.dataType=c;a.numChannels=d;Object(u.c)(a,c);a.textureAccessHelper=new u.a("chunkData");return a}r(b,a);h(b,[{key:"defineShader",value:function(a){k(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"defineShader",this).call(this,a);var c=this.textureAccessHelper;c.defineShader(a);a.addFragmentCode(c.getAccessor("readVolumeData","uVolumeChunkSampler",this.dataType));1<this.numChannels?(a.addUniform("highp float","uChannelStride"),a.addFragmentCode("\nfloat getChannelOffset(int channelIndex) {\n  return float(channelIndex) * uChannelStride;\n}\n")):
a.addFragmentCode("float getChannelOffset(int channelIndex) { return 0.0; }");a.addFragmentCode("\nfloat getIndexIntoChunk (int channelIndex) {\n  vec3 chunkDataPosition = getPositionWithinChunk();\n  return chunkDataPosition.x + uChunkDataSize.x * (chunkDataPosition.y + uChunkDataSize.y * chunkDataPosition.z) + getChannelOffset(channelIndex);\n}\n");c=Object(p.a)(this.dataType);a.addFragmentCode("\n"+c+" getDataValue (int channelIndex) {\n  return readVolumeData(getIndexIntoChunk(channelIndex));\n}\n")}},
{key:"setupTextureLayout",value:function(a,b,c){1<this.numChannels&&a.uniform1f(b.uniform("uChannelStride"),c.channelStride);this.textureAccessHelper.setupTextureLayout(a,b,c)}},{key:"getTextureLayout",value:function(a,b){return g.get(a,b,this.texelsPerElement,this.numChannels)}},{key:"setTextureData",value:function(a,b,c){Object(u.f)(a,b,this,c)}}],[{key:"get",value:function(a,c,d){var e="sliceview.UncompressedChunkFormat:"+c+":"+d;return a.memoize.get(e,function(){return new b(a,c,d,e)})}}]);return b}(n.a),
f=function(b){function c(){q(this,c);return m(this,(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments))}r(c,b);h(c,[{key:"setTextureData",value:function(a){var b=this.source,c=b.chunkFormatHandler,d=c.chunkFormat,e;this.textureLayout=this.chunkDataSize===b.spec.chunkDataSize?e=c.textureLayout.addRef():e=d.getTextureLayout(a,this.chunkDataSize);this.chunkFormat.setTextureData(a,e,this.data)}},{key:"getChannelValueAt",value:function(b,c){var d=this.chunkDataSize;c=b[0]+d[0]*(b[1]+d[1]*(b[2]+
d[2]*c));d=this.chunkFormat.dataType;b=this.data;switch(d){case a.a.UINT8:case a.a.FLOAT32:case a.a.UINT16:case a.a.UINT32:return b[c];case a.a.UINT64:return c*=2,new w.a(b[c],b[c+1])}throw Error("Invalid data type: "+d);}}]);return c}(n.b),v=function(a){function b(a,c){q(this,b);var e=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));e.chunkFormat=e.registerDisposer(d.get(a,c.dataType,c.numChannels));e.textureLayout=e.registerDisposer(e.chunkFormat.getTextureLayout(a,c.chunkDataSize));return e}
r(b,a);h(b,[{key:"getChunk",value:function(a,b){return new f(a,b)}}]);return b}(b.a);Object(e.c)(function(a,b){return null==b.compressedSegmentationBlockSize?new v(a,b):null})},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==
b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=c(208),b=c(209);n=c(104);var l=c(8);e=c(18);var w=c(0),u=c(1),p=c(11),k=c(63),h=c(7),g=function z(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==
a)return z(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),f=function(a){function b(a,c,d,e){q(this,b);var f=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));f.chunkDataSize=c;f.subchunkSize=d;Object(k.d)(f,
a,1,e);a=f.subchunkGridSize=u.p.create();for(e=0;3>e;++e)a[e]=Math.ceil(c[e]/d[e]);return f}r(b,a);d(b,null,[{key:"get",value:function(a,c,d,e){return a.memoize.get("sliceview.CompressedSegmentationTextureLayout:"+Object(u.q)(c)+","+(Object(u.q)(d)+","+e),function(){return new b(a,c,d,e)})}}]);return b}(w.a),v=Object(k.c)(new k.b,l.a.UINT32),y=function(a){function b(a,c,d,e){q(this,b);e=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,e));e.dataType=a;e.subchunkSize=c;e.numChannels=d;e.textureAccessHelper=
new k.a("chunkData");return e}r(b,a);d(b,[{key:"defineShader",value:function(a){g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"defineShader",this).call(this,a);var c=this.textureAccessHelper;c.defineShader(a);var d=function(a){return"compressedSegmentationChunkFormat_"+a};a.addUniform("highp vec3","uSubchunkGridSize");a.addUniform("highp vec3","uSubchunkSize");a.addFragmentCode(h.f);var e=this.dataType,f=Object(h.a)(e);e===l.a.UINT64&&a.addFragmentCode(h.l);a.addFragmentCode(c.getAccessor(d("readTextureValue"),
"uVolumeChunkSampler",l.a.UINT32));a.addFragmentCode(h.o);a.addFragmentCode(h.n);c="\nfloat "+d("getChannelOffset")+"(int channelIndex) {\n  if (channelIndex == 0) {\n    return "+this.numChannels+".0;\n  }\n  vec4 v = "+d("readTextureValue")+"(float(channelIndex)).value;\n  return uintleToFloat(v.xyz);\n}\n"+f+" getDataValue (int channelIndex) {\n  vec3 chunkPosition = getPositionWithinChunk();\n\n  // TODO: maybe premultiply this and store as uniform.\n  vec3 subchunkGridPosition = floor(chunkPosition / uSubchunkSize);\n  float subchunkGridOffset = getFortranOrderIndex(subchunkGridPosition, uSubchunkGridSize);\n\n  float channelOffset = "+
d("getChannelOffset")+"(channelIndex);\n\n  // TODO: Maybe just combine this offset into subchunkGridStrides.\n  float subchunkHeaderOffset = subchunkGridOffset * 2.0 + channelOffset;\n\n  vec4 subchunkHeader0 = "+d("readTextureValue")+"(subchunkHeaderOffset).value;\n  vec4 subchunkHeader1 = "+d("readTextureValue")+"(subchunkHeaderOffset + 1.0).value;\n\n  float outputValueOffset = uintleToFloat(subchunkHeader0.xyz) + channelOffset;\n  float encodingBits = unnormalizeUint8(subchunkHeader0[3]);\n  if (encodingBits > 0.0) {\n    vec3 subchunkPosition = floor(min(chunkPosition - subchunkGridPosition * uSubchunkSize, uSubchunkSize - 1.0));\n    float subchunkOffset = getFortranOrderIndex(subchunkPosition, uSubchunkSize);\n    highp float encodedValueBaseOffset = uintleToFloat(subchunkHeader1.xyz) + channelOffset;\n    highp float encodedValueOffset = floor(encodedValueBaseOffset + subchunkOffset * encodingBits / 32.0);\n    vec4 encodedValue = "+
d("readTextureValue")+"(encodedValueOffset).value;\n    float wordOffset = mod(subchunkOffset * encodingBits, 32.0);\n    // If the value is in the first byte, then 0 <= wordOffset < 8.\n    // We need to mod by 2**encodedBits\n    float wordShifter = pow(2.0, -wordOffset);\n    float encodedValueMod = pow(2.0, encodingBits);\n    float encodedValueShifted;\n    if (wordOffset < 16.0) {\n      encodedValueShifted = dot(unnormalizeUint8(encodedValue.xy), vec2(1.0, 256.0));\n    } else {\n      encodedValueShifted = dot(unnormalizeUint8(encodedValue.zw), vec2(256.0 * 256.0, 256.0 * 256.0 * 256.0));\n    }\n    encodedValueShifted = floor(encodedValueShifted * wordShifter);\n    float decodedValue = mod(encodedValueShifted, encodedValueMod);\n    outputValueOffset += decodedValue * "+
(this.dataType===l.a.UINT64?"2.0":"1.0")+";\n  }\n  "+f+" result;\n";c=e===l.a.UINT64?c+("\n  result.low = "+d("readTextureValue")+"(outputValueOffset).value;\n  result.high = "+d("readTextureValue")+"(outputValueOffset+1.0).value;\n"):c+("\n  result.value = "+d("readTextureValue")+"(outputValueOffset).value;\n");a.addFragmentCode(c+"\n  return result;\n}\n")}},{key:"setupTextureLayout",value:function(a,b,c){a.uniform3fv(b.uniform("uSubchunkGridSize"),c.subchunkGridSize);this.textureAccessHelper.setupTextureLayout(a,
b,c)}},{key:"setTextureData",value:function(a,b,c){Object(k.f)(a,b,v,c)}},{key:"getTextureLayout",value:function(a,b,c){return f.get(a,b,this.subchunkSize,c)}},{key:"beginSource",value:function(a,c){g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"beginSource",this).call(this,a,c);a.uniform3fv(c.uniform("uSubchunkSize"),this.subchunkSize)}}],[{key:"get",value:function(a,c,d,e){var f="sliceview.CompressedSegmentationChunkFormat:"+c+":"+e,g=f+":"+Object(u.q)(d);return a.memoize.get(g,function(){return new b(c,
d,e,f)})}}]);return b}(n.a),G=function(c){function e(){q(this,e);return m(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}r(e,c);d(e,[{key:"setTextureData",value:function(a){var b=this.data,c=this.chunkFormat,d=this.textureLayout=c.getTextureLayout(a,this.chunkDataSize,b.length);c.setTextureData(a,d,b)}},{key:"getChannelValueAt",value:function(c,d){var e=this.chunkDataSize,f=this.chunkFormat,g=this.data;d=g[d];if(f.dataType===l.a.UINT64){var h=new p.a;Object(b.a)(h,g,d,e,f.subchunkSize,
c);return h}return Object(a.a)(g,d,e,f.subchunkSize,c)}}]);return e}(n.b),E=function(a){function b(a,c){q(this,b);var d=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this)),e=c.dataType;if(e!==l.a.UINT64&&e!==l.a.UINT32)throw Error("Unsupported compressed segmentation data type: "+l.a[e]);d.chunkFormat=d.registerDisposer(y.get(a,c.dataType,c.compressedSegmentationBlockSize,c.numChannels));return d}r(b,a);d(b,[{key:"getChunk",value:function(a,b){return new G(a,b)}}]);return b}(w.a);Object(e.c)(function(a,
b){return null!=b.compressedSegmentationBlockSize?new E(a,b):null})},function(n,e,c){e.a=function(c,e,a,b,l){e=Object(q.a)(c,e,a,b,l,1)+e;return c[e]};var q=c(105)},function(n,e,c){e.a=function(c,e,a,b,l,n){a=Object(q.a)(e,a,b,l,n,2)+a;c.low=e[a];c.high=e[a+1];return c};var q=c(105)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){var b=new G.a,c=b.element;c.classList.add("neuroglancer-viewer-context-menu");var d=function(a,d){a=b.registerDisposer(new J.a(d,
{label:a}));a.element.classList.add("neuroglancer-viewer-context-menu-limit-widget");c.appendChild(a.element)};d("GPU memory limit",a.chunkQueueManager.capacities.gpuMemory.sizeLimit);d("System memory limit",a.chunkQueueManager.capacities.systemMemory.sizeLimit);d("Concurrent chunk requests",a.chunkQueueManager.capacities.download.itemLimit);d=function(a,d){var e=document.createElement("label");e.textContent=a;a=b.registerDisposer(new y.b(d));e.appendChild(a.element);c.appendChild(e)};d("Show axis lines",
a.showAxisLines);d("Show scale bar",a.showScaleBar);d("Show cross sections in 3-d",a.showPerspectiveSliceViews);return b}c.d(e,"a",function(){return aa});n=c(13);var b=c.n(n),l=c(10),w=c(85);n=c(106);var u=c(22),p=c(215),k=c(12),h=c(107),g=c(224),d=c(9),f=c(43),v=c(29),y=c(42),G=c(64),E=c(111),B=c(38);e=c(0);var z=c(5),D=c(15),x=c(1),C=c(34),H=c(3),K=c(45),F=c(234),T=c(33),J=c(235),R=c(67),W=c(6),V=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=
!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();c(236);c(60);c(21);c(44);var M=function(a){function b(a){q(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.gl=a;c.worker=new Worker("chunk_worker.bundle.js");c.chunkQueueManager=c.registerDisposer(new l.d(new W.a(c.worker),c.gl,{gpuMemory:new l.a({defaultItemLimit:1E6,defaultSizeLimit:1E9}),systemMemory:new l.a({defaultItemLimit:1E7,defaultSizeLimit:2E9}),
download:new l.a({defaultItemLimit:32,defaultSizeLimit:Number.POSITIVE_INFINITY})}));c.chunkManager=c.registerDisposer(new l.c(c.chunkQueueManager));c.chunkQueueManager.registerDisposer(function(){return c.worker.terminate()});return c}r(b,a);V(b,[{key:"rpc",get:function(){return this.chunkQueueManager.rpc}}]);return b}(e.a);(function(a){function b(){q(this,b);var a=m(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments));a.global=new C.a;return a}r(b,a);return b})(n.b);var Q={showEditOption:!0,
showSaveButton:!0,showHelpButton:!0,showLayerDialog:!0,showLayerPanel:!0,showLocation:!0,resetStateWhenEmpty:!0},aa=function(c){function e(a,c){c=void 0===c?{}:c;q(this,e);var g=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));g.display=a;g.navigationState=g.registerDisposer(new f.e);g.perspectiveNavigationState=new f.e(new f.g(g.navigationState.position),1);g.mouseState=new k.d;g.layerManager=g.registerDisposer(new k.a);g.showAxisLines=new y.a(!0,!0);g.showScaleBar=new y.a(!0,!0);g.showPerspectiveSliceViews=
new y.a(!0,!0);g.layerSelectedValues=g.registerDisposer(new k.b(g.layerManager,g.mouseState));g.resetInitiated=new H.a;g.editorState={editor:Object(F.b)(F.a.keys().next().value),voxelSize:g.navigationState.voxelSize,mouseState:g.mouseState,startPoint:x.p.create(),endPoint:x.p.create()};g.state=new K.a;g.visible=!0;var l=c,n=void 0===l.dataContext?new M(a.gl):l.dataContext,p=void 0===l.visibility?new T.b(T.b.VISIBLE):l.visibility,r=void 0===l.inputEventBindings?{global:new C.a,sliceView:new C.a,perspectiveView:new C.a}:
l.inputEventBindings,D=void 0===l.element?a.makeCanvasOverlayElement():l.element;l=void 0===l.dataSourceProvider?Object(u.a)({credentialsManager:w.a}):l.dataSourceProvider;g.registerDisposer(function(){return Object(z.b)(g.element)});g.registerDisposer(n);g.options=Object.assign({},Q,c,{dataContext:n,visibility:p,inputEventBindings:r,element:D,dataSourceProvider:l});g.layerSpecification=new d.c(g.dataSourceProvider,g.layerManager,g.chunkManager,g.layerSelectedValues,g.navigationState.voxelSize);g.registerDisposer(a.updateStarted.add(function(){g.onUpdateDisplay()}));
g.registerDisposer(a.updateFinished.add(function(){g.onUpdateDisplayFinished()}));c=g.state;c.add("layers",g.layerSpecification);c.add("navigation",g.navigationState);c.add("showAxisLines",g.showAxisLines);c.add("showScaleBar",g.showScaleBar);c.add("perspectiveOrientation",g.perspectiveNavigationState.pose.orientation);c.add("perspectiveZoom",g.perspectiveNavigationState.zoomFactor);c.add("showSlices",g.showPerspectiveSliceViews);c.add("gpuMemoryLimit",g.dataContext.chunkQueueManager.capacities.gpuMemory.sizeLimit);
c.add("systemMemoryLimit",g.dataContext.chunkQueueManager.capacities.systemMemory.sizeLimit);c.add("concurrentDownloads",g.dataContext.chunkQueueManager.capacities.download.itemLimit);g.registerDisposer(g.navigationState.changed.add(function(){g.handleNavigationStateChanged()}));g.layerManager.initializePosition(g.navigationState.position);g.registerDisposer(g.layerSpecification.voxelCoordinatesSet.add(function(a){g.navigationState.position.setVoxelCoordinates(a)}));n=g.registerCancellable(b()(function(){!g.wasDisposed&&
0===g.layerManager.managedLayers.length&&g.options.resetStateWhenEmpty&&(g.navigationState.reset(),g.perspectiveNavigationState.pose.orientation.reset(),g.perspectiveNavigationState.zoomFactor.reset(),g.resetInitiated.dispatch(),!v.b&&g.options.showLayerDialog&&g.visibility.visible&&new h.a(g.layerSpecification))}));g.layerManager.layersChanged.add(n);n();g.registerDisposer(g.dataContext.chunkQueueManager.visibleChunksChanged.add(function(){g.layerSelectedValues.handleLayerChange()}));g.registerDisposer(g.dataContext.chunkQueueManager.visibleChunksChanged.add(function(){g.visible&&
a.scheduleRedraw()}));g.makeUI();c.add("layout",g.layout);g.registerActionListeners();g.registerEventActionBindings();g.registerDisposer(Object(E.a)(D,g.navigationState.position));return g}r(e,c);V(e,[{key:"makeUI",value:function(){var b=this,c=this.options,d=this.element;d.classList.add("neuroglancer-viewer");d.classList.add("neuroglancer-noselect");d.style.display="flex";d.style.flexDirection="column";if(c.showEditOption||c.showSaveButton||c.showHelpButton||c.showLocation){var e=document.createElement("div");
e.title="Right click for settings";(this.contextMenu=this.registerDisposer(a(this))).registerParent(e);e.style.display="flex";e.style.flexDirection="row";e.style.alignItems="stretch";if(c.showLocation){var f=this.registerDisposer(new R.c(document.createElement("div"),this.navigationState.voxelSize));e.appendChild(f.element);f=this.registerDisposer(new R.b(this.navigationState.position));e.appendChild(f.element);f=this.registerDisposer(new R.a(document.createElement("div"),this.mouseState,this.navigationState.voxelSize));
f.element.style.flex="1";f.element.style.alignSelf="center";e.appendChild(f.element)}if(c.showEditOption){var h=document.createElement("select");h.id="edit-option";F.a.forEach(function(a,b){var c=document.createElement("option");c.textContent=a;c.value=b.toString();h.appendChild(c)});this.registerEventListener(h,"change",function(){var a=parseInt(h.value,10);b.setEditor(a)});e.appendChild(h)}c.showSaveButton&&(f=document.createElement("button"),f.id="save-button",f.textContent="save",f.title="Save",
this.registerEventListener(f,"click",function(){b.saveAllEdits()}),e.appendChild(f));c.showHelpButton&&(c=document.createElement("div"),c.className="neuroglancer-help-button neuroglancer-button",c.textContent="?",c.title="Help",this.registerEventListener(c,"click",function(){b.showHelpDialog()}),e.appendChild(c));d.appendChild(e)}this.layout=this.registerDisposer(new g.a(this,"4panel"));d.appendChild(this.layout.element);this.display.onResize();e=function(){var a=b.visibility.visible;a!==b.visible&&
(d.style.visibility=a?"inherit":"hidden",b.visible=a)};e();this.registerDisposer(this.visibility.changed.add(e))}},{key:"registerEventActionBindings",value:function(){var a=this.element;this.registerDisposer(new C.b(a,this.inputEventMap));this.registerDisposer(new B.a(a))}},{key:"bindAction",value:function(a,b){this.registerDisposer(Object(D.c)(this.element,a,b))}},{key:"registerActionListeners",value:function(){for(var a=this,b={},c=$jscomp.makeIterator(["recolor","clear-segments"]),d=c.next();!d.done;b=
{action:b.action},d=c.next())b.action=d.value,this.bindAction(b.action,function(b){return function(){a.layerManager.invokeAction(b.action)}}(b));b={};c=$jscomp.makeIterator(["select","annotate"]);for(d=c.next();!d.done;b={action$217:b.action$217},d=c.next())b.action$217=d.value,this.bindAction(b.action$217,function(b){return function(){a.mouseState.updateUnconditionally();a.layerManager.invokeAction(b.action$217,a.editorState)}}(b));this.bindAction("help",function(){return a.showHelpDialog()});for(d=
{i:1};9>=d.i;d={i:d.i},++d.i)this.bindAction("toggle-layer-"+d.i,function(b){return function(){var c=b.i-1,d=a.layerManager.managedLayers;c<d.length&&(c=d[c],c.setVisible(!c.visible))}}(d));this.bindAction("toggle-axis-lines",function(){return a.showAxisLines.toggle()});this.bindAction("toggle-scale-bar",function(){return a.showScaleBar.toggle()});this.bindAction("toggle-show-slices",function(){return a.showPerspectiveSliceViews.toggle()});this.bindAction("toggle-edit-mode",function(){return a.toggleEditor()})}},
{key:"setEditor",value:function(a){this.editorState.segment=void 0;this.editorState.editor.restoreState(a)}},{key:"toggleEditor",value:function(){var a=this.editorState.editor;this.setEditor(a.value+1);var b=document.getElementById("edit-option");b&&F.a.has(a.value)&&(b.value=a.value.toString())}},{key:"showHelpDialog",value:function(){var a=this.inputEventBindings;new p.a([["Global",a.global],["Slice View",a.sliceView],["Perspective View",a.perspectiveView]])}},{key:"saveAllEdits",value:function(){this.layerManager.invokeAction("save")}},
{key:"onUpdateDisplay",value:function(){this.visible&&(this.dataContext.chunkQueueManager.chunkUpdateDeadline=null)}},{key:"onUpdateDisplayFinished",value:function(){this.visible&&this.mouseState.updateIfStale()}},{key:"handleNavigationStateChanged",value:function(){if(this.visible){var a=this.dataContext.chunkQueueManager;null===a.chunkUpdateDeadline&&(a.chunkUpdateDeadline=Date.now()+10)}this.mouseState.stale=!0}},{key:"chunkManager",get:function(){return this.dataContext.chunkManager}},{key:"chunkQueueManager",
get:function(){return this.dataContext.chunkQueueManager}},{key:"dataContext",get:function(){return this.options.dataContext}},{key:"visibility",get:function(){return this.options.visibility}},{key:"inputEventBindings",get:function(){return this.options.inputEventBindings}},{key:"inputEventMap",get:function(){return this.inputEventBindings.global}},{key:"element",get:function(){return this.options.element}},{key:"dataSourceProvider",get:function(){return this.options.dataSourceProvider}},{key:"gl",
get:function(){return this.display.gl}}]);return e}(e.a)},function(n,e,c){e.b=function(c,e){return function(m){m.style.flex=c;e(m)}};e.a=function(c,e){return function(m){m.style.display="flex";m.style.flexDirection=c;for(var a=$jscomp.makeIterator(e),b=a.next();!b.done;b=a.next()){b=b.value;var l=m.ownerDocument.createElement("div");m.appendChild(l);b(l)}}}},function(n,e,c){c.d(e,"a",function(){return a});var q=c(2),m=c(3),r=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=
e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),a=function(){function a(b,c,e){e=void 0===e?c:e;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.enumType=b;this.value_=c;this.defaultValue=e;this.changed=new m.a}r(a,[{key:"reset",value:function(){this.value=this.defaultValue}},{key:"restoreState",value:function(a){this.value=Object(q.n)(a,this.enumType)}},
{key:"toJSON",value:function(){return this.enumType[this.value_].toLowerCase()}},{key:"value",set:function(a){this.value_!==a&&(this.value_=a,this.changed.dispatch())},get:function(){return this.value_}}]);return a}()},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(a){a.addFragmentExtension("GL_EXT_draw_buffers");a.addFragmentCode(z)}function a(a){a.addFragmentExtension("GL_EXT_draw_buffers");a.addFragmentCode(D)}function b(a){a.setFragmentMain("\nvec4 v0 = getValue0();\nvec4 v1 = getValue1();\nvec4 accum = vec4(v0.rgb, v1.r);\nfloat revealage = v0.a;\n\ngl_FragColor = vec4(accum.rgb / accum.a, revealage);\n")}
c.d(e,"a",function(){return H});var l=c(76),w=c(12),u=c(78),p=c(32);n=c(79);var k=c(35),h=c(42),g=c(15),d=c(1),f=c(83),v=c(53),y=c(7),G=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),E=function F(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),
null!==a)return F(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};c(21);c(214);var B;(function(a){a[a.COLOR=0]="COLOR";a[a.Z=1]="Z";a[a.PICK=2]="PICK";a[a.NUM_TEXTURES=3]="NUM_TEXTURES"})(B||(B={}));var z=[y.i,"\nvoid emit(vec4 color, vec4 pickId) {\n  gl_FragData["+B.COLOR+"] = color;\n  gl_FragData["+B.Z+"] = packFloat01ToFixedPoint(1.0 - gl_FragCoord.z);\n  gl_FragData["+B.PICK+"] = pickId;\n}\n"],D=["\nfloat computeOITWeight(float alpha) {\n  float a = min(1.0, alpha) * 8.0 + 0.01;\n  float b = -gl_FragCoord.z * 0.95 + 1.0;\n  return a * a * a * b * b * b;\n}\n",
"\nvoid emit(vec4 color, vec4 pickId) {\n  float weight = computeOITWeight(color.a);\n  vec4 accum = color * weight;\n  gl_FragData[0] = vec4(accum.rgb, color.a);\n  gl_FragData[1] = vec4(accum.a, 0.0, 0.0, 0.0);\n}\n"],x=d.p.create(),C=d.j.create(),H=function(c){function e(a,c,m){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var n=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a,c,m));n.visibleLayerTracker=Object(w.i)(n.viewer.layerManager,p.a,n);n.sliceViews=
new Set;n.projectionMat=d.j.create();n.inverseProjectionMat=d.j.create();n.modelViewMat=d.j.create();n.width=0;n.height=0;n.pickIDs=new u.a;n.axesLineHelper=n.registerDisposer(l.a.get(n.gl));n.sliceViewRenderHelper=n.registerDisposer(k.d.get(n.gl,r));n.offscreenFramebuffer=n.registerDisposer(new v.b(n.gl,{colorBuffers:Object(v.e)(n.gl,B.NUM_TEXTURES),depthBuffer:new v.a(n.gl)}));n.offscreenCopyHelper=n.registerDisposer(v.c.get(n.gl));n.transparencyCopyHelper=n.registerDisposer(v.c.get(n.gl,b,2));
n.registerDisposer(n.navigationState.changed.add(function(){n.viewportChanged()}));Object(g.c)(c,"translate-via-mouse-drag",function(a){Object(f.a)(a.detail,function(a,b,c){a=n.width;var e=n.height,f=n.viewer.navigationState.position,g=f.spatialCoordinates;d.p.transformMat4(x,g,n.projectionMat);x[0]=2*b/a;x[1]=-2*c/e;d.p.transformMat4(g,x,n.inverseProjectionMat);f.changed.dispatch()})});Object(g.c)(c,"rotate-via-mouse-drag",function(a){Object(f.a)(a.detail,function(a,b,c){n.navigationState.pose.rotateRelative(d.e[1],
-b/4*Math.PI/180);n.navigationState.pose.rotateRelative(d.e[0],c/4*Math.PI/180);n.viewer.navigationState.changed.dispatch()})});m.showSliceViewsCheckbox&&(a=n.registerDisposer(new h.b(m.showSliceViews)),a.element.className="perspective-panel-show-slice-views neuroglancer-noselect",c=document.createElement("label"),c.className="perspective-panel-show-slice-views neuroglancer-noselect",c.appendChild(document.createTextNode("Slices")),c.appendChild(a.element),n.element.appendChild(c));n.registerDisposer(m.showSliceViews.changed.add(function(){n.scheduleRedraw()}));
n.registerDisposer(m.showAxisLines.changed.add(function(){n.scheduleRedraw()}));return n}m(e,c);G(e,[{key:"updateProjectionMatrix",value:function(){var a=this.projectionMat;d.j.perspective(a,Math.PI/4,this.width/this.height,10,5E3);var b=this.modelViewMat;this.navigationState.toMat4(b);d.p.set(x,1,-1,-1);d.j.scale(b,b,x);var c=d.p.set(x,0,0,100);d.j.translate(b,b,c);d.j.invert(C,b);d.j.multiply(a,a,C);d.j.invert(this.inverseProjectionMat,a)}},{key:"viewportChanged",value:function(){this.context.scheduleRedraw()}},
{key:"onResize",value:function(){var a=this.element,b=a.clientHeight;if(a.clientWidth!==this.width||b!==this.height)this.width=this.element.clientWidth,this.height=this.element.clientHeight,this.viewportChanged()}},{key:"disposed",value:function(){for(var a=$jscomp.makeIterator(this.sliceViews),b=a.next();!b.done;b=a.next())b.value.dispose();this.sliceViews.clear();E(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}},{key:"updateMouseState",value:function(a){a.pickedRenderLayer=
null;if(!this.navigationState.valid)return!1;var b=a.position,c=this.offscreenFramebuffer,e=this.width,f=this.height;if(!c.hasSize(e,f))return!1;var g=this.mouseX,h=f-this.mouseY,k=c.readPixel(B.Z,g,h);k=1-Object(y.q)(k);if(1===k)return!1;b[0]=2*g/e-1;b[1]=2*h/f-1;b[2]=2*k-1;d.p.transformMat4(b,b,this.inverseProjectionMat);this.pickIDs.setMouseState(a,c.readPixelAsUint32(B.PICK,g,h));a=this.viewer;b=a.layerManager;b.uniqueAction("edit",b.editorLayer,a.editorState);return!0}},{key:"draw",value:function(){if(this.navigationState.valid){this.onResize();
var b=this.width,c=this.height;if(0!==b&&0!==c){if(this.viewer.showSliceViews.value)for(var e=$jscomp.makeIterator(this.sliceViews),f=e.next();!f.done;f=e.next())f.value.updateRendering();e=this.gl;this.offscreenFramebuffer.bind(b,c);e.disable(e.SCISSOR_TEST);this.gl.clearColor(0,0,0,0);e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);e.enable(e.DEPTH_TEST);f=this.projectionMat;this.updateProjectionMatrix();var g=d.p.create();Object(d.n)(g,d.e[2],this.modelViewMat);d.p.normalize(g,g);var h=this.pickIDs;
h.clear();f={dataToDevice:f,lightDirection:g,ambientLighting:.2,directionalLighting:.8,pickIDs:h,emitter:r,emitColor:!0,emitPickID:!0,alreadyEmittedPickID:!1,viewportWidth:b,viewportHeight:c};g=this.visibleLayerTracker.getVisibleLayers();var k=!1,l=$jscomp.makeIterator(g);for(h=l.next();!h.done;h=l.next())h=h.value,h.isTransparent?k=!0:h.draw(f);this.viewer.showSliceViews.value&&this.drawSliceViews(f);this.viewer.showAxisLines.value&&this.drawAxisLines();if(k){e.depthMask(!1);e.enable(e.BLEND);k=
this.transparentConfiguration;k.bind(b,c);this.gl.clearColor(0,0,0,1);e.clear(e.COLOR_BUFFER_BIT);f.emitter=a;e.blendFuncSeparate(e.ONE,e.ONE,e.ZERO,e.ONE_MINUS_SRC_ALPHA);f.emitPickID=!1;l=$jscomp.makeIterator(g);for(h=l.next();!h.done;h=l.next())h=h.value,h.isTransparent&&h.draw(f);e.disable(e.DEPTH_TEST);this.offscreenFramebuffer.bindSingle(B.COLOR);e.blendFunc(e.ONE_MINUS_SRC_ALPHA,e.SRC_ALPHA);this.transparencyCopyHelper.draw(k.colorBuffers[0].texture,k.colorBuffers[1].texture);e.depthMask(!0);
e.disable(e.BLEND);e.enable(e.DEPTH_TEST);this.offscreenFramebuffer.bind(b,c)}e.WEBGL_draw_buffers.drawBuffersWEBGL([e.NONE,e.WEBGL_draw_buffers.COLOR_ATTACHMENT1_WEBGL,e.WEBGL_draw_buffers.COLOR_ATTACHMENT2_WEBGL]);f.emitter=r;f.emitPickID=!0;f.emitColor=!1;b=$jscomp.makeIterator(g);for(h=b.next();!h.done;h=b.next())c=h.value,f.alreadyEmittedPickID=!c.isTransparent,c.draw(f);e.disable(e.DEPTH_TEST);this.offscreenFramebuffer.unbind();this.setGLViewport();this.offscreenCopyHelper.draw(this.offscreenFramebuffer.colorBuffers[B.COLOR].texture)}}}},
{key:"drawSliceViews",value:function(a){var b=this.sliceViewRenderHelper,c=a.lightDirection,e=a.ambientLighting,f=a.directionalLighting;a=a.dataToDevice;for(var g=$jscomp.makeIterator(this.sliceViews),h=g.next();!h.done;h=g.next())if(h=h.value,0!==h.width&&0!==h.height){var k=Math.abs(d.p.dot(c,h.viewportAxes[2]));k=e+k*f;var l=C;d.j.identity(l);l[0]=h.width/2;l[5]=-h.height/2;d.j.multiply(l,h.viewportToData,l);d.j.multiply(l,a,l);b.draw(h.offscreenFramebuffer.colorBuffers[0].texture,l,d.r.fromValues(k,
k,k,1),d.r.fromValues(.5,.5,.5,1),0,0,1,1)}}},{key:"drawAxisLines",value:function(){var a=this.gl;d.j.identity(C);C[0]=1600;C[5]=1600;C[10]=1600;var b=this.navigationState.position.spatialCoordinates;C[12]=b[0];C[13]=b[1];C[14]=b[2];C[15]=1;d.j.multiply(C,this.projectionMat,C);a.WEBGL_draw_buffers.drawBuffersWEBGL([a.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL]);this.axesLineHelper.draw(C,!1)}},{key:"zoomByMouse",value:function(a){this.navigationState.zoomBy(a)}},{key:"navigationState",get:function(){return this.viewer.navigationState}},
{key:"transparentConfiguration",get:function(){var a=this.transparentConfiguration_;void 0===a&&(a=this.transparentConfiguration_=this.registerDisposer(new v.b(this.gl,{colorBuffers:Object(v.e)(this.gl,2,this.gl.RGBA,this.gl.FLOAT)})));return a}}]);return e}(n.a)},function(n,e){},function(n,e,c){function q(a,c){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!c||"object"!==typeof c&&"function"!==typeof c?a:c}function m(a,c){if("function"!==typeof c&&
null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}function r(a){return a.startsWith("key")?a.substring(3):a.startsWith("digit")||a.startsWith("arrow")?a.substring(5):a}c.d(e,"a",function(){return a});n=c(29);c(216);var a=function(a){function b(a){function c(a,b){for(var d=$jscomp.makeIterator(a.parents),
f=d.next();!f.done;f=d.next())f=f.value,void 0!==f.label?e(f.label,f):c(f,b);a=$jscomp.makeIterator(a.bindings.entries());for(d=a.next();!d.done;d=a.next()){f=$jscomp.makeIterator(d.value);d=f.next().value;f=f.next().value;var g=d.indexOf(":");d=d.substring(g+1);b.set(d,f.action)}}function e(a,b){d.has(b)||(a={label:a,entries:new Map},c(b,a.entries),d.set(b,a))}if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var k=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this)),
h=k.content;h.classList.add("describe-key-bindings");var g=document.createElement("div");g.classList.add("describe-key-bindings-container");var d=new Map;a=$jscomp.makeIterator(a);for(var f=a.next();!f.done;f=a.next()){var m=$jscomp.makeIterator(f.value);f=m.next().value;m=m.next().value;e(f,m)}a=$jscomp.makeIterator(d.values());for(f=a.next();!f.done;f=a.next()){m=f.value;f=document.createElement("h2");f.textContent=m.label;g.appendChild(f);f=document.createElement("div");f.className="dl";m=$jscomp.makeIterator(m.entries);
for(var l=m.next();!l.done;l=m.next()){var n=$jscomp.makeIterator(l.value);l=n.next().value;n=n.next().value;var w=document.createElement("div"),B=document.createElement("div");B.className="definition-outer-container";w.className="definition-container";var z=document.createElement("div");z.className="dt";z.textContent=l.split("+").map(r).join("+");l=document.createElement("div");l.className="dd";l.textContent=n;w.appendChild(z);w.appendChild(l);f.appendChild(B);B.appendChild(w)}g.appendChild(f)}h.appendChild(g);
return k}m(b,a);return b}(n.a)},function(n,e){},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)}function r(a){var b=document.createElement("div");b.textContent=a.value;return b}e.b=function(a){var b=document.createElement("div");b.className="autocomplete-completion-with-description";b.textContent=a.value;var c=document.createElement("div");c.className="autocomplete-completion-description";c.textContent=a.description||"";b.appendChild(c);return b};c.d(e,"a",function(){return G});n=c(13);var a=c.n(n),b=c(14);n=c(0);var l=c(5),w=c(218),u=c(34),p=c(219),
k=c(220),h=c(3),g=c(108),d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),f=function B(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return B(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:
b.call(c)}};c(221);$jscomp.initSymbol();var v=Symbol("autocompleteIndex"),y=u.a.fromObject({arrowdown:{action:"cycle-next-active-completion"},arrowup:{action:"cycle-prev-active-completion"},tab:{action:"choose-active-completion-or-prefix",preventDefault:!1},enter:{action:"choose-active-completion",preventDefault:!1},escape:{action:"cancel",preventDefault:!1,stopPropagation:!1}}),G=function(c){function e(c){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var d=q(this,
(e.__proto__||Object.getPrototypeOf(e)).call(this));d.inputChanged=new h.b;d.prevInputValue="";d.completionsVisible=!1;d.activeCompletionPromise=null;d.activeCompletionCancellationToken=void 0;d.hasFocus=!1;d.completionResult=null;d.dropdownContentsStale=!0;d.updateHintScrollPositionTimer=null;d.completionElements=null;d.hasResultForDropdown=!1;d.commonPrefix="";d.activeIndex=-1;d.dropdownStyleStale=!0;d.completer=c.completer;c=void 0===c.delay?200:c.delay;var f=d.scheduleUpdateCompletions=a()(function(){var a=
d.activeCompletionCancellationToken=new b.b,c=d.activeCompletionPromise=d.completer(d.value,a);null!==c&&c.then(function(a){d.activeCompletionPromise===c&&(d.setCompletions(a),d.activeCompletionPromise=null)})},c);d.registerDisposer(function(){f.cancel()});c=d.element=document.createElement("div");c.className="autocomplete";var k=document.createElement("div");k.className="autocomplete-dropdown-wrapper";var m=d.dropdownElement=document.createElement("div");m.className="autocomplete-dropdown";var l=
d.promptElement=document.createElement("label");l.className="autocomplete-prompt";var n=d.inputWrapperElement=document.createElement("div");n.className="autocomplete-input-wrapper";c.appendChild(l);var p=d.inputElement=document.createElement("input");p.type="text";p.autocomplete="off";p.spellcheck=!1;p.className="autocomplete-input";Object(g.a)(l,p);l=d.hintElement=document.createElement("input");l.type="text";l.spellcheck=!1;l.className="autocomplete-hint";l.disabled=!0;n.appendChild(l);n.appendChild(p);
k.appendChild(n);k.appendChild(m);c.appendChild(k);d.registerInputHandler();d.handleInputChanged("");d.registerEventListener(d.inputElement,"focus",function(){d.hasFocus||(d.hasFocus=!0,d.dropdownStyleStale=!0,d.updateDropdown())});d.registerEventListener(d.inputElement,"blur",function(){d.hasFocus&&(d.hasFocus=!1,d.updateDropdown())});d.registerEventListener(c.ownerDocument.defaultView,"resize",function(){d.dropdownStyleStale=!0});d.registerEventListener(c.ownerDocument.defaultView,"scroll",function(){d.dropdownStyleStale=
!0});d.registerEventListener(d.dropdownElement,"mousedown",d.handleDropdownMousedown.bind(d));d.registerEventListener(d.inputElement,"keydown",function(){d.hintScrollPositionMayBeStale()});d.registerEventListener(d.inputElement,"mousemove",function(a){0!==a.buttons&&d.hintScrollPositionMayBeStale()});d.registerDisposer(new u.b(p,y)).allShortcutsAreGlobal=!0;Object(u.c)(p,"cycle-next-active-completion",function(){d.cycleActiveCompletion(1)});Object(u.c)(p,"cycle-prev-active-completion",function(){d.cycleActiveCompletion(-1)});
Object(u.c)(p,"choose-active-completion-or-prefix",function(a){d.selectActiveCompletion(!0)&&a.preventDefault()});Object(u.c)(p,"choose-active-completion",function(a){d.selectActiveCompletion(!1)&&a.preventDefault()});Object(u.c)(p,"cancel",function(a){a.stopPropagation();d.cancel()&&(a.detail.preventDefault(),a.detail.stopPropagation())});return d}m(e,c);d(e,[{key:"hintScrollPositionMayBeStale",value:function(){""!==this.hintElement.value&&this.scheduleUpdateHintScrollPosition()}},{key:"handleDropdownMousedown",
value:function(a){this.inputElement.focus();for(var b=this.dropdownElement,c=a.target;c instanceof HTMLElement;c=c.parentElement){var d=c[v];if(void 0!==d){this.selectCompletion(d);break}if(c===b)break}a.preventDefault()}},{key:"cycleActiveCompletion",value:function(a){if(null!==this.completionResult){var b=this.activeIndex,c=this.completionResult.completions.length;this.setActiveIndex(-1===b?0<a?0:c-1:(b+a+c)%c)}}},{key:"registerInputHandler",value:function(){for(var a=this,b=function(b){b=a.inputElement.value;
b!==a.prevInputValue&&(a.prevInputValue=b,a.handleInputChanged(b))},c=$jscomp.makeIterator(["input"]),d=c.next();!d.done;d=c.next())this.registerEventListener(this.inputElement,d.value,b,!1)}},{key:"shouldShowDropdown",value:function(){return null!==this.completionResult&&this.hasFocus?this.hasResultForDropdown:!1}},{key:"updateDropdownStyle",value:function(){Object(w.a)(this.dropdownElement,this.inputElement,{horizontal:!1});this.dropdownStyleStale=!1}},{key:"updateDropdown",value:function(){if(this.shouldShowDropdown()){var a=
this.dropdownElement,b=this.activeIndex;if(this.dropdownContentsStale){var c=this.completionResult,d=void 0===c.makeElement?r:c.makeElement;this.completionElements=c.completions.map(function(e,f){e=d.call(c,e);e[v]=f;e.classList.add("autocomplete-completion");b===f&&e.classList.add("autocomplete-completion-active");a.appendChild(e);return e});this.dropdownContentsStale=!1}this.dropdownStyleStale&&this.updateDropdownStyle();this.completionsVisible||(a.style.display="block",this.completionsVisible=
!0);-1!==b&&Object(k.a)(this.completionElements[b])}else this.completionsVisible&&(this.dropdownElement.style.display="none",this.completionsVisible=!1)}},{key:"setCompletions",value:function(a){this.clearCompletions();var b=a.completions;0!==b.length&&(this.completionResult=a,1===b.length?(b=b[0],a.showSingleResult?this.hasResultForDropdown=!0:b.value.startsWith(this.prevInputValue)?this.hasResultForDropdown=!1:this.hasResultForDropdown=!0,a.selectSingleResult?this.setActiveIndex(0):this.setHintValue(this.getCompletedValueByIndex(0))):
(this.hasResultForDropdown=!0,b=Object(p.a)(function(){function b(b,g){for(;;)switch(c){case 0:f=$jscomp.makeIterator(a.completions),e=f.next();case 1:if(e.done){c=3;break}d=e.value;c=4;return{value:d.value,done:!1};case 4:if(void 0===g){c=5;break}c=-1;throw g;case 5:case 2:e=f.next();c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,d,e,f,g={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();
g[Symbol.iterator]=function(){return this};return g}()),b=this.getCompletedValue(b),b.startsWith(this.prevInputValue)&&(this.commonPrefix=b,this.setHintValue(b))),this.updateDropdown())}},{key:"scheduleUpdateHintScrollPosition",value:function(){var a=this;null===this.updateHintScrollPositionTimer&&(this.updateHintScrollPositionTimer=setTimeout(function(){a.updateHintScrollPosition()},0))}},{key:"setHintValue",value:function(a){var b=this.prevInputValue;a!==b&&a.startsWith(b)||(a="");this.hintElement.value=
a;this.scheduleUpdateHintScrollPosition()}},{key:"setActiveIndex",value:function(a){if(!this.dropdownContentsStale){var b=this.activeIndex;-1!==b&&this.completionElements[b].classList.remove("autocomplete-completion-active");-1!==a&&(b=this.completionElements[a],b.classList.add("autocomplete-completion-active"),Object(k.a)(b))}-1!==a&&this.setHintValue(this.getCompletedValueByIndex(a));this.activeIndex=a}},{key:"getCompletedValueByIndex",value:function(a){return this.getCompletedValue(this.completionResult.completions[a].value)}},
{key:"getCompletedValue",value:function(a){return this.prevInputValue.substring(0,this.completionResult.offset)+a}},{key:"selectActiveCompletion",value:function(a){var b=this.activeIndex;if(-1===b){if(!a)return!1;a=this.completionResult;if(null!==a&&1===a.completions.length)b=0;else return a=this.commonPrefix,a.length>this.value.length?(this.value=a,!0):!1}a=this.getCompletedValueByIndex(b);if(this.value===a)return!1;this.value=a;return!0}},{key:"selectCompletion",value:function(a){this.value=this.getCompletedValueByIndex(a)}},
{key:"cancel",value:function(){return!1}},{key:"updateHintScrollPosition",value:function(){this.updateHintScrollPositionTimer=null;this.hintElement.scrollLeft=this.inputElement.scrollLeft}},{key:"cancelActiveCompletion",value:function(){var a=this.activeCompletionCancellationToken;void 0!==a&&a.cancel();this.activeCompletionCancellationToken=void 0;this.activeCompletionPromise=null}},{key:"handleInputChanged",value:function(a){this.cancelActiveCompletion();this.hintElement.value="";this.clearCompletions();
this.inputChanged.dispatch(a);this.scheduleUpdateCompletions()}},{key:"clearCompletions",value:function(){null!==this.completionResult&&(this.activeIndex=-1,this.completionElements=this.completionResult=null,this.dropdownStyleStale=this.dropdownContentsStale=!0,this.commonPrefix="",Object(l.a)(this.dropdownElement),this.updateDropdown())}},{key:"disposed",value:function(){Object(l.b)(this.element);this.cancelActiveCompletion();null!==this.updateHintScrollPositionTimer&&(clearTimeout(this.updateHintScrollPositionTimer),
this.updateHintScrollPositionTimer=null);f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}},{key:"disabled",get:function(){return this.inputElement.disabled},set:function(a){this.inputElement.disabled=a}},{key:"value",get:function(){return this.prevInputValue},set:function(a){a!==this.prevInputValue&&(this.prevInputValue=this.inputElement.value=a,this.handleInputChanged(a))}}]);return e}(n.a)},function(n,e,c){e.a=function(c,e,n){var a=void 0===n?{}:n,b=void 0===
a.horizontal?!1:a.horizontal,l=void 0===a.vertical?!0:a.vertical,m=void 0===a.topMargin?6:a.topMargin,q=void 0===a.bottomMargin?6:a.bottomMargin,p=void 0===a.leftMargin?6:a.leftMargin,k=void 0===a.rightMargin?6:a.rightMargin;n=void 0===a.maxHeight?!0:a.maxHeight;a=void 0===a.maxWidth?!0:a.maxWidth;e=e.getBoundingClientRect();if(b){b=e.right;var h=c.ownerDocument.documentElement.clientHeight-e.left;b>h?(c.style.left="",c.style.right="0",a&&(c.style.maxWidth=b-p+"px")):(c.style.right="",c.style.left=
"0",a&&(c.style.maxWidth=h-k+"px"))}l&&(l=e.top-m,q=c.ownerDocument.documentElement.clientHeight-e.bottom-q,l>3*q?(c.style.top="",c.style.bottom="100%",n&&(c.style.maxHeight=l+"px")):(c.style.top="100%",c.style.bottom="",n&&(c.style.maxHeight=q+"px")))}},function(n,e,c){e.a=function(c){$jscomp.initSymbol();$jscomp.initSymbolIterator();c=c[Symbol.iterator]();var e=c.next(),n=e.value;if(e.done)return"";for(e=n.length;0<e;){var a=c.next(),b=a.value;if(a.done)break;for(a=0;a<e&&n.charCodeAt(a)===b.charCodeAt(a);++a);
e=a}return n.substring(0,e)}},function(n,e,c){e.a=function(c){var e=c.parentElement,n=c.offsetLeft-e.clientLeft,a=c.offsetTop-e.clientTop,b=e.scrollLeft,l=e.scrollTop;a=Math.max(0,a+c.offsetHeight-(l+e.clientHeight))||Math.min(0,a-l);e.scrollLeft+=Math.max(0,n+c.offsetWidth-(b+e.clientWidth))||Math.min(0,n-b);e.scrollTop+=a}},function(n,e){},function(n,e,c){e.a=function(){var c=document.createElement("button");c.type="submit";c.className="hidden-submit-button";c.style.margin="0";c.style.border="0";
c.style.padding="0";c.style.width="0";c.style.height="0";c.style.overflow="hidden";c.tabIndex=-1;return c}},function(n,e){},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b,c){var d=Object(k.c)(a,"dragenter",function(b){void 0!==Object(p.c)(b)&&a.classList.add("neuroglancer-drag-over")}),e=Object(k.c)(a,"dragleave",function(){a.classList.remove("neuroglancer-drag-over")}),f=Object(k.c)(a,"dragover",function(a){Object(w.c)(a)?(Object(g.e)(a,Object(w.b)(a,b)),a.stopPropagation(),
a.preventDefault()):void 0!==Object(p.c)(a)&&(Object(p.f)(a,b,!0),a.stopPropagation(),a.preventDefault())}),h=Object(k.c)(a,"drop",function(d){a.classList.remove("neuroglancer-drag-over");if(Object(w.c)(d)){d.stopPropagation();try{var e=JSON.parse(d.dataTransfer.getData(w.d))}catch(Q){return}var f=Object(p.b)(d,b,!1,!1,!0);if(void 0!==f&&f.finalize(d)){d.preventDefault();d.dataTransfer.dropEffect=Object(g.c)();Object(p.a)(d);var h=c();f=$jscomp.makeIterator(f.layers.keys());for(d=f.next();!d.done;d=
f.next())h.layerSpecification.add(d.value);try{h.restoreState(e)}catch(Q){}}}else if(h=Object(p.b)(d,b,"copy"===Object(g.c)(),!1,!0),void 0!==h&&h.finalize(d))for(d.preventDefault(),d.dataTransfer.dropEffect=Object(g.c)(),Object(p.a)(d),e=c(),h=$jscomp.makeIterator(h.layers.keys()),d=h.next();!d.done;d=h.next())e.layerSpecification.add(d.value)});return function(){h();f();e();d()}}function b(a,b){var c=document.createElement("div");c.style.flex="1";c.style.width="0px";if("string"===typeof b){if(void 0!==
a.parent)throw Error("Invalid layout component specification: "+JSON.stringify(b));return new B(c,b,a.viewer)}Object(d.u)(b);var e=Object(d.w)(b,"type",d.B);switch(e){case "row":case "column":return new z(c,e,Object(d.w)(b,"children",function(b){b=Object(d.a)(b,function(a){return a});if(void 0===a.parent&&0===b.length)throw Error("Stack layout requires at least one child.");return b}),a);case "viewer":e=a.viewer;var f=new u.a(e.layerSpecification.addRef());c=new w.a(c,e.editorState,{display:e.display,
navigationState:e.navigationState.addRef(),perspectiveNavigationState:e.perspectiveNavigationState.addRef(),mouseState:e.mouseState,showAxisLines:e.showAxisLines,showScaleBar:e.showScaleBar,showPerspectiveSliceViews:e.showPerspectiveSliceViews,layerSpecification:f,inputEventBindings:e.inputEventBindings,visibility:e.visibility},{showLayerPanel:e.options.showLayerPanel,showViewerMenu:!0});try{c.restoreState(b)}catch(T){throw c.dispose(),T;}return c}throw Error("Invalid layout component specification: "+
JSON.stringify(b));}c.d(e,"a",function(){return D});n=c(13);var l=c.n(n),w=c(225),u=c(9),p=c(65),k=c(0),h=c(5),g=c(66),d=c(2),f=c(3),v=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),y=function C(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),
null!==a)return C(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};c(233);$jscomp.initSymbol();var G=Symbol("layoutComponentContainer"),E=function(c){function d(b,c,e){q(this,d);var g=m(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));g.viewer=b;g.parent=e;g.changed=new f.a;g.element=document.createElement("div");var h=g.element;h.style.display="flex";h.style.flex="1";h.style.position="relative";h.style.alignItems="stretch";h.foo="hello";h[G]=g;g.setSpecification(c);
var k=[];b=function(b){var c=document.createElement("div");c.className="neuroglancer-layout-split-drop-zone";c.style[b]="0";switch(b){case "left":case "right":var d="row";c.style.width="10px";c.style.height="100%";break;case "top":case "bottom":d="column",c.style.height="10px",c.style.width="100%"}c.style.display="none";k.push({element:c,direction:d,orientation:b});h.appendChild(c);g.registerDisposer(a(c,g.viewer.layerSpecification,function(){return g.split(b).newContainer.component}))};b("left");
b("right");b("top");b("bottom");var l=!1;g.registerEventListener(h,"dragenter",function(a){if(!l&&void 0!==Object(p.c)(a)){l=!0;a=$jscomp.makeIterator(k);for(var b=a.next();!b.done;b=a.next()){var c=b.value;b=c.element;var d=c.direction;c=c.orientation;if(void 0===e||d!==e.direction||("left"!==c&&"top"!==c||e.get(0)===g)&&("bottom"!==c&&"right"!==c||e.get(e.length-1)===g))c=g.component,c instanceof z&&c.direction===d||(b.style.display="block")}}},!0);g.registerEventListener(h,"drop",function(a){if(l){l=
!1;a=$jscomp.makeIterator(k);for(var b=a.next();!b.done;b=a.next())b.value.element.style.display="none"}});g.registerEventListener(h,"dragleave",function(a){a=a.relatedTarget;if(l&&!(a instanceof HTMLElement&&g.element.contains(a))){l=!1;a=$jscomp.makeIterator(k);for(var b=a.next();!b.done;b=a.next())b.value.element.style.display="none"}},!0);return g}r(d,c);v(d,[{key:"unsetComponent",value:function(){var a=this.componentValue;void 0!==a&&(a.changed.remove(this.changed.dispatch),this.element.removeChild(a.element),
a.dispose())}},{key:"setComponent",value:function(a){var b=this;this.unsetComponent();this.componentValue=a;a.changed.add(this.changed.dispatch);this.element.appendChild(a.element);if(a instanceof w.a){var c=a.layerManager,d=a.registerCancellable(l()(function(){0===c.managedLayers.length&&b.dispose()},0));a.registerDisposer(c.layersChanged.add(function(){0===c.managedLayers.length&&d()}));d()}else if(a instanceof z){var e=a.registerCancellable(l()(function(){var c=a.length;if(0===c&&void 0!==b.parent)b.dispose();
else if(1===c){c=a.get(0).component;if(void 0===b.parent&&c instanceof w.a){var d=c.layout.name;c.viewerNavigationState.copyToParent();var e=new Set(c.layerManager.managedLayers),f=c.layerSpecification;f.rootLayers.filter(function(a){return e.has(a)});f.rootLayers.managedLayers=Array.from(c.layerManager.managedLayers);f.rootLayers.layersChanged.dispatch()}else d=c.toJSON();b.setSpecification(d)}},0));a.registerDisposer(a.changed.add(function(){2>a.length&&e()}));e()}}},{key:"toJSON",value:function(){return this.component.toJSON()}},
{key:"setSpecification",value:function(a){this.setComponent(b(this,a))}},{key:"disposed",value:function(){this.unsetComponent();this.componentValue=void 0;y(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"disposed",this).call(this)}},{key:"split",value:function(a){var b={type:"viewer"},c=this.parent;if(void 0!==c){if("left"===a&&"row"===c.direction||"top"===a&&"column"===c.direction)return{newContainer:c.insertChild(b,this),existingContainer:this};if("right"===a&&"row"===c.direction||"bottom"===
a&&"column"===c.direction)return{newContainer:c.insertChild(b),existingContainer:this}}c=this.component;c=c instanceof B?c.layerGroupViewer.toJSON():c.toJSON();var d="left"===a||"right"===a?"row":"column";switch(a){case "left":case "top":var e={type:d,children:[b,c]};var f=0;break;case "right":case "bottom":e={type:d,children:[c,b]},f=1}this.setSpecification(e);a=this.component;return{newContainer:a.get(f),existingContainer:a.get(1-f)}}},{key:"component",get:function(){return this.componentValue}}],
[{key:"getFromElement",value:function(a){return a[G]}}]);return d}(k.a),B=function(a){function b(a,c,d){q(this,b);var e=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));e.element=a;e.layerGroupViewer=e.registerDisposer(new w.a(a,d.editorState,{display:d.display,navigationState:d.navigationState.addRef(),perspectiveNavigationState:d.perspectiveNavigationState.addRef(),mouseState:d.mouseState,showAxisLines:d.showAxisLines,showScaleBar:d.showScaleBar,showPerspectiveSliceViews:d.showPerspectiveSliceViews,
layerSpecification:d.layerSpecification.addRef(),inputEventBindings:d.inputEventBindings,visibility:d.visibility},{showLayerPanel:d.options.showLayerPanel,showViewerMenu:!1}));e.layerGroupViewer.layout.name=c;return e}r(b,a);v(b,[{key:"toJSON",value:function(){return this.layerGroupViewer.layout.name}},{key:"changed",get:function(){return this.layerGroupViewer.layout.changed}}]);return b}(k.a),z=function(b){function c(a,b,d,e){q(this,c);var g=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));
g.element=a;g.direction=b;g.container=e;g.changed=new f.a;a.classList.add("neuroglancer-stack-layout");a.classList.add("neuroglancer-stack-layout-"+b);a.style.display="flex";a.style.flexDirection=b;a.appendChild(g.makeDropPlaceholder(g));a=$jscomp.makeIterator(d);for(b=a.next();!b.done;b=a.next())g.insertChild(b.value);return g}r(c,b);$jscomp.initSymbol();$jscomp.initSymbolIterator();v(c,[{key:"makeDropPlaceholder",value:function(b){var c=this,d=document.createElement("div");d.className="neuroglancer-stack-layout-drop-placeholder";
b.registerDisposer(a(d,this.viewer.layerSpecification,function(){var a=d.nextElementSibling,b;null!==a&&(b=E.getFromElement(a));return c.insertChild({type:"viewer",layers:[]},b).component}));b.registerDisposer(function(){Object(h.b)(d)});return d}},{key:"get",value:function(a){return E.getFromElement(this.element.children[2*a+1])}},{key:"insertChild",value:function(a,b){var c=this,d=new E(this.viewer,a,this);a=this.makeDropPlaceholder(d);d.element.classList.add("neuroglancer-stack-layout-child");
d.registerDisposer(d.changed.add(this.changed.dispatch));d.registerDisposer(function(){c.element.removeChild(d.element);c.changed.dispatch()});b=void 0!==b?b.element:null;this.element.insertBefore(d.element,b);this.element.insertBefore(a,b);this.changed.dispatch();return d}},{key:"disposed",value:function(){this.clear();y(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}},{key:"clear",value:function(){for(;0!==this.length;)this.get(0).dispose()}},{key:Symbol.iterator,
value:function(){function a(a,g){for(;;)switch(b){case 0:e=f,d=e.length,c=0;case 1:if(!(c<d)){b=3;break}b=4;return{value:f.get(c),done:!1};case 4:if(void 0===g){b=5;break}b=-1;throw g;case 5:case 2:++c;b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,c,d,e,f=this,g={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}},
{key:"toJSON",value:function(){return{type:this.direction,children:Array.from(this).map(function(a){return a.toJSON()})}}},{key:"length",get:function(){return(this.element.childElementCount-1)/2}},{key:"viewer",get:function(){return this.container.viewer}}]);return c}(k.a),D=function(a){function b(a,c){q(this,b);var d=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));d.viewer=a;d.defaultSpecification=c;d.container=d.registerDisposer(new E(d.viewer,d.defaultSpecification,void 0));return d}
r(b,a);v(b,[{key:"reset",value:function(){this.container.setSpecification(this.defaultSpecification)}},{key:"restoreState",value:function(a){this.container.setSpecification(a)}},{key:"disposed",value:function(){y(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"disposed",this).call(this)}},{key:"toJSON",value:function(){var a=this.container.toJSON();if(a!==this.defaultSpecification)return a}},{key:"changed",get:function(){return this.container.changed}},{key:"element",get:function(){return this.container.element}}]);
return b}(k.a)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,
writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){a=new p.a(a);var c=a.element;c.classList.add("neuroglancer-layer-group-viewer-context-menu");var d=document.createElement("button");d.textContent="Remove layer group";c.appendChild(d);a.registerEventListener(d,"click",function(){b.layerSpecification.layerManager.clear()});d=b.viewerNavigationState;d=$jscomp.makeIterator([["Position",d.position.link],["Cross-section orientation",d.crossSectionOrientation.link],
["Cross-section zoom",d.crossSectionZoom.link],["Perspective orientation",d.perspectiveOrientation.link],["Perspective zoom",d.perspectiveZoom.link]]);for(var e=d.next();!e.done;e=d.next()){var f=$jscomp.makeIterator(e.value);e=f.next().value;f=f.next().value;f=a.registerDisposer(new y.a(f));var g=document.createElement("label");g.style.display="flex";g.style.flexDirection="row";g.style.whiteSpace="nowrap";g.textContent=e;g.appendChild(f.element);c.appendChild(g)}return a}e.c=function(a){return-1!==
a.dataTransfer.types.indexOf("neuroglancer-layer-group-viewer")};e.b=function(a,b){if(a.shiftKey)return"copy";if(a.ctrlKey)return"move";a=B&&B.viewer.layerSpecification.rootLayers===b.rootLayers?B.viewer:void 0;return void 0!==a?"move":"copy"};c.d(e,"a",function(){return D});var b=c(106),l=c(226),w=c(9),u=c(43),p=c(64),k=c(65),h=c(111),g=c(38);n=c(0);var d=c(5),f=c(15),v=c(45),y=c(231),G=function C(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=
Object.getPrototypeOf(a),null!==a)return C(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},E=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();c(232);e.d="neuroglancer-layer-group-viewer";var B,z=function(a){function b(a){q(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));
c.position=new u.b(a.navigationState.position.addRef());c.crossSectionOrientation=new u.a(a.navigationState.pose.orientation.addRef());c.crossSectionZoom=new u.c(a.navigationState.zoomFactor.addRef());c.navigationState=c.registerDisposer(new u.e(new u.g(c.position.value,c.crossSectionOrientation.value),c.crossSectionZoom.value));c.perspectiveOrientation=new u.a(a.perspectiveNavigationState.pose.orientation.addRef());c.perspectiveZoom=new u.c(a.perspectiveNavigationState.zoomFactor.addRef());c.perspectiveNavigationState=
c.registerDisposer(new u.e(new u.g(c.position.value.addRef(),c.perspectiveOrientation.value),c.perspectiveZoom.value));return c}r(b,a);E(b,[{key:"copyToParent",value:function(){for(var a=$jscomp.makeIterator([this.position,this.crossSectionOrientation,this.crossSectionZoom,this.perspectiveOrientation,this.perspectiveZoom]),b=a.next();!b.done;b=a.next())b.value.copyToPeer()}},{key:"register",value:function(a){a.add("position",this.position);a.add("crossSectionOrientation",this.crossSectionOrientation);
a.add("crossSectionZoom",this.crossSectionZoom);a.add("perspectiveOrientation",this.perspectiveOrientation);a.add("perspectiveZoom",this.perspectiveZoom)}}]);return b}(n.a),D=function(c){function e(a,c,d,f){f=void 0===f?{}:f;q(this,e);var k=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));k.element=a;k.editorState=c;k.viewerState=d;k.state=new v.a;k.options=Object.assign({showLayerPanel:!0,showViewerMenu:!1},f);k.layerSpecification=k.registerDisposer(d.layerSpecification);k.viewerNavigationState=
k.registerDisposer(new z(d));k.viewerNavigationState.register(k.state);k.layerSpecification instanceof w.a?k.state.add("layers",k.layerSpecification):k.state.add("layers",{changed:k.layerSpecification.changed,toJSON:function(){return k.layerSpecification.layerManager.managedLayers.map(function(a){return a.name})},reset:function(){throw Error("not implemented");},restoreState:function(){throw Error("not implemented");}});a.classList.add("neuroglancer-layer-group-viewer");k.registerDisposer(new g.a(a));
k.layout=k.registerDisposer(new b.a(k,"xy"));k.state.add("layout",k.layout);k.registerActionBindings();k.registerDisposer(k.layerManager.useDirectly());k.registerDisposer(Object(h.a)(a,k.navigationState.position));k.makeUI();return k}r(e,c);E(e,[{key:"bindAction",value:function(a,b){this.registerDisposer(Object(f.c)(this.element,a,b))}},{key:"registerActionBindings",value:function(){var a=this;this.bindAction("add-layer",function(){a.layerPanel&&a.layerPanel.addLayerMenu()})}},{key:"toJSON",value:function(){return Object.assign({type:"viewer"},
this.state.toJSON())}},{key:"reset",value:function(){this.state.reset()}},{key:"restoreState",value:function(a){this.state.restoreState(a)}},{key:"makeUI",value:function(){var b=this;this.element.style.flex="1";this.element.style.display="flex";this.element.style.flexDirection="column";var c=this.options;if(c.showLayerPanel){var d=this.layerPanel=this.registerDisposer(new l.a(this.display,this.layerSpecification,this.viewerNavigationState));c.showViewerMenu?(this.registerDisposer(a(d.element,this)),
d.element.title="Right click for options, drag to move/copy layer group."):d.element.title="Drag to move/copy layer group.";d.element.draggable=!0;this.registerEventListener(d.element,"dragstart",function(a){Object(k.e)(a,{manager:b.layerSpecification,layers:b.layerManager.managedLayers});var c=function(){B&&B.viewer===b&&(B=void 0);b.unregisterDisposer(c)};B={viewer:b,disposer:c};b.registerDisposer(c);var d=b.toJSON();delete d.layers;a.dataTransfer.setData("neuroglancer-layer-group-viewer",JSON.stringify(d))});
this.registerEventListener(d.element,"dragend",function(a){Object(k.a)(a);void 0!==B&&B.viewer===b&&B.disposer()});this.element.appendChild(d.element)}this.element.appendChild(this.layout.element)}},{key:"disposed",value:function(){Object(d.a)(this.element);G(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}},{key:"perspectiveNavigationState",get:function(){return this.viewerNavigationState.perspectiveNavigationState}},{key:"navigationState",get:function(){return this.viewerNavigationState.navigationState}},
{key:"display",get:function(){return this.viewerState.display}},{key:"layerManager",get:function(){return this.layerSpecification.layerManager}},{key:"chunkManager",get:function(){return this.layerSpecification.chunkManager}},{key:"mouseState",get:function(){return this.viewerState.mouseState}},{key:"showAxisLines",get:function(){return this.viewerState.showAxisLines}},{key:"showScaleBar",get:function(){return this.viewerState.showScaleBar}},{key:"showPerspectiveSliceViews",get:function(){return this.viewerState.showPerspectiveSliceViews}},
{key:"inputEventBindings",get:function(){return this.viewerState.inputEventBindings}},{key:"visibility",get:function(){return this.viewerState.visibility}},{key:"changed",get:function(){return this.state.changed}}]);return e}(n.a)},function(n,e,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?
a:b}function r(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if("move"===a.method)return!1;a.manager.layerManager.filter(function(b){return!a.layers.has(b)});return void 0!==b&&a.layers.has(b)}function b(b,c,d){function e(c,e){var g=
b.dropLayers,h=e?Object(k.d)(c,b.manager):Object(f.c)(),l=!0;if(void 0!==g&&(e&&Object(f.e)(c,h),!g.compatibleWithMethod(h)&&(b.dropLayers=void 0,a(g,d))))return;if(void 0===g){g=b.dropLayers=Object(k.b)(c,b.manager,"copy"===h,!0,!1);if(void 0===g)return;l="move"===g.method}if(void 0!==d&&g.layers.has(d))return g;if(l){var m=b.manager.layerManager,n=new Set,p=Number.POSITIVE_INFINITY;c=m.managedLayers=m.managedLayers.filter(function(a,b){return g.layers.has(a)?(p===Number.POSITIVE_INFINITY&&(p=b),
n.add(a),!1):!0});void 0!==d?(e=c.indexOf(d),p<=e&&++e):e=c.length;h=$jscomp.makeIterator(g.layers.keys());for(l=h.next();!l.done;l=h.next())l=l.value,n.has(l)||g.layers.delete(l);c.splice.apply(c,[].concat([e,0],$jscomp.arrayFromIterable(g.layers.keys())));m.layersChanged.dispatch()}else for(void 0!==d&&(m=b.manager.layerManager.managedLayers.indexOf(d)),c=$jscomp.makeIterator(g.layers.keys()),e=c.next();!e.done;e=c.next())b.manager.add(e.value,m);return g}var h=Object(g.c)(c,"dragenter",function(a){void 0!==
e(a,!0)&&a.preventDefault()}),l=Object(g.c)(c,"drop",function(c){c.preventDefault();var d=e(c,!1);void 0!==d&&(d.finalize(c)?(c.dataTransfer.dropEffect=Object(f.c)(),Object(k.a)("move"===d.method?void 0:c)):a(d));b.dropLayers=void 0}),m=Object(g.c)(c,"dragover",function(a){void 0!==e(a,!0)&&(a.preventDefault(),a.stopPropagation())});return function(){m();l();h()}}c.d(e,"a",function(){return B});var l=c(107),w=c(9),u=c(43),p=c(64),k=c(65),h=c(109),g=c(0),d=c(5),f=c(66),v=c(67),y=function(){function a(a,
b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),G=function D(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return D(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};c(21);c(230);c(44);var E=function(a){function c(a,
d){q(this,c);var e=m(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));e.layer=a;e.panel=d;var f=e.element=document.createElement("div");f.title="Right click for layer options, drag to move/copy.";f.className="neuroglancer-layer-item neuroglancer-noselect";var g=e.labelElement=document.createElement("span");g.className="neuroglancer-layer-item-label";var h=e.layerNumberElement=document.createElement("span");h.className="neuroglancer-layer-item-number";var n=e.valueElement=document.createElement("span");
n.className="neuroglancer-layer-item-value";var r=document.createElement("span");r.title="Delete layer";r.className="neuroglancer-layer-item-close";e.registerEventListener(r,"click",function(a){e.panel.layerManager.removeManagedLayer(e.layer);a.stopPropagation()});f.appendChild(h);f.appendChild(g);f.appendChild(n);f.appendChild(r);e.registerEventListener(f,"click",function(b){a.setVisible(!a.visible)});g=e.contextMenu=e.registerDisposer(new p.a(f));g.element.classList.add("neuroglancer-layer-dropdown");
g.opened.add(function(){if(void 0!==e.dropdown)e.dropdown.onShow()});g.closed.add(function(){if(void 0!==e.dropdown)e.dropdown.onHide()});f.draggable=!0;e.registerEventListener(f,"dragstart",function(a){Object(k.e)(a,{manager:d.manager,layers:[e.layer]});a.stopPropagation()});e.registerEventListener(f,"dragend",function(a){Object(k.a)(a)});e.registerDisposer(b(e.panel,f,e.layer));e.registerEventListener(f,"dblclick",function(b){a instanceof w.b&&new l.a(e.panel.manager,a)});e.handleLayerChanged();
e.registerDisposer(a.layerChanged.add(function(){e.handleLayerChanged()}));return e}r(c,a);y(c,[{key:"update",value:function(){var a=this.layer;this.labelElement.textContent=a.name;this.element.setAttribute("layer-visible",a.visible.toString())}},{key:"handleLayerChanged",value:function(){var a=this.layer.layer;if(a!==this.userLayer)if(this.dropdown&&(this.dropdown.dispose(),Object(d.a)(this.contextMenu.element)),this.userLayer=a){var b=document.createElement("div");this.contextMenu.element.appendChild(b);
this.dropdown=a.makeDropdown(b)}else this.dropdown=void 0;this.contextMenu.disabled=void 0===this.dropdown}},{key:"disposed",value:function(){this.dropdown&&this.dropdown.dispose();this.element.parentElement.removeChild(this.element);G(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}}]);return c}(g.a),B=function(c){function d(c,e,g){q(this,d);var k=m(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));k.display=c;k.manager=e;k.viewerNavigationState=g;k.layerWidgets=
new Map;k.element=document.createElement("div");k.layerUpdateNeeded=!0;k.valueUpdateNeeded=!1;k.layerWidgetInsertionPoint=document.createElement("div");k.positionWidget=k.registerDisposer(new v.b(k.viewerNavigationState.position.value));k.scheduleUpdate=k.registerCancellable(Object(h.a)(function(){return k.update()}));var l=k.element;l.className="neuroglancer-layer-panel";k.registerDisposer(e.layerSelectedValues.changed.add(function(){k.handleLayerValuesChanged()}));k.registerDisposer(e.layerManager.layersChanged.add(function(){k.handleLayersChanged()}));
k.layerWidgetInsertionPoint.style.display="none";k.element.appendChild(k.layerWidgetInsertionPoint);e=k.addButton=document.createElement("div");e.className="neuroglancer-layer-add-button neuroglancer-button";e.title="Add layer";e.textContent="+";g=k.dropZone=document.createElement("div");g.className="neuroglancer-layer-panel-drop-zone";k.registerEventListener(e,"click",function(){k.addLayerMenu()});l.appendChild(e);l.appendChild(g);k.registerDisposer(Object(f.d)(e));l.appendChild(k.positionWidget.element);
var n=function(){k.positionWidget.element.style.display=k.viewerNavigationState.position.link.value===u.d.LINKED?"none":null};k.registerDisposer(k.viewerNavigationState.position.link.changed.add(n));n();k.update();k.registerEventListener(l,"dragleave",function(b){b.relatedTarget&&l.contains(b.relatedTarget)||(b=k.dropLayers,void 0!==b&&(a(b),k.dropLayers=void 0))});k.registerDisposer(b(k,e,void 0));k.registerDisposer(b(k,g,void 0));k.registerDisposer(c.updateStarted.add(function(){return k.updateLayers()}));
return k}r(d,c);y(d,[{key:"disposed",value:function(){this.layerWidgets.forEach(function(a){return a.dispose()});this.layerWidgets=void 0;G(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"disposed",this).call(this)}},{key:"handleLayersChanged",value:function(){this.layerUpdateNeeded=!0;this.handleLayerValuesChanged()}},{key:"handleLayerValuesChanged",value:function(){this.valueUpdateNeeded||(this.valueUpdateNeeded=!0,this.scheduleUpdate())}},{key:"update",value:function(){this.valueUpdateNeeded=
!1;this.updateLayers();for(var a=this.manager.layerSelectedValues,b=$jscomp.makeIterator(this.layerWidgets),c=b.next();!c.done;c=b.next()){c=$jscomp.makeIterator(c.value);var d=c.next().value;c=c.next().value;var e=d.layer;d="";null!==e&&(e=a.get(e),void 0!==e&&(d=""+e));c.valueElement.textContent=d}}},{key:"updateLayers",value:function(){var a=this;if(this.layerUpdateNeeded){this.layerUpdateNeeded=!1;var b=this.element,c=new Set,d=this.layerWidgetInsertionPoint.nextElementSibling;this.manager.layerManager.managedLayers.forEach(function(e){c.add(e);
var f=a.layerWidgets.get(e),g=a.manager.rootLayers.managedLayers.indexOf(e);void 0===f&&(f=new E(e,a),a.layerWidgets.set(e,f));f.layerNumberElement.textContent=""+(1+g);f.update();e=f.element;e!==d&&b.insertBefore(f.element,d);d=e.nextElementSibling});for(var e=$jscomp.makeIterator(this.layerWidgets),f=e.next();!f.done;f=e.next()){var g=$jscomp.makeIterator(f.value);f=g.next().value;g=g.next().value;c.has(f)||(this.layerWidgets.delete(f),g.dispose())}}}},{key:"addLayerMenu",value:function(){new l.a(this.manager)}},
{key:"layerManager",get:function(){return this.manager.layerManager}}]);return d}(g.a)},function(n,e){},function(n,e,c){e.b=function(c){return Array.prototype.map.call(c,function(c){return("0"+c.toString(16)).slice(-2)}).join("")};e.a=function(c){if(!/^(?:[0-9a-fA-F]{2})*$/.test(c))throw Error("Invalid hex-encoded string");for(var e=c.length/2,n=new Uint8Array(e),a=0;a<e;++a)n[a]=parseInt(c.substr(2*a,2),16);return n}},function(n,e){},function(n,e){},function(n,e,c){function q(a,c){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!c||"object"!==typeof c&&"function"!==typeof c?a:c}function m(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}c.d(e,"a",function(){return a});n=c(0);var r=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||
!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),a=function(a){function b(a){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var c=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.model=a;c.element=document.createElement("select");c.valueIndexMap=new Map;for(var e=c.element,k=c.valueIndexMap,h=0,g=$jscomp.makeIterator(Object.keys(a.enumType)),d=g.next();!d.done;d=
g.next())if(d=d.value,isNaN(Number(d))){var f=document.createElement("option");f.textContent=f.value=d.toLowerCase();e.appendChild(f);k.set(a.enumType[d],h);++h}c.registerDisposer(a.changed.add(function(){return c.updateView()}));c.registerEventListener(e,"change",function(){return c.updateModel()});c.updateView();return c}m(b,a);r(b,[{key:"updateView",value:function(){this.element.selectedIndex=this.valueIndexMap.get(this.model.value)}},{key:"updateModel",value:function(){this.model.restoreState(this.element.value)}}]);
return b}(n.a)},function(n,e){},function(n,e){},function(n,e,c){function q(a){return a%2}e.b=function(a){return new m.a(void 0===a?0:a,q)};var m=c(4),r;(function(a){a[a.NONE=0]="NONE";a[a.MERGE=1]="MERGE";a[a.SPLIT=2]="SPLIT";a[a.TOTAL=2]="TOTAL"})(r||(r={}));n=new Map([[0,"select (2x click)"],[1,"merge (2x click)"]]);e.a=n},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?
a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return w});var r=c(4);n=c(0);var a=c(5),b=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in
e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),l=function p(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return p(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},w=function(c){function e(a,b){b=void 0===b?{}:b;if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var c=q(this,
(e.__proto__||Object.getPrototypeOf(e)).call(this));c.model=a;c.element=document.createElement("label");c.inputElement=document.createElement("input");var f=b;b=f.validator;f=f.label;var g=c.element,h=c.inputElement;void 0===b&&(b=a instanceof r.a?a.validator:function(a){return a});c.validator=b;void 0!==f&&(g.textContent=f);g.appendChild(h);g.className="neuroglancer-number-input";h.type="input";c.registerDisposer(c.model.changed.add(function(){return c.updateView()}));c.registerEventListener(h,"change",
function(){return c.updateModel()});c.updateView();return c}m(e,c);b(e,[{key:"updateView",value:function(){this.inputElement.value=""+this.model.value}},{key:"updateModel",value:function(){var a=parseFloat(this.inputElement.value.trim());if(Number.isNaN(a))this.updateView();else try{a=this.validator(a),this.model.value=a}catch(g){this.updateView()}}},{key:"disposed",value:function(){Object(a.b)(this.element);l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}}]);
return e}(n.a)},function(n,e){},function(n,e,c){e.a=function(){return Object(q.c)(document,"contextmenu",function(c){c.preventDefault()})};e.b=function(){return Object(q.c)(document,"wheel",function(c){c.ctrlKey&&c.preventDefault()})};var q=c(0)},function(n,e,c){e.a=function(a){a.registerEventListener(document,"copy",function(b){if(!Object(q.a)(b)){var c=Object(r.b)(a.state).value;b.clipboardData.setData("text/plain",JSON.stringify(c,void 0,"  "));b.preventDefault()}})};e.b=function(a){a.registerEventListener(document,
"paste",function(b){if(!Object(q.a)(b)){var c=b.clipboardData.getData("text/plain").match(/^[\[\]{}()\s,]*(\d+(?:\.\d+)?)[,\s]+(\d+(?:\.\d+)?)[,\s]+(\d+(?:\.\d+)?)[\[\]{}()\s,]*$/);c=null!==c?m.p.fromValues(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])):void 0;void 0!==c&&a.navigationState.position.setVoxelCoordinates(c);b.preventDefault()}})};var q=c(110),m=c(1),r=c(45)},function(n,e,c){function q(){if(void 0===l){var a=new b.a;a.set("keyl","recolor");a.set("keyx","clear-segments");a.set("keys",
"toggle-show-slices");a.set("keyb","toggle-scale-bar");a.set("keya","toggle-axis-lines");for(var c=1;9>=c;++c)a.set("digit"+c,"toggle-layer-"+c);a.set("keyn","add-layer");a.set("keyh","help");a.set("space","toggle-layout");a.set("shift+space","toggle-layout-alternative");a.set("slash","toggle-edit-mode");l=a}return l}function m(){void 0===w&&(w=b.a.fromObject({arrowleft:"x-",arrowright:"x+",arrowup:"y-",arrowdown:"y+",comma:"z-",period:"z+",keyz:"snap","control+equal":"zoom-in","control+shift+equal":"zoom-in",
"control+minus":"zoom-out",keyr:"rotate-relative-z-",keye:"rotate-relative-z+","shift+arrowdown":"rotate-relative-x-","shift+arrowup":"rotate-relative-x+","shift+arrowleft":"rotate-relative-y-","shift+arrowright":"rotate-relative-y+","at:control+wheel":{action:"zoom-via-wheel",preventDefault:!0},"at:wheel":{action:"z+1-via-wheel",preventDefault:!0},"at:shift+wheel":{action:"z+10-via-wheel",preventDefault:!0},"at:dblclick0":"select","at:control+mousedown0":"annotate","at:mousedown2":"move-to-mouse-position"},
{label:"All Data Panels"}));return w}function r(){void 0===u&&(u=b.a.fromObject({"at:mousedown0":{action:"rotate-via-mouse-drag",stopPropagation:!0},"at:shift+mousedown0":{action:"translate-via-mouse-drag",stopPropagation:!0}},{parents:[[m(),Number.NEGATIVE_INFINITY]]}));return u}function a(){void 0===p&&(p=b.a.fromObject({"at:mousedown0":{action:"translate-via-mouse-drag",stopPropagation:!0},"at:shift+mousedown0":{action:"rotate-via-mouse-drag",stopPropagation:!0}},{parents:[[m(),Number.NEGATIVE_INFINITY]]}));
return p}e.a=function(b){b.global.addParent(q(),Number.NEGATIVE_INFINITY);b.sliceView.addParent(a(),Number.NEGATIVE_INFINITY);b.perspectiveView.addParent(r(),Number.NEGATIVE_INFINITY)};var b=c(15),l,w,u,p},function(n,e,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(e,"a",function(){return u});n=c(13);var r=c.n(n),a=c(4);n=c(0);var b=c(2),l=c(45),w=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,
e);return b}}(),u=function(c){function e(b,c){c=void 0===c?200:c;if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var d=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));d.root=b;d.parseError=new a.b(void 0);d.registerEventListener(window,"hashchange",function(){return d.updateFromUrlHash()});var f=r()(function(){return d.setUrlHash()},c);d.registerDisposer(b.changed.add(f));d.registerDisposer(function(){return f.cancel()});return d}m(e,c);w(e,[{key:"checkLayerChange",
value:function(){if(!(this.root instanceof l.a))return!1;var a=this.root.children.get("layers");if(void 0===a)return!1;a=a.changed.count;if(a===this.prevLayerGeneration)return!1;if(void 0===this.prevLayerGeneration)return this.prevLayerGeneration=a,!1;this.prevLayerGeneration=a;return!0}},{key:"updateHistory",value:function(a){var b=history.replaceState.bind(history);this.checkLayerChange()&&(b=history.pushState.bind(history));"{}"===a?b(null,"","#"):b(null,"","#!"+a)}},{key:"setUrlHash",value:function(){var a=
Object(l.b)(this.root);a.generation!==this.prevStateGeneration&&(this.prevStateGeneration=a.generation,a=Object(b.i)(a.value),a!==this.prevStateString&&(this.prevStateString=a,this.updateHistory(a)))}},{key:"updateFromUrlHash",value:function(){try{var a=location.href.replace(/^[^#]+/,"");if(""===a||"#"===a||"#!"===a)a="#!{}";if(a.startsWith("#!+")){a=a.slice(3);a=decodeURI(a);var c=Object(b.h)(a);Object(b.u)(c);this.root.restoreState(c);this.prevStateString=void 0}else if(a.startsWith("#!")){a=a.slice(2);
a=decodeURI(a);if(a===this.prevStateString)return;this.prevStateString=a;this.root.reset();var d=Object(b.h)(a);Object(b.u)(d);this.root.restoreState(d)}else throw Error('URL hash is expected to be of the form "#!{...}" or "#!+{...}".');this.parseError.value=void 0}catch(f){this.parseError.value=f}}}]);return e}(n.a)}]);
