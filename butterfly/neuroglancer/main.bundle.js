/*

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 JS Signals <http://millermedeiros.github.com/js-signals/>
 Released under the MIT license
 Author: Miller Medeiros
 Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 MIT

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
var $jscomp={scope:{},getGlobal:function(g){return"undefined"!=typeof window&&window===g?g:"undefined"!=typeof global?global:g}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.initSymbol=function(){$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(g){return"jscomp_symbol_"+g+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();$jscomp.global.Symbol.iterator||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};
$jscomp.makeIterator=function(g){$jscomp.initSymbolIterator();if(g[$jscomp.global.Symbol.iterator])return g[$jscomp.global.Symbol.iterator]();if(!(g instanceof Array||"string"==typeof g||g instanceof String))throw new TypeError(g+" is not iterable");var c=0;return{next:function(){return c==g.length?{done:!0}:{done:!1,value:g[c++]}}}};$jscomp.arrayFromIterator=function(g){for(var c,e=[];!(c=g.next()).done;)e.push(c.value);return e};
$jscomp.arrayFromIterable=function(g){return g instanceof Array?g:$jscomp.arrayFromIterator($jscomp.makeIterator(g))};$jscomp.arrayFromArguments=function(g){for(var c=[],e=0;e<g.length;e++)c.push(g[e]);return c};$jscomp.inherits=function(g,c){function e(){}e.prototype=c.prototype;g.prototype=new e;g.prototype.constructor=g;for(var l in c)if($jscomp.global.Object.defineProperties){var b=$jscomp.global.Object.getOwnPropertyDescriptor(c,l);$jscomp.global.Object.defineProperty(g,l,b)}else g[l]=c[l]};
$jscomp.array=$jscomp.array||{};$jscomp.array.done_=function(){return{done:!0,value:void 0}};$jscomp.array.arrayIterator_=function(g,c){g instanceof String&&(g=String(g));var e=0;$jscomp.initSymbol();$jscomp.initSymbolIterator();var l={},b=(l.next=function(){if(e<g.length){var a=e++;return{value:c(a,g[a]),done:!1}}b.next=$jscomp.array.done_;return $jscomp.array.done_()},l[Symbol.iterator]=function(){return b},l);return b};
$jscomp.array.findInternal_=function(g,c,e){g instanceof String&&(g=String(g));for(var l=g.length,b=0;b<l;b++){var a=g[b];if(c.call(e,a,b,g))return{i:b,v:a}}return{i:-1,v:void 0}};
$jscomp.array.from=function(g,c,e){c=void 0===c?function(a){return a}:c;var l=[];$jscomp.initSymbol();$jscomp.initSymbolIterator();if(g[Symbol.iterator]){$jscomp.initSymbol();$jscomp.initSymbolIterator();g=g[Symbol.iterator]();for(var b;!(b=g.next()).done;)l.push(c.call(e,b.value))}else{b=g.length;for(var a=0;a<b;a++)l.push(c.call(e,g[a]))}return l};$jscomp.array.of=function(g){for(var c=[],e=0;e<arguments.length;++e)c[e-0]=arguments[e];return $jscomp.array.from(c)};
$jscomp.array.entries=function(){return $jscomp.array.arrayIterator_(this,function(g,c){return[g,c]})};$jscomp.array.entries$install=function(){Array.prototype.entries||(Array.prototype.entries=$jscomp.array.entries)};$jscomp.array.keys=function(){return $jscomp.array.arrayIterator_(this,function(g){return g})};$jscomp.array.keys$install=function(){Array.prototype.keys||(Array.prototype.keys=$jscomp.array.keys)};$jscomp.array.values=function(){return $jscomp.array.arrayIterator_(this,function(g,c){return c})};
$jscomp.array.values$install=function(){Array.prototype.values||(Array.prototype.values=$jscomp.array.values)};$jscomp.array.copyWithin=function(g,c,e){var l=this.length;g=Number(g);c=Number(c);e=Number(null!=e?e:l);if(g<c)for(e=Math.min(e,l);c<e;)c in this?this[g++]=this[c++]:(delete this[g++],c++);else for(e=Math.min(e,l+c-g),g+=e-c;e>c;)--e in this?this[--g]=this[e]:delete this[g];return this};$jscomp.array.copyWithin$install=function(){Array.prototype.copyWithin||(Array.prototype.copyWithin=$jscomp.array.copyWithin)};
$jscomp.array.fill=function(g,c,e){null!=e&&g.length||(e=this.length||0);e=Number(e);for(c=Number((void 0===c?0:c)||0);c<e;c++)this[c]=g;return this};$jscomp.array.fill$install=function(){Array.prototype.fill||(Array.prototype.fill=$jscomp.array.fill)};$jscomp.array.find=function(g,c){return $jscomp.array.findInternal_(this,g,c).v};$jscomp.array.find$install=function(){Array.prototype.find||(Array.prototype.find=$jscomp.array.find)};
$jscomp.array.findIndex=function(g,c){return $jscomp.array.findInternal_(this,g,c).i};$jscomp.array.findIndex$install=function(){Array.prototype.findIndex||(Array.prototype.findIndex=$jscomp.array.findIndex)};$jscomp.Map=function(g){g=void 0===g?[]:g;this.data_={};this.head_=$jscomp.Map.createHead_();this.size=0;if(g){g=$jscomp.makeIterator(g);for(var c=g.next();!c.done;c=g.next())c=c.value,this.set(c[0],c[1])}};
$jscomp.Map.checkBrowserConformance_=function(){var g=$jscomp.global.Map;if(!g||!g.prototype.entries||!Object.seal)return!1;try{var c=Object.seal({x:4}),e=new g($jscomp.makeIterator([[c,"s"]]));if("s"!=e.get(c)||1!=e.size||e.get({x:4})||e.set({x:4},"t")!=e||2!=e.size)return!1;var l=e.entries(),b=l.next();if(b.done||b.value[0]!=c||"s"!=b.value[1])return!1;b=l.next();return b.done||4!=b.value[0].x||"t"!=b.value[1]||!l.next().done?!1:!0}catch(a){return!1}};
$jscomp.Map.createHead_=function(){var g={};return g.previous=g.next=g.head=g};$jscomp.Map.getId_=function(g){if(!(g instanceof Object))return String(g);$jscomp.Map.key_ in g||g instanceof Object&&Object.isExtensible&&Object.isExtensible(g)&&$jscomp.Map.defineProperty_(g,$jscomp.Map.key_,++$jscomp.Map.index_);return $jscomp.Map.key_ in g?g[$jscomp.Map.key_]:" "+g};
$jscomp.Map.prototype.set=function(g,c){var e=this.maybeGetEntry_(g),l=e.id,b=e.list,e=e.entry;b||(b=this.data_[l]=[]);e?e.value=c:(e={next:this.head_,previous:this.head_.previous,head:this.head_,key:g,value:c},b.push(e),this.head_.previous.next=e,this.head_.previous=e,this.size++);return this};
$jscomp.Map.prototype["delete"]=function(g){var c=this.maybeGetEntry_(g);g=c.id;var e=c.list,l=c.index;return(c=c.entry)&&e?(e.splice(l,1),e.length||delete this.data_[g],c.previous.next=c.next,c.next.previous=c.previous,c.head=null,this.size--,!0):!1};$jscomp.Map.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=$jscomp.Map.createHead_();this.size=0};$jscomp.Map.prototype.has=function(g){return!!this.maybeGetEntry_(g).entry};
$jscomp.Map.prototype.get=function(g){return(g=this.maybeGetEntry_(g).entry)&&g.value};$jscomp.Map.prototype.maybeGetEntry_=function(g){var c=$jscomp.Map.getId_(g),e=this.data_[c];if(e)for(var l=0;l<e.length;l++){var b=e[l];if(g!==g&&b.key!==b.key||g===b.key)return{id:c,list:e,index:l,entry:b}}return{id:c,list:e,index:-1,entry:void 0}};$jscomp.Map.prototype.entries=function(){return this.iter_(function(g){return[g.key,g.value]})};$jscomp.Map.prototype.keys=function(){return this.iter_(function(g){return g.key})};
$jscomp.Map.prototype.values=function(){return this.iter_(function(g){return g.value})};$jscomp.Map.prototype.forEach=function(g,c){for(var e=$jscomp.makeIterator(this.entries()),l=e.next();!l.done;l=e.next())l=l.value,g.call(c,l[1],l[0],this)};
$jscomp.Map.prototype.iter_=function(g){var c=this,e=this.head_;$jscomp.initSymbol();$jscomp.initSymbolIterator();var l={};return l.next=function(){if(e){for(;e.head!=c.head_;)e=e.previous;for(;e.next!=e.head;)return e=e.next,{done:!1,value:g(e)};e=null}return{done:!0,value:void 0}},l[Symbol.iterator]=function(){return this},l};$jscomp.Map.index_=0;$jscomp.Map.defineProperty_=Object.defineProperty?function(g,c,e){Object.defineProperty(g,c,{value:String(e)})}:function(g,c,e){g[c]=String(e)};
$jscomp.Map.Entry_=function(){};$jscomp.Map.ASSUME_NO_NATIVE=!1;$jscomp.Map$install=function(){$jscomp.initSymbol();$jscomp.initSymbolIterator();!$jscomp.Map.ASSUME_NO_NATIVE&&$jscomp.Map.checkBrowserConformance_()?$jscomp.Map=$jscomp.global.Map:($jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Map.prototype[Symbol.iterator]=$jscomp.Map.prototype.entries,$jscomp.initSymbol(),$jscomp.Map.key_=Symbol("map-id-key"));$jscomp.Map$install=function(){}};$jscomp.math=$jscomp.math||{};
$jscomp.math.clz32=function(g){g=Number(g)>>>0;if(0===g)return 32;var c=0;0===(g&4294901760)&&(g<<=16,c+=16);0===(g&4278190080)&&(g<<=8,c+=8);0===(g&4026531840)&&(g<<=4,c+=4);0===(g&3221225472)&&(g<<=2,c+=2);0===(g&2147483648)&&c++;return c};$jscomp.math.imul=function(g,c){g=Number(g);c=Number(c);var e=g&65535,l=c&65535;return e*l+((g>>>16&65535)*l+e*(c>>>16&65535)<<16>>>0)|0};$jscomp.math.sign=function(g){g=Number(g);return 0===g||isNaN(g)?g:0<g?1:-1};
$jscomp.math.log10=function(g){return Math.log(g)/Math.LN10};$jscomp.math.log2=function(g){return Math.log(g)/Math.LN2};$jscomp.math.log1p=function(g){g=Number(g);if(.25>g&&-.25<g){for(var c=g,e=1,l=g,b=0,a=1;b!=l;)c*=g,a*=-1,l=(b=l)+a*c/++e;return l}return Math.log(1+g)};$jscomp.math.expm1=function(g){g=Number(g);if(.25>g&&-.25<g){for(var c=g,e=1,l=g,b=0;b!=l;)c*=g/++e,l=(b=l)+c;return l}return Math.exp(g)-1};$jscomp.math.cosh=function(g){g=Number(g);return(Math.exp(g)+Math.exp(-g))/2};
$jscomp.math.sinh=function(g){g=Number(g);return 0===g?g:(Math.exp(g)-Math.exp(-g))/2};$jscomp.math.tanh=function(g){g=Number(g);if(0===g)return g;var c=Math.exp(2*-Math.abs(g)),c=(1-c)/(1+c);return 0>g?-c:c};$jscomp.math.acosh=function(g){g=Number(g);return Math.log(g+Math.sqrt(g*g-1))};$jscomp.math.asinh=function(g){g=Number(g);if(0===g)return g;var c=Math.log(Math.abs(g)+Math.sqrt(g*g+1));return 0>g?-c:c};
$jscomp.math.atanh=function(g){g=Number(g);return($jscomp.math.log1p(g)-$jscomp.math.log1p(-g))/2};
$jscomp.math.hypot=function(g,c,e){for(var l=[],b=2;b<arguments.length;++b)l[b-2]=arguments[b];g=Number(g);c=Number(c);for(var a=Math.max(Math.abs(g),Math.abs(c)),d=$jscomp.makeIterator(l),b=d.next();!b.done;b=d.next())a=Math.max(a,Math.abs(b.value));if(1E100<a||1E-100>a){g/=a;c/=a;d=g*g+c*c;l=$jscomp.makeIterator(l);for(b=l.next();!b.done;b=l.next())b=b.value,b=Number(b)/a,d+=b*b;return Math.sqrt(d)*a}a=g*g+c*c;l=$jscomp.makeIterator(l);for(b=l.next();!b.done;b=l.next())b=b.value,a+=b*b;return Math.sqrt(a)};
$jscomp.math.trunc=function(g){g=Number(g);if(isNaN(g)||Infinity===g||-Infinity===g||0===g)return g;var c=Math.floor(Math.abs(g));return 0>g?-c:c};$jscomp.math.cbrt=function(g){if(0===g)return g;g=Number(g);var c=Math.pow(Math.abs(g),1/3);return 0>g?-c:c};$jscomp.number=$jscomp.number||{};$jscomp.number.isFinite=function(g){return"number"!==typeof g?!1:!isNaN(g)&&Infinity!==g&&-Infinity!==g};$jscomp.number.isInteger=function(g){return $jscomp.number.isFinite(g)?g===Math.floor(g):!1};
$jscomp.number.isNaN=function(g){return"number"===typeof g&&isNaN(g)};$jscomp.number.isSafeInteger=function(g){return $jscomp.number.isInteger(g)&&Math.abs(g)<=$jscomp.number.MAX_SAFE_INTEGER};$jscomp.number.EPSILON=Math.pow(2,-52);$jscomp.number.MAX_SAFE_INTEGER=9007199254740991;$jscomp.number.MIN_SAFE_INTEGER=-9007199254740991;$jscomp.object=$jscomp.object||{};
$jscomp.object.assign=function(g,c){for(var e=[],l=1;l<arguments.length;++l)e[l-1]=arguments[l];e=$jscomp.makeIterator(e);for(l=e.next();!l.done;l=e.next()){var l=l.value,b;for(b in l)Object.prototype.hasOwnProperty.call(l,b)&&(g[b]=l[b])}return g};$jscomp.object.is=function(g,c){return g===c?0!==g||1/g===1/c:g!==g&&c!==c};$jscomp.Set=function(g){g=void 0===g?[]:g;this.map_=new $jscomp.Map;if(g){g=$jscomp.makeIterator(g);for(var c=g.next();!c.done;c=g.next())this.add(c.value)}this.size=this.map_.size};
$jscomp.Set.checkBrowserConformance_=function(){var g=$jscomp.global.Set;if(!g||!g.prototype.entries||!Object.seal)return!1;var c=Object.seal({x:4}),g=new g($jscomp.makeIterator([c]));if(g.has(c)||1!=g.size||g.add(c)!=g||1!=g.size||g.add({x:4})!=g||2!=g.size)return!1;var g=g.entries(),e=g.next();if(e.done||e.value[0]!=c||e.value[1]!=c)return!1;e=g.next();return e.done||e.value[0]==c||4!=e.value[0].x||e.value[1]!=e.value[0]?!1:g.next().done};
$jscomp.Set.prototype.add=function(g){this.map_.set(g,g);this.size=this.map_.size;return this};$jscomp.Set.prototype["delete"]=function(g){g=this.map_["delete"](g);this.size=this.map_.size;return g};$jscomp.Set.prototype.clear=function(){this.map_.clear();this.size=0};$jscomp.Set.prototype.has=function(g){return this.map_.has(g)};$jscomp.Set.prototype.entries=function(){return this.map_.entries()};$jscomp.Set.prototype.values=function(){return this.map_.values()};
$jscomp.Set.prototype.forEach=function(g,c){var e=this;this.map_.forEach(function(l){return g.call(c,l,l,e)})};$jscomp.Set.ASSUME_NO_NATIVE=!1;$jscomp.Set$install=function(){!$jscomp.Set.ASSUME_NO_NATIVE&&$jscomp.Set.checkBrowserConformance_()?$jscomp.Set=$jscomp.global.Set:($jscomp.Map$install(),$jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Set.prototype[Symbol.iterator]=$jscomp.Set.prototype.values);$jscomp.Set$install=function(){}};$jscomp.string=$jscomp.string||{};
$jscomp.string.noRegExp_=function(g,c){if(g instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");};
$jscomp.string.fromCodePoint=function(g){for(var c=[],e=0;e<arguments.length;++e)c[e-0]=arguments[e];for(var e="",c=$jscomp.makeIterator(c),l=c.next();!l.done;l=c.next()){l=l.value;l=+l;if(0>l||1114111<l||l!==Math.floor(l))throw new RangeError("invalid_code_point "+l);65535>=l?e+=String.fromCharCode(l):(l-=65536,e+=String.fromCharCode(l>>>10&1023|55296),e+=String.fromCharCode(l&1023|56320))}return e};
$jscomp.string.repeat=function(g){var c=this.toString();if(0>g||1342177279<g)throw new RangeError("Invalid count value");g|=0;for(var e="";g;)if(g&1&&(e+=c),g>>>=1)c+=c;return e};$jscomp.string.repeat$install=function(){String.prototype.repeat||(String.prototype.repeat=$jscomp.string.repeat)};
$jscomp.string.codePointAt=function(g){var c=this.toString(),e=c.length;g=Number(g)||0;if(0<=g&&g<e){g|=0;var l=c.charCodeAt(g);if(55296>l||56319<l||g+1===e)return l;g=c.charCodeAt(g+1);return 56320>g||57343<g?l:1024*(l-55296)+g+9216}};$jscomp.string.codePointAt$install=function(){String.prototype.codePointAt||(String.prototype.codePointAt=$jscomp.string.codePointAt)};
$jscomp.string.includes=function(g,c){c=void 0===c?0:c;$jscomp.string.noRegExp_(g,"includes");return-1!==this.toString().indexOf(g,c)};$jscomp.string.includes$install=function(){String.prototype.includes||(String.prototype.includes=$jscomp.string.includes)};
$jscomp.string.startsWith=function(g,c){c=void 0===c?0:c;$jscomp.string.noRegExp_(g,"startsWith");var e=this.toString();g+="";for(var l=e.length,b=g.length,a=Math.max(0,Math.min(c|0,e.length)),d=0;d<b&&a<l;)if(e[a++]!=g[d++])return!1;return d>=b};$jscomp.string.startsWith$install=function(){String.prototype.startsWith||(String.prototype.startsWith=$jscomp.string.startsWith)};
$jscomp.string.endsWith=function(g,c){$jscomp.string.noRegExp_(g,"endsWith");var e=this.toString();g+="";void 0===c&&(c=e.length);for(var l=Math.max(0,Math.min(c|0,e.length)),b=g.length;0<b&&0<l;)if(e[--l]!=g[--b])return!1;return 0>=b};$jscomp.string.endsWith$install=function(){String.prototype.endsWith||(String.prototype.endsWith=$jscomp.string.endsWith)};
(function(g){function c(l){if(e[l])return e[l].exports;var b=e[l]={exports:{},id:l,loaded:!1};g[l].call(b.exports,b,b.exports,c);b.loaded=!0;return b.exports}var e={};c.m=g;c.c=e;c.p="";return c(0)})([function(g,c,e){e(1);e(76);e(78);e(80);e(81);e(83);g.exports=e(85)},function(g,c,e){function l(a,d){if(!(a instanceof d))throw new TypeError("Cannot call a class as a function");}function b(a,d){return t.get(a,d)}function a(a,d){var m=y.stableStringify({instance:a,key:d}),b=F.get(m);if(void 0!==b)return b;
b=Promise.all([k.makeRequest(a,"GET","/v1beta2/volumes/"+d,"json"),k.makeRequest(a,"GET","/v1beta2/objects/"+d+"/meshes","json")]).then(function(m){m=v(m,2);return new D(a,d,m[0],m[1])});F.set(m,b);return b}function d(a){var d=Q.get(a);if(void 0===d){var d=k.makeRequest(a,"GET","/v1beta2/volumes/","json").then(function(a){return new G(a)}),m="Google "+k.INSTANCE_NAMES[a]+" volume list";u.StatusMessage.forPromise(d,{delay:!0,initialMessage:"Retrieving "+m+".",errorPrefix:"Error retrieving "+m+": "});
Q.set(a,d)}return d}function m(a,m){return d(a).then(function(a){var d=m.lastIndexOf(":")+1,b=m.substring(0,d),d=m.substring(d);a=a.hierarchicalVolumeIds.get(b);return void 0===a?null:{offset:b.length,completions:A.getPrefixMatches(d,a)}})}function r(d){var b="brainmaps";d!==k.PRODUCTION_INSTANCE&&(b+="-"+k.INSTANCE_IDENTIFIERS[d].toLowerCase());f.registerDataSourceFactory(b,{description:"Google "+k.INSTANCE_NAMES[d]+" API",getVolume:a.bind(void 0,d),volumeCompleter:m.bind(void 0,d)})}var v=function(){return function(a,
d){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var m=[],b=!0,r=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var c=a[Symbol.iterator](),k;!(b=(k=c.next()).done)&&(m.push(k.value),!d||m.length!==d);b=!0);}catch(h){r=!0,f=h}finally{try{if(!b&&c["return"])c["return"]()}finally{if(r)throw f;}}return m}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),n=function(){function a(d,m){for(var b=
0;b<m.length;b++){var r=m[b];r.enumerable=r.enumerable||!1;r.configurable=!0;"value"in r&&(r.writable=!0);Object.defineProperty(d,r.key,r)}}return function(d,m,b){m&&a(d.prototype,m);b&&a(d,b);return d}}();e(2);var k=e(24),q=e(27),f=e(28);g=e(30);var p=e(60),h=e(59),u=e(4),A=e(29),B=e(9),y=e(8),x=h.defineParameterizedVolumeChunkSource(q.VolumeSourceParameters),t=g.defineParameterizedMeshSource(q.MeshSourceParameters),z=new Map;z.set("UINT8",p.DataType.UINT8);z.set("FLOAT",p.DataType.FLOAT32);z.set("UINT64",
p.DataType.UINT64);var w=function O(a){l(this,O);try{y.verifyObject(a),this.numChannels=y.verifyPositiveInt(a.channelCount),this.dataType=y.verifyMapKey(a.channelType,z),this.voxelSize=y.parseXYZ(B.vec3.create(),a.pixelSize,y.verifyFinitePositiveFloat),this.upperVoxelBound=y.parseXYZ(B.vec3.create(),a.volumeSize,y.verifyPositiveInt)}catch(d){throw Error("Failed to parse BrainMaps volume geometry: "+d.message);}};c.VolumeInfo=w;var C=function V(a){l(this,V);y.verifyObject(a);this.name=y.verifyObjectProperty(a,
"name",y.verifyString);this.type=y.verifyObjectProperty(a,"type",y.verifyString)};c.MeshInfo=C;var D=function(){function a(d,m,b,r){l(this,a);this.instance=d;this.volume_id=m;try{y.verifyObject(b);var f=this.scales=y.verifyObjectProperty(b,"geometry",function(a){return y.parseArray(a,function(a){return new w(a)})});if(0===f.length)throw Error("Expected at least one scale.");var c=f[0],k=this.numChannels=c.numChannels,h=this.dataType=c.dataType;d=1;for(var q=f.length;d<q;++d){var v=f[d];if(v.dataType!==
h)throw Error("Scale "+d+" has data type "+p.DataType[v.dataType]+" but scale 0 has data type "+p.DataType[h]+".");if(v.numChannels!==k)throw Error("Scale "+d+" has "+v.numChannels+" channel(s) but scale 0 has "+k+" channels.");}var n=p.VolumeType.IMAGE;if(1===k)switch(h){case p.DataType.UINT64:n=p.VolumeType.SEGMENTATION}this.volumeType=n}catch(e){throw Error("Failed to parse BrainMaps multiscale volume specification: "+e.message);}try{y.verifyObject(r),this.meshes=y.verifyObjectProperty(r,"meshes",
function(a){return void 0===a?[]:y.parseArray(a,function(a){return new C(a)})})}catch(e){throw Error("Failed to parse BrainMaps meshes specification: "+e.message);}}n(a,[{key:"getSources",value:function(a){var d=this,m=q.VolumeChunkEncoding.RAW;this.volumeType===p.VolumeType.SEGMENTATION?m=q.VolumeChunkEncoding.COMPRESSED_SEGMENTATION:this.volumeType===p.VolumeType.IMAGE&&this.dataType===p.DataType.UINT8&&1===this.numChannels&&(m=q.VolumeChunkEncoding.JPEG);return this.scales.map(function(b,r){return p.VolumeChunkSpecification.getDefaults({voxelSize:b.voxelSize,
dataType:b.dataType,numChannels:b.numChannels,upperVoxelBound:b.upperVoxelBound,volumeType:d.volumeType}).map(function(b){return x.get(a,b,{instance:d.instance,volume_id:d.volume_id,scaleIndex:r,encoding:m})})})}},{key:"getMeshSource",value:function(a){var d=this.meshes.find(function(a){return"TRIANGLES"===a.type});return void 0===d?null:b(a,{instance:this.instance,volume_id:this.volume_id,mesh_name:d.name})}}]);return a}();c.MultiscaleVolumeChunkSource=D;c.getMeshSource=b;var F=new Map;c.getVolume=
a;var G=function P(a){l(this,P);this.hierarchicalVolumeIds=new Map;try{y.verifyObject(a);var d=this.volumeIds=y.parseArray(a.volumeId,y.verifyString);d.sort();for(var m=new Map,b=$jscomp.makeIterator(d),r=b.next();!r.done;r=b.next()){var f=r.value;for(a=0;;){var c=f.indexOf(":",a);-1===c?c=void 0:++c;var k=f.substring(0,a),h=m.get(k);void 0===h&&(h=new Set,m.set(k,h));h.add(f.substring(a,c));if(void 0===c)break;a=c}}for(var p=this.hierarchicalVolumeIds,q=$jscomp.makeIterator(m),n=q.next();!n.done;n=
q.next()){var e=v(n.value,2);p.set(e[0],Array.from(e[1]))}}catch(C){throw Error("Failed to parse Brain Maps volume list reply: "+C.message);}};c.VolumeList=G;var Q=new Map;c.getVolumeList=d;c.volumeCompleter=m;c.registerBrainmapsDataSource=r;r(k.PRODUCTION_INSTANCE)},function(g,c,e){var l=e(3),b=e(4),a=e(6),d=e(20);g=e(22);var m=0;l.implementation.getNewTokenPromise=function(){var r=new b.StatusMessage(!0),c=void 0,n=new Promise(function(b){function q(){var a=1>=arguments.length||void 0===arguments[1]?
"Request authorization.":arguments[1];r.setText((0>=arguments.length||void 0===arguments[0]?"Brain Maps authorization required.":arguments[0])+"  ");var d=document.createElement("button");d.textContent=a;r.element.appendChild(d);d.addEventListener("click",function(){f(!1)});r.setVisible(!0)}function f(r){void 0!==c&&d.cancelPromise(c);q("Waiting for Brain Maps authorization...","Retry");c=a.authenticateGoogleOAuth2({clientId:"639403125587-4k5hgdfumtrvur8v48e3pr7oo91d765k.apps.googleusercontent.com",
scopes:["https://www.googleapis.com/auth/brainmaps"],immediate:r,authUser:0});c.then(function(a){a.generationId=m++;b(a)},function(a){r?q():q("Brain Maps authorization failed: "+a+".","Retry")});d.callFinally(c,function(){c=void 0})}f(!0)});d.callFinally(n,function(){r.dispose()});return n};g.registerRPC("brainmaps.requestToken",function(a){var d=this;l.getToken(a.invalidToken).then(function(a){d.invoke("brainmaps.receiveToken",{authResult:a})})})},function(g,c){var e=function d(){if(!(this instanceof
d))throw new TypeError("Cannot call a class as a function");};c.Implementation=e;c.implementation=new e;var l=null,b=null;c.getToken=function(d){if(null!==l&&(null===b||null==d||d.generationId!==b.generationId))return l;b=null;l=c.implementation.getNewTokenPromise(d);l.then(function(d){b=d});return l}},function(g,c,e){var l=function(){function a(a,m){for(var b=0;b<m.length;b++){var c=m[b];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}
return function(d,m,b){m&&a(d.prototype,m);b&&a(d,b);return d}}();e(5);var b=null;c.DEFAULT_STATUS_DELAY=200;g=function(){function a(){var d=0>=arguments.length||void 0===arguments[0]?!1:arguments[0];if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");null===b&&(b=document.createElement("ul"),b.id="statusContainer",document.body.appendChild(b));var m=document.createElement("li");this.element=m;!0===d&&(d=c.DEFAULT_STATUS_DELAY);!1!==d?(this.setVisible(!1),this.timer=setTimeout(this.setVisible.bind(this,
!0),d)):this.timer=null;b.appendChild(m)}l(a,[{key:"dispose",value:function(){b.removeChild(this.element);this.element=void 0;null!==this.timer&&clearTimeout(this.timer)}},{key:"setText",value:function(a,m){this.element.textContent=a;m&&this.setVisible(!0)}},{key:"setHTML",value:function(a,m){this.element.innerHTML=a;m&&this.setVisible(!0)}},{key:"setVisible",value:function(a){this.timer=null;this.element.style.display=a?"block":"none"}}],[{key:"forPromise",value:function(d,m){var b=new a(m.delay);
b.setText(m.initialMessage);var c=b.dispose.bind(b);d.then(c,function(a){var d=void 0,d=a instanceof Error?a.message:""+a;a=m.errorPrefix;b.element.textContent=(void 0===a?"":a)+d+"  ";d=document.createElement("button");d.textContent="Dismiss";d.addEventListener("click",function(){b.dispose()});b.element.appendChild(d);b.setVisible(!0)});return d}}]);return a}();c.StatusMessage=g},function(g,c){},function(g,c,e){function l(a,d){var m=document.createElement("iframe");m.style.display="none";m.id=a;
m.name=a;m.src="https://accounts.google.com/o/oauth2/postmessageRelay?parent="+encodeURIComponent(location.origin)+"#rpctoken="+d;document.body.appendChild(m)}var b=function(){function a(d,m){for(var b=0;b<m.length;b++){var r=m[b];r.enumerable=r.enumerable||!1;r.configurable=!0;"value"in r&&(r.writable=!0);Object.defineProperty(d,r.key,r)}}return function(d,m,b){m&&a(d.prototype,m);b&&a(d,b);return d}}(),a=e(7),d=e(8),m=e(20),r=e(21);c.AUTH_SERVER="https://accounts.google.com/o/oauth2/auth";c.embedRelayFrame=
l;var v=function(){function a(){var m=this;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.proxyName="postmessageRelay"+r.getRandomHexString();this.rpcToken=""+r.getRandomHexString();this.relayReadyService="oauth2relayReady:"+this.rpcToken;this.oauth2CallbackService="oauth2callback:"+this.rpcToken;this.pendingRequests=new Map;l(this.proxyName,this.rpcToken);this.relayReadyPromise=new Promise(function(a){addEventListener("message",function(b){if("https://accounts.google.com"===
b.origin)try{var r=d.verifyObject(JSON.parse(b.data)),c=d.verifyString(r.s);c===m.relayReadyService&&a();if(c===m.oauth2CallbackService){var k=d.parseArray(r.a,function(a){return a}),v=d.verifyString(k[0]),n=location.origin;if(!v.startsWith(n+"#")&&!v.startsWith(n+"?"))throw Error("oauth2callback: URL "+JSON.stringify(v)+" does not match current origin "+n+".");for(var e=v.substring(n.length+1).split("&"),t=new Map,z=$jscomp.makeIterator(e),w=z.next();!w.done;w=z.next()){var C=w.value.match("^([a-z_]+)=(.*)$");
if(null===C)throw Error("oauth2callback: URL part "+JSON.stringify(C)+" does not match expected pattern.");t.set(C[1],C[2])}var D=t.get("state");if(void 0===D)throw Error("oauth2callback: State argument is missing.");var F=m.pendingRequests.get(D);if(void 0!==F){var G=t.get("error");if(void 0!==G){m.pendingRequests.delete(D);var l=t.get("error_subtype"),r=G;void 0!==l&&(r+=": "+l);F.reject(r)}else{var g=t.get("access_token"),O=t.get("token_type"),V=t.get("expires_in"),P=t.get("scope");if(void 0===
g||void 0===O||void 0===V||void 0===P)throw Error("oauth2callback: URL lacks expected parameters.");m.pendingRequests.delete(D);F.resolve({accessToken:g,tokenType:O,expiresIn:V,scope:P})}}}}catch(T){throw Error("Invalid message received from https://accounts.google.com: "+JSON.stringify(b.data)+": "+T.message+".");}})})}b(a,[{key:"getAuthPromise",value:function(a){var d=this,b=m.makeCancellablePromise(function(m,b){d.pendingRequests.set(a,{resolve:m,reject:b})});m.callFinally(b,function(){d.pendingRequests.delete(a)});
return b}},{key:"makeAuthRequestUrl",value:function(a){var d=c.AUTH_SERVER+"?client_id="+encodeURIComponent(a.clientId),d=d+"&redirect_uri=postmessage&response_type=token",m=a.origin,d=d+("&origin="+encodeURIComponent(void 0===m?location.origin:m)),d=d+("&proxy="+this.proxyName),d=d+"&include_granted_scopes=true",d=d+("&scope="+encodeURIComponent(a.scopes.join(" ")));a.state&&(d+="&state="+a.state);a.approvalPrompt&&(d+="&approval_prompt="+encodeURIComponent(a.approvalPrompt));a.loginHint&&(d+="&login_hint="+
encodeURIComponent(a.loginHint));a.immediate&&(d+="&immediate=true");void 0!==a.authUser&&(d+="&authuser="+a.authUser);return d}}]);return a}(),n=void 0;c.authenticateGoogleOAuth2=function(d){var b=r.getRandomHexString(),f;void 0===n&&(n=new v);f=n;var c=f.makeAuthRequestUrl({state:b,clientId:d.clientId,scopes:d.scopes,approvalPrompt:d.approvalPrompt,loginHint:d.loginHint,immediate:d.immediate,authUser:d.authUser}),h=f.getAuthPromise(b);d.immediate?f.relayReadyPromise.then(function(){var d=document.createElement("iframe");
d.src=c;d.style.display="none";document.body.appendChild(d);m.callFinally(h,function(){a.removeFromParent(d)})}):function(){var a=open(c);m.callFinally(h,function(){a.close()})}();return h}},function(g,c){c.removeChildren=function(c){for(;;){var l=c.firstElementChild;if(!l)break;c.removeChild(l)}};c.removeFromParent=function(c){var l=c.parentElement;return l?(l.removeChild(c),!0):!1}},function(g,c,e){function l(a){var d=typeof a;if("number"===d||"string"===d)if(d=parseFloat(""+a),!Number.isNaN(d))return d;
throw Error("Expected floating-point number, but received: "+JSON.stringify(a)+".");}function b(a){a=l(a);if(Number.isFinite(a))return a;throw Error("Expected finite floating-point number, but received: "+a+".");}function a(a){a=b(a);if(0<a)return a;throw Error("Expected positive finite floating-point number, but received: "+a+".");}function d(a){if("object"===typeof a){if(null===a)return"null";if(Array.isArray(a)){var m="[",b=a.length,r=0;if(r<b)for(m+=d(a[r]);++r<b;)m+=",",m+=d(a[r]);return m+"]"}var m=
"{",b=Object.keys(a).sort(),r=0,f=b.length;if(r<f)for(var c=b[r],m=m+JSON.stringify(c),m=m+":"+d(a[c]);++r<f;)m+=",",c=b[r],m+=JSON.stringify(c),m+=":",m+=d(a[c]);return m+="}"}return JSON.stringify(a)}function m(a){return a.replace(/['"]/g,function(a){return'"'===a?"'":'"'})}function r(a){return m(JSON.stringify(m(a)))}function v(a){if("object"===typeof a){if(null===a)return"null";var d=a.toJSON;if("function"===typeof d)return v(d.call(a));if(Array.isArray(a)){var d="[",m=a.length,b=0;if(b<m)for(d+=
v(a[b]);++b<m;)d+="_",d+=v(a[b]);return d+"]"}for(var d="{",b=Object.keys(a),m=!0,b=$jscomp.makeIterator(b),c=b.next();!c.done;c=b.next()){var c=c.value,f=a[c];void 0!==f&&(f=v(f))&&(m?m=!1:d+="_",d+=r(c),d+=":",d+=f)}return d+"}"}return"string"===typeof a?r(a):JSON.stringify(a)}function n(a,d,m,b){if(2<=a.length&&a.charAt(0)===d&&a.charAt(a.length-1)===d){a=a.substr(1,a.length-2);for(d=m;0<a.length;){var r=a.match(b);if(null===r){d+=a;break}d+=r[1];d+="\\";d+=m;a=a.substr(r.index+r[0].length)}return d+
m}return a}function k(a){return n(a,"'",'"',C)}function q(a,d,m){var b=/[&_,]/g,r=void 0,c=void 0,f=void 0;'"'===m?(r="'",c=C,f=z):(r='"',c=D,f=w);for(var k="";0<a.length;){var h=a.match(f),v=void 0,p=void 0;null===h?(v=a,p=a=""):(v=a.substr(0,h.index),a=a.substr(h.index+h[0].length),p=h[1],p=void 0!==p?n(p,r,m,c):h[2]);k+=v.replace(b,d);k+=p}return k}function f(a){return q(a,",",'"')}function p(a){return JSON.parse(f(a))}function h(a){for(var d="";0<a.length;){var m=a.match(z),b=void 0,r=void 0;
null===m?(b=a,r=a=""):(b=a.substr(0,m.index),a=a.substr(m.index+m[0].length),r=m[1],r=void 0!==r?k(r):m[2]);d+=b.replace(/\(/g,"[").replace(/\)/g,"]").replace("True","true").replace("False","false").replace(/,\s*([\}\]])/g,"$1");d+=r}return d}function u(a,d,m){var b=a.length;if(!Array.isArray(d)||d.length!==b)throw Error("Expected length "+b+" array, but received: "+JSON.stringify(d)+".");for(var r=0;r<b;++r)a[r]=m(d[r],r);return a}function A(a){if("object"!==typeof a||null==a||Array.isArray(a))throw Error("Expected JSON object, but received: "+
JSON.stringify(a)+".");return a}function B(a){var d=parseInt(a,10);if(!Number.isInteger(d))throw Error("Expected integer, but received: "+JSON.stringify(a)+".");return d}function y(a){a=B(a);if(0>=a)throw Error("Expected positive integer, but received: "+a+".");return a}function x(a){if("string"!==typeof a)throw Error("Expected string, but received: "+JSON.stringify(a)+".");return a}var t=e(9);c.verifyFloat=l;c.verifyFiniteFloat=b;c.verifyFinitePositiveFloat=a;c.parseXYZ=function(a,d){var m=2>=arguments.length||
void 0===arguments[2]?l:arguments[2];A(d);var b=Object.keys(d);b.sort();if(3!==b.length||"x"!==b[0]||"y"!==b[1]||"z"!==b[2])throw Error("Expected object to have keys ['x', 'y', 'z'], but received: "+JSON.stringify(d)+".");a[0]=m(d.x);a[1]=m(d.y);a[2]=m(d.z);return a};c.parseFiniteVec=function(a,d){var m=a.length;if(!Array.isArray(d)||d.length!==m)throw Error("Incompatible sizes");for(var b=0;b<m;++b)if(!Number.isFinite(parseFloat(d[b])))throw Error("Non-finite value.");for(b=0;b<m;++b)a[b]=parseFloat(d[b]);
return a};c.parseIntVec=function(a,d){var m=a.length;if(!Array.isArray(d)||d.length!==m)throw Error("Incompatible sizes.");for(var b=0;b<m;++b){var r=parseInt(d[b],void 0);if(!Number.isInteger(r))throw Error("Non-integer value.");}for(b=0;b<m;++b)a[b]=parseInt(d[b],void 0);return a};c.stableStringify=d;c.urlSafeStringifyString=r;c.urlSafeStringify=v;g=/('(?:[^'\\]|(?:\\.))*')/;e=/("(?:[^'\\]|(?:\\.))*")/;var z=new RegExp(g.source+"|"+e.source),w=new RegExp(e.source+"|"+g.source),C=/^((?:[^"'\\]|(?:\\.))*)"/,
D=/^((?:[^"'\\]|(?:\\.))*)'/;c.normalizeStringLiteral=k;c.urlSafeToJSON=f;c.jsonToUrlSafe=function(a){return q(a,"_","'")};c.urlSafeParse=p;c.pythonLiteralToJSON=h;c.pythonLiteralParse=function(a){return JSON.parse(h(a))};c.parseArray=function(a,d){if(!Array.isArray(a))throw Error("Expected array, but received: "+JSON.stringify(a)+".");return a.map(d)};c.parseFixedLengthArray=u;c.verifyObject=A;c.verifyInt=B;c.verifyPositiveInt=y;c.verifyMapKey=function(a,d){var m=d.get(a);if(void 0===m)throw Error("Expected one of "+
JSON.stringify(Array.from(d.keys()))+", but received: "+JSON.stringify(a)+".");return m};c.verifyString=x;c.verifyOptionalString=function(a){return void 0===a?void 0:x(a)};c.verifyObjectProperty=function(a,d,m){a=a.hasOwnProperty(d)?a[d]:void 0;try{return m(a)}catch(b){throw Error("Error parsing "+JSON.stringify(d)+" property: "+b.message);}};c.verifyObjectAsMap=function(a,d){A(a);for(var m=new Map,b=$jscomp.makeIterator(Object.keys(a)),r=b.next();!r.done;r=b.next()){r=r.value;try{m.set(r,d(a[r]))}catch(c){throw Error("Error parsing value associated with key "+
JSON.stringify(r)+": "+c.message);}}return m};c.verifyFloat01=function(a){if("number"!==typeof a||!Number.isFinite(a)||0>a||1<a)throw Error("Expected floating point number in [0,1], but received: "+JSON.stringify(a)+".");return a};c.parseQueryStringParameters=function(a){if(""===a)return{};if(a.startsWith("{"))return p(a);var d={};a=a.split(/[&;]/);a=$jscomp.makeIterator(a);for(var m=a.next();!m.done;m=a.next()){var m=m.value,b=m.match(/^([^=&;]+)=([^&;]*)$/);if(null===b)throw Error("Invalid query string part: "+
JSON.stringify(m)+".");d[b[1]]=b[2]}return d};c.verifyEnumString=function(a,d){if("string"===typeof a&&null!==a.match(/^[a-zA-Z]/)&&(a=a.toUpperCase(),d.hasOwnProperty(a)))return d[a];throw Error("Invalid enum value: "+JSON.stringify(a)+".");};c.verify3dVec=function(a){return u(t.vec3.create(),a,b)};c.verify3dScale=function(d){return u(t.vec3.create(),d,a)};c.verify3dDimensions=function(a){return u(t.vec3.create(),a,y)}},function(g,c,e){function l(b,a){var d=Math.abs(b[a]),m=Math.abs(b[a+1]),r=Math.abs(b[a+
2]),c=Math.max(d,m,r);1E-4>d/c&&(b[a]=0);1E-4>m/c&&(b[a+1]=0);1E-4>r/c&&(b[a+2]=0)}g=e(10);e=e(10);c.mat2=e.mat2;c.mat3=e.mat3;c.mat4=e.mat4;c.quat=e.quat;c.vec2=e.vec2;c.vec3=e.vec3;c.vec4=e.vec4;c.identityMat4=g.mat4.create();c.AXES_NAMES=["x","y","z"];c.BoundingBox=function a(d,m){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.lower=d;this.upper=m};c.kAxes=[g.vec4.fromValues(1,0,0,0),g.vec4.fromValues(0,1,0,0),g.vec4.fromValues(0,0,1,0)];c.kZeroVec=g.vec3.fromValues(0,
0,0);c.kInfinityVec=g.vec3.fromValues(Infinity,Infinity,Infinity);c.prod3=function(a){return a[0]*a[1]*a[2]};c.prod4=function(a){return a[0]*a[1]*a[2]*a[3]};c.vec3Key=function(a){return a[0]+","+a[1]+","+a[2]};c.rectifyVec3IfAxisAligned=l;c.rectifyTransformMatrixIfAxisAligned=function(a){l(a,0);l(a,4);l(a,8)}},function(g,c,e){c.glMatrix=e(11);c.mat2=e(12);c.mat2d=e(13);c.mat3=e(14);c.mat4=e(15);c.quat=e(16);c.vec2=e(19);c.vec3=e(17);c.vec4=e(18)},function(g,c){var e={EPSILON:1E-6};e.ARRAY_TYPE="undefined"!==
typeof Float32Array?Float32Array:Array;e.RANDOM=Math.random;e.ENABLE_SIMD=!1;e.SIMD_AVAILABLE=e.ARRAY_TYPE===Float32Array&&"SIMD"in this;e.USE_SIMD=e.ENABLE_SIMD&&e.SIMD_AVAILABLE;e.setMatrixArrayType=function(b){e.ARRAY_TYPE=b};var l=Math.PI/180;e.toRadian=function(b){return b*l};e.equals=function(b,a){return Math.abs(b-a)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(a))};g.exports=e},function(g,c,e){var l=e(11);c={create:function(){var b=new l.ARRAY_TYPE(4);b[0]=1;b[1]=0;b[2]=0;b[3]=1;return b},clone:function(b){var a=
new l.ARRAY_TYPE(4);a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},copy:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=1;return b},fromValues:function(b,a,d,m){var r=new l.ARRAY_TYPE(4);r[0]=b;r[1]=a;r[2]=d;r[3]=m;return r},set:function(b,a,d,m,r){b[0]=a;b[1]=d;b[2]=m;b[3]=r;return b},transpose:function(b,a){if(b===a){var d=a[1];b[1]=a[2];b[2]=d}else b[0]=a[0],b[1]=a[2],b[2]=a[1],b[3]=a[3];return b},invert:function(b,a){var d=a[0],
m=a[1],r=a[2],c=a[3],n=d*c-r*m;if(!n)return null;n=1/n;b[0]=c*n;b[1]=-m*n;b[2]=-r*n;b[3]=d*n;return b},adjoint:function(b,a){var d=a[0];b[0]=a[3];b[1]=-a[1];b[2]=-a[2];b[3]=d;return b},determinant:function(b){return b[0]*b[3]-b[2]*b[1]},multiply:function(b,a,d){var m=a[0],r=a[1],c=a[2];a=a[3];var n=d[0],k=d[1],q=d[2];d=d[3];b[0]=m*n+c*k;b[1]=r*n+a*k;b[2]=m*q+c*d;b[3]=r*q+a*d;return b}};c.mul=c.multiply;c.rotate=function(b,a,d){var m=a[0],r=a[1],c=a[2];a=a[3];var n=Math.sin(d);d=Math.cos(d);b[0]=m*
d+c*n;b[1]=r*d+a*n;b[2]=m*-n+c*d;b[3]=r*-n+a*d;return b};c.scale=function(b,a,d){var m=a[1],r=a[2],c=a[3],n=d[0];d=d[1];b[0]=a[0]*n;b[1]=m*n;b[2]=r*d;b[3]=c*d;return b};c.fromRotation=function(b,a){var d=Math.sin(a),m=Math.cos(a);b[0]=m;b[1]=d;b[2]=-d;b[3]=m;return b};c.fromScaling=function(b,a){b[0]=a[0];b[1]=0;b[2]=0;b[3]=a[1];return b};c.str=function(b){return"mat2("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+")"};c.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],
2))};c.LDU=function(b,a,d,m){b[2]=m[2]/m[0];d[0]=m[0];d[1]=m[1];d[3]=m[3]-b[2]*d[1];return[b,a,d]};c.add=function(b,a,d){b[0]=a[0]+d[0];b[1]=a[1]+d[1];b[2]=a[2]+d[2];b[3]=a[3]+d[3];return b};c.subtract=function(b,a,d){b[0]=a[0]-d[0];b[1]=a[1]-d[1];b[2]=a[2]-d[2];b[3]=a[3]-d[3];return b};c.sub=c.subtract;c.exactEquals=function(b,a){return b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]&&b[3]===a[3]};c.equals=function(b,a){var d=b[0],m=b[1],r=b[2],c=b[3],n=a[0],k=a[1],q=a[2],f=a[3];return Math.abs(d-n)<=l.EPSILON*
Math.max(1,Math.abs(d),Math.abs(n))&&Math.abs(m-k)<=l.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(r-q)<=l.EPSILON*Math.max(1,Math.abs(r),Math.abs(q))&&Math.abs(c-f)<=l.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))};c.multiplyScalar=function(b,a,d){b[0]=a[0]*d;b[1]=a[1]*d;b[2]=a[2]*d;b[3]=a[3]*d;return b};c.multiplyScalarAndAdd=function(b,a,d,m){b[0]=a[0]+d[0]*m;b[1]=a[1]+d[1]*m;b[2]=a[2]+d[2]*m;b[3]=a[3]+d[3]*m;return b};g.exports=c},function(g,c,e){var l=e(11);c={create:function(){var b=
new l.ARRAY_TYPE(6);b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=0;b[5]=0;return b},clone:function(b){var a=new l.ARRAY_TYPE(6);a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a},copy:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b},identity:function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=0;b[5]=0;return b},fromValues:function(b,a,d,m,r,c){var n=new l.ARRAY_TYPE(6);n[0]=b;n[1]=a;n[2]=d;n[3]=m;n[4]=r;n[5]=c;return n},set:function(b,a,d,m,r,c,n){b[0]=a;b[1]=d;
b[2]=m;b[3]=r;b[4]=c;b[5]=n;return b},invert:function(b,a){var d=a[0],m=a[1],r=a[2],c=a[3],n=a[4],k=a[5],q=d*c-m*r;if(!q)return null;q=1/q;b[0]=c*q;b[1]=-m*q;b[2]=-r*q;b[3]=d*q;b[4]=(r*k-c*n)*q;b[5]=(m*n-d*k)*q;return b},determinant:function(b){return b[0]*b[3]-b[1]*b[2]},multiply:function(b,a,d){var m=a[0],r=a[1],c=a[2],n=a[3],k=a[4];a=a[5];var q=d[0],f=d[1],p=d[2],h=d[3],e=d[4];d=d[5];b[0]=m*q+c*f;b[1]=r*q+n*f;b[2]=m*p+c*h;b[3]=r*p+n*h;b[4]=m*e+c*d+k;b[5]=r*e+n*d+a;return b}};c.mul=c.multiply;c.rotate=
function(b,a,d){var m=a[0],r=a[1],c=a[2],n=a[3],k=a[4];a=a[5];var q=Math.sin(d);d=Math.cos(d);b[0]=m*d+c*q;b[1]=r*d+n*q;b[2]=m*-q+c*d;b[3]=r*-q+n*d;b[4]=k;b[5]=a;return b};c.scale=function(b,a,d){var m=a[1],r=a[2],c=a[3],n=a[4],k=a[5],q=d[0];d=d[1];b[0]=a[0]*q;b[1]=m*q;b[2]=r*d;b[3]=c*d;b[4]=n;b[5]=k;return b};c.translate=function(b,a,d){var m=a[0],r=a[1],c=a[2],n=a[3],k=a[4];a=a[5];var q=d[0];d=d[1];b[0]=m;b[1]=r;b[2]=c;b[3]=n;b[4]=m*q+c*d+k;b[5]=r*q+n*d+a;return b};c.fromRotation=function(b,a){var d=
Math.sin(a),m=Math.cos(a);b[0]=m;b[1]=d;b[2]=-d;b[3]=m;b[4]=0;b[5]=0;return b};c.fromScaling=function(b,a){b[0]=a[0];b[1]=0;b[2]=0;b[3]=a[1];b[4]=0;b[5]=0;return b};c.fromTranslation=function(b,a){b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=a[0];b[5]=a[1];return b};c.str=function(b){return"mat2d("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+")"};c.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2)+Math.pow(b[4],2)+Math.pow(b[5],2)+1)};c.add=function(b,
a,d){b[0]=a[0]+d[0];b[1]=a[1]+d[1];b[2]=a[2]+d[2];b[3]=a[3]+d[3];b[4]=a[4]+d[4];b[5]=a[5]+d[5];return b};c.subtract=function(b,a,d){b[0]=a[0]-d[0];b[1]=a[1]-d[1];b[2]=a[2]-d[2];b[3]=a[3]-d[3];b[4]=a[4]-d[4];b[5]=a[5]-d[5];return b};c.sub=c.subtract;c.multiplyScalar=function(b,a,d){b[0]=a[0]*d;b[1]=a[1]*d;b[2]=a[2]*d;b[3]=a[3]*d;b[4]=a[4]*d;b[5]=a[5]*d;return b};c.multiplyScalarAndAdd=function(b,a,d,m){b[0]=a[0]+d[0]*m;b[1]=a[1]+d[1]*m;b[2]=a[2]+d[2]*m;b[3]=a[3]+d[3]*m;b[4]=a[4]+d[4]*m;b[5]=a[5]+d[5]*
m;return b};c.exactEquals=function(b,a){return b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]&&b[3]===a[3]&&b[4]===a[4]&&b[5]===a[5]};c.equals=function(b,a){var d=b[0],m=b[1],r=b[2],c=b[3],n=b[4],k=b[5],q=a[0],f=a[1],p=a[2],h=a[3],e=a[4],A=a[5];return Math.abs(d-q)<=l.EPSILON*Math.max(1,Math.abs(d),Math.abs(q))&&Math.abs(m-f)<=l.EPSILON*Math.max(1,Math.abs(m),Math.abs(f))&&Math.abs(r-p)<=l.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(c-h)<=l.EPSILON*Math.max(1,Math.abs(c),Math.abs(h))&&Math.abs(n-
e)<=l.EPSILON*Math.max(1,Math.abs(n),Math.abs(e))&&Math.abs(k-A)<=l.EPSILON*Math.max(1,Math.abs(k),Math.abs(A))};g.exports=c},function(g,c,e){var l=e(11);c={create:function(){var b=new l.ARRAY_TYPE(9);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b},fromMat4:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b},clone:function(b){var a=new l.ARRAY_TYPE(9);a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];
a[6]=b[6];a[7]=b[7];a[8]=b[8];return a},copy:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},fromValues:function(b,a,d,m,r,c,n,k,q){var f=new l.ARRAY_TYPE(9);f[0]=b;f[1]=a;f[2]=d;f[3]=m;f[4]=r;f[5]=c;f[6]=n;f[7]=k;f[8]=q;return f},set:function(b,a,d,m,r,c,n,k,q,f){b[0]=a;b[1]=d;b[2]=m;b[3]=r;b[4]=c;b[5]=n;b[6]=k;b[7]=q;b[8]=f;return b},identity:function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b},transpose:function(b,
a){if(b===a){var d=a[1],m=a[2],r=a[5];b[1]=a[3];b[2]=a[6];b[3]=d;b[5]=a[7];b[6]=m;b[7]=r}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b},invert:function(b,a){var d=a[0],m=a[1],r=a[2],c=a[3],n=a[4],k=a[5],q=a[6],f=a[7],p=a[8],h=p*n-k*f,e=-p*c+k*q,A=f*c-n*q,l=d*h+m*e+r*A;if(!l)return null;l=1/l;b[0]=h*l;b[1]=(-p*m+r*f)*l;b[2]=(k*m-r*n)*l;b[3]=e*l;b[4]=(p*d-r*q)*l;b[5]=(-k*d+r*c)*l;b[6]=A*l;b[7]=(-f*d+m*q)*l;b[8]=(n*d-m*c)*l;return b},adjoint:function(b,
a){var d=a[0],m=a[1],r=a[2],c=a[3],n=a[4],k=a[5],q=a[6],f=a[7],p=a[8];b[0]=n*p-k*f;b[1]=r*f-m*p;b[2]=m*k-r*n;b[3]=k*q-c*p;b[4]=d*p-r*q;b[5]=r*c-d*k;b[6]=c*f-n*q;b[7]=m*q-d*f;b[8]=d*n-m*c;return b},determinant:function(b){var a=b[3],d=b[4],m=b[5],r=b[6],c=b[7],n=b[8];return b[0]*(n*d-m*c)+b[1]*(-n*a+m*r)+b[2]*(c*a-d*r)},multiply:function(b,a,d){var m=a[0],r=a[1],c=a[2],n=a[3],k=a[4],q=a[5],f=a[6],p=a[7];a=a[8];var h=d[0],e=d[1],A=d[2],l=d[3],y=d[4],x=d[5],t=d[6],z=d[7];d=d[8];b[0]=h*m+e*n+A*f;b[1]=
h*r+e*k+A*p;b[2]=h*c+e*q+A*a;b[3]=l*m+y*n+x*f;b[4]=l*r+y*k+x*p;b[5]=l*c+y*q+x*a;b[6]=t*m+z*n+d*f;b[7]=t*r+z*k+d*p;b[8]=t*c+z*q+d*a;return b}};c.mul=c.multiply;c.translate=function(b,a,d){var m=a[0],r=a[1],c=a[2],n=a[3],k=a[4],q=a[5],f=a[6],p=a[7];a=a[8];var h=d[0];d=d[1];b[0]=m;b[1]=r;b[2]=c;b[3]=n;b[4]=k;b[5]=q;b[6]=h*m+d*n+f;b[7]=h*r+d*k+p;b[8]=h*c+d*q+a;return b};c.rotate=function(b,a,d){var m=a[0],r=a[1],c=a[2],n=a[3],k=a[4],q=a[5],f=a[6],p=a[7];a=a[8];var h=Math.sin(d);d=Math.cos(d);b[0]=d*m+
h*n;b[1]=d*r+h*k;b[2]=d*c+h*q;b[3]=d*n-h*m;b[4]=d*k-h*r;b[5]=d*q-h*c;b[6]=f;b[7]=p;b[8]=a;return b};c.scale=function(b,a,d){var m=d[0];d=d[1];b[0]=m*a[0];b[1]=m*a[1];b[2]=m*a[2];b[3]=d*a[3];b[4]=d*a[4];b[5]=d*a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};c.fromTranslation=function(b,a){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};c.fromRotation=function(b,a){var d=Math.sin(a),m=Math.cos(a);b[0]=m;b[1]=d;b[2]=0;b[3]=-d;b[4]=m;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};c.fromScaling=
function(b,a){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};c.fromMat2d=function(b,a){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};c.fromQuat=function(b,a){var d=a[0],m=a[1],r=a[2],c=a[3],n=d+d,k=m+m,q=r+r,d=d*n,f=m*n,m=m*k,p=r*n,h=r*k,r=r*q,n=c*n,k=c*k,c=c*q;b[0]=1-m-r;b[3]=f-c;b[6]=p+k;b[1]=f+c;b[4]=1-d-r;b[7]=h-n;b[2]=p-k;b[5]=h+n;b[8]=1-d-m;return b};c.normalFromMat4=function(b,a){var d=a[0],m=a[1],r=a[2],c=a[3],n=
a[4],k=a[5],q=a[6],f=a[7],p=a[8],h=a[9],e=a[10],A=a[11],l=a[12],y=a[13],x=a[14],t=a[15],z=d*k-m*n,w=d*q-r*n,C=d*f-c*n,D=m*q-r*k,F=m*f-c*k,G=r*f-c*q,g=p*y-h*l,I=p*x-e*l,p=p*t-A*l,O=h*x-e*y,h=h*t-A*y,e=e*t-A*x,A=z*e-w*h+C*O+D*p-F*I+G*g;if(!A)return null;A=1/A;b[0]=(k*e-q*h+f*O)*A;b[1]=(q*p-n*e-f*I)*A;b[2]=(n*h-k*p+f*g)*A;b[3]=(r*h-m*e-c*O)*A;b[4]=(d*e-r*p+c*I)*A;b[5]=(m*p-d*h-c*g)*A;b[6]=(y*G-x*F+t*D)*A;b[7]=(x*C-l*G-t*w)*A;b[8]=(l*F-y*C+t*z)*A;return b};c.str=function(b){return"mat3("+b[0]+", "+b[1]+
", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+")"};c.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2)+Math.pow(b[4],2)+Math.pow(b[5],2)+Math.pow(b[6],2)+Math.pow(b[7],2)+Math.pow(b[8],2))};c.add=function(b,a,d){b[0]=a[0]+d[0];b[1]=a[1]+d[1];b[2]=a[2]+d[2];b[3]=a[3]+d[3];b[4]=a[4]+d[4];b[5]=a[5]+d[5];b[6]=a[6]+d[6];b[7]=a[7]+d[7];b[8]=a[8]+d[8];return b};c.subtract=function(b,a,d){b[0]=a[0]-d[0];b[1]=a[1]-d[1];b[2]=a[2]-d[2];
b[3]=a[3]-d[3];b[4]=a[4]-d[4];b[5]=a[5]-d[5];b[6]=a[6]-d[6];b[7]=a[7]-d[7];b[8]=a[8]-d[8];return b};c.sub=c.subtract;c.multiplyScalar=function(b,a,d){b[0]=a[0]*d;b[1]=a[1]*d;b[2]=a[2]*d;b[3]=a[3]*d;b[4]=a[4]*d;b[5]=a[5]*d;b[6]=a[6]*d;b[7]=a[7]*d;b[8]=a[8]*d;return b};c.multiplyScalarAndAdd=function(b,a,d,m){b[0]=a[0]+d[0]*m;b[1]=a[1]+d[1]*m;b[2]=a[2]+d[2]*m;b[3]=a[3]+d[3]*m;b[4]=a[4]+d[4]*m;b[5]=a[5]+d[5]*m;b[6]=a[6]+d[6]*m;b[7]=a[7]+d[7]*m;b[8]=a[8]+d[8]*m;return b};c.exactEquals=function(b,a){return b[0]===
a[0]&&b[1]===a[1]&&b[2]===a[2]&&b[3]===a[3]&&b[4]===a[4]&&b[5]===a[5]&&b[6]===a[6]&&b[7]===a[7]&&b[8]===a[8]};c.equals=function(b,a){var d=b[0],m=b[1],r=b[2],c=b[3],n=b[4],k=b[5],e=b[6],f=b[7],p=b[8],h=a[0],u=a[1],A=a[2],g=a[3],y=a[4],x=a[5],t=b[6],z=a[7],w=a[8];return Math.abs(d-h)<=l.EPSILON*Math.max(1,Math.abs(d),Math.abs(h))&&Math.abs(m-u)<=l.EPSILON*Math.max(1,Math.abs(m),Math.abs(u))&&Math.abs(r-A)<=l.EPSILON*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(c-g)<=l.EPSILON*Math.max(1,Math.abs(c),
Math.abs(g))&&Math.abs(n-y)<=l.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(k-x)<=l.EPSILON*Math.max(1,Math.abs(k),Math.abs(x))&&Math.abs(e-t)<=l.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))&&Math.abs(f-z)<=l.EPSILON*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(p-w)<=l.EPSILON*Math.max(1,Math.abs(p),Math.abs(w))};g.exports=c},function(g,c,e){var l=e(11),b={scalar:{},SIMD:{},create:function(){var a=new l.ARRAY_TYPE(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;
a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){var d=new l.ARRAY_TYPE(16);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];d[9]=a[9];d[10]=a[10];d[11]=a[11];d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d},copy:function(a,d){a[0]=d[0];a[1]=d[1];a[2]=d[2];a[3]=d[3];a[4]=d[4];a[5]=d[5];a[6]=d[6];a[7]=d[7];a[8]=d[8];a[9]=d[9];a[10]=d[10];a[11]=d[11];a[12]=d[12];a[13]=d[13];a[14]=d[14];a[15]=d[15];return a},fromValues:function(a,
d,m,b,c,n,k,e,f,p,h,u,A,g,y,x){var t=new l.ARRAY_TYPE(16);t[0]=a;t[1]=d;t[2]=m;t[3]=b;t[4]=c;t[5]=n;t[6]=k;t[7]=e;t[8]=f;t[9]=p;t[10]=h;t[11]=u;t[12]=A;t[13]=g;t[14]=y;t[15]=x;return t},set:function(a,d,m,b,c,e,k,q,f,p,h,u,l,g,y,x,t){a[0]=d;a[1]=m;a[2]=b;a[3]=c;a[4]=e;a[5]=k;a[6]=q;a[7]=f;a[8]=p;a[9]=h;a[10]=u;a[11]=l;a[12]=g;a[13]=y;a[14]=x;a[15]=t;return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;
return a}};b.scalar.transpose=function(a,d){if(a===d){var m=d[1],b=d[2],c=d[3],e=d[6],k=d[7],q=d[11];a[1]=d[4];a[2]=d[8];a[3]=d[12];a[4]=m;a[6]=d[9];a[7]=d[13];a[8]=b;a[9]=e;a[11]=d[14];a[12]=c;a[13]=k;a[14]=q}else a[0]=d[0],a[1]=d[4],a[2]=d[8],a[3]=d[12],a[4]=d[1],a[5]=d[5],a[6]=d[9],a[7]=d[13],a[8]=d[2],a[9]=d[6],a[10]=d[10],a[11]=d[14],a[12]=d[3],a[13]=d[7],a[14]=d[11],a[15]=d[15];return a};b.SIMD.transpose=function(a,d){var m,b,c,e,k,q,f;m=SIMD.Float32x4.load(d,0);b=SIMD.Float32x4.load(d,4);c=
SIMD.Float32x4.load(d,8);e=SIMD.Float32x4.load(d,12);k=SIMD.Float32x4.shuffle(m,b,0,1,4,5);q=SIMD.Float32x4.shuffle(c,e,0,1,4,5);f=SIMD.Float32x4.shuffle(k,q,0,2,4,6);k=SIMD.Float32x4.shuffle(k,q,1,3,5,7);SIMD.Float32x4.store(a,0,f);SIMD.Float32x4.store(a,4,k);k=SIMD.Float32x4.shuffle(m,b,2,3,6,7);q=SIMD.Float32x4.shuffle(c,e,2,3,6,7);m=SIMD.Float32x4.shuffle(k,q,0,2,4,6);b=SIMD.Float32x4.shuffle(k,q,1,3,5,7);SIMD.Float32x4.store(a,8,m);SIMD.Float32x4.store(a,12,b);return a};b.transpose=l.USE_SIMD?
b.SIMD.transpose:b.scalar.transpose;b.scalar.invert=function(a,d){var m=d[0],b=d[1],c=d[2],e=d[3],k=d[4],q=d[5],f=d[6],p=d[7],h=d[8],u=d[9],l=d[10],g=d[11],y=d[12],x=d[13],t=d[14],z=d[15],w=m*q-b*k,C=m*f-c*k,D=m*p-e*k,F=b*f-c*q,G=b*p-e*q,Q=c*p-e*f,I=h*x-u*y,O=h*t-l*y,V=h*z-g*y,P=u*t-l*x,T=u*z-g*x,Z=l*z-g*t,R=w*Z-C*T+D*P+F*V-G*O+Q*I;if(!R)return null;R=1/R;a[0]=(q*Z-f*T+p*P)*R;a[1]=(c*T-b*Z-e*P)*R;a[2]=(x*Q-t*G+z*F)*R;a[3]=(l*G-u*Q-g*F)*R;a[4]=(f*V-k*Z-p*O)*R;a[5]=(m*Z-c*V+e*O)*R;a[6]=(t*D-y*Q-z*C)*
R;a[7]=(h*Q-l*D+g*C)*R;a[8]=(k*T-q*V+p*I)*R;a[9]=(b*V-m*T-e*I)*R;a[10]=(y*G-x*D+z*w)*R;a[11]=(u*D-h*G-g*w)*R;a[12]=(q*O-k*P-f*I)*R;a[13]=(m*P-b*O+c*I)*R;a[14]=(x*C-y*F-t*w)*R;a[15]=(h*F-u*C+l*w)*R;return a};b.SIMD.invert=function(a,d){var m,b,c,e,k,q,f,p,h;q=SIMD.Float32x4.load(d,0);f=SIMD.Float32x4.load(d,4);p=SIMD.Float32x4.load(d,8);h=SIMD.Float32x4.load(d,12);k=SIMD.Float32x4.shuffle(q,f,0,1,4,5);b=SIMD.Float32x4.shuffle(p,h,0,1,4,5);m=SIMD.Float32x4.shuffle(k,b,0,2,4,6);b=SIMD.Float32x4.shuffle(b,
k,1,3,5,7);k=SIMD.Float32x4.shuffle(q,f,2,3,6,7);e=SIMD.Float32x4.shuffle(p,h,2,3,6,7);c=SIMD.Float32x4.shuffle(k,e,0,2,4,6);e=SIMD.Float32x4.shuffle(e,k,1,3,5,7);k=SIMD.Float32x4.mul(c,e);k=SIMD.Float32x4.swizzle(k,1,0,3,2);q=SIMD.Float32x4.mul(b,k);f=SIMD.Float32x4.mul(m,k);k=SIMD.Float32x4.swizzle(k,2,3,0,1);q=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,k),q);f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(m,k),f);f=SIMD.Float32x4.swizzle(f,2,3,0,1);k=SIMD.Float32x4.mul(b,c);k=SIMD.Float32x4.swizzle(k,1,0,
3,2);q=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,k),q);h=SIMD.Float32x4.mul(m,k);k=SIMD.Float32x4.swizzle(k,2,3,0,1);q=SIMD.Float32x4.sub(q,SIMD.Float32x4.mul(e,k));h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(m,k),h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);k=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,2,3,0,1),e);k=SIMD.Float32x4.swizzle(k,1,0,3,2);c=SIMD.Float32x4.swizzle(c,2,3,0,1);q=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,k),q);p=SIMD.Float32x4.mul(m,k);k=SIMD.Float32x4.swizzle(k,2,3,0,1);q=SIMD.Float32x4.sub(q,
SIMD.Float32x4.mul(c,k));p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(m,k),p);p=SIMD.Float32x4.swizzle(p,2,3,0,1);k=SIMD.Float32x4.mul(m,b);k=SIMD.Float32x4.swizzle(k,1,0,3,2);p=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,k),p);h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,k),h);k=SIMD.Float32x4.swizzle(k,2,3,0,1);p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,k),p);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(c,k));k=SIMD.Float32x4.mul(m,e);k=SIMD.Float32x4.swizzle(k,1,0,3,2);f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(c,
k));p=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,k),p);k=SIMD.Float32x4.swizzle(k,2,3,0,1);f=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,k),f);p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(b,k));k=SIMD.Float32x4.mul(m,c);k=SIMD.Float32x4.swizzle(k,1,0,3,2);f=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,k),f);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(b,k));k=SIMD.Float32x4.swizzle(k,2,3,0,1);f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(e,k));h=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,k),h);m=SIMD.Float32x4.mul(m,q);m=
SIMD.Float32x4.add(SIMD.Float32x4.swizzle(m,2,3,0,1),m);m=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(m,1,0,3,2),m);k=SIMD.Float32x4.reciprocalApproximation(m);m=SIMD.Float32x4.sub(SIMD.Float32x4.add(k,k),SIMD.Float32x4.mul(m,SIMD.Float32x4.mul(k,k)));m=SIMD.Float32x4.swizzle(m,0,0,0,0);if(!m)return null;SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(m,q));SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(m,f));SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(m,p));SIMD.Float32x4.store(a,12,SIMD.Float32x4.mul(m,
h));return a};b.invert=l.USE_SIMD?b.SIMD.invert:b.scalar.invert;b.scalar.adjoint=function(a,d){var m=d[0],b=d[1],c=d[2],e=d[3],k=d[4],q=d[5],f=d[6],p=d[7],h=d[8],u=d[9],l=d[10],g=d[11],y=d[12],x=d[13],t=d[14],z=d[15];a[0]=q*(l*z-g*t)-u*(f*z-p*t)+x*(f*g-p*l);a[1]=-(b*(l*z-g*t)-u*(c*z-e*t)+x*(c*g-e*l));a[2]=b*(f*z-p*t)-q*(c*z-e*t)+x*(c*p-e*f);a[3]=-(b*(f*g-p*l)-q*(c*g-e*l)+u*(c*p-e*f));a[4]=-(k*(l*z-g*t)-h*(f*z-p*t)+y*(f*g-p*l));a[5]=m*(l*z-g*t)-h*(c*z-e*t)+y*(c*g-e*l);a[6]=-(m*(f*z-p*t)-k*(c*z-e*t)+
y*(c*p-e*f));a[7]=m*(f*g-p*l)-k*(c*g-e*l)+h*(c*p-e*f);a[8]=k*(u*z-g*x)-h*(q*z-p*x)+y*(q*g-p*u);a[9]=-(m*(u*z-g*x)-h*(b*z-e*x)+y*(b*g-e*u));a[10]=m*(q*z-p*x)-k*(b*z-e*x)+y*(b*p-e*q);a[11]=-(m*(q*g-p*u)-k*(b*g-e*u)+h*(b*p-e*q));a[12]=-(k*(u*t-l*x)-h*(q*t-f*x)+y*(q*l-f*u));a[13]=m*(u*t-l*x)-h*(b*t-c*x)+y*(b*l-c*u);a[14]=-(m*(q*t-f*x)-k*(b*t-c*x)+y*(b*f-c*q));a[15]=m*(q*l-f*u)-k*(b*l-c*u)+h*(b*f-c*q);return a};b.SIMD.adjoint=function(a,d){var m,b,c,e,k,q,f,p,h;m=SIMD.Float32x4.load(d,0);b=SIMD.Float32x4.load(d,
4);c=SIMD.Float32x4.load(d,8);e=SIMD.Float32x4.load(d,12);f=SIMD.Float32x4.shuffle(m,b,0,1,4,5);q=SIMD.Float32x4.shuffle(c,e,0,1,4,5);k=SIMD.Float32x4.shuffle(f,q,0,2,4,6);q=SIMD.Float32x4.shuffle(q,f,1,3,5,7);f=SIMD.Float32x4.shuffle(m,b,2,3,6,7);b=SIMD.Float32x4.shuffle(c,e,2,3,6,7);m=SIMD.Float32x4.shuffle(f,b,0,2,4,6);b=SIMD.Float32x4.shuffle(b,f,1,3,5,7);f=SIMD.Float32x4.mul(m,b);f=SIMD.Float32x4.swizzle(f,1,0,3,2);c=SIMD.Float32x4.mul(q,f);e=SIMD.Float32x4.mul(k,f);f=SIMD.Float32x4.swizzle(f,
2,3,0,1);c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(q,f),c);e=SIMD.Float32x4.sub(SIMD.Float32x4.mul(k,f),e);e=SIMD.Float32x4.swizzle(e,2,3,0,1);f=SIMD.Float32x4.mul(q,m);f=SIMD.Float32x4.swizzle(f,1,0,3,2);c=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,f),c);h=SIMD.Float32x4.mul(k,f);f=SIMD.Float32x4.swizzle(f,2,3,0,1);c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(b,f));h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(k,f),h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);f=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(q,2,3,0,1),b);
f=SIMD.Float32x4.swizzle(f,1,0,3,2);m=SIMD.Float32x4.swizzle(m,2,3,0,1);c=SIMD.Float32x4.add(SIMD.Float32x4.mul(m,f),c);p=SIMD.Float32x4.mul(k,f);f=SIMD.Float32x4.swizzle(f,2,3,0,1);c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(m,f));p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(k,f),p);p=SIMD.Float32x4.swizzle(p,2,3,0,1);f=SIMD.Float32x4.mul(k,q);f=SIMD.Float32x4.swizzle(f,1,0,3,2);p=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,f),p);h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(m,f),h);f=SIMD.Float32x4.swizzle(f,2,
3,0,1);p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,f),p);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(m,f));f=SIMD.Float32x4.mul(k,b);f=SIMD.Float32x4.swizzle(f,1,0,3,2);e=SIMD.Float32x4.sub(e,SIMD.Float32x4.mul(m,f));p=SIMD.Float32x4.add(SIMD.Float32x4.mul(q,f),p);f=SIMD.Float32x4.swizzle(f,2,3,0,1);e=SIMD.Float32x4.add(SIMD.Float32x4.mul(m,f),e);p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(q,f));f=SIMD.Float32x4.mul(k,m);f=SIMD.Float32x4.swizzle(f,1,0,3,2);e=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,f),e);
h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(q,f));f=SIMD.Float32x4.swizzle(f,2,3,0,1);e=SIMD.Float32x4.sub(e,SIMD.Float32x4.mul(b,f));h=SIMD.Float32x4.add(SIMD.Float32x4.mul(q,f),h);SIMD.Float32x4.store(a,0,c);SIMD.Float32x4.store(a,4,e);SIMD.Float32x4.store(a,8,p);SIMD.Float32x4.store(a,12,h);return a};b.adjoint=l.USE_SIMD?b.SIMD.adjoint:b.scalar.adjoint;b.determinant=function(a){var d=a[0],m=a[1],b=a[2],c=a[3],e=a[4],k=a[5],q=a[6],f=a[7],p=a[8],h=a[9],u=a[10],l=a[11],g=a[12],y=a[13],x=a[14];a=a[15];
return(d*k-m*e)*(u*a-l*x)-(d*q-b*e)*(h*a-l*y)+(d*f-c*e)*(h*x-u*y)+(m*q-b*k)*(p*a-l*g)-(m*f-c*k)*(p*x-u*g)+(b*f-c*q)*(p*y-h*g)};b.SIMD.multiply=function(a,d,m){var b=SIMD.Float32x4.load(d,0),c=SIMD.Float32x4.load(d,4),e=SIMD.Float32x4.load(d,8);d=SIMD.Float32x4.load(d,12);var k=SIMD.Float32x4.load(m,0),k=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(k,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(k,1,1,1,1),c),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(k,
2,2,2,2),e),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(k,3,3,3,3),d))));SIMD.Float32x4.store(a,0,k);k=SIMD.Float32x4.load(m,4);k=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(k,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(k,1,1,1,1),c),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(k,2,2,2,2),e),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(k,3,3,3,3),d))));SIMD.Float32x4.store(a,4,k);k=SIMD.Float32x4.load(m,8);k=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(k,
0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(k,1,1,1,1),c),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(k,2,2,2,2),e),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(k,3,3,3,3),d))));SIMD.Float32x4.store(a,8,k);m=SIMD.Float32x4.load(m,12);b=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,1,1,1,1),c),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,2,2,2,2),
e),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,3,3,3,3),d))));SIMD.Float32x4.store(a,12,b);return a};b.scalar.multiply=function(a,d,m){var b=d[0],c=d[1],e=d[2],k=d[3],q=d[4],f=d[5],p=d[6],h=d[7],u=d[8],l=d[9],g=d[10],y=d[11],x=d[12],t=d[13],z=d[14];d=d[15];var w=m[0],C=m[1],D=m[2],F=m[3];a[0]=w*b+C*q+D*u+F*x;a[1]=w*c+C*f+D*l+F*t;a[2]=w*e+C*p+D*g+F*z;a[3]=w*k+C*h+D*y+F*d;w=m[4];C=m[5];D=m[6];F=m[7];a[4]=w*b+C*q+D*u+F*x;a[5]=w*c+C*f+D*l+F*t;a[6]=w*e+C*p+D*g+F*z;a[7]=w*k+C*h+D*y+F*d;w=m[8];C=m[9];D=
m[10];F=m[11];a[8]=w*b+C*q+D*u+F*x;a[9]=w*c+C*f+D*l+F*t;a[10]=w*e+C*p+D*g+F*z;a[11]=w*k+C*h+D*y+F*d;w=m[12];C=m[13];D=m[14];F=m[15];a[12]=w*b+C*q+D*u+F*x;a[13]=w*c+C*f+D*l+F*t;a[14]=w*e+C*p+D*g+F*z;a[15]=w*k+C*h+D*y+F*d;return a};b.multiply=l.USE_SIMD?b.SIMD.multiply:b.scalar.multiply;b.mul=b.multiply;b.scalar.translate=function(a,d,b){var c=b[0],e=b[1];b=b[2];var n,k,q,f,p,h,u,l,g,y,x,t;d===a?(a[12]=d[0]*c+d[4]*e+d[8]*b+d[12],a[13]=d[1]*c+d[5]*e+d[9]*b+d[13],a[14]=d[2]*c+d[6]*e+d[10]*b+d[14],a[15]=
d[3]*c+d[7]*e+d[11]*b+d[15]):(n=d[0],k=d[1],q=d[2],f=d[3],p=d[4],h=d[5],u=d[6],l=d[7],g=d[8],y=d[9],x=d[10],t=d[11],a[0]=n,a[1]=k,a[2]=q,a[3]=f,a[4]=p,a[5]=h,a[6]=u,a[7]=l,a[8]=g,a[9]=y,a[10]=x,a[11]=t,a[12]=n*c+p*e+g*b+d[12],a[13]=k*c+h*e+y*b+d[13],a[14]=q*c+u*e+x*b+d[14],a[15]=f*c+l*e+t*b+d[15]);return a};b.SIMD.translate=function(a,d,b){var c=SIMD.Float32x4.load(d,0),e=SIMD.Float32x4.load(d,4),n=SIMD.Float32x4.load(d,8),k=SIMD.Float32x4.load(d,12);b=SIMD.Float32x4(b[0],b[1],b[2],0);d!==a&&(a[0]=
d[0],a[1]=d[1],a[2]=d[2],a[3]=d[3],a[4]=d[4],a[5]=d[5],a[6]=d[6],a[7]=d[7],a[8]=d[8],a[9]=d[9],a[10]=d[10],a[11]=d[11]);c=SIMD.Float32x4.mul(c,SIMD.Float32x4.swizzle(b,0,0,0,0));e=SIMD.Float32x4.mul(e,SIMD.Float32x4.swizzle(b,1,1,1,1));n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(b,2,2,2,2));d=SIMD.Float32x4.add(c,SIMD.Float32x4.add(e,SIMD.Float32x4.add(n,k)));SIMD.Float32x4.store(a,12,d);return a};b.translate=l.USE_SIMD?b.SIMD.translate:b.scalar.translate;b.scalar.scale=function(a,d,b){var c=b[0],
e=b[1];b=b[2];a[0]=d[0]*c;a[1]=d[1]*c;a[2]=d[2]*c;a[3]=d[3]*c;a[4]=d[4]*e;a[5]=d[5]*e;a[6]=d[6]*e;a[7]=d[7]*e;a[8]=d[8]*b;a[9]=d[9]*b;a[10]=d[10]*b;a[11]=d[11]*b;a[12]=d[12];a[13]=d[13];a[14]=d[14];a[15]=d[15];return a};b.SIMD.scale=function(a,d,b){var c;b=SIMD.Float32x4(b[0],b[1],b[2],0);c=SIMD.Float32x4.load(d,0);SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(c,SIMD.Float32x4.swizzle(b,0,0,0,0)));c=SIMD.Float32x4.load(d,4);SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(c,SIMD.Float32x4.swizzle(b,1,1,
1,1)));c=SIMD.Float32x4.load(d,8);SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(c,SIMD.Float32x4.swizzle(b,2,2,2,2)));a[12]=d[12];a[13]=d[13];a[14]=d[14];a[15]=d[15];return a};b.scale=l.USE_SIMD?b.SIMD.scale:b.scalar.scale;b.rotate=function(a,d,b,c){var e=c[0],n=c[1];c=c[2];var k=Math.sqrt(e*e+n*n+c*c),q,f,p,h,u,g,B,y,x,t,z,w,C,D,F,G,Q,I,O,V;if(Math.abs(k)<l.EPSILON)return null;k=1/k;e*=k;n*=k;c*=k;q=Math.sin(b);f=Math.cos(b);p=1-f;b=d[0];k=d[1];h=d[2];u=d[3];g=d[4];B=d[5];y=d[6];x=d[7];t=d[8];z=d[9];
w=d[10];C=d[11];D=e*e*p+f;F=n*e*p+c*q;G=c*e*p-n*q;Q=e*n*p-c*q;I=n*n*p+f;O=c*n*p+e*q;V=e*c*p+n*q;e=n*c*p-e*q;n=c*c*p+f;a[0]=b*D+g*F+t*G;a[1]=k*D+B*F+z*G;a[2]=h*D+y*F+w*G;a[3]=u*D+x*F+C*G;a[4]=b*Q+g*I+t*O;a[5]=k*Q+B*I+z*O;a[6]=h*Q+y*I+w*O;a[7]=u*Q+x*I+C*O;a[8]=b*V+g*e+t*n;a[9]=k*V+B*e+z*n;a[10]=h*V+y*e+w*n;a[11]=u*V+x*e+C*n;d!==a&&(a[12]=d[12],a[13]=d[13],a[14]=d[14],a[15]=d[15]);return a};b.scalar.rotateX=function(a,d,b){var c=Math.sin(b);b=Math.cos(b);var e=d[4],n=d[5],k=d[6],q=d[7],f=d[8],p=d[9],
h=d[10],u=d[11];d!==a&&(a[0]=d[0],a[1]=d[1],a[2]=d[2],a[3]=d[3],a[12]=d[12],a[13]=d[13],a[14]=d[14],a[15]=d[15]);a[4]=e*b+f*c;a[5]=n*b+p*c;a[6]=k*b+h*c;a[7]=q*b+u*c;a[8]=f*b-e*c;a[9]=p*b-n*c;a[10]=h*b-k*c;a[11]=u*b-q*c;return a};b.SIMD.rotateX=function(a,d,b){var c=SIMD.Float32x4.splat(Math.sin(b));b=SIMD.Float32x4.splat(Math.cos(b));d!==a&&(a[0]=d[0],a[1]=d[1],a[2]=d[2],a[3]=d[3],a[12]=d[12],a[13]=d[13],a[14]=d[14],a[15]=d[15]);var e=SIMD.Float32x4.load(d,4);d=SIMD.Float32x4.load(d,8);SIMD.Float32x4.store(a,
4,SIMD.Float32x4.add(SIMD.Float32x4.mul(e,b),SIMD.Float32x4.mul(d,c)));SIMD.Float32x4.store(a,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,b),SIMD.Float32x4.mul(e,c)));return a};b.rotateX=l.USE_SIMD?b.SIMD.rotateX:b.scalar.rotateX;b.scalar.rotateY=function(a,d,b){var c=Math.sin(b);b=Math.cos(b);var e=d[0],n=d[1],k=d[2],q=d[3],f=d[8],p=d[9],h=d[10],u=d[11];d!==a&&(a[4]=d[4],a[5]=d[5],a[6]=d[6],a[7]=d[7],a[12]=d[12],a[13]=d[13],a[14]=d[14],a[15]=d[15]);a[0]=e*b-f*c;a[1]=n*b-p*c;a[2]=k*b-h*c;a[3]=q*b-u*
c;a[8]=e*c+f*b;a[9]=n*c+p*b;a[10]=k*c+h*b;a[11]=q*c+u*b;return a};b.SIMD.rotateY=function(a,d,b){var c=SIMD.Float32x4.splat(Math.sin(b));b=SIMD.Float32x4.splat(Math.cos(b));d!==a&&(a[4]=d[4],a[5]=d[5],a[6]=d[6],a[7]=d[7],a[12]=d[12],a[13]=d[13],a[14]=d[14],a[15]=d[15]);var e=SIMD.Float32x4.load(d,0);d=SIMD.Float32x4.load(d,8);SIMD.Float32x4.store(a,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,b),SIMD.Float32x4.mul(d,c)));SIMD.Float32x4.store(a,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(e,c),SIMD.Float32x4.mul(d,
b)));return a};b.rotateY=l.USE_SIMD?b.SIMD.rotateY:b.scalar.rotateY;b.scalar.rotateZ=function(a,d,b){var c=Math.sin(b);b=Math.cos(b);var e=d[0],n=d[1],k=d[2],q=d[3],f=d[4],p=d[5],h=d[6],u=d[7];d!==a&&(a[8]=d[8],a[9]=d[9],a[10]=d[10],a[11]=d[11],a[12]=d[12],a[13]=d[13],a[14]=d[14],a[15]=d[15]);a[0]=e*b+f*c;a[1]=n*b+p*c;a[2]=k*b+h*c;a[3]=q*b+u*c;a[4]=f*b-e*c;a[5]=p*b-n*c;a[6]=h*b-k*c;a[7]=u*b-q*c;return a};b.SIMD.rotateZ=function(a,d,b){var c=SIMD.Float32x4.splat(Math.sin(b));b=SIMD.Float32x4.splat(Math.cos(b));
d!==a&&(a[8]=d[8],a[9]=d[9],a[10]=d[10],a[11]=d[11],a[12]=d[12],a[13]=d[13],a[14]=d[14],a[15]=d[15]);var e=SIMD.Float32x4.load(d,0);d=SIMD.Float32x4.load(d,4);SIMD.Float32x4.store(a,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(e,b),SIMD.Float32x4.mul(d,c)));SIMD.Float32x4.store(a,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,b),SIMD.Float32x4.mul(e,c)));return a};b.rotateZ=l.USE_SIMD?b.SIMD.rotateZ:b.scalar.rotateZ;b.fromTranslation=function(a,d){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=
0;a[9]=0;a[10]=1;a[11]=0;a[12]=d[0];a[13]=d[1];a[14]=d[2];a[15]=1;return a};b.fromScaling=function(a,d){a[0]=d[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=d[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=d[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotation=function(a,d,b){var c=b[0],e=b[1];b=b[2];var n=Math.sqrt(c*c+e*e+b*b),k;if(Math.abs(n)<l.EPSILON)return null;n=1/n;c*=n;e*=n;b*=n;n=Math.sin(d);d=Math.cos(d);k=1-d;a[0]=c*c*k+d;a[1]=e*c*k+b*n;a[2]=b*c*k-e*n;a[3]=0;a[4]=c*e*k-b*n;a[5]=e*e*k+d;a[6]=
b*e*k+c*n;a[7]=0;a[8]=c*b*k+e*n;a[9]=e*b*k-c*n;a[10]=b*b*k+d;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromXRotation=function(a,d){var b=Math.sin(d),c=Math.cos(d);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c;a[6]=b;a[7]=0;a[8]=0;a[9]=-b;a[10]=c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromYRotation=function(a,d){var b=Math.sin(d),c=Math.cos(d);a[0]=c;a[1]=0;a[2]=-b;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=b;a[9]=0;a[10]=c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromZRotation=
function(a,d){var b=Math.sin(d),c=Math.cos(d);a[0]=c;a[1]=b;a[2]=0;a[3]=0;a[4]=-b;a[5]=c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotationTranslation=function(a,d,b){var c=d[0],e=d[1],n=d[2],k=d[3],q=c+c,f=e+e,p=n+n;d=c*q;var h=c*f,c=c*p,u=e*f,e=e*p,n=n*p,q=k*q,f=k*f,k=k*p;a[0]=1-(u+n);a[1]=h+k;a[2]=c-f;a[3]=0;a[4]=h-k;a[5]=1-(d+n);a[6]=e+q;a[7]=0;a[8]=c+f;a[9]=e-q;a[10]=1-(d+u);a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};b.getTranslation=
function(a,d){a[0]=d[12];a[1]=d[13];a[2]=d[14];return a};b.getRotation=function(a,d){var b=d[0]+d[5]+d[10],c=0;0<b?(c=2*Math.sqrt(b+1),a[3]=.25*c,a[0]=(d[6]-d[9])/c,a[1]=(d[8]-d[2])/c,a[2]=(d[1]-d[4])/c):d[0]>d[5]&d[0]>d[10]?(c=2*Math.sqrt(1+d[0]-d[5]-d[10]),a[3]=(d[6]-d[9])/c,a[0]=.25*c,a[1]=(d[1]+d[4])/c,a[2]=(d[8]+d[2])/c):d[5]>d[10]?(c=2*Math.sqrt(1+d[5]-d[0]-d[10]),a[3]=(d[8]-d[2])/c,a[0]=(d[1]+d[4])/c,a[1]=.25*c,a[2]=(d[6]+d[9])/c):(c=2*Math.sqrt(1+d[10]-d[0]-d[5]),a[3]=(d[1]-d[4])/c,a[0]=(d[8]+
d[2])/c,a[1]=(d[6]+d[9])/c,a[2]=.25*c);return a};b.fromRotationTranslationScale=function(a,d,b,c){var e=d[0],n=d[1],k=d[2],q=d[3],f=e+e,p=n+n,h=k+k;d=e*f;var u=e*p,e=e*h,l=n*p,n=n*h,k=k*h,f=q*f,p=q*p,q=q*h,h=c[0],g=c[1];c=c[2];a[0]=(1-(l+k))*h;a[1]=(u+q)*h;a[2]=(e-p)*h;a[3]=0;a[4]=(u-q)*g;a[5]=(1-(d+k))*g;a[6]=(n+f)*g;a[7]=0;a[8]=(e+p)*c;a[9]=(n-f)*c;a[10]=(1-(d+l))*c;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};b.fromRotationTranslationScaleOrigin=function(a,d,b,c,e){var n=d[0],k=d[1],
q=d[2],f=d[3],p=n+n,h=k+k,u=q+q;d=n*p;var l=n*h,n=n*u,g=k*h,k=k*u,q=q*u,p=f*p,h=f*h,f=f*u,u=c[0],y=c[1];c=c[2];var x=e[0],t=e[1];e=e[2];a[0]=(1-(g+q))*u;a[1]=(l+f)*u;a[2]=(n-h)*u;a[3]=0;a[4]=(l-f)*y;a[5]=(1-(d+q))*y;a[6]=(k+p)*y;a[7]=0;a[8]=(n+h)*c;a[9]=(k-p)*c;a[10]=(1-(d+g))*c;a[11]=0;a[12]=b[0]+x-(a[0]*x+a[4]*t+a[8]*e);a[13]=b[1]+t-(a[1]*x+a[5]*t+a[9]*e);a[14]=b[2]+e-(a[2]*x+a[6]*t+a[10]*e);a[15]=1;return a};b.fromQuat=function(a,d){var b=d[0],c=d[1],e=d[2],n=d[3],k=b+b,q=c+c,f=e+e,b=b*k,p=c*k,
c=c*q,h=e*k,u=e*q,e=e*f,k=n*k,q=n*q,n=n*f;a[0]=1-c-e;a[1]=p+n;a[2]=h-q;a[3]=0;a[4]=p-n;a[5]=1-b-e;a[6]=u+k;a[7]=0;a[8]=h+q;a[9]=u-k;a[10]=1-b-c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.frustum=function(a,d,b,c,e,n,k){var q=1/(b-d),f=1/(e-c),p=1/(n-k);a[0]=2*n*q;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*n*f;a[6]=0;a[7]=0;a[8]=(b+d)*q;a[9]=(e+c)*f;a[10]=(k+n)*p;a[11]=-1;a[12]=0;a[13]=0;a[14]=k*n*2*p;a[15]=0;return a};b.perspective=function(a,d,b,c,e){d=1/Math.tan(d/2);var n=1/(c-e);a[0]=d/b;a[1]=
0;a[2]=0;a[3]=0;a[4]=0;a[5]=d;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(e+c)*n;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*e*c*n;a[15]=0;return a};b.perspectiveFromFieldOfView=function(a,d,b,c){var e=Math.tan(d.upDegrees*Math.PI/180),n=Math.tan(d.downDegrees*Math.PI/180),k=Math.tan(d.leftDegrees*Math.PI/180);d=Math.tan(d.rightDegrees*Math.PI/180);var q=2/(k+d),f=2/(e+n);a[0]=q;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=f;a[6]=0;a[7]=0;a[8]=-((k-d)*q*.5);a[9]=(e-n)*f*.5;a[10]=c/(b-c);a[11]=-1;a[12]=0;a[13]=0;a[14]=c*b/(b-c);
a[15]=0;return a};b.ortho=function(a,d,b,c,e,n,k){var q=1/(d-b),f=1/(c-e),p=1/(n-k);a[0]=-2*q;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*f;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*p;a[11]=0;a[12]=(d+b)*q;a[13]=(e+c)*f;a[14]=(k+n)*p;a[15]=1;return a};b.lookAt=function(a,d,c,e){var v,n,k,q,f,p,h,u,g=d[0],B=d[1];d=d[2];k=e[0];q=e[1];n=e[2];h=c[0];e=c[1];v=c[2];if(Math.abs(g-h)<l.EPSILON&&Math.abs(B-e)<l.EPSILON&&Math.abs(d-v)<l.EPSILON)return b.identity(a);c=g-h;e=B-e;h=d-v;u=1/Math.sqrt(c*c+e*e+h*h);c*=u;e*=u;
h*=u;v=q*h-n*e;n=n*c-k*h;k=k*e-q*c;(u=Math.sqrt(v*v+n*n+k*k))?(u=1/u,v*=u,n*=u,k*=u):k=n=v=0;q=e*k-h*n;f=h*v-c*k;p=c*n-e*v;(u=Math.sqrt(q*q+f*f+p*p))?(u=1/u,q*=u,f*=u,p*=u):p=f=q=0;a[0]=v;a[1]=q;a[2]=c;a[3]=0;a[4]=n;a[5]=f;a[6]=e;a[7]=0;a[8]=k;a[9]=p;a[10]=h;a[11]=0;a[12]=-(v*g+n*B+k*d);a[13]=-(q*g+f*B+p*d);a[14]=-(c*g+e*B+h*d);a[15]=1;return a};b.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+
a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};b.add=function(a,d,b){a[0]=d[0]+b[0];a[1]=d[1]+b[1];a[2]=d[2]+b[2];a[3]=d[3]+b[3];a[4]=d[4]+b[4];a[5]=d[5]+b[5];a[6]=d[6]+b[6];a[7]=d[7]+b[7];
a[8]=d[8]+b[8];a[9]=d[9]+b[9];a[10]=d[10]+b[10];a[11]=d[11]+b[11];a[12]=d[12]+b[12];a[13]=d[13]+b[13];a[14]=d[14]+b[14];a[15]=d[15]+b[15];return a};b.subtract=function(a,d,b){a[0]=d[0]-b[0];a[1]=d[1]-b[1];a[2]=d[2]-b[2];a[3]=d[3]-b[3];a[4]=d[4]-b[4];a[5]=d[5]-b[5];a[6]=d[6]-b[6];a[7]=d[7]-b[7];a[8]=d[8]-b[8];a[9]=d[9]-b[9];a[10]=d[10]-b[10];a[11]=d[11]-b[11];a[12]=d[12]-b[12];a[13]=d[13]-b[13];a[14]=d[14]-b[14];a[15]=d[15]-b[15];return a};b.sub=b.subtract;b.multiplyScalar=function(a,d,b){a[0]=d[0]*
b;a[1]=d[1]*b;a[2]=d[2]*b;a[3]=d[3]*b;a[4]=d[4]*b;a[5]=d[5]*b;a[6]=d[6]*b;a[7]=d[7]*b;a[8]=d[8]*b;a[9]=d[9]*b;a[10]=d[10]*b;a[11]=d[11]*b;a[12]=d[12]*b;a[13]=d[13]*b;a[14]=d[14]*b;a[15]=d[15]*b;return a};b.multiplyScalarAndAdd=function(a,d,b,c){a[0]=d[0]+b[0]*c;a[1]=d[1]+b[1]*c;a[2]=d[2]+b[2]*c;a[3]=d[3]+b[3]*c;a[4]=d[4]+b[4]*c;a[5]=d[5]+b[5]*c;a[6]=d[6]+b[6]*c;a[7]=d[7]+b[7]*c;a[8]=d[8]+b[8]*c;a[9]=d[9]+b[9]*c;a[10]=d[10]+b[10]*c;a[11]=d[11]+b[11]*c;a[12]=d[12]+b[12]*c;a[13]=d[13]+b[13]*c;a[14]=
d[14]+b[14]*c;a[15]=d[15]+b[15]*c;return a};b.exactEquals=function(a,d){return a[0]===d[0]&&a[1]===d[1]&&a[2]===d[2]&&a[3]===d[3]&&a[4]===d[4]&&a[5]===d[5]&&a[6]===d[6]&&a[7]===d[7]&&a[8]===d[8]&&a[9]===d[9]&&a[10]===d[10]&&a[11]===d[11]&&a[12]===d[12]&&a[13]===d[13]&&a[14]===d[14]&&a[15]===d[15]};b.equals=function(a,d){var b=a[0],c=a[1],e=a[2],n=a[3],k=a[4],q=a[5],f=a[6],p=a[7],h=a[8],u=a[9],g=a[10],B=a[11],y=a[12],x=a[13],t=a[14],z=a[15],w=d[0],C=d[1],D=d[2],F=d[3],G=d[4],Q=d[5],I=d[6],O=d[7],V=
d[8],P=d[9],T=d[10],Z=d[11],R=d[12],ea=d[13],ca=d[14],Ha=d[15];return Math.abs(b-w)<=l.EPSILON*Math.max(1,Math.abs(b),Math.abs(w))&&Math.abs(c-C)<=l.EPSILON*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(e-D)<=l.EPSILON*Math.max(1,Math.abs(e),Math.abs(D))&&Math.abs(n-F)<=l.EPSILON*Math.max(1,Math.abs(n),Math.abs(F))&&Math.abs(k-G)<=l.EPSILON*Math.max(1,Math.abs(k),Math.abs(G))&&Math.abs(q-Q)<=l.EPSILON*Math.max(1,Math.abs(q),Math.abs(Q))&&Math.abs(f-I)<=l.EPSILON*Math.max(1,Math.abs(f),Math.abs(I))&&
Math.abs(p-O)<=l.EPSILON*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(h-V)<=l.EPSILON*Math.max(1,Math.abs(h),Math.abs(V))&&Math.abs(u-P)<=l.EPSILON*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(g-T)<=l.EPSILON*Math.max(1,Math.abs(g),Math.abs(T))&&Math.abs(B-Z)<=l.EPSILON*Math.max(1,Math.abs(B),Math.abs(Z))&&Math.abs(y-R)<=l.EPSILON*Math.max(1,Math.abs(y),Math.abs(R))&&Math.abs(x-ea)<=l.EPSILON*Math.max(1,Math.abs(x),Math.abs(ea))&&Math.abs(t-ca)<=l.EPSILON*Math.max(1,Math.abs(t),Math.abs(ca))&&Math.abs(z-
Ha)<=l.EPSILON*Math.max(1,Math.abs(z),Math.abs(Ha))};g.exports=b},function(g,c,e){var l=e(11),b=e(14),a=e(17);c=e(18);var d={create:function(){var a=new l.ARRAY_TYPE(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}};d.rotationTo=function(){var b=a.create(),c=a.fromValues(1,0,0),e=a.fromValues(0,1,0);return function(n,k,q){var f=a.dot(k,q);if(-.999999>f)return a.cross(b,c,k),1E-6>a.length(b)&&a.cross(b,e,k),a.normalize(b,b),d.setAxisAngle(n,b,Math.PI),n;if(.999999<f)return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n;a.cross(b,
k,q);n[0]=b[0];n[1]=b[1];n[2]=b[2];n[3]=1+f;return d.normalize(n,n)}}();d.setAxes=function(){var a=b.create();return function(b,c,e,k){a[0]=e[0];a[3]=e[1];a[6]=e[2];a[1]=k[0];a[4]=k[1];a[7]=k[2];a[2]=-c[0];a[5]=-c[1];a[8]=-c[2];return d.normalize(b,d.fromMat3(b,a))}}();d.clone=c.clone;d.fromValues=c.fromValues;d.copy=c.copy;d.set=c.set;d.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};d.setAxisAngle=function(a,d,b){b*=.5;var c=Math.sin(b);a[0]=c*d[0];a[1]=c*d[1];a[2]=c*d[2];a[3]=Math.cos(b);
return a};d.getAxisAngle=function(a,d){var b=2*Math.acos(d[3]),c=Math.sin(b/2);0!=c?(a[0]=d[0]/c,a[1]=d[1]/c,a[2]=d[2]/c):(a[0]=1,a[1]=0,a[2]=0);return b};d.add=c.add;d.multiply=function(a,d,b){var c=d[0],e=d[1],q=d[2];d=d[3];var f=b[0],p=b[1],h=b[2];b=b[3];a[0]=c*b+d*f+e*h-q*p;a[1]=e*b+d*p+q*f-c*h;a[2]=q*b+d*h+c*p-e*f;a[3]=d*b-c*f-e*p-q*h;return a};d.mul=d.multiply;d.scale=c.scale;d.rotateX=function(a,d,b){b*=.5;var c=d[0],e=d[1],q=d[2];d=d[3];var f=Math.sin(b);b=Math.cos(b);a[0]=c*b+d*f;a[1]=e*
b+q*f;a[2]=q*b-e*f;a[3]=d*b-c*f;return a};d.rotateY=function(a,d,b){b*=.5;var c=d[0],e=d[1],q=d[2];d=d[3];var f=Math.sin(b);b=Math.cos(b);a[0]=c*b-q*f;a[1]=e*b+d*f;a[2]=q*b+c*f;a[3]=d*b-e*f;return a};d.rotateZ=function(a,d,b){b*=.5;var c=d[0],e=d[1],q=d[2];d=d[3];var f=Math.sin(b);b=Math.cos(b);a[0]=c*b+e*f;a[1]=e*b-c*f;a[2]=q*b+d*f;a[3]=d*b-q*f;return a};d.calculateW=function(a,d){var b=d[0],c=d[1],e=d[2];a[0]=b;a[1]=c;a[2]=e;a[3]=Math.sqrt(Math.abs(1-b*b-c*c-e*e));return a};d.dot=c.dot;d.lerp=c.lerp;
d.slerp=function(a,d,b,c){var e=d[0],q=d[1],f=d[2];d=d[3];var p=b[0],h=b[1],u=b[2];b=b[3];var l,g,y;g=e*p+q*h+f*u+d*b;0>g&&(g=-g,p=-p,h=-h,u=-u,b=-b);1E-6<1-g?(l=Math.acos(g),y=Math.sin(l),g=Math.sin((1-c)*l)/y,c=Math.sin(c*l)/y):g=1-c;a[0]=g*e+c*p;a[1]=g*q+c*h;a[2]=g*f+c*u;a[3]=g*d+c*b;return a};d.sqlerp=function(){var a=d.create(),b=d.create();return function(c,e,k,q,f,p){d.slerp(a,e,f,p);d.slerp(b,k,q,p);d.slerp(c,a,b,2*p*(1-p));return c}}();d.invert=function(a,d){var b=d[0],c=d[1],e=d[2],q=d[3],
f=b*b+c*c+e*e+q*q,f=f?1/f:0;a[0]=-b*f;a[1]=-c*f;a[2]=-e*f;a[3]=q*f;return a};d.conjugate=function(a,d){a[0]=-d[0];a[1]=-d[1];a[2]=-d[2];a[3]=d[3];return a};d.length=c.length;d.len=d.length;d.squaredLength=c.squaredLength;d.sqrLen=d.squaredLength;d.normalize=c.normalize;d.fromMat3=function(a,d){var b=d[0]+d[4]+d[8];if(0<b)b=Math.sqrt(b+1),a[3]=.5*b,b=.5/b,a[0]=(d[5]-d[7])*b,a[1]=(d[6]-d[2])*b,a[2]=(d[1]-d[3])*b;else{var c=0;d[4]>d[0]&&(c=1);d[8]>d[3*c+c]&&(c=2);var e=(c+1)%3,q=(c+2)%3,b=Math.sqrt(d[3*
c+c]-d[3*e+e]-d[3*q+q]+1);a[c]=.5*b;b=.5/b;a[3]=(d[3*e+q]-d[3*q+e])*b;a[e]=(d[3*e+c]+d[3*c+e])*b;a[q]=(d[3*q+c]+d[3*c+q])*b}return a};d.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};d.exactEquals=c.exactEquals;d.equals=c.equals;g.exports=d},function(g,c,e){var l=e(11),b={create:function(){var a=new l.ARRAY_TYPE(3);a[0]=0;a[1]=0;a[2]=0;return a},clone:function(a){var d=new l.ARRAY_TYPE(3);d[0]=a[0];d[1]=a[1];d[2]=a[2];return d},fromValues:function(a,d,b){var c=new l.ARRAY_TYPE(3);
c[0]=a;c[1]=d;c[2]=b;return c},copy:function(a,d){a[0]=d[0];a[1]=d[1];a[2]=d[2];return a},set:function(a,d,b,c){a[0]=d;a[1]=b;a[2]=c;return a},add:function(a,d,b){a[0]=d[0]+b[0];a[1]=d[1]+b[1];a[2]=d[2]+b[2];return a},subtract:function(a,d,b){a[0]=d[0]-b[0];a[1]=d[1]-b[1];a[2]=d[2]-b[2];return a}};b.sub=b.subtract;b.multiply=function(a,d,b){a[0]=d[0]*b[0];a[1]=d[1]*b[1];a[2]=d[2]*b[2];return a};b.mul=b.multiply;b.divide=function(a,d,b){a[0]=d[0]/b[0];a[1]=d[1]/b[1];a[2]=d[2]/b[2];return a};b.div=
b.divide;b.ceil=function(a,d){a[0]=Math.ceil(d[0]);a[1]=Math.ceil(d[1]);a[2]=Math.ceil(d[2]);return a};b.floor=function(a,d){a[0]=Math.floor(d[0]);a[1]=Math.floor(d[1]);a[2]=Math.floor(d[2]);return a};b.min=function(a,d,b){a[0]=Math.min(d[0],b[0]);a[1]=Math.min(d[1],b[1]);a[2]=Math.min(d[2],b[2]);return a};b.max=function(a,d,b){a[0]=Math.max(d[0],b[0]);a[1]=Math.max(d[1],b[1]);a[2]=Math.max(d[2],b[2]);return a};b.round=function(a,d){a[0]=Math.round(d[0]);a[1]=Math.round(d[1]);a[2]=Math.round(d[2]);
return a};b.scale=function(a,d,b){a[0]=d[0]*b;a[1]=d[1]*b;a[2]=d[2]*b;return a};b.scaleAndAdd=function(a,d,b,c){a[0]=d[0]+b[0]*c;a[1]=d[1]+b[1]*c;a[2]=d[2]+b[2]*c;return a};b.distance=function(a,d){var b=d[0]-a[0],c=d[1]-a[1],e=d[2]-a[2];return Math.sqrt(b*b+c*c+e*e)};b.dist=b.distance;b.squaredDistance=function(a,d){var b=d[0]-a[0],c=d[1]-a[1],e=d[2]-a[2];return b*b+c*c+e*e};b.sqrDist=b.squaredDistance;b.length=function(a){var d=a[0],b=a[1];a=a[2];return Math.sqrt(d*d+b*b+a*a)};b.len=b.length;b.squaredLength=
function(a){var d=a[0],b=a[1];a=a[2];return d*d+b*b+a*a};b.sqrLen=b.squaredLength;b.negate=function(a,d){a[0]=-d[0];a[1]=-d[1];a[2]=-d[2];return a};b.inverse=function(a,d){a[0]=1/d[0];a[1]=1/d[1];a[2]=1/d[2];return a};b.normalize=function(a,d){var b=d[0],c=d[1],e=d[2],b=b*b+c*c+e*e;0<b&&(b=1/Math.sqrt(b),a[0]=d[0]*b,a[1]=d[1]*b,a[2]=d[2]*b);return a};b.dot=function(a,d){return a[0]*d[0]+a[1]*d[1]+a[2]*d[2]};b.cross=function(a,d,b){var c=d[0],e=d[1];d=d[2];var n=b[0],k=b[1];b=b[2];a[0]=e*b-d*k;a[1]=
d*n-c*b;a[2]=c*k-e*n;return a};b.lerp=function(a,d,b,c){var e=d[0],n=d[1];d=d[2];a[0]=e+c*(b[0]-e);a[1]=n+c*(b[1]-n);a[2]=d+c*(b[2]-d);return a};b.hermite=function(a,d,b,c,e,n){var k=n*n,q=k*(2*n-3)+1,f=k*(n-2)+n,p=k*(n-1);n=k*(3-2*n);a[0]=d[0]*q+b[0]*f+c[0]*p+e[0]*n;a[1]=d[1]*q+b[1]*f+c[1]*p+e[1]*n;a[2]=d[2]*q+b[2]*f+c[2]*p+e[2]*n;return a};b.bezier=function(a,d,b,c,e,n){var k=1-n,q=k*k,f=n*n,p=q*k,q=3*n*q,k=3*f*k;n*=f;a[0]=d[0]*p+b[0]*q+c[0]*k+e[0]*n;a[1]=d[1]*p+b[1]*q+c[1]*k+e[1]*n;a[2]=d[2]*p+
b[2]*q+c[2]*k+e[2]*n;return a};b.random=function(a,d){d=d||1;var b=2*l.RANDOM()*Math.PI,c=2*l.RANDOM()-1,e=Math.sqrt(1-c*c)*d;a[0]=Math.cos(b)*e;a[1]=Math.sin(b)*e;a[2]=c*d;return a};b.transformMat4=function(a,d,b){var c=d[0],e=d[1];d=d[2];var n=b[3]*c+b[7]*e+b[11]*d+b[15],n=n||1;a[0]=(b[0]*c+b[4]*e+b[8]*d+b[12])/n;a[1]=(b[1]*c+b[5]*e+b[9]*d+b[13])/n;a[2]=(b[2]*c+b[6]*e+b[10]*d+b[14])/n;return a};b.transformMat3=function(a,d,b){var c=d[0],e=d[1];d=d[2];a[0]=c*b[0]+e*b[3]+d*b[6];a[1]=c*b[1]+e*b[4]+
d*b[7];a[2]=c*b[2]+e*b[5]+d*b[8];return a};b.transformQuat=function(a,d,b){var c=d[0],e=d[1],n=d[2];d=b[0];var k=b[1],q=b[2];b=b[3];var f=b*c+k*n-q*e,p=b*e+q*c-d*n,h=b*n+d*e-k*c,c=-d*c-k*e-q*n;a[0]=f*b+c*-d+p*-q-h*-k;a[1]=p*b+c*-k+h*-d-f*-q;a[2]=h*b+c*-q+f*-k-p*-d;return a};b.rotateX=function(a,d,b,c){var e=[],n=[];e[0]=d[0]-b[0];e[1]=d[1]-b[1];e[2]=d[2]-b[2];n[0]=e[0];n[1]=e[1]*Math.cos(c)-e[2]*Math.sin(c);n[2]=e[1]*Math.sin(c)+e[2]*Math.cos(c);a[0]=n[0]+b[0];a[1]=n[1]+b[1];a[2]=n[2]+b[2];return a};
b.rotateY=function(a,d,b,c){var e=[],n=[];e[0]=d[0]-b[0];e[1]=d[1]-b[1];e[2]=d[2]-b[2];n[0]=e[2]*Math.sin(c)+e[0]*Math.cos(c);n[1]=e[1];n[2]=e[2]*Math.cos(c)-e[0]*Math.sin(c);a[0]=n[0]+b[0];a[1]=n[1]+b[1];a[2]=n[2]+b[2];return a};b.rotateZ=function(a,d,b,c){var e=[],n=[];e[0]=d[0]-b[0];e[1]=d[1]-b[1];e[2]=d[2]-b[2];n[0]=e[0]*Math.cos(c)-e[1]*Math.sin(c);n[1]=e[0]*Math.sin(c)+e[1]*Math.cos(c);n[2]=e[2];a[0]=n[0]+b[0];a[1]=n[1]+b[1];a[2]=n[2]+b[2];return a};b.forEach=function(){var a=b.create();return function(d,
b,c,e,n,k){b||(b=3);c||(c=0);for(e=e?Math.min(e*b+c,d.length):d.length;c<e;c+=b)a[0]=d[c],a[1]=d[c+1],a[2]=d[c+2],n(a,a,k),d[c]=a[0],d[c+1]=a[1],d[c+2]=a[2];return d}}();b.angle=function(a,d){var c=b.fromValues(a[0],a[1],a[2]),e=b.fromValues(d[0],d[1],d[2]);b.normalize(c,c);b.normalize(e,e);c=b.dot(c,e);return 1<c?0:Math.acos(c)};b.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};b.exactEquals=function(a,d){return a[0]===d[0]&&a[1]===d[1]&&a[2]===d[2]};b.equals=function(a,d){var b=a[0],
c=a[1],e=a[2],n=d[0],k=d[1],q=d[2];return Math.abs(b-n)<=l.EPSILON*Math.max(1,Math.abs(b),Math.abs(n))&&Math.abs(c-k)<=l.EPSILON*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(e-q)<=l.EPSILON*Math.max(1,Math.abs(e),Math.abs(q))};g.exports=b},function(g,c,e){var l=e(11),b={create:function(){var a=new l.ARRAY_TYPE(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a},clone:function(a){var d=new l.ARRAY_TYPE(4);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];return d},fromValues:function(a,d,b,c){var e=new l.ARRAY_TYPE(4);
e[0]=a;e[1]=d;e[2]=b;e[3]=c;return e},copy:function(a,d){a[0]=d[0];a[1]=d[1];a[2]=d[2];a[3]=d[3];return a},set:function(a,d,b,c,e){a[0]=d;a[1]=b;a[2]=c;a[3]=e;return a},add:function(a,d,b){a[0]=d[0]+b[0];a[1]=d[1]+b[1];a[2]=d[2]+b[2];a[3]=d[3]+b[3];return a},subtract:function(a,d,b){a[0]=d[0]-b[0];a[1]=d[1]-b[1];a[2]=d[2]-b[2];a[3]=d[3]-b[3];return a}};b.sub=b.subtract;b.multiply=function(a,d,b){a[0]=d[0]*b[0];a[1]=d[1]*b[1];a[2]=d[2]*b[2];a[3]=d[3]*b[3];return a};b.mul=b.multiply;b.divide=function(a,
d,b){a[0]=d[0]/b[0];a[1]=d[1]/b[1];a[2]=d[2]/b[2];a[3]=d[3]/b[3];return a};b.div=b.divide;b.ceil=function(a,d){a[0]=Math.ceil(d[0]);a[1]=Math.ceil(d[1]);a[2]=Math.ceil(d[2]);a[3]=Math.ceil(d[3]);return a};b.floor=function(a,d){a[0]=Math.floor(d[0]);a[1]=Math.floor(d[1]);a[2]=Math.floor(d[2]);a[3]=Math.floor(d[3]);return a};b.min=function(a,d,b){a[0]=Math.min(d[0],b[0]);a[1]=Math.min(d[1],b[1]);a[2]=Math.min(d[2],b[2]);a[3]=Math.min(d[3],b[3]);return a};b.max=function(a,d,b){a[0]=Math.max(d[0],b[0]);
a[1]=Math.max(d[1],b[1]);a[2]=Math.max(d[2],b[2]);a[3]=Math.max(d[3],b[3]);return a};b.round=function(a,d){a[0]=Math.round(d[0]);a[1]=Math.round(d[1]);a[2]=Math.round(d[2]);a[3]=Math.round(d[3]);return a};b.scale=function(a,d,b){a[0]=d[0]*b;a[1]=d[1]*b;a[2]=d[2]*b;a[3]=d[3]*b;return a};b.scaleAndAdd=function(a,d,b,c){a[0]=d[0]+b[0]*c;a[1]=d[1]+b[1]*c;a[2]=d[2]+b[2]*c;a[3]=d[3]+b[3]*c;return a};b.distance=function(a,d){var b=d[0]-a[0],c=d[1]-a[1],e=d[2]-a[2],n=d[3]-a[3];return Math.sqrt(b*b+c*c+e*
e+n*n)};b.dist=b.distance;b.squaredDistance=function(a,d){var b=d[0]-a[0],c=d[1]-a[1],e=d[2]-a[2],n=d[3]-a[3];return b*b+c*c+e*e+n*n};b.sqrDist=b.squaredDistance;b.length=function(a){var d=a[0],b=a[1],c=a[2];a=a[3];return Math.sqrt(d*d+b*b+c*c+a*a)};b.len=b.length;b.squaredLength=function(a){var d=a[0],b=a[1],c=a[2];a=a[3];return d*d+b*b+c*c+a*a};b.sqrLen=b.squaredLength;b.negate=function(a,d){a[0]=-d[0];a[1]=-d[1];a[2]=-d[2];a[3]=-d[3];return a};b.inverse=function(a,d){a[0]=1/d[0];a[1]=1/d[1];a[2]=
1/d[2];a[3]=1/d[3];return a};b.normalize=function(a,d){var b=d[0],c=d[1],e=d[2],n=d[3],k=b*b+c*c+e*e+n*n;0<k&&(k=1/Math.sqrt(k),a[0]=b*k,a[1]=c*k,a[2]=e*k,a[3]=n*k);return a};b.dot=function(a,d){return a[0]*d[0]+a[1]*d[1]+a[2]*d[2]+a[3]*d[3]};b.lerp=function(a,d,b,c){var e=d[0],n=d[1],k=d[2];d=d[3];a[0]=e+c*(b[0]-e);a[1]=n+c*(b[1]-n);a[2]=k+c*(b[2]-k);a[3]=d+c*(b[3]-d);return a};b.random=function(a,d){d=d||1;a[0]=l.RANDOM();a[1]=l.RANDOM();a[2]=l.RANDOM();a[3]=l.RANDOM();b.normalize(a,a);b.scale(a,
a,d);return a};b.transformMat4=function(a,d,b){var c=d[0],e=d[1],n=d[2];d=d[3];a[0]=b[0]*c+b[4]*e+b[8]*n+b[12]*d;a[1]=b[1]*c+b[5]*e+b[9]*n+b[13]*d;a[2]=b[2]*c+b[6]*e+b[10]*n+b[14]*d;a[3]=b[3]*c+b[7]*e+b[11]*n+b[15]*d;return a};b.transformQuat=function(a,b,c){var e=b[0],l=b[1],n=b[2],k=c[0],q=c[1],f=c[2];c=c[3];var p=c*e+q*n-f*l,h=c*l+f*e-k*n,u=c*n+k*l-q*e,e=-k*e-q*l-f*n;a[0]=p*c+e*-k+h*-f-u*-q;a[1]=h*c+e*-q+u*-k-p*-f;a[2]=u*c+e*-f+p*-q-h*-k;a[3]=b[3];return a};b.forEach=function(){var a=b.create();
return function(b,c,e,l,n,k){c||(c=4);e||(e=0);for(l=l?Math.min(l*c+e,b.length):b.length;e<l;e+=c)a[0]=b[e],a[1]=b[e+1],a[2]=b[e+2],a[3]=b[e+3],n(a,a,k),b[e]=a[0],b[e+1]=a[1],b[e+2]=a[2],b[e+3]=a[3];return b}}();b.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};b.equals=function(a,b){var c=a[0],e=a[1],g=a[2],n=a[3],k=b[0],q=b[1],f=b[2],p=b[3];return Math.abs(c-k)<=l.EPSILON*Math.max(1,Math.abs(c),
Math.abs(k))&&Math.abs(e-q)<=l.EPSILON*Math.max(1,Math.abs(e),Math.abs(q))&&Math.abs(g-f)<=l.EPSILON*Math.max(1,Math.abs(g),Math.abs(f))&&Math.abs(n-p)<=l.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))};g.exports=b},function(g,c,e){var l=e(11),b={create:function(){var a=new l.ARRAY_TYPE(2);a[0]=0;a[1]=0;return a},clone:function(a){var b=new l.ARRAY_TYPE(2);b[0]=a[0];b[1]=a[1];return b},fromValues:function(a,b){var c=new l.ARRAY_TYPE(2);c[0]=a;c[1]=b;return c},copy:function(a,b){a[0]=b[0];a[1]=b[1];return a},
set:function(a,b,c){a[0]=b;a[1]=c;return a},add:function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];return a},subtract:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];return a}};b.sub=b.subtract;b.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];return a};b.mul=b.multiply;b.divide=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];return a};b.div=b.divide;b.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);return a};b.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);return a};b.min=
function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);return a};b.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);return a};b.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);return a};b.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;return a};b.scaleAndAdd=function(a,b,c,e){a[0]=b[0]+c[0]*e;a[1]=b[1]+c[1]*e;return a};b.distance=function(a,b){var c=b[0]-a[0],e=b[1]-a[1];return Math.sqrt(c*c+e*e)};b.dist=b.distance;b.squaredDistance=function(a,b){var c=
b[0]-a[0],e=b[1]-a[1];return c*c+e*e};b.sqrDist=b.squaredDistance;b.length=function(a){var b=a[0];a=a[1];return Math.sqrt(b*b+a*a)};b.len=b.length;b.squaredLength=function(a){var b=a[0];a=a[1];return b*b+a*a};b.sqrLen=b.squaredLength;b.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];return a};b.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];return a};b.normalize=function(a,b){var c=b[0],e=b[1],c=c*c+e*e;0<c&&(c=1/Math.sqrt(c),a[0]=b[0]*c,a[1]=b[1]*c);return a};b.dot=function(a,b){return a[0]*b[0]+a[1]*
b[1]};b.cross=function(a,b,c){b=b[0]*c[1]-b[1]*c[0];a[0]=a[1]=0;a[2]=b;return a};b.lerp=function(a,b,c,e){var l=b[0];b=b[1];a[0]=l+e*(c[0]-l);a[1]=b+e*(c[1]-b);return a};b.random=function(a,b){b=b||1;var c=2*l.RANDOM()*Math.PI;a[0]=Math.cos(c)*b;a[1]=Math.sin(c)*b;return a};b.transformMat2=function(a,b,c){var e=b[0];b=b[1];a[0]=c[0]*e+c[2]*b;a[1]=c[1]*e+c[3]*b;return a};b.transformMat2d=function(a,b,c){var e=b[0];b=b[1];a[0]=c[0]*e+c[2]*b+c[4];a[1]=c[1]*e+c[3]*b+c[5];return a};b.transformMat3=function(a,
b,c){var e=b[0];b=b[1];a[0]=c[0]*e+c[3]*b+c[6];a[1]=c[1]*e+c[4]*b+c[7];return a};b.transformMat4=function(a,b,c){var e=b[0];b=b[1];a[0]=c[0]*e+c[4]*b+c[12];a[1]=c[1]*e+c[5]*b+c[13];return a};b.forEach=function(){var a=b.create();return function(b,c,e,l,n,k){c||(c=2);e||(e=0);for(l=l?Math.min(l*c+e,b.length):b.length;e<l;e+=c)a[0]=b[e],a[1]=b[e+1],n(a,a,k),b[e]=a[0],b[e+1]=a[1];return b}}();b.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]};
b.equals=function(a,b){var c=a[0],e=a[1],g=b[0],n=b[1];return Math.abs(c-g)<=l.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(e-n)<=l.EPSILON*Math.max(1,Math.abs(e),Math.abs(n))};g.exports=b},function(g,c){function e(a){var b=!1,e=void 0,l=void 0,n=new Promise(function(k,q){function f(a){b||(b=!0,e=void 0,k(a))}function p(a){b||(b=!0,e=void 0,q(a))}function h(a){if(b)try{void 0!==a&&a()}catch(d){}else e=a}try{a(f,p,h)}catch(n){p(n)}l=function(){if(!b){b=!0;if(void 0!==e){try{e()}catch(a){}e=
void 0}q(c.CANCELLED)}}});n.cancel=l;return n}function l(a){if(null!=a){var b=a.cancel;void 0!==b&&b.call(a)}}var b=function(){function a(b,d){for(var c=0;c<d.length;c++){var e=d[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),a=function(){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");}b(a,[{key:"toString",value:function(){return"CancellationError"}}]);
return a}();c.CancellationError=a;c.CANCELLED=new a;c.makeCancellablePromise=e;c.cancelPromise=l;c.callFinally=function(a,b){return e(function(c,e,n){n(function(){l(a)});a.then(function(a){n(void 0);Promise.resolve(b(n)).then(function(){c(a)})},function(a){n(void 0);try{Promise.resolve(b(n)).then(function(){e(a)},e)}catch(d){e(d)}})})};c.cancellableThen=function(a,b){return e(function(e,g,n){var k=!1;n(function(){k=!0;l(a)});a.then(function(a){k?g(c.CANCELLED):(n(void 0),e(b(a,n)))})})}},function(g,
c){c.getRandomHexString=function(){var c=Math.ceil((0>=arguments.length||void 0===arguments[0]?128:arguments[0])/32),l=new Uint32Array(c);crypto.getRandomValues(l);for(var b="",a=0;a<c;++a)b+=("00000000"+l[a].toString(16)).slice(-8);return b};c.getRandomValues=function(c){c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength);for(var l=0,b=c.length;l<b;l+=65536)crypto.getRandomValues(c.subarray(l,Math.min(b,l+65536)))}},function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function d(a,b){v.set(a,b)}var m=
function q(a,b,d){null===a&&(a=Function.prototype);var c=Object.getOwnPropertyDescriptor(a,b);if(void 0===c)return a=Object.getPrototypeOf(a),null===a?void 0:q(a,b,d);if("value"in c)return c.value;b=c.get;return void 0===b?void 0:b.call(d)},r=function(){function a(b,d){for(var c=0;c<d.length;c++){var e=d[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}();g=e(23);var v=new Map;
c.registerRPC=d;e=function(){function b(d){var c=this;a(this,b);this.target=d;this.objects=new Map;this.nextId=0;d.onmessage=function(a){a=a.data;v.get(a.functionName).call(c,a)}}r(b,[{key:"set",value:function(a,b){this.objects.set(a,b)}},{key:"delete",value:function(a){this.objects.delete(a)}},{key:"get",value:function(a){return this.objects.get(a)}},{key:"getRef",value:function(a){var b=this.get(a.id);b.referencedGeneration=a.gen;b.addRef();return b}},{key:"invoke",value:function(a,b,d){b.functionName=
a;this.target.postMessage(b,d)}},{key:"newId",value:function(){return this.nextId++}},{key:"numObjects",get:function(){return this.objects.size}}]);return b}();c.RPC=e;g=function(d){function c(){a(this,c);for(var b=arguments.length,d=Array(b),e=0;e<b;e++)d[e]=arguments[e];var q,b=l(this,(q=Object.getPrototypeOf(c)).call.apply(q,[].concat([this],$jscomp.arrayFromIterable(d))));b.rpc=null;b.rpcId=null;return b}b(c,d);r(c,[{key:"initializeSharedObject",value:function(a){var b=1>=arguments.length||void 0===
arguments[1]?a.newId():arguments[1];this.rpc=a;this.rpcId=b;this.isOwner=!1;a.set(b,this)}},{key:"initializeCounterpart",value:function(a){var b=1>=arguments.length||void 0===arguments[1]?{}:arguments[1];this.initializeSharedObject(a);this.referencedGeneration=this.unreferencedGeneration=0;this.isOwner=!0;b.id=this.rpcId;b.type=this.RPC_TYPE_ID;a.invoke("SharedObject.new",b)}},{key:"dispose",value:function(){m(Object.getPrototypeOf(c.prototype),"dispose",this).call(this)}},{key:"addCounterpartRef",
value:function(){return{id:this.rpcId,gen:++this.referencedGeneration}}},{key:"refCountReachedZero",value:function(){!0===this.isOwner?this.referencedGeneration===this.unreferencedGeneration&&this.ownerDispose():!1===this.isOwner?this.rpc.invoke("SharedObject.refCountReachedZero",{id:this.rpcId,gen:this.referencedGeneration}):m(Object.getPrototypeOf(c.prototype),"refCountReachedZero",this).call(this)}},{key:"ownerDispose",value:function(){var a=this.rpc,b=this.rpcId;m(Object.getPrototypeOf(c.prototype),
"refCountReachedZero",this).call(this);a.delete(b);a.invoke("SharedObject.dispose",{id:b})}},{key:"counterpartRefCountReachedZero",value:function(a){this.unreferencedGeneration=a;0===this.refCount&&a===this.referencedGeneration&&this.ownerDispose()}}]);return c}(g.RefCounted);c.SharedObject=g;g=function(d){function c(b){var d=1>=arguments.length||void 0===arguments[1]?{}:arguments[1];a(this,c);var e=l(this,Object.getPrototypeOf(c).call(this));null!=b&&e.initializeSharedObject(b,d.id);return e}b(c,
d);return c}(g);c.SharedObjectCounterpart=g;d("SharedObject.dispose",function(a){a=this.get(a.id);if(0!==a.refCount)throw Error("Attempted to dispose object with non-zero reference count.");a.disposed();this.delete(a.rpcId);a.rpcId=null;a.rpc=null});d("SharedObject.refCountReachedZero",function(a){this.get(a.id).counterpartRefCountReachedZero(a.gen)});var n=new Map;c.registerSharedObjectOwner=function(a){return function(b){b.prototype.RPC_TYPE_ID=a}};c.registerSharedObject=function(a){return function(b){n.set(a,
b);b.prototype.RPC_TYPE_ID=a}};d("SharedObject.new",function(a){--(new (n.get(a.type))(this,a)).refCount})},function(g,c){var e=function(){function b(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,d,c){d&&b(a.prototype,d);c&&b(a,c);return a}}(),l=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.refCount=1}e(b,[{key:"addRef",
value:function(){++this.refCount;return this}},{key:"dispose",value:function(){0===--this.refCount&&this.refCountReachedZero()}},{key:"refCountReachedZero",value:function(){this.disposed();var a=this.disposers;if(null!=a){for(var b=a.length;0<b;--b){var c=a[b-1];"object"===typeof c?c.dispose():c.call(this)}this.disposers=void 0}}},{key:"disposed",value:function(){}},{key:"registerDisposer",value:function(a){var b=this.disposers;null==b?this.disposers=[a]:b.push(a);return a}},{key:"unregisterDisposer",
value:function(a){var b=this.disposers;if(null!=b){var c=b.indexOf(a);-1!==c&&b.splice(c,1)}return a}},{key:"registerSignalBinding",value:function(a){this.registerDisposer(function(){return a.detach()})}},{key:"registerEventListener",value:function(a,b,c,e){a.addEventListener(b,c,e);this.registerDisposer(function(){return a.removeEventListener(b,c,e)})}},{key:"registerCancellable",value:function(a){this.registerDisposer(function(){a.cancel()});return a}}]);return b}();c.RefCounted=l},function(g,c,
e){function l(a,b,d,e){c.INSTANCE_IDENTIFIERS[a]=d;c.INSTANCE_NAMES[a]=e;d=["https://"+b];for(e=0;9>=e;++e)d.push("https://s"+e+"-"+b);c.INSTANCE_BASE_URLS[a]=d}var b=e(3),a=e(25),d=e(20);c.numPendingRequests=0;c.PRODUCTION_INSTANCE=0;c.INSTANCE_NAMES=[];c.INSTANCE_BASE_URLS=[];c.INSTANCE_IDENTIFIERS=[];c.brainmapsInstanceKey=function(a){return c.INSTANCE_IDENTIFIERS[a]};c.setupBrainmapsInstance=l;l(c.PRODUCTION_INSTANCE,"brainmaps.googleapis.com","prod","Brain Maps");c.makeRequest=function(e,l,g,
n){var k=void 0;return d.makeCancellablePromise(function(d,f,p){function h(p){null===k?--c.numPendingRequests:(k=a.openShardedHttpRequest(c.INSTANCE_BASE_URLS[e],g,l),k.responseType=n,k.setRequestHeader("Authorization",p.tokenType+" "+p.accessToken),k.onloadend=function(){if(null===k)--c.numPendingRequests;else{var e=this.status;200<=e&&300>e?(--c.numPendingRequests,d(this.response)):403===e||401===e?b.getToken(p).then(h):(--c.numPendingRequests,f(a.HttpError.fromXhr(this)))}},k.send())}p(function(){var a=
k;k=null;null!=a&&a.abort()});b.getToken().then(h)})}},function(g,c,e){function l(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function b(a,b){if(Array.isArray(a)){var c=a.length,c=1===c?0:Math.abs(d.simpleStringHash(b))%c;return a[c]+b}return a+
b}var a=function(){function a(b,d){for(var c=0;c<d.length;c++){var e=d[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}(),d=e(26),m=e(20);$jscomp.initSymbol();c.URL_SYMBOL=Symbol("url");$jscomp.initSymbol();c.METHOD_SYMBOL=Symbol("method");var r=function(b){function d(a,b,c,e){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");var h=a+" "+JSON.stringify(b)+
" resulted in HTTP error "+c;e&&(h+=": "+e);var h=h+".",u;u=Object.getPrototypeOf(d).call(this,h);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");u=!u||"object"!==typeof u&&"function"!==typeof u?this:u;u.name="HttpError";u.message=h;u.method=a;u.url=b;u.code=c;u.statusMessage=e;return u}l(d,b);a(d,null,[{key:"fromXhr",value:function(a){return new d(a[c.METHOD_SYMBOL],a[c.URL_SYMBOL],a.status,a.statusText)}}]);return d}(Error);c.HttpError=r;c.openHttpRequest=
function(a){var b=1>=arguments.length||void 0===arguments[1]?"GET":arguments[1],d=new XMLHttpRequest;d[c.METHOD_SYMBOL]=b;d[c.URL_SYMBOL]=a;d.open(b,a);return d};c.pickShard=b;c.openShardedHttpRequest=function(a,d){var e=2>=arguments.length||void 0===arguments[2]?"GET":arguments[2],q=new XMLHttpRequest,f=b(a,d);q[c.METHOD_SYMBOL]=e;q[c.URL_SYMBOL]=f;q.open(e,f);return q};c.sendHttpRequest=function(a,b){a.responseType=b;return m.makeCancellablePromise(function(b,d,c){a.onloadend=function(){var c=this.status;
200<=c&&300>c?b(this.response):d(r.fromXhr(a))};c(function(){a.abort()});a.send()})};c.parseSpecialUrl=function(a){var b=a.match(/^([^:\/]+):\/\/([^\/]+)(\/.*)?$/);if(null===b)throw Error("Invalid URL: "+JSON.stringify(a));return"gs"===b[1]?(a=b[2],[["https://"+a+".storage.googleapis.com","https://storage.googleapis.com/"+a],b[3]]):[[a],""]}},function(g,c){c.simpleStringHash=function(c){for(var l=0,b=c.length,a=0;a<b;++a)l=31*l+c.charCodeAt(a)|0;return l}},function(g,c,e){function l(a,b){if(!(a instanceof
b))throw new TypeError("Cannot call a class as a function");}var b=function(){function a(b,d){for(var c=0;c<d.length;c++){var e=d[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}(),a=e(24);(function(a){a[a.RAW=0]="RAW";a[a.JPEG=1]="JPEG";a[a.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION"})(c.VolumeChunkEncoding||(c.VolumeChunkEncoding={}));var d=c.VolumeChunkEncoding;
g=function(){function c(){l(this,c)}b(c,null,[{key:"stringify",value:function(b){return"brainmaps-"+a.brainmapsInstanceKey(b.instance)+":volume/"+b.volume_id+"/"+b.scaleIndex+"/"+d[b.encoding]}}]);return c}();g.RPC_ID="brainmaps/VolumeChunkSource";c.VolumeSourceParameters=g;g=function(){function d(){l(this,d)}b(d,null,[{key:"stringify",value:function(b){return"brainmaps:"+a.brainmapsInstanceKey(b.instance)+":mesh/"+b.volume_id+"/"+b.mesh_name}}]);return d}();g.RPC_ID="brainmaps/MeshSource";c.MeshSourceParameters=
g},function(g,c,e){function l(a,b){void 0===b&&(b=-1===a.indexOf("/")?":":"/");var d=a.lastIndexOf(b);return-1===d?0:d+1}function b(a,b){var d=l(a,b);return a.substring(d)}function a(a){a=a.match(n);if(null===a||void 0===a[1])throw Error('Data source URL must have the form "<protocol>://<path>".');var b=a[1],d=v.get(b);if(void 0===d)throw Error("Unsupported data source: "+JSON.stringify(b)+".");return[d,a[2],b]}var d=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();
$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var d=[],c=!0,e=!1,u=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var n=a[Symbol.iterator](),l;!(c=(l=n.next()).done)&&(d.push(l.value),!b||d.length!==b);c=!0);}catch(m){e=!0,u=m}finally{try{if(!c&&n["return"])n["return"]()}finally{if(e)throw u;}}return d}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),m=e(29),r=e(20);c.findSourceGroupBasedOnSeparator=l;c.suggestLayerNameBasedOnSeparator=
b;var v=new Map;c.registerDataSourceFactory=function(a,b){v.set(a,b)};var n=/^(?:([a-zA-Z-+_]+):\/\/)?(.*)$/;c.getVolume=function(b){b=a(b);b=d(b,2);return b[0].getVolume(b[1])};c.getMeshSource=function(b,c){var e=2>=arguments.length||void 0===arguments[2]?0:arguments[2],p=a(c),p=d(p,2);return p[0].getMeshSource(b,p[1],e)};c.getSkeletonSource=function(b,c){var e=a(c),e=d(e,2);return e[0].getSkeletonSource(b,e[1])};c.volumeCompleter=function(a){var b=a.match(n),c=b[1];if(void 0===c){for(var b=[],e=
$jscomp.makeIterator(v),h=e.next();!h.done;h=e.next()){var u=d(h.value,2),h=u[0],u=u[1],h=h+"://";h.startsWith(a)&&b.push({value:h,description:u.description})}return Promise.resolve({offset:0,completions:b})}a=v.get(c);return void 0!==a&&(a=a.volumeCompleter,void 0!==a)?r.cancellableThen(a(b[2]),function(a){return m.applyCompletionOffset(c.length+3,a)}):Promise.reject(null)};c.suggestLayerName=function(c){c=a(c);var e=d(c,2);c=e[1];e=e[0].suggestLayerName;return void 0!==e?e(c):b(c)};c.findSourceGroup=
function(b){b=a(b);b=d(b,3);var c=b[2];return(b[0].findSourceGroup||l)(b[1])+c.length+3}},function(g,c){c.applyCompletionOffset=function(c,l){l.offset+=c;return l};c.getPrefixMatches=function(c,l){for(var b=[],a=$jscomp.makeIterator(l),d=a.next();!d.done;d=a.next())d=d.value,d.startsWith(c)&&b.push({value:d});return b};c.getPrefixMatchesWithDescriptions=function(c,l,b,a){var d=[];l=$jscomp.makeIterator(l);for(var m=l.next();!m.done;m=l.next()){var m=m.value,g=b(m);g.startsWith(c)&&d.push({value:g,
description:a(m)})}return d}},function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,
b):a.__proto__=b)}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var d=function C(a,b,d){null===a&&(a=Function.prototype);var c=Object.getOwnPropertyDescriptor(a,b);if(void 0===c)return a=Object.getPrototypeOf(a),null===a?void 0:C(a,b,d);if("value"in c)return c.value;b=c.get;return void 0===b?void 0:b.call(d)},m=function(){function a(b,d){for(var c=0;c<d.length;c++){var e=d[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=
!0);Object.defineProperty(b,e.key,e)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}();g=this&&this.__decorate||function(a,b,d,c){var e=arguments.length,f=3>e?b:null===c?c=Object.getOwnPropertyDescriptor(b,d):c,h;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)f=Reflect.decorate(a,b,d,c);else for(var p=a.length-1;0<=p;p--)if(h=a[p])f=(3>e?h(f):3<e?h(b,d,f):h(b,d))||f;return 3<e&&f&&Object.defineProperty(b,d,f),f};var r=e(31),v=e(32),n=e(35),k=e(36),q=e(74),f=e(9),
p=e(8),h=e(38),u=e(41),A=e(71);e=e(22);var B=function(){function b(){a(this,b);this.tempLightVec=f.vec4.create();this.tempPickID=new Float32Array(4)}m(b,[{key:"defineShader",value:function(a){a.addAttribute("highp vec3","aVertexPosition");a.addAttribute("highp vec3","aVertexNormal");a.addVarying("highp vec3","vColor");a.addUniform("highp vec4","uLightDirection");a.addUniform("highp vec3","uColor");a.addUniform("highp mat4","uModelMatrix");a.addUniform("highp mat4","uProjection");a.addUniform("highp vec4",
"uPickID");a.require(k.perspectivePanelEmit);a.setVertexMain("\ngl_Position = uProjection * (uModelMatrix * vec4(aVertexPosition, 1.0));\nvec3 normal = (uModelMatrix * vec4(aVertexNormal, 0.0)).xyz;\nfloat lightingFactor = abs(dot(normal, uLightDirection.xyz)) + uLightDirection.w;\nvColor = lightingFactor * uColor;\n");a.setFragmentMain("emit(vec4(vColor, 1.0), uPickID);")}},{key:"beginLayer",value:function(a,b,d){var c=d.dataToDevice,e=d.lightDirection,h=d.ambientLighting;d=d.directionalLighting;
a.uniformMatrix4fv(b.uniform("uProjection"),!1,c);c=this.tempLightVec;f.vec3.scale(c,e,d);c[3]=h;a.uniform4fv(b.uniform("uLightDirection"),c)}},{key:"beginObject",value:function(a,b,d,c,e){a.uniformMatrix4fv(b.uniform("uModelMatrix"),!1,d);a.uniform4fv(b.uniform("uPickID"),A.setVec4FromUint32(this.tempPickID,e));a.uniform3fv(b.uniform("uColor"),c)}},{key:"getShader",value:function(a){var b=this;return a.memoize.get("mesh/MeshShaderManager",function(){var d=new u.ShaderBuilder(a);b.defineShader(d);
return d.build()})}},{key:"drawFragment",value:function(a,b,d){d.vertexBuffer.bindToVertexAttrib(b.attribute("aVertexPosition"),3);d.normalBuffer.bindToVertexAttrib(b.attribute("aVertexNormal"),3);d.indexBuffer.bind();a.drawElements(a.TRIANGLES,d.numIndices,a.UNSIGNED_INT,0)}},{key:"endLayer",value:function(a,b){a.disableVertexAttribArray(b.attribute("aVertexPosition"));a.disableVertexAttribArray(b.attribute("aVertexNormal"))}}]);return b}();c.MeshShaderManager=B;var y=function(d){function c(b,d,
e){a(this,c);var f=l(this,Object.getPrototypeOf(c).call(this));f.chunkManager=b;f.source=d;f.displayState=e;f.meshShaderManager=new B;f.shader=f.registerDisposer(f.meshShaderManager.getShader(f.gl));q.registerRedrawWhenSegmentationDisplayStateChanged(e,f);b=f.registerDisposer(new q.SegmentationLayerSharedObject(b,e));b.RPC_TYPE_ID=n.MESH_LAYER_RPC_ID;b.initializeCounterpartWithChunkManager({source:d.addCounterpartRef()});f.setReady(!0);return f}b(c,d);m(c,[{key:"draw",value:function(a){var b=this,
d=this.gl,c=this.shader,e=this.displayState,h=this.meshShaderManager;c.bind();h.beginLayer(d,c,a);var p=a.pickIDs,t=f.identityMat4;q.forEachSegmentToDraw(e,this.source.fragmentSource.objectChunks,function(a,f,C){h.beginObject(d,c,t,q.getObjectColor(e,a),p.register(b,f));a=$jscomp.makeIterator(C);for(f=a.next();!f.done;f=a.next())f=f.value,f.state===r.ChunkState.GPU_MEMORY&&h.drawFragment(d,c,f)});h.endLayer(d,c)}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}]);return c}(k.PerspectiveViewRenderLayer);
c.MeshLayer=y;var x=function(c){function e(b,d){a(this,e);var c=l(this,Object.getPrototypeOf(e).call(this,b));c.objectKey=d.objectKey;c.vertexPositions=d.vertexPositions;var f=c.indices=d.indices;c.numIndices=f.length;c.vertexNormals=d.vertexNormals;return c}b(e,c);m(e,[{key:"copyToGPU",value:function(a){d(Object.getPrototypeOf(e.prototype),"copyToGPU",this).call(this,a);this.vertexBuffer=h.Buffer.fromData(a,this.vertexPositions,a.ARRAY_BUFFER,a.STATIC_DRAW);this.indexBuffer=h.Buffer.fromData(a,this.indices,
a.ELEMENT_ARRAY_BUFFER,a.STATIC_DRAW);this.normalBuffer=h.Buffer.fromData(a,this.vertexNormals,a.ARRAY_BUFFER,a.STATIC_DRAW)}},{key:"freeGPUMemory",value:function(a){d(Object.getPrototypeOf(e.prototype),"freeGPUMemory",this).call(this,a);this.vertexBuffer.dispose();this.indexBuffer.dispose();this.normalBuffer.dispose()}}]);return e}(v.Chunk);c.FragmentChunk=x;var t=function(c){function e(b,d){a(this,e);var c=l(this,Object.getPrototypeOf(e).call(this,b));c.meshSource=d;c.objectChunks=new Map;return c}
b(e,c);m(e,[{key:"addChunk",value:function(a,b){d(Object.getPrototypeOf(e.prototype),"addChunk",this).call(this,a,b);var c=this.objectChunks,f=b.objectKey,h=c.get(f);void 0===h&&(h=new Set,c.set(f,h));h.add(b)}},{key:"deleteChunk",value:function(a){var b=this.chunks.get(a);d(Object.getPrototypeOf(e.prototype),"deleteChunk",this).call(this,a);a=this.objectChunks;var c=b.objectKey,f=a.get(c);f.delete(b);0===f.size&&a.delete(c)}},{key:"getChunk",value:function(a){return new x(this,a)}}]);return e}(v.ChunkSource),
t=g([e.registerSharedObjectOwner(n.FRAGMENT_SOURCE_RPC_ID)],t);c.FragmentSource=t;var z=function(c){function e(){a(this,e);for(var b=arguments.length,d=Array(b),c=0;c<b;c++)d[c]=arguments[c];var f,b=l(this,(f=Object.getPrototypeOf(e)).call.apply(f,[].concat([this],$jscomp.arrayFromIterable(d))));b.fragmentSource=new t(b.chunkManager,b);return b}b(e,c);m(e,[{key:"initializeCounterpart",value:function(a,b){this.fragmentSource.initializeCounterpart(this.chunkManager.rpc,{});b.fragmentSource=this.fragmentSource.addCounterpartRef();
d(Object.getPrototypeOf(e.prototype),"initializeCounterpart",this).call(this,a,b)}}]);return e}(v.ChunkSource);c.MeshSource=z;c.defineParameterizedMeshSource=function(c){var e=function(e){function f(b,d){a(this,f);var c=l(this,Object.getPrototypeOf(f).call(this,b));c.parameters=d;return c}b(f,e);m(f,[{key:"initializeCounterpart",value:function(a,b){b.parameters=this.parameters;d(Object.getPrototypeOf(f.prototype),"initializeCounterpart",this).call(this,a,b)}},{key:"toString",value:function(){return c.stringify(this.parameters)}}],
[{key:"get",value:function(a,b){var d=this;return a.getChunkSource(this,p.stableStringify(b),function(){return new d(a,b)})}}]);return f}(z);e.prototype.RPC_TYPE_ID=c.RPC_ID;return e}},function(g,c){var e=function(){function b(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,d,c){d&&b(a.prototype,d);c&&b(a,c);return a}}();(function(b){b[b.GPU_MEMORY=0]="GPU_MEMORY";b[b.SYSTEM_MEMORY=
1]="SYSTEM_MEMORY";b[b.SYSTEM_MEMORY_WORKER=2]="SYSTEM_MEMORY_WORKER";b[b.DOWNLOADING=3]="DOWNLOADING";b[b.QUEUED=4]="QUEUED";b[b.NEW=5]="NEW";b[b.FAILED=6]="FAILED";b[b.EXPIRED=7]="EXPIRED"})(c.ChunkState||(c.ChunkState={}));(function(b){b[b.FIRST_TIER=0]="FIRST_TIER";b[b.FIRST_ORDERED_TIER=0]="FIRST_ORDERED_TIER";b[b.VISIBLE=0]="VISIBLE";b[b.PREFETCH=1]="PREFETCH";b[b.LAST_ORDERED_TIER=1]="LAST_ORDERED_TIER";b[b.RECENT=2]="RECENT";b[b.LAST_TIER=2]="LAST_TIER"})(c.ChunkPriorityTier||(c.ChunkPriorityTier=
{}));var l=function(){function b(a,d){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.itemCapacity=this.availableItems=a;this.sizeCapacity=this.availableSize=d}e(b,[{key:"adjust",value:function(a,b){this.availableItems+=a;this.availableSize+=b}},{key:"toString",value:function(){return this.availableItems+"/"+this.itemCapacity+" items, "+this.availableSize+"/"+this.sizeCapacity+" size"}},{key:"toObject",value:function(){return{itemCapacity:this.itemCapacity,sizeCapacity:this.sizeCapacity}}}],
[{key:"fromObject",value:function(a){return new b(a.itemCapacity,a.sizeCapacity)}}]);return b}();l.INFINITE=new l(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);c.AvailableCapacity=l;c.CHUNK_QUEUE_MANAGER_RPC_ID="ChunkQueueManager";c.CHUNK_MANAGER_RPC_ID="ChunkManager"},function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==
b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var d=function f(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),
null===a?void 0:f(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},m=function(){function a(b,d){for(var c=0;c<d.length;c++){var e=d[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}();g=this&&this.__decorate||function(a,b,d,c){var e=arguments.length,k=3>e?b:null===c?c=Object.getOwnPropertyDescriptor(b,d):c,n;if("object"===typeof Reflect&&"function"===
typeof Reflect.decorate)k=Reflect.decorate(a,b,d,c);else for(var l=a.length-1;0<=l;l--)if(n=a[l])k=(3>e?n(k):3<e?n(b,d,k):n(b,d))||k;return 3<e&&k&&Object.defineProperty(b,d,k),k};var r=e(31),v=e(33),n=e(22),k=e(34);e=function(){function b(d){a(this,b);this.source=d;this.state=r.ChunkState.SYSTEM_MEMORY}m(b,[{key:"copyToGPU",value:function(a){this.state=r.ChunkState.GPU_MEMORY}},{key:"freeGPUMemory",value:function(a){this.state=r.ChunkState.SYSTEM_MEMORY}},{key:"gl",get:function(){return this.source.gl}}]);
return b}();c.Chunk=e;e=function(d){function c(b,d,e){a(this,c);var f=l(this,Object.getPrototypeOf(c).call(this));f.gl=d;f.visibleChunksChanged=new k.Signal;f.pendingChunkUpdates=null;f.pendingChunkUpdatesTail=null;f.chunkUpdateDeadline=null;f.chunkUpdateDelay=30;f.initializeCounterpart(b,{gpuMemoryCapacity:e.gpuMemory.toObject(),systemMemoryCapacity:e.systemMemory.toObject(),downloadCapacity:e.download.toObject()});return f}b(c,d);m(c,[{key:"scheduleChunkUpdate",value:function(){var a=this.chunkUpdateDeadline,
b=void 0,b=null===a||Date.now()<a?0:this.chunkUpdateDelay;setTimeout(this.processPendingChunkUpdates.bind(this),b)}},{key:"processPendingChunkUpdates",value:function(){var a=this.chunkUpdateDeadline;if(null!==a&&Date.now()>a)setTimeout(this.processPendingChunkUpdates.bind(this),this.chunkUpdateDelay);else{var a=this.pendingChunkUpdates,b=this.rpc.get(a.source),d=a.state;if(d===r.ChunkState.EXPIRED)b.deleteChunk(a.id);else{var c=void 0,e=a.id;a["new"]?(c=b.getChunk(a),b.addChunk(e,c)):c=b.chunks.get(e);
if(d!==c.state)switch(d){case r.ChunkState.GPU_MEMORY:c.copyToGPU(this.gl);this.visibleChunksChanged.dispatch();break;case r.ChunkState.SYSTEM_MEMORY:c.freeGPUMemory(this.gl);break;default:throw Error("INTERNAL ERROR: Invalid chunk state: "+r.ChunkState[d]);}}null!=(this.pendingChunkUpdates=a.nextUpdate)?this.scheduleChunkUpdate():this.pendingChunkUpdatesTail=null}}}]);return c}(n.SharedObject);e=g([n.registerSharedObjectOwner(r.CHUNK_QUEUE_MANAGER_RPC_ID)],e);c.ChunkQueueManager=e;n.registerRPC("Chunk.update",
function(a){var b=this.get(a.source).chunkManager.chunkQueueManager,c=b.pendingChunkUpdatesTail;null==c?(b.pendingChunkUpdates=a,b.pendingChunkUpdatesTail=a,b.scheduleChunkUpdate()):(c.nextUpdate=a,b.pendingChunkUpdatesTail=a)});e=function(c){function d(b){a(this,d);var c=l(this,Object.getPrototypeOf(d).call(this));c.chunkQueueManager=b;c.chunkSourceCache=new Map;c.registerDisposer(b.addRef());c.initializeCounterpart(b.rpc,{chunkQueueManager:b.rpcId});return c}b(d,c);m(d,[{key:"getChunkSource",value:function(a,
b,c){var d=this.chunkSourceCache,e=d.get(a);void 0===e&&(e=new v.Memoize,d.set(a,e));return e.get(b,function(){var a=c();a.initializeCounterpart(a.chunkManager.rpc,{});return a})}}]);return d}(n.SharedObject);e=g([n.registerSharedObjectOwner(r.CHUNK_MANAGER_RPC_ID)],e);c.ChunkManager=e;g=function(c){function e(b){a(this,e);var c=l(this,Object.getPrototypeOf(e).call(this));c.chunkManager=b;c.chunks=new Map;c.registerDisposer(b.addRef());return c}b(e,c);m(e,[{key:"initializeCounterpart",value:function(a,
b){b.chunkManager=this.chunkManager.rpcId;d(Object.getPrototypeOf(e.prototype),"initializeCounterpart",this).call(this,a,b)}},{key:"deleteChunk",value:function(a){this.chunks.delete(a)}},{key:"addChunk",value:function(a,b){this.chunks.set(a,b)}},{key:"getChunk",value:function(a){throw Error("Not implemented.");}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}]);return e}(n.SharedObject);c.ChunkSource=g},function(g,c){var e=function(){function b(a,b){for(var c=0;c<b.length;c++){var e=
b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,c,e){c&&b(a.prototype,c);e&&b(a,e);return a}}(),l=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.map=new Map}e(b,[{key:"get",value:function(a,b){var c=this.map,e=c.get(a);void 0===e?(e=b(),e.registerDisposer(function(){c.delete(a)}),c.set(a,e)):e.addRef();return e}}]);return b}();c.Memoize=l},function(g,
c,e){var l;(function(b){function a(a,b,c,d,e){this._listener=b;this._isOnce=c;this.context=d;this._signal=a;this._priority=e||0}function d(a,b){if("function"!==typeof a)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b));}function m(){this._bindings=[];this._prevParams=null;var a=this;this.dispatch=function(){m.prototype.dispatch.apply(a,arguments)}}a.prototype={active:!0,params:null,execute:function(a){var b;this.active&&this._listener&&(a=this.params?
this.params.concat(a):a,b=this._listener.apply(this.context,a),this._isOnce&&this.detach());return b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[SignalBinding isOnce:"+
this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};m.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(b,c,d,e){var q=this._indexOfListener(b,d);if(-1!==q){if(b=this._bindings[q],b.isOnce()!==c)throw Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.");}else b=new a(this,b,c,d,e),this._addBinding(b);this.memorize&&this._prevParams&&b.execute(this._prevParams);
return b},_addBinding:function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){for(var c=this._bindings.length,d;c--;)if(d=this._bindings[c],d._listener===a&&d.context===b)return c;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){d(a,"add");return this._registerListener(a,!1,b,c)},addOnce:function(a,b,c){d(a,"addOnce");return this._registerListener(a,
!0,b,c)},remove:function(a,b){d(a,"remove");var c=this._indexOfListener(a,b);-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1));return a},removeAll:function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(a){if(this.active){var b=Array.prototype.slice.call(arguments),c=this._bindings.length,d;this.memorize&&(this._prevParams=
b);if(c){d=this._bindings.slice();this._shouldPropagate=!0;do c--;while(d[c]&&this._shouldPropagate&&!1!==d[c].execute(b))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};m.Signal=m;!(l=function(){return m}.call(c,e,c,g),void 0!==l&&(g.exports=l))})(this)},function(g,c){c.MESH_LAYER_RPC_ID="mesh/MeshLayer";c.FRAGMENT_SOURCE_RPC_ID=
"mesh/FragmentSource"},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,
enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function d(a){a.addFragmentExtension("GL_EXT_draw_buffers");a.addFragmentCode(c.glsl_perspectivePanelEmit)}var m=function C(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:C(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},r=function(){function a(b,c){for(var d=
0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),v=e(37);g=e(42);var n=e(42),k=e(53),q=e(54),f=e(59),p=e(69),h=e(9),u=e(70),A=e(67),B=e(71);e(72);e(73);var y=function(c){function d(){l(this,d);return b(this,Object.getPrototypeOf(d).apply(this,arguments))}a(d,c);r(d,[{key:"draw",value:function(a){}},{key:"drawPicking",value:function(a){}}]);return d}(g.RenderLayer);
c.PerspectiveViewRenderLayer=y;(function(a){a[a.COLOR=0]="COLOR";a[a.Z=1]="Z";a[a.PICK=2]="PICK";a[a.NUM_TEXTURES=3]="NUM_TEXTURES"})(c.OffscreenTextures||(c.OffscreenTextures={}));var x=c.OffscreenTextures;c.glsl_perspectivePanelEmit=[B.glsl_packFloat01ToFixedPoint,"\nvoid emit(vec4 color, vec4 pickId) {\n  gl_FragData["+x.COLOR+"] = color;\n  gl_FragData["+x.Z+"] = packFloat01ToFixedPoint(1.0 - gl_FragCoord.z);\n  gl_FragData["+x.PICK+"] = pickId;\n}\n"];c.perspectivePanelEmit=d;var t=h.vec3.create(),
z=h.mat4.create();e=function(c){function e(a,c,t){l(this,e);var q=b(this,Object.getPrototypeOf(e).call(this,a,c,t));q.visibleLayerTracker=q.registerDisposer(new n.VisibleRenderLayerTracker(q.viewer.layerManager,y,function(a){a.redrawNeeded.add(q.scheduleRedraw,q);q.scheduleRedraw()},function(a){a.redrawNeeded.remove(q.scheduleRedraw,q);q.scheduleRedraw()}));q.sliceViews=new Set;q.projectionMat=h.mat4.create();q.inverseProjectionMat=h.mat4.create();q.modelViewMat=h.mat4.create();q.width=0;q.height=
0;q.pickIDs=new k.PickIDManager;q.axesLineHelper=q.registerDisposer(v.AxesLineHelper.get(q.gl));q.sliceViewRenderHelper=q.registerDisposer(f.SliceViewRenderHelper.get(q.gl,"SliceViewRenderHelper:PerspectivePanel",d));q.offscreenFramebuffer=new A.OffscreenFramebuffer(q.gl,{numDataBuffers:x.NUM_TEXTURES,depthBuffer:!0,stencilBuffer:!0});q.offscreenCopyHelper=A.OffscreenCopyHelper.get(q.gl);q.registerSignalBinding(q.navigationState.changed.add(function(){q.viewportChanged()}));a=q.registerDisposer(new p.TrackableBooleanCheckbox(t.showSliceViews));
a.element.className="perspective-panel-show-slice-views noselect";c=document.createElement("label");c.className="perspective-panel-show-slice-views noselect";c.appendChild(document.createTextNode("Slices"));c.appendChild(a.element);q.element.appendChild(c);q.registerSignalBinding(t.showSliceViews.changed.add(function(){q.scheduleRedraw()}));q.registerSignalBinding(t.showAxisLines.changed.add(function(){q.scheduleRedraw()}));return q}a(e,c);r(e,[{key:"updateProjectionMatrix",value:function(){var a=
this.projectionMat;h.mat4.perspective(a,Math.PI/4,this.width/this.height,10,5E3);var b=this.modelViewMat;this.navigationState.toMat4(b);h.vec3.set(t,1,-1,-1);h.mat4.scale(b,b,t);var c=h.vec3.set(t,0,0,100);h.mat4.translate(b,b,c);h.mat4.invert(z,b);h.mat4.multiply(a,a,z);h.mat4.invert(this.inverseProjectionMat,a)}},{key:"viewportChanged",value:function(){this.context.scheduleRedraw()}},{key:"onResize",value:function(){this.width=this.element.clientWidth;this.height=this.element.clientHeight;this.viewportChanged()}},
{key:"disposed",value:function(){for(var a=$jscomp.makeIterator(this.sliceViews),b=a.next();!b.done;b=a.next())b.value.dispose();this.sliceViews.clear();m(Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}},{key:"updateMouseState",value:function(a){a.pickedRenderLayer=null;if(!this.navigationState.valid)return!1;var b=a.position,c=this.offscreenFramebuffer,d=this.width,e=this.height;if(!c.hasSize(d,e))return!1;var f=this.mouseX,q=e-this.mouseY,t=c.readPixel(x.Z,f,q),t=1-B.unpackFloat01FromFixedPoint(t);
if(1===t)return!1;b[0]=2*f/d-1;b[1]=2*q/e-1;b[2]=2*t-1;h.vec3.transformMat4(b,b,this.inverseProjectionMat);this.pickIDs.setMouseState(a,c.readPixelAsUint32(x.PICK,f,q));return!0}},{key:"onMousedown",value:function(a){if(a.target===this.element&&(m(Object.getPrototypeOf(e.prototype),"onMousedown",this).call(this,a),this.navigationState.valid&&0===a.button)){var b=this;u.startRelativeMouseDrag(a,function(a,c,d){b.navigationState.pose.rotateRelative(h.kAxes[1],-c/4*Math.PI/180);b.navigationState.pose.rotateRelative(h.kAxes[0],
d/4*Math.PI/180);b.viewer.navigationState.changed.dispatch()})}}},{key:"draw",value:function(){var a=this.width,b=this.height;if(this.navigationState.valid&&0!==a&&0!==b){for(var c=$jscomp.makeIterator(this.sliceViews),d=c.next();!d.done;d=c.next())d.value.updateRendering();c=this.gl;this.offscreenFramebuffer.bind(a,b);c.disable(c.SCISSOR_TEST);this.gl.clearColor(0,0,0,0);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT);c.enable(c.DEPTH_TEST);b=this.projectionMat;this.updateProjectionMatrix();d=h.vec4.create();
h.vec4.transformMat4(d,h.kAxes[2],this.modelViewMat);h.vec4.normalize(d,d);a=this.pickIDs;a.clear();for(var a={dataToDevice:b,lightDirection:d.subarray(0,3),ambientLighting:.2,directionalLighting:.8,pickIDs:a},e=this.visibleLayerTracker.getVisibleLayers(),f=$jscomp.makeIterator(e),q=f.next();!q.done;q=f.next())q.value.draw(a);if(this.viewer.showSliceViews.value)for(var f=this.sliceViewRenderHelper,q=$jscomp.makeIterator(this.sliceViews),t=q.next();!t.done;t=q.next()){var t=t.value,p=.2+.8*Math.abs(h.vec3.dot(d,
t.viewportAxes[2])),k=z;h.mat4.identity(k);k[0]=t.width/2;k[5]=-t.height/2;h.mat4.multiply(k,t.viewportToData,k);h.mat4.multiply(k,b,k);f.draw(t.offscreenFramebuffer.dataTextures[0],k,h.vec4.fromValues(p,p,p,1),h.vec4.fromValues(.5,.5,.5,1),0,0,1,1)}this.viewer.showAxisLines.value&&(h.mat4.identity(z),z[0]=1600,z[5]=1600,z[10]=1600,d=this.navigationState.position.spatialCoordinates,z[12]=d[0],z[13]=d[1],z[14]=d[2],z[15]=1,h.mat4.multiply(z,b,z),c.WEBGL_draw_buffers.drawBuffersWEBGL([c.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL]),
this.axesLineHelper.draw(z,!1));c.WEBGL_draw_buffers.drawBuffersWEBGL([c.NONE,c.WEBGL_draw_buffers.COLOR_ATTACHMENT1_WEBGL,c.WEBGL_draw_buffers.COLOR_ATTACHMENT2_WEBGL]);b=$jscomp.makeIterator(e);for(d=b.next();!d.done;d=b.next())d.value.drawPicking(a);c.disable(c.DEPTH_TEST);this.offscreenFramebuffer.unbind();this.setGLViewport();this.offscreenCopyHelper.draw(this.offscreenFramebuffer.dataTextures[x.COLOR])}}},{key:"zoomByMouse",value:function(a){this.navigationState.zoomBy(a)}},{key:"navigationState",
get:function(){return this.viewer.navigationState}}]);return e}(q.RenderedDataPanel);c.PerspectivePanel=e},function(g,c,e){function l(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var b=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=
c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(23);var a=e(38),d=e(40);e=function(c){function e(b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var c;c=Object.getPrototypeOf(e).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==typeof c&&"function"!==typeof c?
this:c;c.gl=b;c.vertexBuffer=c.registerDisposer(a.Buffer.fromData(b,new Float32Array([0,0,0,1,1,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,1,1]),b.ARRAY_BUFFER,b.STATIC_DRAW));c.colorBuffer=c.registerDisposer(a.Buffer.fromData(b,new Float32Array([1,0,0,.5,1,0,0,.5,0,1,0,.5,0,1,0,.5,0,0,1,.5,0,0,1,.5]),b.ARRAY_BUFFER,b.STATIC_DRAW));c.trivialColorShader=c.registerDisposer(d.trivialColorShader(b));return c}l(e,c);b(e,[{key:"draw",value:function(a){var b=1>=arguments.length||void 0===arguments[1]?!0:arguments[1],
c=this.trivialColorShader,d=this.gl;c.bind();d.uniformMatrix4fv(c.uniform("uProjectionMatrix"),!1,a);var e=c.attribute("aVertexPosition");this.vertexBuffer.bindToVertexAttrib(e,4);c=c.attribute("aColor");this.colorBuffer.bindToVertexAttrib(c,4);b&&(d.colorMask(!1,!1,!1,!0),d.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT),d.colorMask(!0,!0,!0,!0),d.enable(d.BLEND),d.blendFunc(d.ONE_MINUS_DST_ALPHA,d.DST_ALPHA));d.lineWidth(1);d.drawArrays(d.LINES,0,6);b&&d.disable(d.BLEND);d.disableVertexAttribArray(e);
d.disableVertexAttribArray(c)}}],[{key:"get",value:function(a){return a.memoize.get("SliceViewPanel:AxesLineHelper",function(){return new e(a)})}}]);return e}(g.RefCounted);c.AxesLineHelper=e},function(g,c,e){var l=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),b=e(39);g=function(){function a(c){var e=1>=
arguments.length||void 0===arguments[1]?b.GL_ARRAY_BUFFER:arguments[1];if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.gl=c;this.bufferType=e;this.gl=c;this.buffer=c.createBuffer()}l(a,[{key:"bind",value:function(){this.gl.bindBuffer(this.bufferType,this.buffer)}},{key:"bindToVertexAttrib",value:function(a,c){var e=2>=arguments.length||void 0===arguments[2]?b.GL_FLOAT:arguments[2],l=3>=arguments.length||void 0===arguments[3]?!1:arguments[3],n=4>=arguments.length||
void 0===arguments[4]?0:arguments[4],k=5>=arguments.length||void 0===arguments[5]?0:arguments[5];this.bind();this.gl.enableVertexAttribArray(a);this.gl.vertexAttribPointer(a,c,e,l,n,k)}},{key:"setData",value:function(a){var c=1>=arguments.length||void 0===arguments[1]?b.GL_STATIC_DRAW:arguments[1],e=this.gl;this.bind();e.bufferData(this.bufferType,a,c)}},{key:"dispose",value:function(){this.gl.deleteBuffer(this.buffer);this.gl=this.buffer=void 0}}],[{key:"fromData",value:function(b,c,e,l){b=new a(b,
e);b.setData(c,l);return b}}]);return a}();c.Buffer=g},function(g,c){c.GL_DEPTH_BUFFER_BIT=256;c.GL_STENCIL_BUFFER_BIT=1024;c.GL_COLOR_BUFFER_BIT=16384;c.GL_POINTS=0;c.GL_LINES=1;c.GL_LINE_LOOP=2;c.GL_LINE_STRIP=3;c.GL_TRIANGLES=4;c.GL_TRIANGLE_STRIP=5;c.GL_TRIANGLE_FAN=6;c.GL_ZERO=0;c.GL_ONE=1;c.GL_SRC_COLOR=768;c.GL_ONE_MINUS_SRC_COLOR=769;c.GL_SRC_ALPHA=770;c.GL_ONE_MINUS_SRC_ALPHA=771;c.GL_DST_ALPHA=772;c.GL_ONE_MINUS_DST_ALPHA=773;c.GL_DST_COLOR=774;c.GL_ONE_MINUS_DST_COLOR=775;c.GL_SRC_ALPHA_SATURATE=
776;c.GL_FUNC_ADD=32774;c.GL_BLEND_EQUATION=32777;c.GL_BLEND_EQUATION_RGB=32777;c.GL_BLEND_EQUATION_ALPHA=34877;c.GL_FUNC_SUBTRACT=32778;c.GL_FUNC_REVERSE_SUBTRACT=32779;c.GL_BLEND_DST_RGB=32968;c.GL_BLEND_SRC_RGB=32969;c.GL_BLEND_DST_ALPHA=32970;c.GL_BLEND_SRC_ALPHA=32971;c.GL_CONSTANT_COLOR=32769;c.GL_ONE_MINUS_CONSTANT_COLOR=32770;c.GL_CONSTANT_ALPHA=32771;c.GL_ONE_MINUS_CONSTANT_ALPHA=32772;c.GL_BLEND_COLOR=32773;c.GL_ARRAY_BUFFER=34962;c.GL_ELEMENT_ARRAY_BUFFER=34963;c.GL_ARRAY_BUFFER_BINDING=
34964;c.GL_ELEMENT_ARRAY_BUFFER_BINDING=34965;c.GL_STREAM_DRAW=35040;c.GL_STATIC_DRAW=35044;c.GL_DYNAMIC_DRAW=35048;c.GL_BUFFER_SIZE=34660;c.GL_BUFFER_USAGE=34661;c.GL_CURRENT_VERTEX_ATTRIB=34342;c.GL_FRONT=1028;c.GL_BACK=1029;c.GL_FRONT_AND_BACK=1032;c.GL_CULL_FACE=2884;c.GL_BLEND=3042;c.GL_DITHER=3024;c.GL_STENCIL_TEST=2960;c.GL_DEPTH_TEST=2929;c.GL_SCISSOR_TEST=3089;c.GL_POLYGON_OFFSET_FILL=32823;c.GL_SAMPLE_ALPHA_TO_COVERAGE=32926;c.GL_SAMPLE_COVERAGE=32928;c.GL_NO_ERROR=0;c.GL_INVALID_ENUM=1280;
c.GL_INVALID_VALUE=1281;c.GL_INVALID_OPERATION=1282;c.GL_OUT_OF_MEMORY=1285;c.GL_CW=2304;c.GL_CCW=2305;c.GL_LINE_WIDTH=2849;c.GL_ALIASED_POINT_SIZE_RANGE=33901;c.GL_ALIASED_LINE_WIDTH_RANGE=33902;c.GL_CULL_FACE_MODE=2885;c.GL_FRONT_FACE=2886;c.GL_DEPTH_RANGE=2928;c.GL_DEPTH_WRITEMASK=2930;c.GL_DEPTH_CLEAR_VALUE=2931;c.GL_DEPTH_FUNC=2932;c.GL_STENCIL_CLEAR_VALUE=2961;c.GL_STENCIL_FUNC=2962;c.GL_STENCIL_FAIL=2964;c.GL_STENCIL_PASS_DEPTH_FAIL=2965;c.GL_STENCIL_PASS_DEPTH_PASS=2966;c.GL_STENCIL_REF=2967;
c.GL_STENCIL_VALUE_MASK=2963;c.GL_STENCIL_WRITEMASK=2968;c.GL_STENCIL_BACK_FUNC=34816;c.GL_STENCIL_BACK_FAIL=34817;c.GL_STENCIL_BACK_PASS_DEPTH_FAIL=34818;c.GL_STENCIL_BACK_PASS_DEPTH_PASS=34819;c.GL_STENCIL_BACK_REF=36003;c.GL_STENCIL_BACK_VALUE_MASK=36004;c.GL_STENCIL_BACK_WRITEMASK=36005;c.GL_VIEWPORT=2978;c.GL_SCISSOR_BOX=3088;c.GL_COLOR_CLEAR_VALUE=3106;c.GL_COLOR_WRITEMASK=3107;c.GL_UNPACK_ALIGNMENT=3317;c.GL_PACK_ALIGNMENT=3333;c.GL_MAX_TEXTURE_SIZE=3379;c.GL_MAX_VIEWPORT_DIMS=3386;c.GL_SUBPIXEL_BITS=
3408;c.GL_RED_BITS=3410;c.GL_GREEN_BITS=3411;c.GL_BLUE_BITS=3412;c.GL_ALPHA_BITS=3413;c.GL_DEPTH_BITS=3414;c.GL_STENCIL_BITS=3415;c.GL_POLYGON_OFFSET_UNITS=10752;c.GL_POLYGON_OFFSET_FACTOR=32824;c.GL_TEXTURE_BINDING_2D=32873;c.GL_SAMPLE_BUFFERS=32936;c.GL_SAMPLES=32937;c.GL_SAMPLE_COVERAGE_VALUE=32938;c.GL_SAMPLE_COVERAGE_INVERT=32939;c.GL_COMPRESSED_TEXTURE_FORMATS=34467;c.GL_DONT_CARE=4352;c.GL_FASTEST=4353;c.GL_NICEST=4354;c.GL_GENERATE_MIPMAP_HINT=33170;c.GL_BYTE=5120;c.GL_UNSIGNED_BYTE=5121;
c.GL_SHORT=5122;c.GL_UNSIGNED_SHORT=5123;c.GL_INT=5124;c.GL_UNSIGNED_INT=5125;c.GL_FLOAT=5126;c.GL_DEPTH_COMPONENT=6402;c.GL_ALPHA=6406;c.GL_RGB=6407;c.GL_RGBA=6408;c.GL_LUMINANCE=6409;c.GL_LUMINANCE_ALPHA=6410;c.GL_UNSIGNED_SHORT_4_4_4_4=32819;c.GL_UNSIGNED_SHORT_5_5_5_1=32820;c.GL_UNSIGNED_SHORT_5_6_5=33635;c.GL_FRAGMENT_SHADER=35632;c.GL_VERTEX_SHADER=35633;c.GL_MAX_VERTEX_ATTRIBS=34921;c.GL_MAX_VERTEX_UNIFORM_VECTORS=36347;c.GL_MAX_VARYING_VECTORS=36348;c.GL_MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661;
c.GL_MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660;c.GL_MAX_TEXTURE_IMAGE_UNITS=34930;c.GL_MAX_FRAGMENT_UNIFORM_VECTORS=36349;c.GL_SHADER_TYPE=35663;c.GL_DELETE_STATUS=35712;c.GL_LINK_STATUS=35714;c.GL_VALIDATE_STATUS=35715;c.GL_ATTACHED_SHADERS=35717;c.GL_ACTIVE_UNIFORMS=35718;c.GL_ACTIVE_ATTRIBUTES=35721;c.GL_SHADING_LANGUAGE_VERSION=35724;c.GL_CURRENT_PROGRAM=35725;c.GL_NEVER=512;c.GL_LESS=513;c.GL_EQUAL=514;c.GL_LEQUAL=515;c.GL_GREATER=516;c.GL_NOTEQUAL=517;c.GL_GEQUAL=518;c.GL_ALWAYS=519;c.GL_KEEP=7680;
c.GL_REPLACE=7681;c.GL_INCR=7682;c.GL_DECR=7683;c.GL_INVERT=5386;c.GL_INCR_WRAP=34055;c.GL_DECR_WRAP=34056;c.GL_VENDOR=7936;c.GL_RENDERER=7937;c.GL_VERSION=7938;c.GL_NEAREST=9728;c.GL_LINEAR=9729;c.GL_NEAREST_MIPMAP_NEAREST=9984;c.GL_LINEAR_MIPMAP_NEAREST=9985;c.GL_NEAREST_MIPMAP_LINEAR=9986;c.GL_LINEAR_MIPMAP_LINEAR=9987;c.GL_TEXTURE_MAG_FILTER=10240;c.GL_TEXTURE_MIN_FILTER=10241;c.GL_TEXTURE_WRAP_S=10242;c.GL_TEXTURE_WRAP_T=10243;c.GL_TEXTURE_2D=3553;c.GL_TEXTURE=5890;c.GL_TEXTURE_CUBE_MAP=34067;
c.GL_TEXTURE_BINDING_CUBE_MAP=34068;c.GL_TEXTURE_CUBE_MAP_POSITIVE_X=34069;c.GL_TEXTURE_CUBE_MAP_NEGATIVE_X=34070;c.GL_TEXTURE_CUBE_MAP_POSITIVE_Y=34071;c.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y=34072;c.GL_TEXTURE_CUBE_MAP_POSITIVE_Z=34073;c.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z=34074;c.GL_MAX_CUBE_MAP_TEXTURE_SIZE=34076;c.GL_TEXTURE0=33984;c.GL_TEXTURE1=33985;c.GL_TEXTURE2=33986;c.GL_TEXTURE3=33987;c.GL_TEXTURE4=33988;c.GL_TEXTURE5=33989;c.GL_TEXTURE6=33990;c.GL_TEXTURE7=33991;c.GL_TEXTURE8=33992;c.GL_TEXTURE9=
33993;c.GL_TEXTURE10=33994;c.GL_TEXTURE11=33995;c.GL_TEXTURE12=33996;c.GL_TEXTURE13=33997;c.GL_TEXTURE14=33998;c.GL_TEXTURE15=33999;c.GL_TEXTURE16=34E3;c.GL_TEXTURE17=34001;c.GL_TEXTURE18=34002;c.GL_TEXTURE19=34003;c.GL_TEXTURE20=34004;c.GL_TEXTURE21=34005;c.GL_TEXTURE22=34006;c.GL_TEXTURE23=34007;c.GL_TEXTURE24=34008;c.GL_TEXTURE25=34009;c.GL_TEXTURE26=34010;c.GL_TEXTURE27=34011;c.GL_TEXTURE28=34012;c.GL_TEXTURE29=34013;c.GL_TEXTURE30=34014;c.GL_TEXTURE31=34015;c.GL_ACTIVE_TEXTURE=34016;c.GL_REPEAT=
10497;c.GL_CLAMP_TO_EDGE=33071;c.GL_MIRRORED_REPEAT=33648;c.GL_FLOAT_VEC2=35664;c.GL_FLOAT_VEC3=35665;c.GL_FLOAT_VEC4=35666;c.GL_INT_VEC2=35667;c.GL_INT_VEC3=35668;c.GL_INT_VEC4=35669;c.GL_BOOL=35670;c.GL_BOOL_VEC2=35671;c.GL_BOOL_VEC3=35672;c.GL_BOOL_VEC4=35673;c.GL_FLOAT_MAT2=35674;c.GL_FLOAT_MAT3=35675;c.GL_FLOAT_MAT4=35676;c.GL_SAMPLER_2D=35678;c.GL_SAMPLER_CUBE=35680;c.GL_VERTEX_ATTRIB_ARRAY_ENABLED=34338;c.GL_VERTEX_ATTRIB_ARRAY_SIZE=34339;c.GL_VERTEX_ATTRIB_ARRAY_STRIDE=34340;c.GL_VERTEX_ATTRIB_ARRAY_TYPE=
34341;c.GL_VERTEX_ATTRIB_ARRAY_NORMALIZED=34922;c.GL_VERTEX_ATTRIB_ARRAY_POINTER=34373;c.GL_VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975;c.GL_IMPLEMENTATION_COLOR_READ_TYPE=35738;c.GL_IMPLEMENTATION_COLOR_READ_FORMAT=35739;c.GL_COMPILE_STATUS=35713;c.GL_LOW_FLOAT=36336;c.GL_MEDIUM_FLOAT=36337;c.GL_HIGH_FLOAT=36338;c.GL_LOW_INT=36339;c.GL_MEDIUM_INT=36340;c.GL_HIGH_INT=36341;c.GL_FRAMEBUFFER=36160;c.GL_RENDERBUFFER=36161;c.GL_RGBA4=32854;c.GL_RGB5_A1=32855;c.GL_RGB565=36194;c.GL_DEPTH_COMPONENT16=33189;
c.GL_STENCIL_INDEX=6401;c.GL_STENCIL_INDEX8=36168;c.GL_DEPTH_STENCIL=34041;c.GL_RENDERBUFFER_WIDTH=36162;c.GL_RENDERBUFFER_HEIGHT=36163;c.GL_RENDERBUFFER_INTERNAL_FORMAT=36164;c.GL_RENDERBUFFER_RED_SIZE=36176;c.GL_RENDERBUFFER_GREEN_SIZE=36177;c.GL_RENDERBUFFER_BLUE_SIZE=36178;c.GL_RENDERBUFFER_ALPHA_SIZE=36179;c.GL_RENDERBUFFER_DEPTH_SIZE=36180;c.GL_RENDERBUFFER_STENCIL_SIZE=36181;c.GL_FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048;c.GL_FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049;c.GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=
36050;c.GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051;c.GL_COLOR_ATTACHMENT0=36064;c.GL_DEPTH_ATTACHMENT=36096;c.GL_STENCIL_ATTACHMENT=36128;c.GL_DEPTH_STENCIL_ATTACHMENT=33306;c.GL_NONE=0;c.GL_FRAMEBUFFER_COMPLETE=36053;c.GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054;c.GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055;c.GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057;c.GL_FRAMEBUFFER_UNSUPPORTED=36061;c.GL_FRAMEBUFFER_BINDING=36006;c.GL_RENDERBUFFER_BINDING=36007;c.GL_MAX_RENDERBUFFER_SIZE=34024;
c.GL_INVALID_FRAMEBUFFER_OPERATION=1286;c.GL_UNPACK_FLIP_Y_WEBGL=37440;c.GL_UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441;c.GL_CONTEXT_LOST_WEBGL=37442;c.GL_UNPACK_COLORSPACE_CONVERSION_WEBGL=37443;c.GL_BROWSER_DEFAULT_WEBGL=37444},function(g,c,e){var l=e(41);c.trivialTextureShader=function(b){return b.memoize.get("trivialTextureShader",function(){var a=new l.ShaderBuilder(b);a.addVarying("vec2","vTexCoord");a.addUniform("sampler2D","uSampler");a.addUniform("mat4","uProjectionMatrix");a.setFragmentMain("gl_FragColor = texture2D(uSampler, vTexCoord);");
a.addAttribute("vec4","aVertexPosition");a.addAttribute("vec2","aTexCoord");a.setVertexMain("vTexCoord = aTexCoord; gl_Position = uProjectionMatrix * aVertexPosition;");return a.build()})};c.trivialColorShader=function(b){return b.memoize.get("trivialColorShader",function(){var a=new l.ShaderBuilder(b);a.addVarying("vec4","vColor");a.setFragmentMain("gl_FragColor = vColor;");a.addAttribute("vec4","aVertexPosition");a.addAttribute("vec4","aColor");a.addUniform("mat4","uProjectionMatrix");a.setVertexMain("vColor = aColor; gl_Position = uProjectionMatrix * aVertexPosition;");
return a.build()})};c.trivialUniformColorShader=function(b){return b.memoize.get("trivialUniformColorShader",function(){var a=new l.ShaderBuilder(b);a.addUniform("mat4","uProjectionMatrix");a.addAttribute("vec4","aVertexPosition");a.addUniform("vec4","uColor");a.setFragmentMain("gl_FragColor = uColor;");a.setVertexMain("gl_Position = uProjectionMatrix * aVertexPosition;");return a.build()})}},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function d(a){a=a.replace("\x00",
"");var b=[];a=$jscomp.makeIterator(a.split("\n"));for(var c=a.next();!c.done;c=a.next()){var c=c.value,d=c.match(/^ERROR:\s*(\d+):(\d+)\s*(.+)$/);null!==d?b.push({message:d[3].trim(),file:parseInt(d[1],10),line:parseInt(d[2],10)}):(d=c.match(/^ERROR:\s*(.+)$/),null!==d?b.push({message:d[1]}):(c=c.trim())&&b.push({message:c}))}return b}function m(a,b,c){var e=a.createShader(c);a.shaderSource(e,b);a.compileShader(e);if(!a.getShaderParameter(e,a.COMPILE_STATUS))throw a=a.getShaderInfoLog(e)||"",new k(c,
b,a,d(a));return e}var r=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(23);var v=e(39);(function(a){a[a.VERTEX=v.GL_VERTEX_SHADER]="VERTEX";a[a.FRAGMENT=v.GL_FRAGMENT_SHADER]="FRAGMENT"})(c.ShaderType||(c.ShaderType={}));var n=c.ShaderType;c.parseShaderErrors=d;var k=function(c){function d(a,c,e,f){l(this,
d);var t="Error compiling "+n[a].toLowerCase()+" shader: "+e,h=b(this,Object.getPrototypeOf(d).call(this,t));h.name="ShaderCompilationError";h.log=e;h.message=t;h.shaderType=a;h.source=c;h.errorMessages=f;return h}a(d,c);return d}(Error);c.ShaderCompilationError=k;var q=function(c){function d(a,c,e){l(this,d);var f="Error linking shader: "+e,t=b(this,Object.getPrototypeOf(d).call(this,f));t.name="ShaderLinkError";t.log=e;t.message=f;t.vertexSource=a;t.fragmentSource=c;return t}a(d,c);return d}(Error);
c.ShaderLinkError=q;c.getShader=m;var f=function(c){function d(a,c,e,f,t){l(this,d);var h=b(this,Object.getPrototypeOf(d).call(this));h.gl=a;h.vertexSource=c;h.fragmentSource=e;h.attributes=new Map;h.uniforms=new Map;var p=h.vertexShader=m(a,c,a.VERTEX_SHADER),k=h.fragmentShader=m(a,e,a.FRAGMENT_SHADER),n=a.createProgram();a.attachShader(n,p);a.attachShader(n,k);a.linkProgram(n);if(!a.getProgramParameter(n,a.LINK_STATUS))throw a=a.getProgramInfoLog(n)||"",new q(c,e,a);h.program=n;e=h.uniforms;c=h.attributes;
if(f)for(f=$jscomp.makeIterator(f),p=f.next();!p.done;p=f.next())p=p.value,e.set(p,a.getUniformLocation(n,p));if(t)for(t=$jscomp.makeIterator(t),f=t.next();!f.done;f=t.next())f=f.value,c.set(f,a.getAttribLocation(n,f));return h}a(d,c);r(d,[{key:"uniform",value:function(a){return this.uniforms.get(a)}},{key:"attribute",value:function(a){return this.attributes.get(a)}},{key:"textureUnit",value:function(a){return this.textureUnits.get(a)}},{key:"bind",value:function(){this.gl.useProgram(this.program)}},
{key:"disposed",value:function(){var a=this.gl;a.deleteShader(this.vertexShader);this.vertexShader=void 0;a.deleteShader(this.fragmentShader);this.fragmentShader=void 0;a.deleteProgram(this.program);this.uniforms=this.attributes=this.gl=this.program=void 0}}]);return d}(g.RefCounted);c.ShaderProgram=f;var p=function(){function a(){l(this,a);this.code="";this.parts=new Set}r(a,[{key:"add",value:function(a){if(!this.parts.has(a))switch(this.parts.add(a),typeof a){case "string":this.code+=a;break;case "function":this.add(a());
break;default:if(Array.isArray(a)){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())this.add(b.value)}else throw Error("Invalid code type");}}},{key:"toString",value:function(){return this.code}}]);return a}();c.ShaderCode=p;e=function(){function a(b){l(this,a);this.gl=b;this.nextTextureUnit=this.nextSymbolID=0;this.varyingsCode=this.attributesCode=this.uniformsCode="";this.fragmentExtensionsSet=new Set;this.fragmentExtensions="";this.vertexCode=new p;this.vertexMain="";this.fragmentCode=
new p;this.fragmentMain="";this.required=new Set;this.uniforms=[];this.attributes=[];this.initializers=[];this.textureUnits=new Map}r(a,[{key:"allocateTextureUnit",value:function(a){var b=1>=arguments.length||void 0===arguments[1]?1:arguments[1];if(this.textureUnits.has(a))throw Error("Duplicate texture unit symbol: "+a);var c=this.nextTextureUnit;this.nextTextureUnit+=b;this.textureUnits.set(a,c);return c}},{key:"addTextureSampler2D",value:function(a,b,c){var d=this.allocateTextureUnit(b,c);this.addUniform("highp sampler2D",
a,c);this.addInitializer(function(b){if(c){for(var e=new Int32Array(c),f=0;f<c;++f)e[f]=f+d;b.gl.uniform1iv(b.uniform(a),e)}else b.gl.uniform1i(b.uniform(a),d)});return d}},{key:"symbol",value:function(a){return a+this.nextSymbolID++}},{key:"addAttribute",value:function(a,b){this.attributes.push(b);this.attributesCode+="attribute "+a+" "+b+";\n";return b}},{key:"addVarying",value:function(a,b){this.varyingsCode+="varying "+a+" "+b+";\n"}},{key:"addUniform",value:function(a,b,c){this.uniforms.push(b);
this.uniformsCode=null!=c?this.uniformsCode+("uniform "+a+" "+b+"["+c+"];\n"):this.uniformsCode+("uniform "+a+" "+b+";\n");return b}},{key:"addFragmentExtension",value:function(a){this.fragmentExtensionsSet.has(a)||(this.fragmentExtensionsSet.add(a),this.fragmentExtensions+="#extension "+a+" : require\n")}},{key:"addVertexCode",value:function(a){this.vertexCode.add(a)}},{key:"addFragmentCode",value:function(a){this.fragmentCode.add(a)}},{key:"setVertexMain",value:function(a){this.vertexMain=a}},{key:"setFragmentMain",
value:function(a){this.fragmentMain="void main() {\n"+a+"\n}\n"}},{key:"setFragmentMainFunction",value:function(a){this.fragmentMain=a}},{key:"addInitializer",value:function(a){this.initializers.push(a)}},{key:"require",value:function(a){this.required.has(a)||(this.required.add(a),a(this))}},{key:"build",value:function(){var a=new f(this.gl,"\nprecision highp float;\n"+this.uniformsCode+"\n"+this.attributesCode+"\n"+this.varyingsCode+"\n"+this.vertexCode+"\nvoid main() {\n"+this.vertexMain+"\n}\n",
"\n"+this.fragmentExtensions+"\nprecision highp float;\n"+this.uniformsCode+"\n"+this.varyingsCode+"\n"+this.fragmentCode+"\n"+this.fragmentMain+"\n",this.uniforms,this.attributes);a.textureUnits=this.textureUnits;var b=this.initializers;if(0<b.length){a.bind();for(var b=$jscomp.makeIterator(b),c=b.next();!c.done;c=b.next())c=c.value,c(a)}return a}}]);return a}();c.ShaderBuilder=e},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,
b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d=function(){return function(a,
b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var h=a[Symbol.iterator](),p;!(d=(p=h.next()).done)&&(c.push(p.value),!b||c.length!==b);d=!0);}catch(q){e=!0,f=q}finally{try{if(!d&&h["return"])h["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),m=function A(a,b,c){null===a&&
(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:A(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},r=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),v=e(43),n=e(50);g=e(23);var k=e(9),q=e(51),
f=e(52),p=e(34);e=function(c){function d(){l(this,d);for(var a=arguments.length,c=Array(a),e=0;e<a;e++)c[e]=arguments[e];var f,a=b(this,(f=Object.getPrototypeOf(d)).call.apply(f,[].concat([this],$jscomp.arrayFromIterable(c))));a.ready=!1;a.layerChanged=new p.Signal;a.redrawNeeded=new p.Signal;a.readyStateChanged=new p.Signal;a.voxelSize=null;a.boundingBox=null;return a}a(d,c);r(d,[{key:"setReady",value:function(a){this.ready=a;this.readyStateChanged.dispatch();this.layerChanged.dispatch()}},{key:"handleAction",
value:function(a){}},{key:"getValueAt",value:function(a){}}]);return d}(g.RefCounted);c.RenderLayer=e;e=function(c){function d(){l(this,d);return b(this,Object.getPrototypeOf(d).apply(this,arguments))}a(d,c);r(d,[{key:"onShow",value:function(){}},{key:"onHide",value:function(){}}]);return d}(g.RefCounted);c.UserLayerDropdown=e;e=function(c){function d(){var a=0>=arguments.length||void 0===arguments[0]?[]:arguments[0];l(this,d);var c=b(this,Object.getPrototypeOf(d).call(this));c.layersChanged=new p.Signal;
c.readyStateChanged=new p.Signal;c.specificationChanged=new p.Signal;c.renderLayers=[];a.forEach(c.addRenderLayer.bind(c));return c}a(d,c);r(d,[{key:"addRenderLayer",value:function(a){this.renderLayers.push(a);var b=this.layersChanged,c=this.readyStateChanged;this.registerDisposer(a);this.registerSignalBinding(a.layerChanged.add(b.dispatch,b));this.registerSignalBinding(a.readyStateChanged.add(c.dispatch,c));b.dispatch()}},{key:"getValueAt",value:function(a,b,c){var d=void 0,e=this.renderLayers;if(null!==
b&&-1!==e.indexOf(b))return this.transformPickedValue(c);b=$jscomp.makeIterator(e);for(c=b.next();!c.done&&(c=c.value,!c.ready||(d=c.getValueAt(a),void 0===d));c=b.next());return this.transformPickedValue(d)}},{key:"transformPickedValue",value:function(a){return a}},{key:"toJSON",value:function(){return null}},{key:"makeDropdown",value:function(a){}},{key:"handleAction",value:function(a){}}]);return d}(g.RefCounted);c.UserLayer=e;var h=function(c){function d(a){var c=1>=arguments.length||void 0===
arguments[1]?null:arguments[1],e=2>=arguments.length||void 0===arguments[2]?!0:arguments[2];l(this,d);var f=b(this,Object.getPrototypeOf(d).call(this));f.name=a;f.visible=e;f.readyStateChanged=new p.Signal;f.layerChanged=new p.Signal;f.specificationChanged=new p.Signal;f.wasDisposed=!1;f.layer_=null;f.layer=c;return f}a(d,c);r(d,[{key:"updateSignalBindings",value:function(a,b){b(a.layersChanged,this.handleLayerChanged,this);b(a.readyStateChanged,this.readyStateChanged.dispatch,this.readyStateChanged);
b(a.specificationChanged,this.specificationChanged.dispatch,this.specificationChanged)}},{key:"handleLayerChanged",value:function(){this.visible&&this.layerChanged.dispatch()}},{key:"setVisible",value:function(a){a!==this.visible&&(this.visible=a,this.layerChanged.dispatch())}},{key:"disposed",value:function(){this.wasDisposed=!0;this.layer=null;m(Object.getPrototypeOf(d.prototype),"disposed",this).call(this)}},{key:"layer",get:function(){return this.layer_},set:function(a){var b=this.layer_;null!=
b&&(this.updateSignalBindings(b,q.removeSignalBinding),b.dispose());this.layer_=a;null!=a&&(this.updateSignalBindings(a,q.addSignalBinding),this.readyStateChanged.dispatch(),this.handleLayerChanged())}}]);return d}(g.RefCounted);c.ManagedUserLayer=h;e=function(c){function e(){l(this,e);for(var a=arguments.length,c=Array(a),d=0;d<a;d++)c[d]=arguments[d];var f,a=b(this,(f=Object.getPrototypeOf(e)).call.apply(f,[].concat([this],$jscomp.arrayFromIterable(c))));a.managedLayers=[];a.layersChanged=new p.Signal;
a.readyStateChanged=new p.Signal;a.specificationChanged=new p.Signal;a.boundPositions=new WeakSet;return a}a(e,c);r(e,[{key:"updateSignalBindings",value:function(a,b){b(a.layerChanged,this.layersChanged.dispatch,this.layersChanged);b(a.readyStateChanged,this.readyStateChanged.dispatch,this.readyStateChanged);b(a.specificationChanged,this.specificationChanged.dispatch,this.specificationChanged)}},{key:"addManagedLayer",value:function(a){this.updateSignalBindings(a,q.addSignalBinding);this.managedLayers.push(a);
this.layersChanged.dispatch();return a}},{key:"addUserLayer",value:function(a,b,c){a=new h(a,b,c);return this.addManagedLayer(a)}},{key:"readyRenderLayers",value:function(){function a(k,l){for(;;)switch(b){case 0:p=$jscomp.makeIterator(q.managedLayers),h=p.next();case 1:if(h.done){b=3;break}f=h.value;if(f.visible&&f.layer){b=4;break}b=2;break;case 4:e=$jscomp.makeIterator(f.layer.renderLayers),d=e.next();case 5:if(d.done){b=7;break}c=d.value;if(c.ready){b=8;break}b=6;break;case 8:return b=9,{value:c,
done:!1};case 9:if(void 0===l){b=10;break}b=-1;throw l;case 10:case 6:d=e.next();b=5;break;case 7:case 2:h=p.next();b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,c,d,e,f,h,p,q=this,k={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();k[Symbol.iterator]=function(){return this};return k}},{key:"unbindManagedLayer",value:function(a){this.updateSignalBindings(a,q.removeSignalBinding);
a.dispose()}},{key:"clear",value:function(){for(var a=$jscomp.makeIterator(this.managedLayers),b=a.next();!b.done;b=a.next())this.unbindManagedLayer(b.value);this.managedLayers.length=0;this.layersChanged.dispatch()}},{key:"removeManagedLayer",value:function(a){var b=this.managedLayers.indexOf(a);if(-1===b)throw Error("Internal error: invalid managed layer.");this.unbindManagedLayer(a);this.managedLayers.splice(b,1);this.layersChanged.dispatch()}},{key:"reorderManagedLayer",value:function(a,b){var c=
this.managedLayers.length;a===b||0>a||a>=c||0>b||b>=c||(c=this.managedLayers.splice(a,1),c=d(c,1)[0],this.managedLayers.splice(b,0,c),this.layersChanged.dispatch())}},{key:"disposed",value:function(){this.clear();m(Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}},{key:"getLayerByName",value:function(a){return this.managedLayers.find(function(b){return b.name===a})}},{key:"initializePosition",value:function(a){var b=this,c=this.boundPositions;c.has(a)||(c.add(a),c=v(function(){b.updatePositionFromLayers(a)}),
this.readyStateChanged.add(c),a.changed.add(c),this.updatePositionFromLayers(a))}},{key:"updatePositionFromLayers",value:function(a){if(!a.valid)for(var b=$jscomp.makeIterator(this.managedLayers),c=b.next();!c.done;c=b.next())if(c=c.value.layer,null!=c)for(var c=$jscomp.makeIterator(c.renderLayers),d=c.next();!d.done;d=c.next())if(d=d.value,d.ready&&(a.voxelSize.valid||null==d.voxelSize||(k.vec3.copy(a.voxelSize.size,d.voxelSize),a.voxelSize.setValid()),!a.spatialCoordinatesValid&&!a.voxelCoordinatesValid&&
null!=d.boundingBox)){var d=d.boundingBox,e=a.spatialCoordinates;k.vec3.add(e,d.lower,d.upper);k.vec3.scale(e,e,.5);a.spatialCoordinatesValid=!0;a.changed.dispatch()}}},{key:"invokeAction",value:function(a){for(var b=$jscomp.makeIterator(this.managedLayers),c=b.next();!c.done;c=b.next())if(c=c.value,null!==c.layer&&c.visible){c=c.layer;c.handleAction(a);for(var c=$jscomp.makeIterator(c.renderLayers),d=c.next();!d.done;d=c.next())d=d.value,d.ready&&d.handleAction(a)}}},{key:"renderLayers",get:function(){var a=
this;$jscomp.initSymbol();$jscomp.initSymbolIterator();var b={};return b[Symbol.iterator]=function(){function b(k,t){for(;;)switch(c){case 0:q=$jscomp.makeIterator(a.managedLayers),p=q.next();case 1:if(p.done){c=3;break}h=p.value;if(null!==h.layer){c=4;break}c=2;break;case 4:f=$jscomp.makeIterator(h.layer.renderLayers),e=f.next();case 5:if(e.done){c=7;break}d=e.value;c=8;return{value:d,done:!1};case 8:if(void 0===t){c=9;break}c=-1;throw t;case 9:case 6:e=f.next();c=5;break;case 7:case 2:p=q.next();
c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,d,e,f,h,p,q,k={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();k[Symbol.iterator]=function(){return this};return k},b}},{key:"visibleRenderLayers",get:function(){var a=this;$jscomp.initSymbol();$jscomp.initSymbolIterator();var b={};return b[Symbol.iterator]=function(){function b(k,t){for(;;)switch(c){case 0:q=$jscomp.makeIterator(a.managedLayers),
p=q.next();case 1:if(p.done){c=3;break}h=p.value;if(null!==h.layer&&h.visible){c=4;break}c=2;break;case 4:f=$jscomp.makeIterator(h.layer.renderLayers),e=f.next();case 5:if(e.done){c=7;break}d=e.value;c=8;return{value:d,done:!1};case 8:if(void 0===t){c=9;break}c=-1;throw t;case 9:case 6:e=f.next();c=5;break;case 7:case 2:p=q.next();c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,d,e,f,h,p,q,k={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");
}};$jscomp.initSymbolIterator();k[Symbol.iterator]=function(){return this};return k},b}}]);return e}(g.RefCounted);c.LayerManager=e;e=function(){function a(){var b=this;l(this,a);this.changed=new p.Signal;this.position=k.vec3.create();this.active=!1;this.pickedRenderLayer=null;this.pickedValue=new f.Uint64(0,0);this.updater=void 0;this.stale=!1;this.triggerUpdate=n(function(){b.update()},50,{leading:!0,trailing:!0})}r(a,[{key:"updateUnconditionally",value:function(){this.triggerUpdate.cancel();this.update();
return this.active}},{key:"updateIfStale",value:function(){this.stale&&this.update()}},{key:"update",value:function(){var a=this.updater;this.stale=!1;a?this.setActive(a(this)):this.setActive(!1)}},{key:"setActive",value:function(a){this.stale=!1;if(this.active!==a||!0===a)this.active=a,this.changed.dispatch()}}]);return a}();c.MouseSelectionState=e;e=function(c){function d(a,c){l(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.layerManager=a;e.mouseState=c;e.values=new Map;e.changed=
new p.Signal;e.needsUpdate=!0;e.registerSignalBinding(c.changed.add(e.handleChange,e));e.registerSignalBinding(a.layersChanged.add(function(){e.handleLayerChange()}));return e}a(d,c);r(d,[{key:"handleLayerChange",value:function(){this.mouseState.active&&this.handleChange()}},{key:"handleChange",value:function(){this.needsUpdate=!0;this.changed.dispatch()}},{key:"update",value:function(){if(this.needsUpdate){this.needsUpdate=!1;var a=this.values,b=this.mouseState;a.clear();if(b.active)for(var c=b.position,
d=$jscomp.makeIterator(this.layerManager.managedLayers),e=d.next();!e.done;e=d.next()){var e=e.value,f=e.layer;e.visible&&f&&a.set(f,f.getValueAt(c,b.pickedRenderLayer,b.pickedValue))}}}},{key:"get",value:function(a){this.update();return this.values.get(a)}}]);return d}(g.RefCounted);c.LayerSelectedValues=e;g=function(c){function d(a,c,e,f){l(this,d);var h=b(this,Object.getPrototypeOf(d).call(this));h.layerManager=a;h.renderLayerType=c;h.layerAdded=e;h.layerRemoved=f;h.visibleLayers=new Set;h.newVisibleLayers=
new Set;h.updatePending=null;h.registerSignalBinding(a.layersChanged.add(h.handleLayersChanged,h));h.updateVisibleLayers();return h}a(d,c);r(d,[{key:"handleLayersChanged",value:function(){if(null===this.updatePending){var a=this;this.updatePending=setTimeout(function(){a.updatePending=null;a.updateVisibleLayers()},0)}}},{key:"disposed",value:function(){this.cancelUpdate();this.visibleLayers.forEach(this.layerRemoved);this.visibleLayers.clear();m(Object.getPrototypeOf(d.prototype),"disposed",this).call(this)}},
{key:"cancelUpdate",value:function(){var a=this.updatePending;null!==a&&clearTimeout(a)}},{key:"updateVisibleLayers",value:function(){for(var a=this.visibleLayers,b=this.newVisibleLayers,c=this.renderLayerType,d=this.layerAdded,e=this.layerRemoved,f=$jscomp.makeIterator(this.layerManager.readyRenderLayers()),h=f.next();!h.done;h=f.next())h=h.value,h instanceof c&&(b.add(h),a.has(h)||(a.add(h),d(h)));c=$jscomp.makeIterator(a);for(d=c.next();!d.done;d=c.next())d=d.value,b.has(d)||(a.delete(d),e(d));
b.clear()}},{key:"getVisibleLayers",value:function(){null!==this.updatePending&&(this.cancelUpdate(),this.updateVisibleLayers());return this.visibleLayers}}]);return d}(g.RefCounted);c.VisibleRenderLayerTracker=g},function(g,c,e){var l=e(44),b=e(45),a=e(46),d=Math.max,m=Math.min;g.exports=function(c,e,n){function k(a){var b=g,d=A;g=A=void 0;z=a;return y=c.apply(d,b)}function q(a){var b=a-t;a-=z;return void 0===t||b>=e||0>b||C&&a>=B}function f(){var a=b();if(q(a))return p(a);var c=setTimeout,d;d=a-
z;a=e-(a-t);d=C?m(a,B-d):a;x=c(f,d)}function p(a){x=void 0;if(D&&g)return k(a);g=A=void 0;return y}function h(){var a=b(),c=q(a);g=arguments;A=this;t=a;if(c){if(void 0===x)return z=a=t,x=setTimeout(f,e),w?k(a):y;if(C)return x=setTimeout(f,e),k(t)}void 0===x&&(x=setTimeout(f,e));return y}var g,A,B,y,x,t,z=0,w=!1,C=!1,D=!0;if("function"!=typeof c)throw new TypeError("Expected a function");e=a(e)||0;l(n)&&(w=!!n.leading,B=(C="maxWait"in n)?d(a(n.maxWait)||0,e):B,D="trailing"in n?!!n.trailing:D);h.cancel=
function(){z=0;g=t=A=x=void 0};h.flush=function(){return void 0===x?y:p(b())};return h}},function(g,c){g.exports=function(c){var l=typeof c;return!!c&&("object"==l||"function"==l)}},function(g,c){g.exports=function(){return Date.now()}},function(g,c,e){var l=e(47),b=e(44),a=e(48),d=0/0,m=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,v=/^0b[01]+$/i,n=/^0o[0-7]+$/i,k=parseInt;g.exports=function(c){if("number"==typeof c)return c;if(a(c))return d;b(c)&&(c=l(c.valueOf)?c.valueOf():c,c=b(c)?c+"":c);if("string"!=
typeof c)return 0===c?c:+c;c=c.replace(m,"");var e=v.test(c);return e||n.test(c)?k(c.slice(2),e?2:8):r.test(c)?d:+c}},function(g,c,e){var l=e(44),b=Object.prototype.toString;g.exports=function(a){a=l(a)?b.call(a):"";return"[object Function]"==a||"[object GeneratorFunction]"==a}},function(g,c,e){var l=e(49),b=Object.prototype.toString;g.exports=function(a){return"symbol"==typeof a||l(a)&&"[object Symbol]"==b.call(a)}},function(g,c){g.exports=function(c){return!!c&&"object"==typeof c}},function(g,c,
e){var l=e(43),b=e(44);g.exports=function(a,c,e){var g=!0,v=!0;if("function"!=typeof a)throw new TypeError("Expected a function");b(e)&&(g="leading"in e?!!e.leading:g,v="trailing"in e?!!e.trailing:v);return l(a,c,{leading:g,maxWait:c,trailing:v})}},function(g,c){c.removeSignalBinding=function(c,l,b){c.remove(l,b)};c.addSignalBinding=function(c,l,b){c.add(l,b)}},function(g,c){var e=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in
e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),l=new Uint32Array(2),b=[],a=2;for(;36>=a;++a){var d=Math.floor(32/Math.log2(a)),m=Math.pow(a,d),r=Math.floor(d/2),v=Math.pow(a,r),r=Math.pow(a,d-r),n="^[0-"+String.fromCharCode(48+Math.min(9,a-1));10<a&&(n+="a-"+String.fromCharCode(97+a-11),n+="A-"+String.fromCharCode(65+a-11));n+="]{1,"+Math.ceil(64/Math.log2(a))+"}$";b[a]={lowDigits:d,lowBase:m,lowBase1:v,lowBase2:r,pattern:new RegExp(n)}}a=
function(){function a(){var b=0>=arguments.length||void 0===arguments[0]?0:arguments[0],c=1>=arguments.length||void 0===arguments[1]?0:arguments[1];if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.low=b;this.high=c}e(a,[{key:"clone",value:function(){return new a(this.low,this.high)}},{key:"assign",value:function(a){this.low=a.low;this.high=a.high}},{key:"toString",value:function(){var a=0>=arguments.length||void 0===arguments[0]?10:arguments[0],c=this.low,d=this.high;
if(0===d)return c.toString(a);var d=4294967296*d,e=b[a],k=e.lowBase,e=e.lowDigits,l=d%k,d=Math.floor(d/k),c=c+l,d=d+Math.floor(c/k),c=(c%k).toString(a);return d.toString(a)+"0".repeat(e-c.length)+c}},{key:"tryParseString",value:function(a){var c=1>=arguments.length||void 0===arguments[1]?10:arguments[1],d=b[c],e=d.lowDigits,k=d.lowBase,l=d.lowBase1,n=d.lowBase2;if(!d.pattern.test(a))return!1;if(a.length<=e)return this.low=parseInt(a,c),this.high=0,!0;e=a.length-e;d=parseInt(a.substr(e),c);c=parseInt(a.substr(0,
e),c);k=Math.floor(c*k/4294967296);l=d+c%4294967296*l%4294967296*n%4294967296;4294967296<l&&(++k,l-=4294967296);if(l>>>0!==l||k>>>0!==k)return!1;this.low=l;this.high=k;return!0}},{key:"parseString",value:function(a){if(!this.tryParseString(a,1>=arguments.length||void 0===arguments[1]?10:arguments[1]))throw Error("Failed to parse string as uint64 value: "+JSON.stringify(a)+".");return this}},{key:"valid",value:function(){var a=this.low,b=this.high;return a>>>0===a&&b>>>0===b}},{key:"toJSON",value:function(){return this.toString()}}],
[{key:"less",value:function(a,b){return a.high<b.high||a.high===b.high&&a.low<b.low}},{key:"compare",value:function(a,b){return a.high-b.high||a.low-b.low}},{key:"equal",value:function(a,b){return a.low===b.low&&a.high===b.high}},{key:"min",value:function(b,c){return a.less(b,c)?b:c}},{key:"random",value:function(){crypto.getRandomValues(l);return new a(l[0],l[1])}},{key:"parseString",value:function(b){var c=1>=arguments.length||void 0===arguments[1]?10:arguments[1];return(new a).parseString(b,c)}}]);
return a}();a.ZERO=new a(0,0);c.Uint64=a},function(g,c){var e=function(){function b(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,c,e){c&&b(a.prototype,c);e&&b(a,e);return a}}(),l=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.renderLayers=[null];this.lowValues=[0];this.highValues=[0]}e(b,[{key:"clear",value:function(){this.renderLayers.length=
1;this.lowValues.length=1;this.highValues.length=1}},{key:"register",value:function(a,b){var c=this.renderLayers,e=this.lowValues,l=this.highValues,n=c.length;c[n]=a;e[n]=b.low;l[n]=b.high;return n}},{key:"setMouseState",value:function(a,b){a.pickedRenderLayer=this.renderLayers[b];var c=a.pickedValue;c.low=this.lowValues[b];c.high=this.highValues[b]}}]);return b}();c.PickIDManager=l},function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in
e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(55);var d=e(9),m=e(57);e(58);c.KEY_COMMANDS=new Map;e=function(a){for(var b=d.AXES_NAMES[a],e=function(e){var f=0>e?"-":"+";c.KEY_COMMANDS.set("rotate-relative-"+b+f,function(){this.navigationState.pose.rotateRelative(d.kAxes[a],.1*e)});var p=d.vec3.create();c.KEY_COMMANDS.set(""+b+f,function(){var b=this.navigationState;p[0]=0;p[1]=0;p[2]=0;p[a]=e;b.pose.translateVoxelsRelative(p)})},
f=$jscomp.makeIterator([-1,1]),p=f.next();!p.done;p=f.next())e(p.value)};for(var r=0;3>r;++r)e(r);c.KEY_COMMANDS.set("snap",function(){this.navigationState.pose.snap()});c.KEY_COMMANDS.set("zoom-in",function(){this.navigationState.zoomBy(.5)});c.KEY_COMMANDS.set("zoom-out",function(){this.navigationState.zoomBy(2)});var v=d.vec3.create();g=function(e){function k(a,b,c){if(!(this instanceof k))throw new TypeError("Cannot call a class as a function");var d=l(this,Object.getPrototypeOf(k).call(this,
a,b));d.viewer=c;d.mouseX=0;d.mouseY=0;d.mouseStateUpdater=d.updateMouseState.bind(d);b.classList.add("rendered-data-panel");d.registerEventListener(b,"mousemove",d.onMousemove.bind(d));d.registerEventListener(b,"mouseleave",d.onMouseout.bind(d));d.registerEventListener(b,"mousedown",d.onMousedown.bind(d),!1);d.registerEventListener(b,"wheel",d.onMousewheel.bind(d),!1);d.registerEventListener(b,"dblclick",function(){d.viewer.layerManager.invokeAction("select")});return d}b(k,e);a(k,[{key:"onMouseout",
value:function(a){a=this.viewer.mouseState;a.updater=void 0;a.setActive(!1)}},{key:"onKeyCommand",value:function(a){return(a=c.KEY_COMMANDS.get(a))?(a.call(this),!0):!1}},{key:"onMousemove",value:function(a){var b=this.element;a.target===b&&(this.mouseX=a.offsetX-b.clientLeft,this.mouseY=a.offsetY-b.clientTop,a=this.viewer.mouseState,a.updater=this.mouseStateUpdater,a.triggerUpdate())}},{key:"onMousewheel",value:function(a){if(a.ctrlKey)this.onMousemove(a),this.zoomByMouse(m.getWheelZoomAmount(a));
else{var b=this.navigationState,c=0!==a.deltaY?a.deltaY:a.deltaX;v[0]=0;v[1]=0;v[2]=(0<c?-1:1)*(a.shiftKey?10:1);b.pose.translateVoxelsRelative(v)}a.preventDefault()}},{key:"onMousedown",value:function(a){if(a.target===this.element&&(this.onMousemove(a),2===a.button&&(a=this.viewer.mouseState,a.updateUnconditionally()))){var b=this.navigationState.pose.position;d.vec3.copy(b.spatialCoordinates,a.position);b.changed.dispatch()}}}]);return k}(g.RenderedPanel);c.RenderedDataPanel=g},function(g,c,e){function l(a,
b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)}var d=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),m=function k(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:k(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===
b?void 0:b.call(c)};g=e(23);var r=e(56),v=e(34);e=function(c){function e(a,c){l(this,e);var d=b(this,Object.getPrototypeOf(e).call(this));d.context=a;d.element=c;d.gl=a.gl;d.registerEventListener(c,"mouseenter",function(a){d.context.setActivePanel(d)});a.addPanel(d);return d}a(e,c);d(e,[{key:"scheduleRedraw",value:function(){this.context.scheduleRedraw()}},{key:"setGLViewport",value:function(){var a=this.element,b=a.offsetLeft+a.clientLeft,c=a.clientWidth,d=a.clientHeight,e=a.offsetTop+a.clientTop+
d,a=this.gl;a.enable(a.SCISSOR_TEST);e=this.context.canvas.height-e;a.viewport(b,e,c,d);a.scissor(b,e,c,d)}},{key:"onKeyCommand",value:function(a){return!1}},{key:"disposed",value:function(){this.context.removePanel(this);m(Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}}]);return e}(g.RefCounted);c.RenderedPanel=e;e=function(c){function e(a){l(this,e);var c=b(this,Object.getPrototypeOf(e).call(this));c.container=a;c.canvas=document.createElement("canvas");c.updateStarted=new v.Signal;
c.updateFinished=new v.Signal;c.panels=new Set;c.activePanel=null;c.updatePending=null;c.needsRedraw=!1;var d=c.canvas;d.className="gl-canvas";a.appendChild(d);c.gl=r.initializeWebGL(d);c.registerEventListener(window,"resize",c.onResize.bind(c));return c}a(e,c);d(e,[{key:"disposed",value:function(){null!=this.updatePending&&(cancelAnimationFrame(this.updatePending),this.updatePending=null)}},{key:"addPanel",value:function(a){this.panels.add(a);null==this.activePanel&&this.setActivePanel(a)}},{key:"setActivePanel",
value:function(a){var b=this.activePanel;null!=b&&b.element.attributes.removeNamedItem("isActivePanel");null!=a&&a.element.setAttribute("isActivePanel","true");this.activePanel=a}},{key:"removePanel",value:function(a){this.panels.delete(a);a===this.activePanel&&this.setActivePanel(null);a.dispose()}},{key:"onResize",value:function(){this.scheduleRedraw();for(var a=$jscomp.makeIterator(this.panels),b=a.next();!b.done;b=a.next())b.value.onResize()}},{key:"scheduleUpdate",value:function(){null===this.updatePending&&
(this.updatePending=requestAnimationFrame(this.update.bind(this)))}},{key:"scheduleRedraw",value:function(){this.needsRedraw||(this.needsRedraw=!0,this.scheduleUpdate())}},{key:"update",value:function(){this.updatePending=null;this.updateStarted.dispatch();if(this.needsRedraw){this.needsRedraw=!1;var a=this.gl,b=this.canvas;b.width=b.offsetWidth;b.height=b.offsetHeight;this.gl.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a=$jscomp.makeIterator(this.panels);for(b=a.next();!b.done;b=
a.next()){var b=b.value,c=b.element;0!==c.clientWidth&&0!==c.clientHeight&&(b.setGLViewport(),b.draw())}}this.updateFinished.dispatch()}}]);return e}(g.RefCounted);c.DisplayContext=e},function(g,c,e){var l=e(33);c.DEBUG_SHADERS=!1;c.initializeWebGL=function(b){var a={antialias:!1,stencil:!0};c.DEBUG_SHADERS&&(console.log("DEBUGGING via preserveDrawingBuffer"),a.preserveDrawingBuffer=!0);b=b.getContext("webgl",a)||b.getContext("experimental-webgl",a);b.memoize=new l.Memoize;b.maxTextureSize=b.getParameter(b.MAX_TEXTURE_SIZE);
b.maxTextureImageUnits=b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS);b.tempTextureUnit=b.maxTextureImageUnits-1;b.WEBGL_draw_buffers=b.getExtension("WEBGL_draw_buffers");if(!b.WEBGL_draw_buffers)throw Error("WEBGL_draw_buffers extension not available");for(var a=$jscomp.makeIterator(["OES_texture_float","OES_element_index_uint"]),d=a.next();!d.done;d=a.next())if(d=d.value,!b.getExtension(d))throw Error(d+" extension not available");return b}},function(g,c){c.getWheelZoomAmount=function(c){var l=0;switch(c.deltaMode){case 0:l=
.005;break;case 1:l=.1;break;case 2:l=2}return Math.exp(c.deltaY*l)}},function(g,c){},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);
a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function d(a,b){for(var c=$jscomp.makeIterator(z),d=c.next();!d.done;d=c.next())if(d=d.value,d=d(a,b),null!=d)return d;throw Error("No chunk format handler found.");}var m=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,
e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),r=function D(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:D(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},v=this&&this.__decorate||function(a,b,c,d){var e=arguments.length,f=3>e?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d,h;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)f=
Reflect.decorate(a,b,c,d);else for(var p=a.length-1;0<=p;p--)if(h=a[p])f=(3>e?h(f):3<e?h(b,c,f):h(b,c))||f;return 3<e&&f&&Object.defineProperty(b,c,f),f},n=e(31),k=e(32),q=e(60),f=e(65);g=e(23);var p=e(9),h=e(8),u=e(38),A=e(67),B=e(41),y=e(22),x=e(34),t=p.mat4.create();e=function(c){function d(a,c,e,f){l(this,d);var h=b(this,Object.getPrototypeOf(d).call(this));h.gl=a;h.chunkManager=c;h.layerManager=e;h.navigationState=f;h.dataToViewport=p.mat4.create();h.viewportToDevice=p.mat4.create();h.dataToDevice=
p.mat4.create();h.visibleChunks=new Map;h.viewChanged=new x.Signal;h.renderingStale=!0;h.visibleChunksStale=!0;h.visibleLayersStale=!1;h.visibleLayerList=[];h.newVisibleLayers=new Set;h.offscreenFramebuffer=new A.OffscreenFramebuffer(h.gl,{numDataBuffers:1,depthBuffer:!1,stencilBuffer:!0});p.mat4.identity(h.dataToViewport);h.initializeCounterpart(h.chunkManager.rpc,{chunkManager:c.rpcId});h.updateVisibleLayers();h.registerSignalBinding(f.changed.add(function(){h.updateViewportFromNavigationState()}));
h.updateViewportFromNavigationState();h.registerSignalBinding(e.layersChanged.add(function(){!h.visibleLayersStale&&h.hasValidViewport&&(h.visibleLayersStale=!0,setTimeout(h.updateVisibleLayers.bind(h),0))}));h.viewChanged.add(function(){h.renderingStale=!0});h.registerSignalBinding(c.chunkQueueManager.visibleChunksChanged.add(h.viewChanged.dispatch,h.viewChanged));h.updateViewportFromNavigationState();return h}a(d,c);m(d,[{key:"updateViewportFromNavigationState",value:function(){var a=this.navigationState;
a.valid&&(a.toMat4(t),this.setViewportToDataMatrix(t))}},{key:"updateVisibleLayers",value:function(){if(!this.hasValidViewport)return!1;this.visibleLayersStale=!1;var a=this.visibleLayers,b=this.rpc,c={id:this.rpcId},d=this.newVisibleLayers,e=!1,h=this.visibleLayerList;h.length=0;for(var p=$jscomp.makeIterator(this.layerManager.readyRenderLayers()),k=p.next();!k.done;k=p.next())k=k.value,k instanceof f.RenderLayer&&(d.add(k),h.push(k),a.has(k)||(a.set(k.addRef(),[]),k.redrawNeeded.add(this.viewChanged.dispatch,
this.viewChanged),c.layerId=k.rpcId,b.invoke("SliceView.addVisibleLayer",c),e=!0));h=$jscomp.makeIterator(a.keys());for(p=h.next();!p.done;p=h.next())p=p.value,d.has(p)||(a.delete(p),p.redrawNeeded.remove(this.viewChanged.dispatch,this.viewChanged),c.layerId=p.rpcId,b.invoke("SliceView.removeVisibleLayer",c),p.dispose(),e=!0);d.clear();e&&(this.visibleSourcesStale=!0);this.viewChanged.dispatch();return e}},{key:"onViewportChanged",value:function(){var a=this.width,b=this.height,c=this.viewportToDevice,
d=this.dataToViewport,e=this.dataToDevice;p.mat4.ortho(c,-a/2,a/2,b/2,-b/2,-1,1);p.mat4.multiply(e,c,d);this.visibleChunksStale=!0;this.viewChanged.dispatch()}},{key:"setViewportSize",value:function(a,b){return r(Object.getPrototypeOf(d.prototype),"setViewportSize",this).call(this,a,b)?(this.rpc.invoke("SliceView.updateView",{id:this.rpcId,width:a,height:b}),!0):!1}},{key:"onViewportToDataMatrixChanged",value:function(){var a=this.viewportToData,b=this.dataToViewport;p.mat4.invert(b,a);p.rectifyTransformMatrixIfAxisAligned(b);
this.rpc.invoke("SliceView.updateView",{id:this.rpcId,viewportToData:a})}},{key:"onHasValidViewport",value:function(){this.updateVisibleLayers()}},{key:"updateRendering",value:function(){if(this.renderingStale&&this.hasValidViewport&&0!==this.width&&0!==this.height){this.renderingStale=!1;this.maybeUpdateVisibleChunks();var a=this.gl,b=this.offscreenFramebuffer;b.bind(this.width,this.height);a.disable(a.SCISSOR_TEST);a.clearStencil(0);a.clearColor(0,0,0,0);a.colorMask(!0,!0,!0,!0);a.clear(a.COLOR_BUFFER_BIT);
a.enable(a.STENCIL_TEST);a.disable(a.DEPTH_TEST);a.stencilOpSeparate(a.FRONT_AND_BACK,a.KEEP,a.KEEP,a.REPLACE);for(var c=0,d=$jscomp.makeIterator(this.visibleLayerList),e=d.next();!e.done;e=d.next())e=e.value,a.clear(a.STENCIL_BUFFER_BIT),a.stencilFuncSeparate(a.FRONT_AND_BACK,a.GREATER,1,1),1===c&&(a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA)),e.draw(this),++c;a.disable(a.BLEND);a.disable(a.STENCIL_TEST);b.unbind()}}},{key:"maybeUpdateVisibleChunks",value:function(){if(!this.visibleChunksStale&&
!this.visibleSourcesStale)return!1;this.visibleChunksStale=!1;this.updateVisibleChunks();return!0}},{key:"updateVisibleChunks",value:function(){var a=this.visibleChunks;this.computeVisibleChunks(function(b){var c=a.get(b);void 0===c?(c=[],a.set(b,c)):c.length=0;return c},function(a,b,c){a=p.vec3Key(c);b[b.length]=a})}},{key:"disposed",value:function(){for(var a=$jscomp.makeIterator(this.visibleLayers.keys()),b=a.next();!b.done;b=a.next())b.value.dispose();this.visibleLayers.clear();this.visibleLayerList.length=
0}}]);return d}(q.SliceViewBase);e=v([y.registerSharedObjectOwner(q.SLICEVIEW_RPC_ID)],e);c.SliceView=e;var z=[];c.registerChunkFormatHandler=function(a){z.push(a)};var w=function(c){function e(a,c){l(this,e);var f=b(this,Object.getPrototypeOf(e).call(this,a));f.spec=c;f.chunkFormatHandler=f.registerDisposer(d(a.chunkQueueManager.gl,c));return f}a(e,c);m(e,[{key:"initializeCounterpart",value:function(a,b){b.spec=this.spec.toObject();r(Object.getPrototypeOf(e.prototype),"initializeCounterpart",this).call(this,
a,b)}},{key:"getValueAt",value:function(a){for(var b=p.vec3.create(),c=this.spec,d=c.chunkLayout,e=d.offset,f=d.size,d=0;3>d;++d)b[d]=Math.floor((a[d]-e[d])/f[d]);d=p.vec3Key(b);d=this.chunks.get(d);if(!d)return null;for(var h=c.voxelSize,k=0;3>k;++k)b[k]=Math.floor((a[k]-e[k]-b[k]*f[k])/h[k]);a=d.chunkDataSize;for(e=0;3>e;++e)if(b[e]>=a[e])return;c=c.numChannels;if(1===c)return d.getChannelValueAt(b,0);a=Array(c);for(e=0;e<c;++e)a[e]=d.getChannelValueAt(b,e);return a}},{key:"getChunk",value:function(a){return this.chunkFormatHandler.getChunk(this,
a)}},{key:"chunkFormat",get:function(){return this.chunkFormatHandler.chunkFormat}}]);return e}(k.ChunkSource);c.VolumeChunkSource=w;c.defineParameterizedVolumeChunkSource=function(c){var d=function(d){function e(a,c,d){l(this,e);a=b(this,Object.getPrototypeOf(e).call(this,a,c));a.parameters=d;return a}a(e,d);m(e,[{key:"initializeCounterpart",value:function(a,b){b.parameters=this.parameters;r(Object.getPrototypeOf(e.prototype),"initializeCounterpart",this).call(this,a,b)}},{key:"toString",value:function(){return c.stringify(this.parameters)}}],
[{key:"get",value:function(a,b,c){var d=this;return a.getChunkSource(this,h.stableStringify({parameters:c,spec:b.toObject()}),function(){return new d(a,b,c)})}}]);return e}(w);d.prototype.RPC_TYPE_ID=c.RPC_ID;return d};e=function(c){function d(a,c){l(this,d);var e=b(this,Object.getPrototypeOf(d).call(this,a));e.chunkGridPosition=c.chunkGridPosition;e.chunkDataSize=c.chunkDataSize||a.spec.chunkDataSize;e.state=n.ChunkState.SYSTEM_MEMORY;return e}a(d,c);m(d,[{key:"chunkFormat",get:function(){return this.source.chunkFormat}}]);
return d}(k.Chunk);c.VolumeChunk=e;g=function(c){function d(a,c){l(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.gl=a;e.copyVertexPositionsBuffer=e.registerDisposer(u.Buffer.fromData(e.gl,new Float32Array([-1,-1,0,1,-1,1,0,1,1,1,0,1,1,-1,0,1]),e.gl.ARRAY_BUFFER,e.gl.STATIC_DRAW));e.copyTexCoordsBuffer=e.registerDisposer(u.Buffer.fromData(e.gl,new Float32Array([0,0,0,1,1,1,1,0]),e.gl.ARRAY_BUFFER,e.gl.STATIC_DRAW));e.textureCoordinateAdjustment=new Float32Array(4);var f=new B.ShaderBuilder(a);
f.addVarying("vec2","vTexCoord");f.addUniform("sampler2D","uSampler");f.addInitializer(function(b){a.uniform1i(b.uniform("uSampler"),0)});f.addUniform("vec4","uColorFactor");f.addUniform("vec4","uBackgroundColor");f.addUniform("mat4","uProjectionMatrix");f.addUniform("vec4","uTextureCoordinateAdjustment");f.require(c);f.setFragmentMain("\nvec4 sampledColor = texture2D(uSampler, vTexCoord);\nif (sampledColor.a == 0.0) {\n  sampledColor = uBackgroundColor;\n}\nemit(sampledColor * uColorFactor, vec4(0,0,0,0));\n");
f.addAttribute("vec4","aVertexPosition");f.addAttribute("vec2","aTexCoord");f.setVertexMain("\nvTexCoord = uTextureCoordinateAdjustment.xy + aTexCoord * uTextureCoordinateAdjustment.zw;\ngl_Position = uProjectionMatrix * aVertexPosition;\n");e.shader=e.registerDisposer(f.build());return e}a(d,c);m(d,[{key:"draw",value:function(a,b,c,d,e,f,h,p){var k=this.gl,l=this.shader,t=this.textureCoordinateAdjustment;t[0]=e;t[1]=f;t[2]=h-e;t[3]=p-f;l.bind();k.activeTexture(k.TEXTURE0);k.bindTexture(k.TEXTURE_2D,
a);k.uniformMatrix4fv(l.uniform("uProjectionMatrix"),!1,b);k.uniform4fv(l.uniform("uColorFactor"),c);k.uniform4fv(l.uniform("uBackgroundColor"),d);k.uniform4fv(l.uniform("uTextureCoordinateAdjustment"),t);a=l.attribute("aVertexPosition");this.copyVertexPositionsBuffer.bindToVertexAttrib(a,4);l=l.attribute("aTexCoord");this.copyTexCoordsBuffer.bindToVertexAttrib(l,2);k.drawArrays(k.TRIANGLE_FAN,0,4);k.disableVertexAttribArray(a);k.disableVertexAttribArray(l);k.bindTexture(k.TEXTURE_2D,null)}}],[{key:"get",
value:function(a,b,c){return a.memoize.get(b,function(){return new d(a,c)})}}]);return d}(g.RefCounted);c.SliceViewRenderHelper=g},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b,c){for(var d=0;3>d;++d)a[d]=Number.POSITIVE_INFINITY,b[d]=Number.NEGATIVE_INFINITY;c=$jscomp.makeIterator(c);for(d=c.next();!d.done;d=c.next())for(var e=d.value.spec,d=e.lowerChunkBound,e=e.upperChunkBound,f=0;3>f;++f)a[f]=Math.min(a[f],d[f]),b[f]=Math.max(b[f],e[f])}function d(a,b,c,d){for(var e=u.FULLY_INSIDE,f=0;3>f;++f){var h;h=a[f];var k=b[f],p=c[f],l=d[f];h=h>=l||k<=p?u.FULLY_OUTSIDE:h>=p&&k<=l?u.FULLY_INSIDE:u.PARTIALLY_INSIDE;switch(h){case u.FULLY_OUTSIDE:return h;
case u.PARTIALLY_INSIDE:e=h}}return e}function m(a,b,c){var d=c.length,e=0;if(1<d)for(var f=0,h=0;h<d;++h){for(var k=c[h],p=0,l=p,q=0;3>q;++q)var g=k.spec.chunkLayout.size[q],p=Math.max(p,g*Math.abs(a[q])),l=Math.max(l,g*Math.abs(b[q]));k=p*l;k>f&&(f=k,e=h)}return c[e]}function r(a){var b=a.voxelSize,d=a.lowerVoxelBound,e=void 0===d?h.kZeroVec:d,f=a.upperVoxelBound;a=a.maxVoxelsPerChunkLog2;a=void 0===a?c.DEFAULT_MAX_VOXELS_PER_CHUNK_LOG2:a;var d=h.vec3.fromValues(1,1,1),k=void 0;if(void 0===f)k=
h.kInfinityVec;else for(var k=h.vec3.create(),p=0;3>p;++p)k[p]=Math.pow(2,Math.floor(Math.log2(f[p]-e[p])));for(e=0;e<a;++e){for(var f=Infinity,p=-1,l=0;3>l;++l)if(!(d[l]>=k[l])){var q=d[l]*b[l];q<f&&(f=q,p=l)}f=p;if(-1===f)break;d[f]*=2}return d}var v=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var h=a[Symbol.iterator](),
k;!(d=(k=h.next()).done)&&(c.push(k.value),!b||c.length!==b);d=!0);}catch(p){e=!0,f=p}finally{try{if(!d&&h["return"])h["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),n=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),k=e(61),q=e(62),
f=e(63),p=e(64);c.DATA_TYPE_BYTES=p.DATA_TYPE_BYTES;c.DataType=p.DataType;var h=e(9);g=e(22);var u;(function(a){a[a.FULLY_OUTSIDE=0]="FULLY_OUTSIDE";a[a.FULLY_INSIDE=1]="FULLY_INSIDE";a[a.PARTIALLY_INSIDE=2]="PARTIALLY_INSIDE"})(u||(u={}));g=function(c){function e(){l(this,e);var a;a=Object.getPrototypeOf(e).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a.width=-1;a.height=-1;a.hasViewportToData=
!1;a.hasValidViewport=!1;a.viewportToData=h.mat4.create();a.viewportAxes=[h.vec4.create(),h.vec4.create(),h.vec4.create()];a.previousViewportAxes=[h.vec3.create(),h.vec3.create()];a.centerDataPosition=h.vec3.create();a.viewportPlaneDistanceToOrigin=0;a.visibleChunkLayouts=new Map;a.visibleLayers=new Map;a.visibleSourcesStale=!0;a.pixelSize=0;h.mat4.identity(a.viewportToData);return a}b(e,c);n(e,[{key:"onViewportChanged",value:function(){}},{key:"maybeSetHasValidViewport",value:function(){!this.hasValidViewport&&
-1!==this.width&&-1!==this.height&&this.hasViewportToData&&(this.hasValidViewport=!0,this.onHasValidViewport());if(this.hasValidViewport)this.onViewportChanged()}},{key:"onHasValidViewport",value:function(){}},{key:"setViewportSize",value:function(a,b){return a!==this.width||b!==this.height?(this.width=a,this.height=b,this.maybeSetHasValidViewport(),!0):!1}},{key:"setViewportToDataMatrix",value:function(a){if(this.hasViewportToData&&h.mat4.equals(this.viewportToData,a))return!1;this.hasViewportToData=
!0;var b=this.viewportToData;h.mat4.copy(b,a);h.rectifyTransformMatrixIfAxisAligned(b);h.vec3.transformMat4(this.centerDataPosition,h.kZeroVec,a);a=0;for(var c=this.viewportAxes,d=this.previousViewportAxes,e=0;3>e;++e){var k=c[e];h.vec4.transformMat4(k,h.kAxes[e],b);0===e&&(a=h.vec3.length(k));h.vec4.normalize(k,k)}this.viewportAxes=c;this.previousViewportAxes=d;if(!f.approxEqual(a,this.pixelSize)||.95>h.vec3.dot(c[0],d[0])||.95>h.vec3.dot(c[1],d[1]))h.vec3.copy(d[0],c[0]),h.vec3.copy(d[1],c[1]),
this.visibleSourcesStale=!0,this.pixelSize=a;this.viewportPlaneDistanceToOrigin=h.vec3.dot(this.centerDataPosition,this.viewportAxes[2]);this.onViewportToDataMatrixChanged();this.maybeSetHasValidViewport();return!0}},{key:"onViewportToDataMatrixChanged",value:function(){}},{key:"updateVisibleSources",value:function(){if(this.visibleSourcesStale){this.visibleSourcesStale=!1;var a=1.1*this.pixelSize,b=this.visibleChunkLayouts,c=v(this.viewportAxes,2),d=c[0],e=c[1],f=this.visibleLayers;b.clear();for(var c=
function(c){k=v(c,2);c=k[0];var f=k[1];f.length=0;c=c.sources;for(var h=c.length,p=void 0,l=c[0][0].spec.voxelSize,q=function(b){for(var c=0;3>c;++c){var d=b[c];if(d>a&&d>l[c])return!0}return!1},g=function(a,c){f[f.length++]=a;var d=a.spec.chunkLayout,e=b.get(d);void 0===e&&(e=new Map,b.set(d,e));e.set(a,h-c-1)},p=h-1;;){var n=m(d,e,c[p]);g(n,p);if(0===p||!q(n.spec.voxelSize))break;--p}f.reverse()},f=$jscomp.makeIterator(f),h=f.next();!h.done;h=f.next()){var k;c(h.value)}}}},{key:"computeVisibleChunks",
value:function(b,c){var e=this;this.updateVisibleSources();for(var f=this.centerDataPosition,k=h.vec3.clone(f),p=h.vec3.clone(f),f=h.vec3.create(),l=$jscomp.makeIterator([-this.width/2,this.width/2]),g=l.next();!g.done;g=l.next())for(var g=g.value,n=$jscomp.makeIterator([-this.height/2,this.height/2]),m=n.next();!m.done;m=n.next())m=m.value,h.vec3.scale(f,h.kAxes[0],g),h.vec3.scaleAndAdd(f,f,h.kAxes[1],m),h.vec3.transformMat4(f,f,this.viewportToData),h.vec3.min(k,k,f),h.vec3.max(p,p,f);for(var r=
h.vec3.create(),x=h.vec3.create(),y=h.vec3.create(),A=this.viewportAxes[2],f=0;3>f;++f)0<A[f]&&(y[f]=1);var B=[],v=[];this.visibleChunkLayouts.forEach(function(f,l){function g(){for(var a=0,b=0,c=0;3>c;++c)var d=m[c],e=A[c],f=r[c],h=x[c]-f,k=y[c]*h,a=a+e*d*(f+k),b=b+e*d*(f+h-k);return a<Q?!1:b<=Q}function C(a){function b(){ua=q.partitionArray(B,0,t,function(a){var b=a.spec;switch(d(r,x,b.lowerChunkBound,b.upperChunkBound)){case u.PARTIALLY_INSIDE:return!0;case u.FULLY_INSIDE:v.push(a);default:return!1}})}
if(0!==v.length||0!==ua){for(var e=1,f=0;3>f;++f)e*=Math.max(0,x[f]-r[f]);if(0!==e&&g())if(1===e)c(l,n,r,v);else{for(var h;;)if(e=r[a],f=x[a],h=f-e,1===h)a=(a+1)%3;else break;h=e+Math.floor(.5*h);var k=(a+1)%3,p=v.length;x[a]=h;var t=ua;b();C(k);v.length=p;ua=t;x[a]=f;r[a]=h;b();C(k);r[a]=e;v.length=p;ua=t}}}var n=b(l),m=l.size,G=l.offset,Q=e.viewportPlaneDistanceToOrigin-h.vec3.dot(G,e.viewportAxes[2]);a(r,x,f.keys());for(var I=0;3>I;++I)r[I]=Math.max(r[I],Math.floor((k[I]-G[I])/m[I])),x[I]=Math.min(x[I],
Math.floor((p[I]-G[I])/m[I]+1));v.length=0;B.length=0;G=$jscomp.makeIterator(f.keys());for(I=G.next();!I.done;I=G.next()){var I=I.value,O=I.spec;switch(d(r,x,O.lowerChunkBound,O.upperChunkBound)){case u.FULLY_INSIDE:v.push(I);break;case u.PARTIALLY_INSIDE:B.push(I)}}var ua=B.length;C(0)})}}]);return e}(g.SharedObject);c.SliceViewBase=g;(function(a){a[a.UNKNOWN=0]="UNKNOWN";a[a.IMAGE=1]="IMAGE";a[a.SEGMENTATION=2]="SEGMENTATION"})(c.VolumeType||(c.VolumeType={}));var A=c.VolumeType;c.DEFAULT_MAX_VOXELS_PER_CHUNK_LOG2=
18;c.getNearIsotropicBlockSize=r;var B=h.vec3.create();c.getTwoDimensionalBlockSize=function(a){var b=a.lowerVoxelBound,c=a.upperVoxelBound,d=a.flatDimension,e=a.voxelSize;a=a.maxVoxelsPerChunkLog2;h.vec3.subtract(B,void 0===c?h.kInfinityVec:c,void 0===b?h.kZeroVec:b);B[d]=1;return r({voxelSize:e,upperVoxelBound:B,maxVoxelsPerChunkLog2:a})};g=function(){function a(b){l(this,a);var c=b.dataType,d=b.lowerVoxelBound,d=void 0===d?h.kZeroVec:d,e=b.upperVoxelBound,f=b.chunkDataSize,q=b.chunkLayoutOffset,
q=void 0===q?h.kZeroVec:q,g=b.voxelSize,n=b.baseVoxelOffset,n=void 0===n?h.kZeroVec:n,m=b.numChannels,u=b.lowerClipBound,u=void 0===u?h.vec3.multiply(h.vec3.create(),g,d):u,r=b.upperClipBound,r=void 0===r?h.vec3.multiply(h.vec3.create(),g,e):r;this.dataType=b.dataType;this.numChannels=m;this.voxelSize=g;this.chunkDataSize=f;this.chunkLayout=k.ChunkLayout.get(h.vec3.multiply(h.vec3.create(),b.chunkDataSize,g),q);this.chunkBytes=h.prod3(b.chunkDataSize)*p.DATA_TYPE_BYTES[c]*m;this.lowerClipBound=u;
this.upperClipBound=r;this.lowerVoxelBound=d;this.upperVoxelBound=e;this.baseVoxelOffset=n;c=this.lowerChunkBound=h.vec3.create();q=this.upperChunkBound=h.vec3.create();for(g=0;3>g;++g)c[g]=Math.floor(d[g]/f[g]),q[g]=Math.floor((e[g]-1)/f[g]+1);this.compressedSegmentationBlockSize=b.compressedSegmentationBlockSize}n(a,[{key:"toObject",value:function(){return{chunkLayoutOffset:this.chunkLayout.offset,numChannels:this.numChannels,chunkDataSize:this.chunkDataSize,voxelSize:this.voxelSize,dataType:this.dataType,
lowerVoxelBound:this.lowerVoxelBound,upperVoxelBound:this.upperVoxelBound,lowerClipBound:this.lowerClipBound,upperClipBound:this.upperClipBound,baseVoxelOffset:this.baseVoxelOffset,compressedSegmentationBlockSize:this.compressedSegmentationBlockSize}}}],[{key:"fromObject",value:function(b){return new a(b)}},{key:"withDefaultCompression",value:function(b){var c=b.compressedSegmentationBlockSize,d=b.dataType,e=b.voxelSize,f=b.lowerVoxelBound,h=b.upperVoxelBound;void 0!==c||b.volumeType!==A.SEGMENTATION||
d!==p.DataType.UINT32&&d!==p.DataType.UINT64||(c=r({voxelSize:e,lowerVoxelBound:f,upperVoxelBound:h,maxVoxelsPerChunkLog2:9}));return new a(Object.assign({},b,{compressedSegmentationBlockSize:c}))}},{key:"getDefaults",value:function(b){var c=b.chunkDataSizes;return(void 0===c?[r(b)]:c).map(function(c){return a.withDefaultCompression(Object.assign({},b,{chunkDataSize:c}))})}}]);return a}();c.VolumeChunkSpecification=g;c.SLICEVIEW_RPC_ID="SliceView";c.SLICEVIEW_RENDERLAYER_RPC_ID="sliceview/RenderLayer"},
function(g,c,e){var l=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),b=e(9);g=function(){function a(c,e){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.size=b.vec3.clone(c);this.offset=void 0===e?b.vec3.create():b.vec3.clone(e)}l(a,[{key:"toObject",value:function(a){a.size=
this.size;a.offset=this.offset}}],[{key:"get",value:function(c){var e=1>=arguments.length||void 0===arguments[1]?b.kZeroVec:arguments[1],l=a.cache,g=b.vec3Key(c)+"+"+b.vec3Key(e),n=l.get(g);void 0===n&&(n=new a(c,e),l.set(g,n));return n}},{key:"fromObject",value:function(b){return a.get(b.size,b.offset)}}]);return a}();g.cache=new Map;c.ChunkLayout=g},function(g,c){c.partitionArray=function(c,l,b,a){for(;l<b;){var d=c[l];a(d)?++l:(--b,c[l]=c[b],c[b]=d)}return b};c.maybePadArray=function(c,l){if(c.length===
l)return c;var b=new c.constructor(l);b.set(c);return b};c.getFortranOrderStrides=function(c){for(var l=c.length,b=Array(l),a=b[0]=1>=arguments.length||void 0===arguments[1]?1:arguments[1],d=1;d<l;++d)a*=c[d-1],b[d]=a;return b}},function(g,c){c.approxEqual=function(c,l){return c===l?!0:1E-6>Math.abs(c-l)/Math.min(Math.abs(c),Math.abs(l))}},function(g,c){var e=c.DataType||(c.DataType={});e[e.UINT8=0]="UINT8";e[e.UINT16=1]="UINT16";e[e.UINT32=2]="UINT32";e[e.UINT64=3]="UINT64";e[e.FLOAT32=4]="FLOAT32";
e=c.DataType;c.DATA_TYPE_BYTES=[];c.DATA_TYPE_BYTES[e.UINT8]=1;c.DATA_TYPE_BYTES[e.UINT16]=2;c.DATA_TYPE_BYTES[e.UINT32]=4;c.DATA_TYPE_BYTES[e.UINT64]=8;c.DATA_TYPE_BYTES[e.FLOAT32]=4},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&
null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function d(a){for(var b=0,c=0;3>c;++c)0>a[c]&&(b+=1<<c);return b}var m=function z(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:
z(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},r=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),v=e(31);g=e(42);var n=e(60),k=e(66),q=e(23),f=e(9),p=e(8),h=e(38),u=e(41),A=e(22);c.GLSL_TYPE_FOR_DATA_TYPE=new Map([[n.DataType.UINT8,"uint8_t"],[n.DataType.FLOAT32,"float"],
[n.DataType.UINT16,"uint16_t"],[n.DataType.UINT32,"uint32_t"],[n.DataType.UINT64,"uint64_t"]]);c.trackableAlphaValue=function(){return new k.TrackableValue(0>=arguments.length||void 0===arguments[0]?.5:arguments[0],p.verifyFloat01)};var B=function(c){function d(a){l(this,d);var c=b(this,Object.getPrototypeOf(d).call(this));c.outputVertexIndices=c.registerDisposer(h.Buffer.fromData(a,new Float32Array([0,1,2,3,4,5]),a.ARRAY_BUFFER,a.STATIC_DRAW));c.vertexBasePositions=[0,0,0,1,0,0,0,1,0,1,1,0,0,0,1,
1,0,1,0,1,1,1,1,1];a=[0,1,2,4,5,3,6,7];for(var e=[0,1,2,5,3,4,6,7],f=[0,1,1,4,4,7,4,7,1,5,0,1,1,4,4,7,0,2,2,5,5,7,5,7,2,6,0,2,2,5,5,7,0,3,3,6,6,7,6,7,3,4,0,3,3,6,6,7],k=[0,1,2,3,4,5,6,7,1,4,5,0,3,7,2,6,2,6,0,5,7,3,1,4,3,0,6,4,1,2,7,5,4,3,7,1,0,6,5,2,5,2,1,7,6,0,4,3,6,7,3,2,5,4,0,1,7,5,4,6,2,1,3,0],p=[],q=0;8>q;++q)for(var g=0;g<f.length;++g)p.push(a[k[8*e[q]+f[g]]]);c.vertexIndices=new Int32Array(p);return c}a(d,c);r(d,null,[{key:"get",value:function(a){return a.memoize.get("SliceViewShaderBuffers",
function(){return new d(a)})}}]);return d}(q.RefCounted);c.glsl_getPositionWithinChunk="\nvec3 getPositionWithinChunk () {\n  return floor(min(vChunkPosition, uChunkDataSize - 1.0));\n}\n";var y=f.vec3.create(),x=function(e){function h(a){l(this,h);var c=b(this,Object.getPrototypeOf(h).call(this));c.data=c.registerDisposer(B.get(a));return c}a(h,e);r(h,[{key:"defineShader",value:function(a){var b=this.data;a.addAttribute("highp float","aVertexIndexFloat");a.addUniform("highp vec3","uTranslation");
a.addUniform("highp mat4","uProjectionMatrix");a.addUniform("highp vec3","uPlaneNormal");a.addUniform("highp float","uPlaneDistance");a.addUniform("highp ivec2","uVertexIndex",24);a.addUniform("highp vec3","uVertexBasePosition",8);a.addInitializer(function(a){a.gl.uniform3fv(a.uniform("uVertexBasePosition"),new Float32Array(b.vertexBasePositions))});a.addUniform("highp vec3","uChunkDataSize");a.addUniform("highp vec3","uVoxelSize");a.addUniform("highp vec3","uLowerClipBound");a.addUniform("highp vec3",
"uUpperClipBound");a.addVarying("highp vec3","vChunkPosition");a.setVertexMain("\nvec3 chunkSize = uChunkDataSize * uVoxelSize;\nint vertexIndex = int(aVertexIndexFloat);\nfor (int e = 0; e < 4; ++e) {\n  highp ivec2 vidx = uVertexIndex[vertexIndex*4 + e];\n  highp vec3 v1 = max(uLowerClipBound, min(uUpperClipBound, chunkSize * uVertexBasePosition[vidx.x] + uTranslation));\n  highp vec3 v2 = max(uLowerClipBound, min(uUpperClipBound, chunkSize * uVertexBasePosition[vidx.y] + uTranslation));\n  highp vec3 vDir = v2 - v1;\n  highp float denom = dot(vDir, uPlaneNormal);\n  if (abs(denom) > 0.001) {\n    highp float lambda = (uPlaneDistance - dot(v1, uPlaneNormal)) / denom;\n    if ((lambda >= -0.001) && (lambda <= (1.0 + 0.001))) {\n      lambda = clamp(lambda, 0.0, 1.0);\n      highp vec3 position = v1 + lambda * vDir;\n      gl_Position = uProjectionMatrix * vec4(position, 1.0);\n      vChunkPosition = (position - uTranslation) / uVoxelSize;\n      break;\n    }\n  }\n}\n");
a.addFragmentCode(c.glsl_getPositionWithinChunk)}},{key:"computeVerticesDebug",value:function(a,b,c,e,h,k){a=f.vec3.multiply(f.vec3.create(),a,b);b=d(e);b=this.data.vertexIndices.subarray(48*b,48*(b+1));for(var p=[0,0],l=[f.vec3.create(),f.vec3.create()],q=f.vec3.create(),g=f.vec3.create(),n=f.vec3.create(),m=f.vec3.create(),w=f.vec3.create(),u=new Float32Array(this.data.vertexBasePositions),z=function(a){return u.subarray(3*a,3*a+3)},r=0;6>r;++r)for(var x=0;4>x;++x){for(var y=0;2>y;++y)p[y]=b[2*
(4*r+x)+y],f.vec3.multiply(l[y],a,z(p[y]));f.vec3.add(q,l[0],h);f.vec3.subtract(g,l[1],l[0]);y=f.vec3.dot(g,e);if(.001<Math.abs(y)){var A=(c-f.vec3.dot(q,e))/y;if(-.001<=A&&1.001>=A){A=Math.max(0,Math.min(1,A));f.vec3.scaleAndAdd(n,q,g,A);f.vec3.transformMat4(m,f.vec4.fromValues(n[0],n[1],n[2],1),k);f.vec3.scale(w,z(p[0]),1-A);f.vec3.scaleAndAdd(w,w,z(p[1]),A);console.log("vertex "+r+", e = "+x+", at "+m+", vChunkPosition = "+w+", edge dir = "+g+", denom = "+y);break}else console.log("vertex "+r+
", e = "+x+", skipped, deom = "+y+", vDir = "+f.vec3Key(g)+", uPlaneNormal = "+f.vec3Key(e)+", lambda="+A)}else console.log("vertex "+r+", e = "+x+", skipped, deom = "+y+", vDir = "+f.vec3Key(g)+", uPlaneNormal = "+f.vec3Key(e))}}},{key:"beginSlice",value:function(a,b,c,e){var f=e.viewportAxes[2],h=d(f);a.uniformMatrix4fv(b.uniform("uProjectionMatrix"),!1,c);a.uniform3fv(b.uniform("uPlaneNormal"),f.subarray(0,3));a.uniform1f(b.uniform("uPlaneDistance"),e.viewportPlaneDistanceToOrigin);c=b.attribute("aVertexIndexFloat");
this.data.outputVertexIndices.bindToVertexAttrib(c,1);a.uniform2iv(b.uniform("uVertexIndex"),this.data.vertexIndices.subarray(48*h,48*(h+1)))}},{key:"endSlice",value:function(a,b){var c=b.attribute("aVertexIndexFloat");a.disableVertexAttribArray(c)}},{key:"beginSource",value:function(a,b,c){a.uniform3fv(b.uniform("uVoxelSize"),c.voxelSize);a.uniform3fv(b.uniform("uLowerClipBound"),f.vec3.add(y,c.lowerClipBound,c.chunkLayout.offset));a.uniform3fv(b.uniform("uUpperClipBound"),f.vec3.add(y,c.upperClipBound,
c.chunkLayout.offset))}},{key:"setupChunkDataSize",value:function(a,b,c){a.uniform3fv(b.uniform("uChunkDataSize"),c)}},{key:"drawChunk",value:function(a,b,c){a.uniform3fv(b.uniform("uTranslation"),c);a.drawArrays(a.TRIANGLE_FAN,0,6)}}],[{key:"get",value:function(a){return a.memoize.get("sliceview.VolumeSliceVertexComputationManager",function(){return new h(a)})}}]);return h}(q.RefCounted);e=function(d){function e(a,c){l(this,e);var d=b(this,Object.getPrototypeOf(e).call(this));d.chunkManager=a;d.sources=
null;d.shader=void 0;d.shaderUpdated=!0;d.rpcId=null;d.shaderError=new k.WatchableValue(void 0);d.vertexComputationManager=x.get(d.gl);Promise.resolve(c).then(function(b){var c=d.sources=b.getSources(a);b=[];for(var c=$jscomp.makeIterator(c),e=c.next();!e.done;e=c.next()){var h=e.value,e=[];b.push(e);for(var h=$jscomp.makeIterator(h),k=h.next();!k.done;k=h.next())e.push(k.value.rpcId)}c=d.registerDisposer(new A.SharedObject);c.RPC_TYPE_ID=n.SLICEVIEW_RENDERLAYER_RPC_ID;c.initializeCounterpart(a.rpc,
{sources:b});d.rpcId=c.rpcId;b=d.sources[0][0].spec;d.voxelSize=b.voxelSize;d.boundingBox=new f.BoundingBox(f.vec3.add(f.vec3.create(),b.chunkLayout.offset,b.lowerClipBound),f.vec3.add(f.vec3.create(),b.chunkLayout.offset,b.upperClipBound));d.setReady(!0)});return d}a(e,d);r(e,[{key:"initializeShader",value:function(){if(this.shaderUpdated){this.shaderUpdated=!1;try{var a=this.getShader();this.disposeShader();this.shader=a;this.shaderError.value=void 0}catch(b){this.shaderError.value=b}}}},{key:"disposeShader",
value:function(){this.shader&&(this.shader.dispose(),this.shader=void 0)}},{key:"disposed",value:function(){m(Object.getPrototypeOf(e.prototype),"disposed",this).call(this);this.disposeShader()}},{key:"getValueAt",value:function(a){for(var b=$jscomp.makeIterator(this.sources),c=b.next();!c.done;c=b.next())for(var c=$jscomp.makeIterator(c.value),d=c.next();!d.done;d=c.next())if(d=d.value.getValueAt(a),null!=d)return d;return null}},{key:"getShaderKey",value:function(){return""}},{key:"getShader",value:function(){var a=
this,b=this.getShaderKey()+"/"+this.chunkFormat.shaderKey;return this.gl.memoize.get(b,function(){return a.buildShader()})}},{key:"buildShader",value:function(){var a=new u.ShaderBuilder(this.gl);this.defineShader(a);return a.build()}},{key:"defineShader",value:function(a){this.vertexComputationManager.defineShader(a);a.addFragmentCode("\nvoid emit(vec4 color) {\n  gl_FragData[0] = color;\n}\n");this.chunkFormat.defineShader(a);a.addFragmentCode("\n"+c.GLSL_TYPE_FOR_DATA_TYPE.get(this.dataType)+" getDataValue() { return getDataValue(0); }\n")}},
{key:"beginSlice",value:function(a){var b=a.dataToDevice,c=this.gl,d=this.shader;d.bind();this.vertexComputationManager.beginSlice(c,d,b,a);return d}},{key:"endSlice",value:function(a){this.vertexComputationManager.endSlice(this.gl,a)}},{key:"draw",value:function(a){var b=a.visibleLayers.get(this);if(0!==b.length&&(this.initializeShader(),void 0!==this.shader)){var c=this.gl,d=f.vec3.create(),e=this.beginSlice(a),h=this.vertexComputationManager,k=this.chunkFormat;k.beginDrawing(c,e);for(var b=$jscomp.makeIterator(b),
p=b.next();!p.done;p=b.next()){var l=p.value,q=l.spec.chunkLayout,p=q.offset,g=l.chunks,n=q.size,m=void 0;if(q=a.visibleChunks.get(q)){h.beginSource(c,e,l.spec);l=l.chunkFormat;l.beginSource(c,e);for(var q=$jscomp.makeIterator(q),w=q.next();!w.done;w=q.next())if((w=g.get(w.value))&&w.state===v.ChunkState.GPU_MEMORY){var u=w.chunkDataSize;u!==m&&(m=u,h.setupChunkDataSize(c,e,m));f.vec3.multiply(d,n,w.chunkGridPosition);f.vec3.add(d,d,p);l.bindChunk(c,e,w);h.drawChunk(c,e,d)}}}k.endDrawing(c,e);this.endSlice(e)}}},
{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}},{key:"chunkFormat",get:function(){return this.sources[0][0].chunkFormat}},{key:"dataType",get:function(){return this.sources[0][0].spec.dataType}}]);return e}(g.RenderLayer);c.RenderLayer=e},function(g,c,e){function l(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,
configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),d=e(34);g=function(){function c(a){b(this,c);this.value_=a;this.changed=
new d.Signal}a(c,[{key:"value",get:function(){return this.value_},set:function(a){a!==this.value_&&(this.value_=a,this.changed.dispatch())}}]);return c}();c.WatchableValue=g;g=function(c){function d(a,c){var e=2>=arguments.length||void 0===arguments[2]?a:arguments[2];b(this,d);var l;l=Object.getPrototypeOf(d).call(this,a);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");l=!l||"object"!==typeof l&&"function"!==typeof l?this:l;l.validator=c;l.defaultValue=
e;return l}l(d,c);a(d,[{key:"toJSON",value:function(){return this.value_===this.defaultValue?void 0:this.value_}},{key:"reset",value:function(){this.value=this.defaultValue}},{key:"restoreState",value:function(a){if(void 0!==a){var b=this.validator;try{this.value=b(a);return}catch(c){}}this.value=this.defaultValue}}]);return d}(g);c.TrackableValue=g},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in
e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(23);var m=e(9),r=e(38),v=e(68),n=e(40);e=function(c){function e(a){var c=1>=arguments.length||void 0===arguments[1]?{}:arguments[1],d=c.numDataBuffers,d=void 0===d?1:d,k=c.depthBuffer,k=void 0===k?!1:k,c=c.stencilBuffer,c=void 0===c?!1:c;l(this,e);var g=b(this,Object.getPrototypeOf(e).call(this));g.gl=a;g.width=Number.NaN;g.height=Number.NaN;g.framebuffer=g.gl.createFramebuffer();
g.depthBuffer=null;g.dataTextures=[];g.attachmentVerified=!1;g.tempPixel=new Uint8Array(4);g.fullAttachmentList=[];g.singleAttachmentList=[g.gl.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL];for(var n=g.dataTextures,m=g.fullAttachmentList,r=0;r<d;++r)n[r]=a.createTexture(),m[r]=a.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL+r;if(k||c)g.depthBuffer=a.createRenderbuffer();g.useStencilBuffer=c;return g}a(e,c);d(e,[{key:"disposed",value:function(){var a=this.gl,b=this.depthBuffer;a.deleteFramebuffer(this.framebuffer);
null!=b&&a.deleteRenderbuffer(b);for(var b=$jscomp.makeIterator(this.dataTextures),c=b.next();!c.done;c=b.next())a.deleteTexture(c.value)}},{key:"resize",value:function(a,b){if(!this.hasSize(a,b)){this.width=a;this.height=b;for(var c=this.gl,d=this.useStencilBuffer,e=this.depthBuffer,k=$jscomp.makeIterator(this.dataTextures),l=k.next();!l.done;l=k.next())v.resizeTexture(c,l.value,a,b);e&&(c.bindRenderbuffer(c.RENDERBUFFER,e),c.renderbufferStorage(c.RENDERBUFFER,d?c.DEPTH_STENCIL:c.DEPTH_COMPONENT16,
a,b),c.bindRenderbuffer(c.RENDERBUFFER,null))}}},{key:"hasSize",value:function(a,b){return this.width===a&&this.height===b}},{key:"bind",value:function(a,b){this.resize(a,b);var c=this.gl,d=this.useStencilBuffer,e=this.depthBuffer;c.bindFramebuffer(c.FRAMEBUFFER,this.framebuffer);e&&c.framebufferRenderbuffer(c.FRAMEBUFFER,d?c.DEPTH_STENCIL_ATTACHMENT:c.DEPTH_ATTACHMENT,c.RENDERBUFFER,e);this.dataTextures.forEach(function(a,b){c.framebufferTexture2D(c.FRAMEBUFFER,c.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL+
b,c.TEXTURE_2D,a,0)});c.WEBGL_draw_buffers.drawBuffersWEBGL(this.fullAttachmentList);this.verifyAttachment();c.viewport(0,0,a,b)}},{key:"unbind",value:function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,null)}},{key:"bindSingle",value:function(a){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this.dataTextures[a],0);b.WEBGL_draw_buffers.drawBuffersWEBGL(this.singleAttachmentList)}},{key:"readPixel",value:function(a,
b,c){var d=this.gl,e=this.tempPixel;try{this.bindSingle(a),d.readPixels(b,c,1,1,d.RGBA,d.UNSIGNED_BYTE,e)}finally{d.bindFramebuffer(d.FRAMEBUFFER,null)}return e}},{key:"readPixelAsUint32",value:function(a,b,c){a=this.readPixel(a,b,c);return a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24)}},{key:"verifyAttachment",value:function(){if(!this.attachmentVerified){var a=this.gl;if(a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE)throw Error("Framebuffer configuration not supported");this.attachmentVerified=
!0}}}]);return e}(g.RefCounted);c.OffscreenFramebuffer=e;e=function(c){function e(a){l(this,e);var c=b(this,Object.getPrototypeOf(e).call(this));c.gl=a;c.copyVertexPositionsBuffer=c.registerDisposer(r.Buffer.fromData(c.gl,new Float32Array([-1,-1,0,1,-1,1,0,1,1,1,0,1,1,-1,0,1]),c.gl.ARRAY_BUFFER,c.gl.STATIC_DRAW));c.copyTexCoordsBuffer=c.registerDisposer(r.Buffer.fromData(c.gl,new Float32Array([0,0,0,1,1,1,1,0]),c.gl.ARRAY_BUFFER,c.gl.STATIC_DRAW));c.trivialTextureShader=c.registerDisposer(n.trivialTextureShader(c.gl));
return c}a(e,c);d(e,[{key:"draw",value:function(a){var b=this.gl,c=this.trivialTextureShader;c.bind();b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,a);b.uniform1i(c.uniform("uSampler"),0);b.uniformMatrix4fv(c.uniform("uProjectionMatrix"),!1,m.identityMat4);a=c.attribute("aVertexPosition");this.copyVertexPositionsBuffer.bindToVertexAttrib(a,4);c=c.attribute("aTexCoord");this.copyTexCoordsBuffer.bindToVertexAttrib(c,2);b.drawArrays(b.TRIANGLE_FAN,0,4);b.disableVertexAttribArray(a);b.disableVertexAttribArray(c);
b.bindTexture(b.TEXTURE_2D,null)}}],[{key:"get",value:function(a){return a.memoize.get("OffscreenCopyHelper",function(){return new e(a)})}}]);return e}(g.RefCounted);c.OffscreenCopyHelper=e},function(g,c){function e(c){c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE)}c.setRawTextureParameters=e;c.resizeTexture=
function(c,b,a,d){var g=4>=arguments.length||void 0===arguments[4]?c.RGBA:arguments[4],r=5>=arguments.length||void 0===arguments[5]?c.UNSIGNED_BYTE:arguments[5];c.activeTexture(c.TEXTURE0+c.tempTextureUnit);c.bindTexture(c.TEXTURE_2D,b);e(c);c.texImage2D(c.TEXTURE_2D,0,g,a,d,0,g,r,null);c.bindTexture(c.TEXTURE_2D,null)}},function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:
b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var d=function n(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,
b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:n(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},m=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(23);var r=e(34);e=function(){function b(c,d){a(this,b);this.value_=c;this.defaultValue=d;this.changed=
new r.Signal}m(b,[{key:"toggle",value:function(){this.value=!this.value}},{key:"toJSON",value:function(){return this.value_===this.defaultValue?void 0:this.value_}},{key:"restoreState",value:function(a){this.value=!0===a||!1===a?a:this.defaultValue}},{key:"reset",value:function(){this.value=this.defaultValue}},{key:"value",get:function(){return this.value_},set:function(a){a!==this.value_&&(this.value_=a,this.changed.dispatch())}}]);return b}();c.TrackableBoolean=e;e=function(c){function e(b){a(this,
e);var c=l(this,Object.getPrototypeOf(e).call(this));c.model=b;c.element=document.createElement("input");var d=c.element;d.type="checkbox";c.registerSignalBinding(b.changed.add(c.updateCheckbox,c));c.updateCheckbox();c.registerEventListener(d,"change",function(a){b.value=this.checked});return c}b(e,c);m(e,[{key:"updateCheckbox",value:function(){this.element.checked=this.model.value}},{key:"disposed",value:function(){var a=this.element,b=a.parentElement;b&&b.removeChild(a);d(Object.getPrototypeOf(e.prototype),
"disposed",this).call(this)}}]);return e}(g.RefCounted);c.TrackableBooleanCheckbox=e;g=function(c){function d(b,c){a(this,d);var e=l(this,Object.getPrototypeOf(d).call(this));e.model=b;e.element=c;e.updateVisibility();e.registerSignalBinding(b.changed.add(function(){e.updateVisibility()}));return e}b(d,c);m(d,[{key:"updateVisibility",value:function(){this.element.style.display=this.model.value?"":"none"}}]);return d}(g.RefCounted);c.ElementVisibilityFromTrackableBoolean=g},function(g,c){c.startRelativeMouseDrag=
function(c,l){var b=c.view.document,a=c.screenX,d=c.screenY,g=function(b){var c=a-b.screenX,e=d-b.screenY;a=b.screenX;d=b.screenY;l(b,c,e)},r=c.button,v=function(a){a.button===r&&(b.removeEventListener("mousemove",g,!0),b.removeEventListener("mouseup",v,!1))};b.addEventListener("mousemove",g,!0);b.addEventListener("mouseup",v,!1)}},function(g,c){c.glsl_packFloat01ToFixedPoint="\nvec4 packFloat01ToFixedPoint(const float value) {\n  const vec4 shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n  const vec4 mask = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n  vec4 result = fract(value * shift);\n  result -= result.xxyz * mask;\n  return result * 256.0 / 255.0;\n}\n";
c.unpackFloat01FromFixedPoint=function(c){return(c[3]+1/256*c[2]+1/65536*c[1]+1/16777216*c[0])/256};c.glsl_hsvToRgb="\nvec3 hueToRgb(float hue) {\n  float hue6 = hue * 6.0;\n  float r = abs(hue6 - 3.0) - 1.0;\n  float g = 2.0 - abs(hue6 - 2.0);\n  float b = 2.0 - abs(hue6 - 4.0);\n  return clamp(vec3(r, g, b), 0.0, 1.0);\n}\nvec3 hsvToRgb(vec3 c) {\n  vec3 hueRgb = hueToRgb(c.x);\n  return c.z * ((hueRgb - 1.0) * c.y + 1.0);\n}\n";c.glsl_uint64="\nstruct uint64_t {\n  vec4 low, high;\n};\nuint64_t toUint64(uint64_t x) { return x; }\n";
c.glsl_uint8=[c.glsl_uint64,"\nstruct uint8_t {\n  float value;\n};\nfloat toRaw(uint8_t x) { return x.value * 255.0; }\nfloat toNormalized(uint8_t x) { return x.value; }\nuint64_t toUint64(uint8_t x) {\n  uint64_t result;\n  result.low = vec4(x.value, 0.0, 0.0, 0.0);\n  result.high = vec4(0.0, 0.0, 0.0, 0.0);\n  return result;\n}\n"];c.glsl_float="\nfloat toRaw(float x) { return x; }\nfloat toNormalized(float x) { return x; }\n";c.glsl_uint16=[c.glsl_uint64,"\nstruct uint16_t {\n  vec2 value;\n};\nfloat toRaw(uint16_t x) { return x.value.x * 255.0 + x.value.y * 65280.0; }\nfloat toNormalized(uint16_t x) { return toRaw(x) / 65535.0; }\nuint64_t toUint64(uint16_t x) {\n  uint64_t result;\n  result.low = vec4(x.value, 0.0, 0.0);\n  result.high = vec4(0.0, 0.0, 0.0, 0.0);\n  return result;\n}\n"];
c.glsl_uint32=[c.glsl_uint64,"\nstruct uint32_t {\n  vec4 value;\n};\nuint64_t toUint64(uint32_t x) {\n  uint64_t result;\n  result.low = x.value;\n  result.high = vec4(0.0, 0.0, 0.0, 0.0);\n  return result;\n}\n"];c.glsl_getSubscriptsFromNormalized="\nvec3 getSubscriptsFromNormalized(vec3 normalizedPosition, vec3 size) {\n  return floor(min(normalizedPosition * size, size - 1.0));\n}\n";c.glsl_getFortranOrderIndex="\nfloat getFortranOrderIndex(vec3 subscripts, vec3 size) {\n  return subscripts.x + size.x * (subscripts.y + size.y * subscripts.z);\n}\n";
c.glsl_getFortranOrderIndexFromNormalized=[c.glsl_getSubscriptsFromNormalized,c.glsl_getFortranOrderIndex,"\nfloat getFortranOrderIndexFromNormalized(vec3 normalizedPosition, vec3 size) {\n  return getFortranOrderIndex(getSubscriptsFromNormalized(normalizedPosition, size), size);\n}\n"];c.glsl_imod="\nfloat imod(float x, float y) {\n  return x - y * floor(x / y);\n}\n";c.glsl_exactDot="\nfloat exactDot(vec4 a, vec4 b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n}\nfloat exactDot(vec3 a, vec3 b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n";
c.fract=function(c){return c-Math.floor(c)};c.step=function(c,l){return l<c?0:1};c.mod=function(c,l){return c%l};c.exp2=function(c){return Math.pow(2,c)};c.glsl_packFloat="\nvec4 packFloatIntoVec4(float f) {\n  float magnitude = abs(f); \n  if (magnitude == 0.0) {\n     return vec4(0,0,0,0);\n  }\n  float sign =  step(0.0, -f);\n  float exponent = floor(log2(magnitude)); \n  float mantissa = magnitude / exp2(exponent); \n  // Denormalized values if all exponent bits are zero\n  if (mantissa < 1.0) {\n     exponent -= 1.0;\n  }\n\n  exponent +=  127.0;\n\n  vec4 result;\n  result[3] = 128.0 * sign + floor(exponent / 2.0);\n  result[2] = 128.0 * mod(exponent, 2.0) +  mod(floor(mantissa * float(128.0)),128.0);\n  result[1] = floor( mod(floor(mantissa* exp2(float(23.0 - 8.0))), exp2(8.0)));\n  result[0] = floor( exp2(23.0)* mod(mantissa, exp2(-15.0)));\n  return result / 255.0;\n}\n";
c.glsl_debugFunctions=[c.glsl_packFloat];c.encodeBytesToFloat32=function(c){c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength);for(var l=c.length,b=new Float32Array(l),a=0;a<l;++a)b[a]=c[a]/255;return b};c.setVec4FromUint32=function(c,l){for(var b=0;4>b;++b)c[b]=(l>>8*b&255)/255;return c};c.getUint32FromVec4=function(c){return 255*c[0]+65280*c[1]+16711680*c[2]+4278190080*c[3]}},function(g,c){},function(g,c){},function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var d=function u(a,b,c){null===a&&
(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:u(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},m=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),r=e(75),v=e(23);g=e(9);var n=e(52),k=e(22),
q=e(34),f=function(){function b(c,d){a(this,b);this.key=c;this.value=d}m(b,[{key:"toString",value:function(){return this.key+"\u2192"+this.value}}]);return b}();c.Uint64MapEntry=f;e=function(c){function d(){a(this,d);for(var b=arguments.length,c=Array(b),e=0;e<b;e++)c[e]=arguments[e];var f,b=l(this,(f=Object.getPrototypeOf(d)).call.apply(f,[].concat([this],$jscomp.arrayFromIterable(c))));b.selectedSegment=new n.Uint64;b.hasSelectedSegment=!1;b.changed=new q.Signal;return b}b(d,c);m(d,[{key:"set",
value:function(a){if(null==a)this.hasSelectedSegment&&(this.hasSelectedSegment=!1,this.changed.dispatch());else{var b=this.selectedSegment;this.hasSelectedSegment&&a.low===b.low&&a.high===b.high||(b.low=a.low,b.high=a.high,this.hasSelectedSegment=!0,this.changed.dispatch())}}},{key:"isSelected",value:function(a){return this.hasSelectedSegment&&n.Uint64.equal(a,this.selectedSegment)}},{key:"bindTo",value:function(a,b){var c=this,d=new n.Uint64;this.registerSignalBinding(a.changed.add(function(){var e=
a.get(b);"number"===typeof e?(d.low=e,d.high=0,e=d):e instanceof f&&(e=e.value);c.set(e)}))}}]);return d}(v.RefCounted);c.SegmentSelectionState=e;c.registerRedrawWhenSegmentationDisplayStateChanged=function(a,b){var c=function(){b.redrawNeeded.dispatch()};b.registerSignalBinding(a.segmentColorHash.changed.add(c));b.registerSignalBinding(a.visibleSegments.changed.add(c));b.registerSignalBinding(a.segmentEquivalences.changed.add(c));b.registerSignalBinding(a.segmentSelectionState.changed.add(c))};var p=
g.vec3.create();c.getObjectColor=function(a,b){a.segmentColorHash.compute(p,b);if(a.segmentSelectionState.isSelected(b))for(var c=0;3>c;++c)p[c]=.5*p[c]+.5;return p};c.forEachSegmentToDraw=function(a,b,c){r.forEachVisibleSegment(a,function(a,d){var e=r.getObjectKey(a),e=b.get(e);void 0!==e&&c(d,a,e)})};e=function(c){function e(b,c){a(this,e);var d=l(this,Object.getPrototypeOf(e).call(this));d.chunkManager=b;d.displayState=c;return d}b(e,c);m(e,[{key:"initializeCounterpartWithChunkManager",value:function(a){var b=
this.displayState;a.chunkManager=this.chunkManager.rpcId;a.visibleSegments=b.visibleSegments.rpcId;a.segmentEquivalences=b.segmentEquivalences.rpcId;d(Object.getPrototypeOf(e.prototype),"initializeCounterpart",this).call(this,this.chunkManager.rpc,a)}}]);return e}(k.SharedObject);c.SegmentationLayerSharedObject=e},function(g,c){c.getObjectKey=function(c){return c.low+","+c.high};c.forEachVisibleSegment=function(c,l){for(var b=c.segmentEquivalences,a=$jscomp.makeIterator(c.visibleSegments),d=a.next();!d.done;d=
a.next())if(d=d.value,b.disjointSets.isMinElement(d))for(var g=$jscomp.makeIterator(b.setElements(d)),r=g.next();!r.done;r=g.next())l(r.value,d)}},function(g,c,e){function l(a){x.verifyObject(a);var b=x.verifyObjectProperty(a,"neariso_voxelres",function(a){return x.verifyObjectAsMap(a,x.verify3dScale)}),c=x.verifyObjectProperty(a,"neariso_imagesize",function(a){return x.verifyObjectAsMap(a,x.verify3dDimensions)}),d=x.verifyObjectProperty(a,"neariso_offset",function(a){return x.verifyObjectAsMap(a,
x.verify3dVec)});return x.verifyObjectProperty(a,"resolutions",function(a){return x.parseArray(a,x.verifyInt)}).map(function(a){var e=""+a,f=b.get(e),h=c.get(e),k=d.get(e);if(void 0===f||void 0===h||void 0===k)throw Error("Missing neariso_voxelres/neariso_imagesize/neariso_offset for resolution "+a+".");return{key:e,voxelSize:f,imageSize:h,voxelOffset:k}})}function b(a){a=z.get(a);void 0===a&&(a=h.VolumeType.UNKNOWN);return a}function a(a){x.verifyObject(a);var c=x.verifyObjectProperty(a,"channel_type",
x.verifyString);return{channelType:c,description:x.verifyObjectProperty(a,"description",x.verifyString),volumeType:b(c),dataType:x.verifyObjectProperty(a,"datatype",function(a){return x.verifyEnumString(a,h.DataType)})}}function d(b){x.verifyObject(b);return{channels:x.verifyObjectProperty(b,"channels",function(b){return x.verifyObjectAsMap(b,a)}),scales:x.verifyObjectProperty(b,"dataset",l)}}function m(a,b){var c=JSON.stringify({hostnames:a,token:b}),e=G.get(c);if(void 0!==e)return e;e=y.sendHttpRequest(y.openShardedHttpRequest(a,
"/ocp/ca/"+b+"/info/"),"json").then(d);G.set(c,e);return e}function r(a,b){var c=b.match(F);if(null===c)throw Error("Invalid volume path "+JSON.stringify(b));var d=x.stableStringify({hostnames:a,path:b}),e=Q.get(d);if(void 0!==e)return e;var f=c[1],h=c[2],k=x.parseQueryStringParameters(c[3]||""),c=m(a,f).then(function(b){return new D(a,f,b,h,k)});Q.set(d,c);return c}function v(a){var b=a.match(I);if(null===b)throw Error("Invalid ndstore volume path: "+JSON.stringify(a));return r([b[1]],b[2])}function n(a){var b=
JSON.stringify(a),c=O.get(b);if(void 0!==c)return c;a=y.sendHttpRequest(y.openShardedHttpRequest(a,"/ocp/ca/public_tokens/"),"json").then(function(a){return x.parseArray(a,x.verifyString)});O.set(b,a);return a}function k(a,b){var c=b.match(/^(?:([^\/]+)(?:\/([^\/]*))?)?$/);if(null===c)return Promise.reject(null);if(void 0===c[2]){var d=function(){var b=c[1]||"";return{v:n(a).then(function(a){return{offset:0,completions:A.getPrefixMatchesWithDescriptions(b,a,function(a){return a+"/"},function(a){})}})}}();
if("object"===typeof d)return d.v}return t.cancellableThen(m(a,c[1]),function(a){a=A.getPrefixMatchesWithDescriptions(c[2],a.channels,function(a){return a[0]},function(a){return a[1].channelType+" ("+h.DataType[a[1].dataType]+")"});return{offset:c[1].length+1,completions:a}})}function q(a){var b=a.match(I);return null===b?Promise.reject(null):t.cancellableThen(k([b[1]],b[2]),function(a){return A.applyCompletionOffset(b[1].length+1,a)})}var f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=
c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(28);var p=e(77),h=e(60),u=e(59),A=e(29),B=e(9),y=e(25),x=e(8),t=e(20),z=new Map;z.set("image",h.VolumeType.IMAGE);z.set("annotation",h.VolumeType.SEGMENTATION);var w=new Set(["npz","raw","jpeg"]),C=u.defineParameterizedVolumeChunkSource(p.VolumeChunkSourceParameters),D=function(){function a(b,c,d,e,f){if(!(this instanceof
a))throw new TypeError("Cannot call a class as a function");this.baseUrls=b;this.key=c;this.tokenInfo=d;this.parameters=f;if(void 0===e){e=Array.from(d.channels.keys());if(1!==e.length)throw Error("Dataset contains multiple channels: "+JSON.stringify(e));e=e[0]}b=d.channels.get(e);if(void 0===b)throw Error("Specified channel "+JSON.stringify(e)+" is not one of the supported channels "+JSON.stringify(Array.from(d.channels.keys())));this.channel=e;this.channelInfo=b;this.scales=d.scales;d=x.verifyOptionalString(f.encoding);
if(void 0===d)d=this.volumeType===h.VolumeType.IMAGE?"jpeg":"npz";else if(!w.has(d))throw Error("Invalid encoding: "+JSON.stringify(d)+".");this.encoding=d}f(a,[{key:"getSources",value:function(a){var b=this;return this.scales.map(function(c){for(var d=c.voxelOffset,e=c.voxelSize,f=B.vec3.create(),k=0;3>k;++k)f[k]=Math.ceil(d[k]);return h.VolumeChunkSpecification.getDefaults({numChannels:b.numChannels,volumeType:b.volumeType,dataType:b.dataType,voxelSize:e,chunkLayoutOffset:B.vec3.multiply(B.vec3.create(),
d,e),baseVoxelOffset:f,upperVoxelBound:c.imageSize}).map(function(d){return C.get(a,d,{baseUrls:b.baseUrls,key:b.key,channel:b.channel,resolution:c.key,encoding:b.encoding})})})}},{key:"getMeshSource",value:function(a){return null}},{key:"dataType",get:function(){return this.channelInfo.dataType}},{key:"numChannels",get:function(){return 1}},{key:"volumeType",get:function(){return this.channelInfo.volumeType}}]);return a}();c.MultiscaleVolumeChunkSource=D;var F=/^([^\/?]+)(?:\/([^\/?]+))?(?:\?(.*))?$/,
G=new Map;c.getTokenInfo=m;var Q=new Map;c.getShardedVolume=r;var I=/^((?:http|https):\/\/[^\/?]+)\/(.*)$/;c.getVolume=v;var O=new Map;c.getPublicTokens=n;c.tokenAndChannelCompleter=k;c.volumeCompleter=q;g.registerDataSourceFactory("ndstore",{description:"NDstore",volumeCompleter:q,getVolume:v})},function(g,c){var e=function(){function b(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,
c,e){c&&b(a.prototype,c);e&&b(a,e);return a}}(),l=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");}e(b,null,[{key:"stringify",value:function(a){return"ndstore:volume:"+a.baseUrls[0]+"/"+a.key+"/"+a.channel+"/"+a.resolution+"/"+a.encoding}}]);return b}();l.RPC_ID="ndstore/VolumeChunkSource";c.VolumeChunkSourceParameters=l},function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function d(a,b,c){w.verifyObject(a);
var d=w.verifyObjectProperty(a,"Base",function(a){return new D(a)});switch(d.typeName){case "uint8blk":case "grayscale8":return new G(a,b,d,A.VolumeType.IMAGE,c);case "imagetile":return new V(a,b,d);case "labels64":case "labelblk":return new G(a,b,d,A.VolumeType.SEGMENTATION,c);default:throw Error("DVID data type "+JSON.stringify(d.typeName)+" is not supported.");}}function m(a){try{for(var b=w.verifyObjectAsMap(a,function(a){return new P(a)}),c=new Map,d=$jscomp.makeIterator(b),e=d.next();!e.done;e=
d.next()){var f=p(e.value,2),h=f[0],k=f[1];c.set(h,k);for(var l=$jscomp.makeIterator(k.vnodes),g=l.next();!g.done;g=l.next()){var q=g.value;if(q!==h){var n=new P(k);c.set(q,n)}}}for(var t=$jscomp.makeIterator(c),m=t.next();!m.done;m=t.next()){var C=p(m.value,2);C[1].uuid=C[0]}return c}catch(z){throw Error("Failed to parse DVID repositories info: "+z.message);}}function r(a){var b=w.stableStringify(a),c=Z.get(b);void 0===c&&(c=z.sendHttpRequest(z.openShardedHttpRequest(a,"/api/repos/info","GET"),"json").then(function(a){return new T(a)}),
a="repository info for DVID server "+a[0],y.StatusMessage.forPromise(c,{initialMessage:"Retrieving "+a+".",delay:!0,errorPrefix:"Error retrieving "+a+": "}),Z.set(b,c));return c}function v(a,b,c){return r(a).then(function(d){d=d.getNode(b);if(void 0===d)throw Error("Invalid node: "+JSON.stringify(b)+".");var e=d.dataInstances.get(c);if(!(e instanceof G||e instanceof V))throw Error("Invalid data instance "+c+".");var f=w.stableStringify({baseUrls:a,nodeKey:d.uuid,dataInstanceKey:c}),h=ea.get(f);void 0===
h&&(h=new R(a,d.uuid,c,e),ea.set(f,h));return h})}function n(a){var b=a.match(ca);if(null===b)throw Error("Invalid DVID URL: "+JSON.stringify(a)+".");return v([b[1]],b[2],b[3])}function k(a,b){return{offset:0,completions:x.getPrefixMatchesWithDescriptions(b,a.dataInstances.values(),function(a){return a.name},function(a){return""+a.base.typeName})}}function q(a,b){var c=b.match(/^(?:([^\/]+)(?:\/([^\/]*))?)?$/);if(null===c)throw Error("Invalid DVID URL syntax.");if(void 0===c[2])return{offset:0,completions:x.getPrefixMatchesWithDescriptions(b,
a.repositories.values(),function(a){return a.uuid+"/"},function(a){return a.alias+": "+a.description})};var d=c[1],e=a.getNode(d);return x.applyCompletionOffset(d.length+1,k(e,c[2]))}function f(a){a=a.match(/^((?:http|https):\/\/[^\/]+)\/(.*)$/);if(null===a)return Promise.reject(null);var b=a[1],c=a[2];return r([b]).then(function(a){return x.applyCompletionOffset(b.length+1,q(a,c))})}var p=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();
if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var h=a[Symbol.iterator](),k;!(d=(k=h.next()).done)&&(c.push(k.value),!b||c.length!==b);d=!0);}catch(l){e=!0,f=l}finally{try{if(!d&&h["return"])h["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),h=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=
!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),u=e(79);g=e(28);var A=e(60),B=e(59),y=e(4),x=e(29),t=e(9),z=e(25),w=e(8),C=new Map;C.set("uint8",A.DataType.UINT8);C.set("uint32",A.DataType.UINT32);C.set("uint64",A.DataType.UINT64);var D=function(){function b(c){a(this,b);this.obj=c;w.verifyObject(c);w.verifyObjectProperty(c,"TypeName",w.verifyString)}h(b,[{key:"typeName",get:function(){return this.obj.TypeName}}]);
return b}();c.DataInstanceBaseInfo=D;e=function Xa(b,c,d){a(this,Xa);this.obj=b;this.name=c;this.base=d};c.DataInstanceInfo=e;var F=B.defineParameterizedVolumeChunkSource(u.VolumeChunkSourceParameters),G=function(c){function d(b,c,e,f,h){a(this,d);e=l(this,Object.getPrototypeOf(d).call(this,b,c,e));e.volumeType=f;b=w.verifyObjectProperty(b,"Extended",w.verifyObject);f=w.verifyObjectProperty(b,"Values",function(a){return w.parseArray(a,w.verifyObject)});if(1>f.length)throw Error("Expected Extended.Values property to have length >= 1, but received: ${JSON.stringify(extendedValues)}.");
e.numLevels=1;for(h=new Set(h);h.has(c+"_"+e.numLevels.toString());)e.numLevels+=1;e.dataType=w.verifyObjectProperty(f[0],"DataType",function(a){return w.verifyMapKey(a,C)});e.lowerVoxelBound=w.verifyObjectProperty(b,"MinPoint",function(a){return w.parseIntVec(t.vec3.create(),a)});e.upperVoxelBound=w.verifyObjectProperty(b,"MaxPoint",function(a){return w.parseIntVec(t.vec3.create(),a)});e.voxelSize=w.verifyObjectProperty(b,"VoxelSize",function(a){return w.parseFixedLengthArray(t.vec3.create(),a,w.verifyFinitePositiveFloat)});
e.numChannels=1;return e}b(d,c);h(d,[{key:"getSources",value:function(a,b){for(var c=this,d=[],e=function(e){var f=t.vec3.clone(c.voxelSize);f[0]*=Math.pow(2,e);f[1]*=Math.pow(2,e);f[2]*=Math.pow(2,e);for(var h=t.vec3.create(),k=t.vec3.create(),l=0;3>l;++l)h[l]=Math.floor(c.voxelSize[l]/f[l]*c.lowerVoxelBound[l]),k[l]=Math.ceil(c.voxelSize[l]/f[l]*c.upperVoxelBound[l]);h=b.dataInstanceKey;0<e&&(h+="_"+e.toString());var g={baseUrls:b.baseUrls,nodeKey:b.nodeKey,dataInstanceKey:h};e=A.VolumeChunkSpecification.getDefaults({voxelSize:f,
dataType:c.dataType,numChannels:c.numChannels,baseVoxelOffset:c.lowerVoxelBound,upperVoxelBound:t.vec3.subtract(t.vec3.create(),c.upperVoxelBound,c.lowerVoxelBound),volumeType:c.volumeType}).map(function(b){return F.get(a,b,g)});d.push(e)},f=0;f<this.numLevels;++f)e(f);return d}}]);return d}(e);c.VolumeDataInstanceInfo=G;var Q=function ya(b){a(this,ya);w.verifyObject(b);this.resolution=w.verifyObjectProperty(b,"Resolution",function(a){return w.parseFixedLengthArray(t.vec3.create(),a,w.verifyFinitePositiveFloat)});
this.tileSize=w.verifyObjectProperty(b,"TileSize",function(a){return w.parseFixedLengthArray(t.vec3.create(),a,w.verifyPositiveInt)})};c.TileLevelInfo=Q;var I=[[0,1],[0,2],[1,2]],O=B.defineParameterizedVolumeChunkSource(u.TileChunkSourceParameters),V=function(c){function d(b,c,e){a(this,d);c=l(this,Object.getPrototypeOf(d).call(this,b,c,e));b=w.verifyObjectProperty(b,"Extended",w.verifyObject);c.levels=w.verifyObjectProperty(b,"Levels",function(a){return w.verifyObjectAsMap(a,function(a){return new Q(a)})});
e=c.levels.get("0");if(void 0===e)throw Error("Level 0 is not defined.");c.voxelSize=e.resolution;var f=w.verifyObjectProperty(b,"MinTileCoord",function(a){return w.parseFixedLengthArray(t.vec3.create(),a,w.verifyInt)}),h=w.verifyObjectProperty(b,"MaxTileCoord",function(a){return w.parseFixedLengthArray(t.vec3.create(),a,w.verifyInt)});c.lowerVoxelBound=t.vec3.multiply(t.vec3.create(),e.tileSize,f);c.upperVoxelBound=t.vec3.multiply(t.vec3.create(),e.tileSize,h);b=w.verifyObjectProperty(b,"Encoding",
function(a){return a});switch(b){case 2:c.encoding=u.TileEncoding.JPEG;break;default:throw Error("Unsupported tile encoding: "+JSON.stringify(b)+".");}return c}b(d,c);h(d,[{key:"getSources",value:function(a,b){for(var c=this,d=[],e=this.numChannels,f=this.dataType,h=this.encoding,k=function(k){q=p(k,2);var l=q[0],g=q[1];k=I.map(function(d){for(var k=t.vec3.clone(c.voxelSize),p=t.vec3.fromValues(1,1,1),q=0;2>q;++q)k[d[q]]=g.resolution[d[q]],p[d[q]]=g.tileSize[d[q]];for(var q=t.vec3.create(),n=t.vec3.create(),
m=0;3>m;++m)q[m]=Math.floor(c.voxelSize[m]/k[m]*c.lowerVoxelBound[m]),n[m]=Math.ceil(c.voxelSize[m]/k[m]*c.upperVoxelBound[m]);k=new A.VolumeChunkSpecification({voxelSize:k,chunkDataSize:p,numChannels:e,dataType:f,lowerVoxelBound:q,upperVoxelBound:n});return O.get(a,k,{baseUrls:b.baseUrls,nodeKey:b.nodeKey,dataInstanceKey:b.dataInstanceKey,encoding:h,level:l,dims:d[0]+"_"+d[1]})});d.push(k)},l=$jscomp.makeIterator(this.levels),g=l.next();!g.done;g=l.next()){var q;k(g.value)}return d}},{key:"dataType",
get:function(){return A.DataType.UINT8}},{key:"volumeType",get:function(){return A.VolumeType.IMAGE}},{key:"numChannels",get:function(){return 1}}]);return d}(e);c.TileDataInstanceInfo=V;c.parseDataInstance=d;var P=function za(b){a(this,za);this.errors=[];this.dataInstances=new Map;this.vnodes=new Set;if(b instanceof za)this.alias=b.alias,this.description=b.description,this.errors=b.errors,this.dataInstances=b.dataInstances;else{w.verifyObject(b);this.alias=w.verifyObjectProperty(b,"Alias",w.verifyString);
this.description=w.verifyObjectProperty(b,"Description",w.verifyString);for(var c=w.verifyObjectProperty(b,"DataInstances",w.verifyObject),e=Object.keys(c),f=$jscomp.makeIterator(e),h=f.next();!h.done;h=f.next()){h=h.value;try{this.dataInstances.set(h,d(c[h],h,e))}catch(k){h="Failed to parse data instance "+JSON.stringify(h)+": "+k.message,console.log(h),this.errors.push(h)}}b=w.verifyObjectProperty(b,"DAG",w.verifyObject);b=w.verifyObjectProperty(b,"Nodes",w.verifyObject);b=$jscomp.makeIterator(Object.keys(b));
for(c=b.next();!c.done;c=b.next())this.vnodes.add(c.value)}};c.RepositoryInfo=P;c.parseRepositoriesInfo=m;var T=function(){function b(c){a(this,b);this.repositories=m(c)}h(b,[{key:"getNode",value:function(a){for(var b=[],c=$jscomp.makeIterator(this.repositories.keys()),d=c.next();!d.done;d=c.next())d=d.value,d.startsWith(a)&&b.push(d);if(1!==b.length)throw Error("Node key "+JSON.stringify(a)+" matches "+JSON.stringify(b)+" nodes.");return this.repositories.get(b[0])}}]);return b}();c.ServerInfo=T;
var Z=new Map;c.getServerInfo=r;var R=function(){function b(c,d,e,f){a(this,b);this.baseUrls=c;this.nodeKey=d;this.dataInstanceKey=e;this.info=f}h(b,[{key:"getSources",value:function(a){return this.info.getSources(a,{baseUrls:this.baseUrls,nodeKey:this.nodeKey,dataInstanceKey:this.dataInstanceKey})}},{key:"getMeshSource",value:function(a){return null}},{key:"dataType",get:function(){return this.info.dataType}},{key:"numChannels",get:function(){return this.info.numChannels}},{key:"volumeType",get:function(){return this.info.volumeType}}]);
return b}();c.MultiscaleVolumeChunkSource=R;var ea=new Map;c.getShardedVolume=v;var ca=/^((?:http|https):\/\/[^\/]+)\/([^\/]+)\/([^\/]+)$/;c.getVolume=n;c.completeInstanceName=k;c.completeNodeAndInstance=q;c.volumeCompleter=f;g.registerDataSourceFactory("dvid",{description:"DVID",volumeCompleter:f,getVolume:n})},function(g,c){function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function l(a,
b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=
!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),d=function n(){b(this,n)};c.DVIDSourceParameters=d;var m=function(c){function d(){b(this,d);return e(this,Object.getPrototypeOf(d).apply(this,arguments))}l(d,c);a(d,null,[{key:"stringify",value:function(a){return"dvid:volume:"+a.baseUrls[0]+"/"+a.nodeKey+"/"+a.dataInstanceKey}}]);return d}(d);m.RPC_ID="dvid/VolumeChunkSource";c.VolumeChunkSourceParameters=m;(function(a){a[a.JPEG=
0]="JPEG"})(c.TileEncoding||(c.TileEncoding={}));var r=c.TileEncoding,d=function(c){function d(){b(this,d);return e(this,Object.getPrototypeOf(d).apply(this,arguments))}l(d,c);a(d,null,[{key:"stringify",value:function(a){return"dvid:volume:"+a.baseUrls[0]+"/"+a.nodeKey+"/"+a.dataInstanceKey+"/"+a.dims+"/"+a.level+"/"+r[a.encoding]}}]);return d}(d);d.RPC_ID="dvid/TileChunkSource";c.TileChunkSourceParameters=d},function(g,c,e){function l(b){return a.getShardedVolume(d,b)}function b(b){return a.tokenAndChannelCompleter(d,
b)}g=e(28);var a=e(76),d=["http://openconnecto.me","http://www.openconnecto.me"];c.getVolume=l;c.volumeCompleter=b;g.registerDataSourceFactory("openconnectome",{description:"NDstore server hosted at openconnecto.me",getVolume:l,volumeCompleter:b})},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){return B.get(a,b)}function a(a,c,d){c=h.parseSpecialUrl(c);c=r(c,2);return b(a,{baseUrls:c[0],path:c[1],lod:d})}function d(a,
b){var c=u.stableStringify({baseUrls:a,path:b}),d=t.get(c);if(void 0!==d)return d;d=h.sendHttpRequest(h.openShardedHttpRequest(a,b+"/info"),"json").then(function(c){return new x(a,b,c)});t.set(c,d);return d}function m(a){a=h.parseSpecialUrl(a);a=r(a,2);return d(a[0],a[1])}var r=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();
for(var h=a[Symbol.iterator](),k;!(d=(k=h.next()).done)&&(c.push(k.value),!b||c.length!==b);d=!0);}catch(l){e=!0,f=l}finally{try{if(!d&&h["return"])h["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),v=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,
d);return b}}();g=e(28);var n=e(82),k=e(30),q=e(60),f=e(59),p=e(9),h=e(25),u=e(8),A=f.defineParameterizedVolumeChunkSource(n.VolumeChunkSourceParameters),B=k.defineParameterizedMeshSource(n.MeshSourceParameters),y=function w(a){l(this,w);u.verifyObject(a);this.resolution=u.verifyObjectProperty(a,"resolution",function(a){return u.parseFixedLengthArray(p.vec3.create(),a,u.verifyFinitePositiveFloat)});this.voxelOffset=u.verifyObjectProperty(a,"voxel_offset",function(a){return u.parseIntVec(p.vec3.create(),
a)});this.size=u.verifyObjectProperty(a,"size",function(a){return u.parseFixedLengthArray(p.vec3.create(),a,u.verifyPositiveInt)});this.chunkSizes=u.verifyObjectProperty(a,"chunk_sizes",function(a){return u.parseArray(a,function(a){return u.parseFixedLengthArray(p.vec3.create(),a,u.verifyPositiveInt)})});if(0===this.chunkSizes.length)throw Error("No chunk sizes specified.");(this.encoding=u.verifyObjectProperty(a,"encoding",function(a){return u.verifyEnumString(a,n.VolumeChunkEncoding)}))===n.VolumeChunkEncoding.COMPRESSED_SEGMENTATION&&
(this.compressedSegmentationBlockSize=u.verifyObjectProperty(a,"compressed_segmentation_block_size",function(a){return u.parseFixedLengthArray(p.vec3.create(),a,u.verifyPositiveInt)}));this.key=u.verifyObjectProperty(a,"key",u.verifyString)},x=function(){function a(b,c,d){l(this,a);this.baseUrls=b;this.path=c;this.obj=d;u.verifyObject(d);this.dataType=u.verifyObjectProperty(d,"data_type",function(a){return u.verifyEnumString(a,q.DataType)});this.numChannels=u.verifyObjectProperty(d,"num_channels",
u.verifyPositiveInt);this.volumeType=u.verifyObjectProperty(d,"type",function(a){return u.verifyEnumString(a,q.VolumeType)});this.mesh=u.verifyObjectProperty(d,"mesh",u.verifyOptionalString);this.scales=u.verifyObjectProperty(d,"scales",function(a){return u.parseArray(a,function(a){return new y(a)})})}v(a,[{key:"getMeshSource",value:function(a){var c=this.mesh;return void 0===c?null:b(a,{baseUrls:this.baseUrls,path:this.path+"/"+c,lod:0})}},{key:"getSources",value:function(a){var b=this;return this.scales.map(function(c){return q.VolumeChunkSpecification.getDefaults({voxelSize:c.resolution,
dataType:b.dataType,numChannels:b.numChannels,chunkLayoutOffset:p.vec3.multiply(p.vec3.create(),c.resolution,c.voxelOffset),upperVoxelBound:c.size,volumeType:b.volumeType,chunkDataSizes:c.chunkSizes,baseVoxelOffset:c.voxelOffset,compressedSegmentationBlockSize:c.compressedSegmentationBlockSize}).map(function(d){return A.get(a,d,{baseUrls:b.baseUrls,path:b.path+"/"+c.key,encoding:c.encoding})})})}}]);return a}();c.MultiscaleVolumeChunkSource=x;c.getShardedMeshSource=b;c.getMeshSource=a;var t=new Map;
c.getShardedVolume=d;c.getVolume=m;g.registerDataSourceFactory("precomputed",{description:"Precomputed file-backed data source",getVolume:m,getMeshSource:a})},function(g,c){function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var l=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,
e);return b}}();(function(a){a[a.RAW=0]="RAW";a[a.JPEG=1]="JPEG";a[a.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION"})(c.VolumeChunkEncoding||(c.VolumeChunkEncoding={}));var b=function(){function a(){e(this,a)}l(a,null,[{key:"stringify",value:function(a){return"precomputed:volume:"+a.baseUrls[0]+"/"+a.path}}]);return a}();b.RPC_ID="precomputed/VolumeChunkSource";c.VolumeChunkSourceParameters=b;b=function(){function a(){e(this,a)}l(a,null,[{key:"stringify",value:function(a){return"precomputed:mesh:"+
a.baseUrls[0]+"/"+a.path+"/"+a.lod}}]);return a}();b.RPC_ID="precomputed/MeshSource";c.MeshSourceParameters=b},function(g,c,e){function l(a){f.verifyObject(a);return{key:f.verifyObjectProperty(a,"key",f.verifyString),offset:f.verifyObjectProperty(a,"offset",f.verify3dVec),sizeInVoxels:f.verifyObjectProperty(a,"sizeInVoxels",f.verify3dDimensions),voxelSize:f.verifyObjectProperty(a,"voxelSize",f.verify3dScale),chunkDataSize:f.verifyObjectProperty(a,"chunkDataSize",function(a){return void 0===a?void 0:
f.verify3dDimensions(a)})}}function b(a,b){var c=f.stableStringify({baseUrls:a,key:b}),d=A.get(b);if(void 0!==d)return d;d=q.sendHttpRequest(q.openShardedHttpRequest(a,"/neuroglancer/info/"+b),"json").then(function(c){return new u(a,b,c)});A.set(c,d);return d}function a(a){var c=a.match(B);if(null===c)throw Error("Invalid python volume path: "+JSON.stringify(a));return b([c[1]],c[2])}var d=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=
!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(28);var m=e(84),r=e(30),v=e(60),n=e(59),k=e(9),q=e(25),f=e(8),p=n.defineParameterizedVolumeChunkSource(m.VolumeChunkSourceParameters),h=r.defineParameterizedMeshSource(m.MeshSourceParameters),u=function(){function a(b,c,d){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.baseUrls=b;this.key=c;this.response=d;f.verifyObject(d);
this.dataType=f.verifyObjectProperty(d,"dataType",function(a){return f.verifyEnumString(a,v.DataType)});this.volumeType=f.verifyObjectProperty(d,"volumeType",function(a){return f.verifyEnumString(a,v.VolumeType)});this.numChannels=f.verifyObjectProperty(d,"numChannels",f.verifyPositiveInt);this.encoding=f.verifyObjectProperty(d,"encoding",function(a){return f.verifyEnumString(a,m.VolumeChunkEncoding)});var e=f.verifyObjectProperty(d,"maxVoxelsPerChunkLog2",function(a){return void 0===a?v.DEFAULT_MAX_VOXELS_PER_CHUNK_LOG2:
f.verifyPositiveInt(a)});b=f.verifyObjectProperty(d,"threeDimensionalScales",function(a){return void 0===a?void 0:f.parseArray(a,l)});d=f.verifyObjectProperty(d,"twoDimensionalScales",function(a){return void 0===a?void 0:f.parseArray(a,function(a){return f.parseFixedLengthArray(Array(3),a,l)})});if(void 0===d===(void 0===b))throw Error('Exactly one of "threeDimensionalScales" and "twoDimensionalScales" must be specified.');if(void 0!==d){if(0===d.length)throw Error("At least one scale must be specified.");
this.scales=d.map(function(a){return a.map(function(a,b){var c=a.voxelSize,d=a.sizeInVoxels,f=a.chunkDataSize,f=void 0===f?v.getTwoDimensionalBlockSize({voxelSize:c,upperVoxelBound:d,flatDimension:2-b,maxVoxelsPerChunkLog2:e}):f;return{key:a.key,offset:a.offset,sizeInVoxels:d,voxelSize:c,chunkDataSize:f}})});if(!k.vec3.equals(this.scales[0][0].voxelSize,this.scales[0][1].voxelSize)||!k.vec3.equals(this.scales[0][0].voxelSize,this.scales[0][2].voxelSize))throw Error("Lowest scale must have uniform voxel size.");
}if(void 0!==b){if(0===b.length)throw Error("At least one scale must be specified.");this.scales=b.map(function(a){var b=a.voxelSize,c=a.sizeInVoxels,d=a.chunkDataSize,d=void 0===d?v.getNearIsotropicBlockSize({voxelSize:b,upperVoxelBound:c,maxVoxelsPerChunkLog2:e}):d;return[{key:a.key,offset:a.offset,sizeInVoxels:c,voxelSize:b,chunkDataSize:d}]})}}d(a,[{key:"getSources",value:function(a){var b=this,c=this.numChannels,d=this.dataType,e=this.volumeType,f=this.encoding,h=this.scales[0][0],l=k.vec3.multiply(k.vec3.create(),
h.voxelSize,h.sizeInVoxels);return this.scales.map(function(h){return h.map(function(h){var k=v.VolumeChunkSpecification.withDefaultCompression({voxelSize:h.voxelSize,dataType:d,volumeType:e,numChannels:c,chunkLayoutOffset:h.offset,upperVoxelBound:h.sizeInVoxels,upperClipBound:l,chunkDataSize:h.chunkDataSize});return p.get(a,k,{baseUrls:b.baseUrls,key:h.key,encoding:f})})})}},{key:"getMeshSource",value:function(a){return h.get(a,{baseUrls:this.baseUrls,key:this.key})}}]);return a}();c.MultiscaleVolumeChunkSource=
u;var A=new Map;c.getShardedVolume=b;var B=/^((?:http|https):\/\/[^\/?]+)\/(.*)$/;c.getVolume=a;g.registerDataSourceFactory("python",{description:"Python-served volume",getVolume:a})},function(g,c){function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var l=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,e){c&&
a(b.prototype,c);e&&a(b,e);return b}}();(function(a){a[a.JPEG=0]="JPEG";a[a.NPZ=1]="NPZ";a[a.RAW=2]="RAW"})(c.VolumeChunkEncoding||(c.VolumeChunkEncoding={}));var b=c.VolumeChunkEncoding,a=function(){function a(){e(this,a)}l(a,null,[{key:"stringify",value:function(a){return"python:volume:"+a.baseUrls[0]+"/"+a.key+"/"+b[a.encoding]}}]);return a}();a.RPC_ID="python/VolumeChunkSource";c.VolumeChunkSourceParameters=a;a=function(){function a(){e(this,a)}l(a,null,[{key:"stringify",value:function(a){return"python:mesh:"+
a.baseUrls[0]+"/"+a.key}}]);return a}();a.RPC_ID="python/MeshSource";c.MeshSourceParameters=a},function(g,c,e){var l=e(86),b=e(87);window.addEventListener("DOMContentLoaded",function(){var a=window.viewer=b.makeDefaultViewer();l.makeDefaultKeyBindings(a.keyMap)})},function(g,c){c.makeDefaultKeyBindings=function(c){c.bind("arrowleft","x-");c.bind("arrowright","x+");c.bind("arrowup","y-");c.bind("arrowdown","y+");c.bind("comma","z-");c.bind("period","z+");c.bind("keyz","snap");c.bind("control+equal",
"zoom-in");c.bind("control+shift+equal","zoom-in");c.bind("control+minus","zoom-out");c.bind("keyr","rotate-relative-z-");c.bind("keye","rotate-relative-z+");c.bind("shift+arrowdown","rotate-relative-x-");c.bind("shift+arrowup","rotate-relative-x+");c.bind("shift+arrowleft","rotate-relative-y-");c.bind("shift+arrowright","rotate-relative-y+");c.bind("keyl","recolor");c.bind("keyx","clear-segments");c.bind("keys","toggle-show-slices");c.bind("keyb","toggle-scale-bar");c.bind("keya","toggle-axis-lines");
for(var l=1;9>=l;++l)c.bind("digit"+l,"toggle-layer-"+l);c.bind("keyn","add-layer");c.bind("keyh","help");c.bind("space","toggle-layout")}},function(g,c,e){e(88);e(89);var l=e(55),b=e(97);c.makeDefaultViewer=function(){var a=new l.DisplayContext(document.getElementById("container"));return new b.Viewer(a)}},function(g,c){},function(g,c,e){e(90);e(93)},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d=function x(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),
null===a?void 0:x(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},m=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),r=e(60);g=e(59);var v=e(91),n=e(23),k=e(9),q=e(52),f=e(92),p=e(71),h=function(c){function d(a,c,e,h){l(this,d);var k=b(this,Object.getPrototypeOf(d).call(this));
k.chunkDataSize=c;k.channelStride=c[0]*c[1]*c[2];f.compute3dTextureLayout(k,a,e,c[0],c[1],c[2]*h);return k}a(d,c);m(d,null,[{key:"get",value:function(a,b,c,e){return a.memoize.get("sliceview.UncompressedTextureLayout:"+k.vec3Key(b)+","+c+","+e,function(){return new d(a,b,c,e)})}}]);return d}(n.RefCounted),u=function(c){function e(a,c,d,h){l(this,e);h=b(this,Object.getPrototypeOf(e).call(this,h));h.dataType=c;h.numChannels=d;switch(c){case r.DataType.UINT8:h.texelsPerElement=1;h.textureFormat=a.LUMINANCE;
h.texelType=a.UNSIGNED_BYTE;h.arrayElementsPerTexel=1;h.arrayConstructor=Uint8Array;break;case r.DataType.UINT16:h.texelsPerElement=1;h.textureFormat=a.LUMINANCE_ALPHA;h.texelType=a.UNSIGNED_BYTE;h.arrayElementsPerTexel=2;h.arrayConstructor=Uint8Array;break;case r.DataType.UINT64:h.texelsPerElement=2;h.textureFormat=a.RGBA;h.texelType=a.UNSIGNED_BYTE;h.arrayElementsPerTexel=4;h.arrayConstructor=Uint8Array;break;case r.DataType.UINT32:h.texelsPerElement=1;h.textureFormat=a.RGBA;h.texelType=a.UNSIGNED_BYTE;
h.arrayElementsPerTexel=4;h.arrayConstructor=Uint8Array;break;case r.DataType.FLOAT32:h.texelsPerElement=1;h.textureFormat=a.LUMINANCE;h.texelType=a.FLOAT;h.arrayElementsPerTexel=1;h.arrayConstructor=Float32Array;break;default:throw Error("Unsupported dataType: "+c);}h.textureAccessHelper=new f.OneDimensionalTextureAccessHelper("chunkData",h.texelsPerElement);return h}a(e,c);m(e,[{key:"defineShader",value:function(a){d(Object.getPrototypeOf(e.prototype),"defineShader",this).call(this,a);this.textureAccessHelper.defineShader(a);
1<this.numChannels?(a.addUniform("highp float","uChannelStride"),a.addFragmentCode("\nfloat getChannelOffset(int channelIndex) {\n  return float(channelIndex) * uChannelStride;\n}\n")):a.addFragmentCode("float getChannelOffset(int channelIndex) { return 0.0; }");a.addFragmentCode("\nfloat getIndexIntoChunk (int channelIndex) {\n  vec3 chunkDataPosition = getPositionWithinChunk();\n  return chunkDataPosition.x + uChunkDataSize.x * (chunkDataPosition.y + uChunkDataSize.y * chunkDataPosition.z) + getChannelOffset(channelIndex);\n}\n");
switch(this.dataType){case r.DataType.UINT8:a.addFragmentCode(p.glsl_uint8);a.addFragmentCode("\nuint8_t getDataValue (int channelIndex) {\n  uint8_t result;\n  vec4 temp;\n  "+this.textureAccessHelper.readTextureValue+"(uVolumeChunkSampler, getIndexIntoChunk(channelIndex), temp);\n  result.value = temp.x;\n  return result;\n}\n");break;case r.DataType.FLOAT32:a.addFragmentCode(p.glsl_float);a.addFragmentCode("\nfloat getDataValue (int channelIndex) {\n  vec4 temp;\n  "+this.textureAccessHelper.readTextureValue+
"(uVolumeChunkSampler, getIndexIntoChunk(channelIndex), temp);\n  return temp.x;\n}\n");break;case r.DataType.UINT16:a.addFragmentCode(p.glsl_uint16);a.addFragmentCode("\nuint16_t getDataValue (int channelIndex) {\n  uint16_t result;\n  vec4 temp;\n  "+this.textureAccessHelper.readTextureValue+"(uVolumeChunkSampler, getIndexIntoChunk(channelIndex), temp);\n  result.value = temp.xw;\n  return result;\n}\n");break;case r.DataType.UINT32:a.addFragmentCode(p.glsl_uint32);a.addFragmentCode("\nuint32_t getDataValue (int channelIndex) {\n  uint32_t result;\n  "+
this.textureAccessHelper.readTextureValue+"(uVolumeChunkSampler, getIndexIntoChunk(channelIndex), result.value);\n  return result;\n}\n");break;case r.DataType.UINT64:a.addFragmentCode(p.glsl_uint64),a.addFragmentCode("\nuint64_t getDataValue (int channelIndex) {\n  uint64_t result;\n  "+this.textureAccessHelper.readTextureValue+"(uVolumeChunkSampler, getIndexIntoChunk(channelIndex), result.low, result.high);\n  return result;\n}\n")}}},{key:"setupTextureLayout",value:function(a,b,c){1<this.numChannels&&
a.uniform1f(b.uniform("uChannelStride"),c.channelStride);this.textureAccessHelper.setupTextureLayout(a,b,c)}},{key:"getTextureLayout",value:function(a,b){return h.get(a,b,this.texelsPerElement,this.numChannels)}},{key:"setTextureData",value:function(a,b,c){f.setOneDimensionalTextureData(a,b,c,this.arrayElementsPerTexel,this.textureFormat,this.texelType,this.arrayConstructor)}}],[{key:"get",value:function(a,b,c){var d="sliceview.UncompressedChunkFormat:"+b+":"+c;return a.memoize.get(d,function(){return new e(a,
b,c,d)})}}]);return e}(v.SingleTextureChunkFormat);c.ChunkFormat=u;var A=function(c){function d(){l(this,d);return b(this,Object.getPrototypeOf(d).apply(this,arguments))}a(d,c);m(d,[{key:"setTextureData",value:function(a){var b=this.source,c=b.chunkFormatHandler,d=c.chunkFormat,e=void 0;this.textureLayout=this.chunkDataSize===b.spec.chunkDataSize?e=c.textureLayout.addRef():e=d.getTextureLayout(a,this.chunkDataSize);this.chunkFormat.setTextureData(a,e,this.data)}},{key:"getChannelValueAt",value:function(a,
b){var c=this.chunkDataSize,d=a[0]+c[0]*(a[1]+c[1]*(a[2]+c[2]*b)),e=this.chunkFormat.dataType,c=this.data;switch(e){case r.DataType.UINT8:case r.DataType.FLOAT32:case r.DataType.UINT16:case r.DataType.UINT32:return c[d];case r.DataType.UINT64:return d*=2,new q.Uint64(c[d],c[d+1])}throw Error("Invalid data type: "+e);}}]);return d}(v.SingleTextureVolumeChunk);c.UncompressedVolumeChunk=A;var B=function(c){function d(a,c){l(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.chunkFormat=e.registerDisposer(u.get(a,
c.dataType,c.numChannels));e.textureLayout=e.registerDisposer(e.chunkFormat.getTextureLayout(a,c.chunkDataSize));return e}a(d,c);m(d,[{key:"getChunk",value:function(a,b){return new A(a,b)}}]);return d}(n.RefCounted);c.UncompressedChunkFormatHandler=B;g.registerChunkFormatHandler(function(a,b){return null==b.compressedSegmentationBlockSize?new B(a,b):null})},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d=function f(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),
null===a?void 0:f(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},m=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(59);var r=e(23),v=e(68);$jscomp.initSymbol();var n=Symbol("SingleTextureVolumeChunk.textureUnit");$jscomp.initSymbol();var k=Symbol("SingleTextureVolumeChunk.textureLayout");
e=function(c){function d(a){l(this,d);var c=b(this,Object.getPrototypeOf(d).call(this));c.shaderKey=a;return c}a(d,c);m(d,[{key:"defineShader",value:function(a){a.addTextureSampler2D("uVolumeChunkSampler",n)}},{key:"beginDrawing",value:function(a,b){var c=b.textureUnit(n);a.activeTexture(a.TEXTURE0+c);b[k]=null}},{key:"endDrawing",value:function(a,b){a.bindTexture(a.TEXTURE_2D,null);b[k]=null}},{key:"bindChunk",value:function(a,b,c){var d=c.textureLayout;b[k]!==d&&(b[k]=d,this.setupTextureLayout(a,
b,d));a.bindTexture(a.TEXTURE_2D,c.texture)}},{key:"beginSource",value:function(a,b){}}]);return d}(r.RefCounted);c.SingleTextureChunkFormat=e;e=function(c){function e(a,c){l(this,e);var d=b(this,Object.getPrototypeOf(e).call(this,a,c));d.texture=null;d.data=c.data;return d}a(e,c);m(e,[{key:"copyToGPU",value:function(a){d(Object.getPrototypeOf(e.prototype),"copyToGPU",this).call(this,a);var b=this.texture=a.createTexture();a.bindTexture(a.TEXTURE_2D,b);a.pixelStorei(a.UNPACK_ALIGNMENT,1);v.setRawTextureParameters(a);
this.setTextureData(a);a.bindTexture(a.TEXTURE_2D,null)}},{key:"freeGPUMemory",value:function(a){d(Object.getPrototypeOf(e.prototype),"freeGPUMemory",this).call(this,a);a.deleteTexture(this.texture);this.texture=null;this.textureLayout.dispose();this.textureLayout=null}}]);return e}(g.VolumeChunk);c.SingleTextureVolumeChunk=e},function(g,c,e){var l=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,
e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),b=e(62);c.compute3dTextureLayout=function(a,b,c,e,l,g){var k=b.maxTextureSize;b=void 0;var q=e*l*g;if(c*e<=k&&l*g<=k)b=e;else if(c*e*l<=k&&g<=k)b=e*l;else if(b=Math.ceil(q/k),b*c>k)throw Error("Chunk data size exceeds maximum texture size: "+c+" * "+q);e=Math.ceil(q/b);a.textureWidth=b*c;a.textureHeight=e;a.textureAccessCoefficients=Float32Array.of(1/b,1/(b*e))};c.compute1dTextureLayout=function(a,b,c,e){var l=b.maxTextureSize;
b=Math.ceil(e/l);if(b*c>l)throw Error("Number of elements exceeds maximum texture size: "+c+" * "+e);e=Math.ceil(e/b);a.textureWidth=b*c;a.textureHeight=e;a.textureAccessCoefficients=Float32Array.of(1/b,1/(b*e))};c.setOneDimensionalTextureData=function(a,c,e,l,g,n,k){l*=c.textureWidth*c.textureHeight;e.constructor!==k&&(e=new k(e.buffer,e.byteOffset,e.byteLength/k.BYTES_PER_ELEMENT));e=b.maybePadArray(e,l);a.texImage2D(a.TEXTURE_2D,0,g,c.textureWidth,c.textureHeight,0,g,n,e)};g=function(){function a(b,
c){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.key=b;this.texelsPerElement=c;this.uniformName="uTextureAccessCoefficients_"+this.key;this.readTextureValue="readTextureValue_"+this.key}l(a,[{key:"defineShader",value:function(a){var b=this.texelsPerElement,c=this.uniformName;a.addUniform("highp vec2",c);for(var e="\nvoid "+this.readTextureValue+"(highp sampler2D sampler, float index",l=0;l<b;++l)e+=", out vec4 output"+l;e+=") {\n  index += "+.5/this.texelsPerElement+
";\n  vec2 texCoords = vec2(fract(index * "+c+".x),\n                        index * "+c+".y);\n";for(l=0;l<b;++l)e+="\n  output"+l+" = texture2D(sampler, vec2(texCoords.x + "+c+".x * "+(l/b).toFixed(8)+", texCoords.y));\n";a.addFragmentCode(e+"\n}\n")}},{key:"setupTextureLayout",value:function(a,b,c){a.uniform2fv(b.uniform(this.uniformName),c.textureAccessCoefficients)}}]);return a}();c.OneDimensionalTextureAccessHelper=g},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d=function w(a,
b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:w(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},m=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),r=e(60),v=e(94),n=e(96);g=e(59);
var k=e(65),q=e(91),f=e(23),p=e(9),h=e(52),u=e(92),A=e(71),B=function(c){function d(a,c,e,f){l(this,d);var h=b(this,Object.getPrototypeOf(d).call(this));h.chunkDataSize=c;h.subchunkSize=e;u.compute1dTextureLayout(h,a,1,f);a=h.subchunkGridSize=p.vec3.create();for(f=0;3>f;++f)a[f]=Math.ceil(c[f]/e[f]);return h}a(d,c);m(d,null,[{key:"get",value:function(a,b,c,e){return a.memoize.get("sliceview.CompressedSegmentationTextureLayout:"+p.vec3Key(b)+","+p.vec3Key(c)+","+e,function(){return new d(a,b,c,e)})}}]);
return d}(f.RefCounted),y=function(c){function e(a,c,d,f){l(this,e);f=b(this,Object.getPrototypeOf(e).call(this,f));f.dataType=a;f.subchunkSize=c;f.numChannels=d;f.textureAccessHelper=new u.OneDimensionalTextureAccessHelper("chunkData",1);return f}a(e,c);m(e,[{key:"defineShader",value:function(a){d(Object.getPrototypeOf(e.prototype),"defineShader",this).call(this,a);this.textureAccessHelper.defineShader(a);var b=function(a){return"compressedSegmentationChunkFormat_"+a};a.addUniform("highp vec3","uSubchunkGridSize");
a.addUniform("highp vec3","uSubchunkSize");a.addFragmentCode(A.glsl_getFortranOrderIndexFromNormalized);var c=this.dataType,f=k.GLSL_TYPE_FOR_DATA_TYPE.get(c);c===r.DataType.UINT64?a.addFragmentCode(A.glsl_uint64):a.addFragmentCode(A.glsl_uint32);f="\nvec4 "+b("readTextureValue")+"(float offset) {\n  vec4 result;\n  "+this.textureAccessHelper.readTextureValue+"(uVolumeChunkSampler, offset, result);\n  return result;\n}\nfloat "+b("getChannelOffset")+"(int channelIndex) {\n  if (channelIndex == 0) {\n    return "+
this.numChannels+".0;\n  }\n  vec4 v = "+b("readTextureValue")+"(float(channelIndex));\n  return v.x * 255.0 + v.y * 255.0 * 256.0 + v.z * 255.0 * 256.0 * 256.0;\n}\n"+f+" getDataValue (int channelIndex) {\n  vec3 chunkPosition = getPositionWithinChunk();\n\n  // TODO: maybe premultiply this and store as uniform.\n  vec3 subchunkGridPosition = floor(chunkPosition / uSubchunkSize);\n  float subchunkGridOffset = getFortranOrderIndex(subchunkGridPosition, uSubchunkGridSize);\n\n  float channelOffset = "+
b("getChannelOffset")+"(channelIndex);\n\n  // TODO: Maybe just combine this offset into subchunkGridStrides.\n  float subchunkHeaderOffset = subchunkGridOffset * 2.0 + channelOffset;\n\n  vec4 subchunkHeader0 = "+b("readTextureValue")+"(subchunkHeaderOffset);\n  vec4 subchunkHeader1 = "+b("readTextureValue")+"(subchunkHeaderOffset + 1.0);\n\n  float outputValueOffset = dot(subchunkHeader0.xyz, vec3(255, 256 * 255, 256 * 256 * 255)) + channelOffset;\n  float encodingBits = subchunkHeader0[3] * 255.0;\n  if (encodingBits > 0.0) {\n    vec3 subchunkPosition = floor(min(chunkPosition - subchunkGridPosition * uSubchunkSize, uSubchunkSize - 1.0));\n    float subchunkOffset = getFortranOrderIndex(subchunkPosition, uSubchunkSize);\n    highp float encodedValueBaseOffset = dot(subchunkHeader1.xyz, vec3(255.0, 256.0 * 255.0, 256.0 * 256.0 * 255.0)) + channelOffset;\n    highp float encodedValueOffset = floor(encodedValueBaseOffset + subchunkOffset * encodingBits / 32.0);\n    vec4 encodedValue = "+
b("readTextureValue")+"(encodedValueOffset);\n    float wordOffset = mod(subchunkOffset * encodingBits, 32.0);\n    // If the value is in the first byte, then 0 <= wordOffset < 8.\n    // We need to mod by 2**encodedBits\n    float wordShifter = pow(2.0, -wordOffset);\n    float encodedValueMod = pow(2.0, encodingBits);\n    float encodedValueShifted;\n    if (wordOffset < 16.0) {\n      encodedValueShifted = dot(encodedValue.xy, vec2(255.0, 255.0 * 256.0));\n    } else {\n      encodedValueShifted = dot(encodedValue.zw, vec2(255.0 * 256.0 * 256.0, 255.0 * 256.0 * 256.0 * 256.0));\n    }\n    encodedValueShifted = floor(encodedValueShifted * wordShifter);\n    float decodedValue = mod(encodedValueShifted, encodedValueMod);\n    outputValueOffset += decodedValue * "+
(this.dataType===r.DataType.UINT64?"2.0":"1.0")+";\n  }\n  "+f+" result;\n";f=c===r.DataType.UINT64?f+("\n  result.low = "+b("readTextureValue")+"(outputValueOffset);\n  result.high = "+b("readTextureValue")+"(outputValueOffset+1.0);\n"):f+("\n  result.value = "+b("readTextureValue")+"(outputValueOffset);\n");a.addFragmentCode(f+"\n  return result;\n}\n")}},{key:"setupTextureLayout",value:function(a,b,c){a.uniform3fv(b.uniform("uSubchunkGridSize"),c.subchunkGridSize);this.textureAccessHelper.setupTextureLayout(a,
b,c)}},{key:"setTextureData",value:function(a,b,c){u.setOneDimensionalTextureData(a,b,c,4,a.RGBA,a.UNSIGNED_BYTE,Uint8Array)}},{key:"getTextureLayout",value:function(a,b,c){return B.get(a,b,this.subchunkSize,c)}},{key:"beginSource",value:function(a,b){d(Object.getPrototypeOf(e.prototype),"beginSource",this).call(this,a,b);a.uniform3fv(b.uniform("uSubchunkSize"),this.subchunkSize)}}],[{key:"get",value:function(a,b,c,d){var f="sliceview.CompressedSegmentationChunkFormat:"+b+":"+d,h=f+":"+p.vec3Key(c);
return a.memoize.get(h,function(){return new e(b,c,d,f)})}}]);return e}(q.SingleTextureChunkFormat);c.ChunkFormat=y;var x=function(c){function d(){l(this,d);return b(this,Object.getPrototypeOf(d).apply(this,arguments))}a(d,c);m(d,[{key:"setTextureData",value:function(a){var b=this.data,c=this.chunkFormat,d=this.textureLayout=c.getTextureLayout(a,this.chunkDataSize,b.length);c.setTextureData(a,d,b)}},{key:"getChannelValueAt",value:function(a,b){var c=this.chunkDataSize,d=this.chunkFormat,e=this.data,
f=e[b];if(d.dataType===r.DataType.UINT64){var l=new h.Uint64;n.readSingleChannelValue(l,e,f,c,d.subchunkSize,a);return l}return v.readSingleChannelValue(e,f,c,d.subchunkSize,a)}}]);return d}(q.SingleTextureVolumeChunk);c.CompressedSegmentationVolumeChunk=x;var t=function(c){function d(a,c){l(this,d);var e=b(this,Object.getPrototypeOf(d).call(this)),f=c.dataType;if(f!==r.DataType.UINT64&&f!==r.DataType.UINT32)throw Error("Unsupported compressed segmentation data type: "+r.DataType[f]);e.chunkFormat=
e.registerDisposer(y.get(a,c.dataType,c.compressedSegmentationBlockSize,c.numChannels));return e}a(d,c);m(d,[{key:"getChunk",value:function(a,b){return new x(a,b)}}]);return d}(f.RefCounted);c.CompressedSegmentationChunkFormatHandler=t;g.registerChunkFormatHandler(function(a,b){return null!=b.compressedSegmentationBlockSize?new t(a,b):null})},function(g,c,e){function l(b,c,e,l,g){c=a.decodeValueOffset(b,c,e,l,g,1)+c;return b[c]}function b(b,c,e,l,g){var k=l[0]*l[1]*l[2]*1;if(k!==b.length)throw Error("Output length "+
b.length+" is not equal to expected length "+k+".");for(var k=l[0],q=l[1],f=l[2],p=[0,0,0],h=0,u=0;u<f;++u){p[2]=u;for(var A=0;A<q;++A){p[1]=A;for(var B=0;B<k;++B){p[0]=B;var y=a.decodeValueOffset(c,e,l,g,p,1)+e;b[h++]=c[y]}}}return b}var a=e(95);c.readSingleChannelValue=l;c.readValue=function(a,b,c,e,g){return l(a,b+a[g[3]],c,e,g)};c.decodeChannel=b;c.decodeChannels=function(a,c,e,l,g){var k=l[0]*l[1]*l[2]*1,q=k*l[3];if(q!==a.length)throw Error("Output length "+a.length+" is not equal to expected length "+
q+".");for(var q=l[3],f=0;f<q;++f)b(a.subarray(k*f,k*(f+1)),c,e+c[f],l,g);return a}},function(g,c){c.decodeValueOffset=function(c,l,b,a,d,g){for(var r=0,v=0,n=1,k=1,q=0;3>q;++q)var f=d[q],p=a[q],h=f%p,r=r+Math.floor(f/p)*n,n=n*Math.ceil(b[q]/p),v=v+h*k,k=k*p;a=l+2*r;b=c[a];a=c[a+1];d=b&16777215;b=b>>24&255;0<b&&(d+=g*(c[(l+a&16777215)+Math.floor(v*b/32)]>>v*b%32&(1<<b)-1));return d}},function(g,c,e){function l(b,c,e,l,g,k){e=a.decodeValueOffset(c,e,l,g,k,2)+e;b.low=c[e];b.high=c[e+1];return b}function b(b,
c,e,l,g){var k=l[0]*l[1]*l[2]*2;if(k!==b.length)throw Error("Output length "+b.length+" is not equal to expected length "+k+".");for(var k=l[0],q=l[1],f=l[2],p=[0,0,0],h=0,u=0;u<f;++u){p[2]=u;for(var A=0;A<q;++A){p[1]=A;for(var B=0;B<k;++B){p[0]=B;var y=a.decodeValueOffset(c,e,l,g,p,2)+e;b[h++]=c[y];b[h++]=c[y+1]}}}return b}var a=e(95);c.readSingleChannelValue=l;c.readValue=function(a,b,c,e,g,k){return l(a,b,c+b[k[3]],e,g,k)};c.decodeChannel=b;c.decodeChannels=function(a,c,e,l,g){var k=l[0]*l[1]*
l[2]*2,q=k*l[3];if(q!==a.length)throw Error("Output length "+a.length+" is not equal to expected length "+q+".");for(var q=l[3],f=0;f<q;++f)b(a.subarray(k*f,k*(f+1)),c,e+c[f],l,g);return a}},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&
null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function d(a){var b=c.LAYOUTS.find(function(b){return b[0]===a});if(void 0===b)throw Error("Invalid layout name: "+JSON.stringify(a)+".");return b}function m(a){return d(a)[0]}var r=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=
c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),v=function ea(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:ea(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},n=e(43),k=e(31),q=e(32),f=e(98),p=e(42),h=e(103),u=e(146),A=e(104),B=e(149),
y=e(150),x=e(99),t=e(36),z=e(151),w=e(59),C=e(128),D=e(69),F=e(66),G=e(153);g=e(23);var Q=e(7),I=e(9),O=e(100),V=e(22),P=e(34);e(154);e(115);e(72);var T=function(c){function d(a,c){l(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.rootElement=a;e.viewer=c;var f=c.makeOrthogonalSliceViews(),h=c.display,k={mouseState:c.mouseState,layerManager:c.layerManager,navigationState:c.perspectiveNavigationState,showSliceViews:c.showPerspectiveSliceViews,showAxisLines:c.showAxisLines},g={mouseState:c.mouseState,
layerManager:c.layerManager,navigationState:c.navigationState,showAxisLines:c.showAxisLines,showScaleBar:c.showScaleBar},p={mouseState:c.mouseState,layerManager:c.layerManager,navigationState:c.navigationState,showAxisLines:c.showAxisLines,showScaleBar:new D.TrackableBoolean(!1,!1)},q=[B.withFlex(1,B.box("column",[B.withFlex(1,B.box("row",[B.withFlex(1,function(a){a.className="gllayoutcell noselect";e.registerDisposer(new C.SliceViewPanel(h,a,f[0],g))}),B.withFlex(1,function(a){a.className="gllayoutcell noselect";
e.registerDisposer(new C.SliceViewPanel(h,a,f[1],p))})])),B.withFlex(1,B.box("row",[B.withFlex(1,function(a){a.className="gllayoutcell noselect";a=e.registerDisposer(new t.PerspectivePanel(h,a,k));for(var b=$jscomp.makeIterator(f),c=b.next();!c.done;c=b.next())a.sliceViews.add(c.value.addRef())}),B.withFlex(1,function(a){a.className="gllayoutcell noselect";e.registerDisposer(new C.SliceViewPanel(h,a,f[2],p))})]))]))];B.box("row",q)(a);h.onResize();return e}a(d,c);r(d,[{key:"disposed",value:function(){Q.removeChildren(this.rootElement);
v(Object.getPrototypeOf(d.prototype),"disposed",this).call(this)}}]);return d}(g.RefCounted);c.FourPanelLayout=T;var Z=function(c){function d(a,c){l(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.rootElement=a;e.viewer=c;var f=c.makeSliceView(),h={mouseState:c.mouseState,layerManager:c.layerManager,navigationState:c.navigationState,showAxisLines:c.showAxisLines,showScaleBar:c.showScaleBar};B.box("row",[B.withFlex(1,function(a){e.registerDisposer(new C.SliceViewPanel(c.display,a,f,h))})])(a);
c.display.onResize();return e}a(d,c);r(d,[{key:"disposed",value:function(){Q.removeChildren(this.rootElement);v(Object.getPrototypeOf(d.prototype),"disposed",this).call(this)}}]);return d}(g.RefCounted);c.SinglePanelLayout=Z;c.LAYOUTS=[["4panel",function(a,b){return new T(a,b)}],["xy",function(a,b){return new Z(a,b)}]];c.getLayoutByName=d;c.validateLayoutName=m;e=function(e){function g(a){l(this,g);var d=b(this,Object.getPrototypeOf(g).call(this));d.display=a;d.navigationState=d.registerDisposer(new y.NavigationState);
d.perspectiveNavigationState=new y.NavigationState(new y.Pose(d.navigationState.position),1);d.mouseState=new p.MouseSelectionState;d.layerManager=d.registerDisposer(new p.LayerManager);d.showAxisLines=new D.TrackableBoolean(!0,!0);d.showScaleBar=new D.TrackableBoolean(!0,!0);d.showPerspectiveSliceViews=new D.TrackableBoolean(!0,!0);d.layerSelectedValues=d.registerDisposer(new p.LayerSelectedValues(d.layerManager,d.mouseState));d.worker=new V.RPC(new Worker("chunk_worker.bundle.js"));d.resetInitiated=
new P.Signal;d.chunkQueueManager=new q.ChunkQueueManager(d.worker,d.display.gl,{gpuMemory:new k.AvailableCapacity(1E6,1E9),systemMemory:new k.AvailableCapacity(1E7,2E9),download:new k.AvailableCapacity(32,Number.POSITIVE_INFINITY)});d.chunkManager=new q.ChunkManager(d.chunkQueueManager);d.keyMap=new O.KeySequenceMap;d.keyCommands=new Map;d.layerSpecification=new A.LayerListSpecification(d.layerManager,d.chunkManager,d.worker,d.layerSelectedValues,d.navigationState.voxelSize);d.layoutName=new F.TrackableValue(c.LAYOUTS[0][0],
m);d.registerSignalBinding(a.updateStarted.add(d.onUpdateDisplay,d));d.registerSignalBinding(a.updateFinished.add(d.onUpdateDisplayFinished,d));d.registerEventListener(document,"contextmenu",function(a){a.preventDefault();return!1});G.registerTrackable("layers",d.layerSpecification);G.registerTrackable("navigation",d.navigationState);G.registerTrackable("showAxisLines",d.showAxisLines);G.registerTrackable("showScaleBar",d.showScaleBar);G.registerTrackable("perspectiveOrientation",d.perspectiveNavigationState.pose.orientation);
G.registerTrackable("perspectiveZoom",d.perspectiveNavigationState.zoomFactor);G.registerTrackable("showSlices",d.showPerspectiveSliceViews);G.registerTrackable("layout",d.layoutName);d.registerSignalBinding(d.navigationState.changed.add(d.handleNavigationStateChanged,d));d.layerManager.initializePosition(d.navigationState.position);d.layerManager.layersChanged.add(d.registerCancellable(n(function(){0===d.layerManager.managedLayers.length&&(d.navigationState.reset(),d.perspectiveNavigationState.pose.orientation.reset(),
d.perspectiveNavigationState.zoomFactor.reset(),d.resetInitiated.dispatch(),x.overlaysOpen||new h.LayerDialog(d.layerSpecification))})));d.registerSignalBinding(d.chunkQueueManager.visibleChunksChanged.add(function(){d.layerSelectedValues.handleLayerChange()}));d.chunkQueueManager.visibleChunksChanged.add(a.scheduleRedraw,a);d.makeUI();d.registerDisposer(new O.GlobalKeyboardShortcutHandler(d.keyMap,d.onKeyCommand.bind(d)));d.layoutName.changed.add(function(){if(void 0!==d.dataDisplayLayout){var a=
d.dataDisplayLayout.rootElement;d.dataDisplayLayout.dispose();d.createDataDisplayLayout(a)}});var e=d.keyCommands;e.set("toggle-layout",function(){this.toggleLayout()});e.set("snap",function(){this.navigationState.pose.snap()});e.set("add-layer",function(){this.layerPanel.addLayerMenu();return!0});e.set("help",d.showHelpDialog);a=function(a){e.set("toggle-layer-"+a,function(){var b=a-1,c=this.layerManager.managedLayers;b<c.length&&(b=c[b],b.setVisible(!b.visible))})};for(var f=1;9>=f;++f)a(f);a=function(a){e.set(a,
function(){this.layerManager.invokeAction(a)})};for(var f=$jscomp.makeIterator(["recolor","clear-segments"]),t=f.next();!t.done;t=f.next())a(t.value);e.set("toggle-axis-lines",function(){this.showAxisLines.toggle()});e.set("toggle-scale-bar",function(){this.showScaleBar.toggle()});d.keyCommands.set("toggle-show-slices",function(){this.showPerspectiveSliceViews.toggle()});0===d.layerManager.managedLayers.length&&new h.LayerDialog(d.layerSpecification);return d}a(g,e);r(g,[{key:"makeUI",value:function(){var a=
this,b=this.display,c=document.createElement("div");c.setAttribute("class","gllayoutcontainer noselect");b.container.appendChild(c);B.box("column",[B.box("row",[B.withFlex(1,function(b){return new z.PositionStatusPanel(b,a)}),function(b){var c=document.createElement("button");c.className="help-button";c.textContent="?";c.title="Help";b.appendChild(c);a.registerEventListener(c,"click",function(){a.showHelpDialog()})}]),function(b){a.layerPanel=new u.LayerPanel(b,a.layerSpecification)},B.withFlex(1,
function(b){a.createDataDisplayLayout(b)})])(c);this.display.onResize()}},{key:"createDataDisplayLayout",value:function(a){this.dataDisplayLayout=(0,d(this.layoutName.value)[1])(a,this)}},{key:"toggleLayout",value:function(){var a=d(this.layoutName.value),a=c.LAYOUTS.indexOf(a);this.layoutName.value=c.LAYOUTS[(a+1)%c.LAYOUTS.length][0]}},{key:"showHelpDialog",value:function(){new f.KeyBindingHelpDialog(this.keyMap)}},{key:"onUpdateDisplay",value:function(){G.delayHashUpdate();this.chunkQueueManager.chunkUpdateDeadline=
null}},{key:"onUpdateDisplayFinished",value:function(){this.mouseState.updateIfStale()}},{key:"onKeyCommand",value:function(a){var b=this.keyCommands.get(a);return b&&b.call(this)?!0:(b=this.display.activePanel)?b.onKeyCommand(a):!1}},{key:"makeSliceView",value:function(a){var b=void 0,b=void 0===a?this.navigationState:new y.NavigationState(new y.Pose(this.navigationState.pose.position,y.OrientationState.makeRelative(this.navigationState.pose.orientation,a)),this.navigationState.zoomFactor);return new w.SliceView(this.gl,
this.chunkManager,this.layerManager,b)}},{key:"makeOrthogonalSliceViews",value:function(){var a=[];a.push(this.makeSliceView(void 0));var b=I.quat.rotateX(I.quat.create(),I.quat.create(),Math.PI/2);a.push(this.makeSliceView(b));b=I.quat.rotateY(I.quat.create(),I.quat.create(),Math.PI/2);a.push(this.makeSliceView(b));return a}},{key:"handleNavigationStateChanged",value:function(){var a=this.chunkQueueManager;null===a.chunkUpdateDeadline&&(a.chunkUpdateDeadline=Date.now()+10);this.mouseState.stale=
!0}},{key:"gl",get:function(){return this.display.gl}}]);return g}(g.RefCounted);c.Viewer=e},function(g,c,e){function l(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function b(a){return a.startsWith("key")?a.substring(3):a.startsWith("digit")||
a.startsWith("arrow")?a.substring(5):a}function a(a){return a.split("+").map(b).join("+")}var d=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,l=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var f=a[Symbol.iterator](),g;!(d=(g=f.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(h){e=!0,l=h}finally{try{if(!d&&f["return"])f["return"]()}finally{if(e)throw l;
}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}();g=e(99);e(102);c.formatKeyName=b;c.formatKeyStroke=a;e=function(b){function c(b){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");var e;e=Object.getPrototypeOf(c).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");e=!e||"object"!==typeof e&&"function"!==typeof e?this:e;var l=e.content;l.classList.add("describe-key-bindings");
var g=document.createElement("div"),f=document.createElement("div");f.className="dl";b=$jscomp.makeIterator(b.entries());for(var p=b.next();!p.done;p=b.next()){var h=d(p.value,2),p=h[0],h=h[1],m=document.createElement("div"),A=document.createElement("div");A.className="definition-outer-container";m.className="definition-container";var B=document.createElement("div");B.className="dt";B.textContent=p.map(a).join(" ");p=document.createElement("div");p.className="dd";p.textContent=h;m.appendChild(B);
m.appendChild(p);f.appendChild(A);A.appendChild(m)}g.appendChild(f);l.appendChild(g);return e}l(c,b);return c}(g.Overlay);c.KeyBindingHelpDialog=e},function(g,c,e){function l(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var b=function(){function a(b,
c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),a=function v(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:v(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)};g=e(23);var d=e(100);e(101);c.overlaysOpen=
0;var m=new d.KeySequenceMap;m.bind("escape","close");e=function(e){function g(){var a=0>=arguments.length||void 0===arguments[0]?m:arguments[0];if(!(this instanceof g))throw new TypeError("Cannot call a class as a function");var b;b=Object.getPrototypeOf(g).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");b=!b||"object"!==typeof b&&"function"!==typeof b?this:b;b.keySequenceMap=a;++c.overlaysOpen;var e=b.container=document.createElement("div");
e.className="overlay";var l=b.content=document.createElement("div");l.className="overlay-content";e.appendChild(l);document.body.appendChild(e);b.keyboardShortcutHandler=b.registerDisposer(new d.GlobalKeyboardShortcutHandler(a,b.commandReceived.bind(b)));return b}l(g,e);b(g,[{key:"commandReceived",value:function(a){"close"===a&&this.dispose();return!1}},{key:"disposed",value:function(){--c.overlaysOpen;document.body.removeChild(this.container);a(Object.getPrototypeOf(g.prototype),"disposed",this).call(this)}}]);
return g}(g.RefCounted);c.Overlay=e},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,
enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function d(a){return(a.ctrlKey?1:0)|(a.altKey?2:0)|(a.metaKey?4:0)|(a.shiftKey?8:0)}function m(a,b){var c="";b&1&&(c+="control+");b&2&&(c+="alt+");b&4&&(c+="meta+");b&8&&(c+="shift+");return c+a}function r(a){return a.code.toLowerCase()}function v(a){a=a.toLowerCase().replace(" ","");for(var b=a.split("+"),c=void 0,d=0,b=$jscomp.makeIterator(b),e=b.next();!e.done;e=b.next())switch(e=e.value,
e){case "control":d|=1;break;case "alt":d|=2;break;case "meta":d|=4;break;case "shift":d|=8;break;default:c=void 0===c?e:null}if(null==c)throw Error("Invalid stroke "+JSON.stringify(a));return m(c,d)}function n(a){"string"===typeof a&&(a=a.replace(/[ +]*\+[ +]*/g,"+").replace(/[ ]+/g," ").toLowerCase(),a=a.split(" "));a=a.map(v);if(0===a.length)throw Error("Key sequence must not be empty");return a}function k(a){return JSON.stringify(a.join(" "))}function q(a){function b(w,C){for(;;)switch(c){case 0:n=
1>=m.length||void 0===m[1]?[]:m[1],t=$jscomp.makeIterator(a),p=t.next();case 1:if(p.done){c=3;break}k=p.value;g=u(k,2);l=g[0];h=g[1];f=[].concat($jscomp.arrayFromIterable(n),[l]);if("string"!==typeof h){c=4;break}c=6;return{value:[f,h],done:!1};case 6:if(void 0===C){c=7;break}c=-1;throw C;case 7:c=5;break;case 4:e=$jscomp.makeIterator(q(h,f));case 8:if((d=e.next(w)).done){c=9;break}c=10;return{value:d.value,done:!1};case 10:if(void 0===C){c=11;break}c=-1;throw C;case 11:c=8;break;case 9:case 5:case 2:p=
t.next();c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,d,e,f,h,l,g,k,p,t,n,m=arguments,w={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();w[Symbol.iterator]=function(){return this};return w}function f(a,b,c){void 0===w&&(w=new x(window,new z,function(){return!1}));C.push([w.keySequenceMap,w.handler,D]);w.setKeySequenceMap(a);w.handler=b;D=c}function p(){var a=C.pop(),
a=u(a,3),b=a[1],c=a[2];w.setKeySequenceMap(a[0]);w.handler=b;D=c}var h=function G(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:G(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},u=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();
$jscomp.initSymbolIterator();for(var h=a[Symbol.iterator](),l;!(d=(l=h.next()).done)&&(c.push(l.value),!b||c.length!==b);d=!0);}catch(g){e=!0,f=g}finally{try{if(!d&&h["return"])h["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),A=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,
c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(23);var B=new Set("f1 f2 f3 f4 f5 f6 f7 f8 f9 f10 f11 f12 escape pause".split(" ")),y=new Set("color date datetime datetime-local email month number password search tel text time url week".split(" ")),x=function(c){function e(a,c,d){l(this,e);var f=b(this,Object.getPrototypeOf(e).call(this));f.target=a;f.keySequenceMap=c;f.handler=d;f.modifierShortcutsAreGlobal=!0;f.allShortcutsAreGlobal=!1;f.allowSpaceKeyOnButtons=!1;f.reset();f.registerEventListener(a,
"keydown",f.handleKeyDown.bind(f),!0);return f}a(e,c);A(e,[{key:"reset",value:function(){this.currentNode=this.keySequenceMap.root;this.lastStrokeTime=Number.NEGATIVE_INFINITY}},{key:"setKeySequenceMap",value:function(a){this.keySequenceMap=a;this.reset()}},{key:"shouldIgnoreEvent",value:function(a,b){var c=b.target,d=c.tagName;if(c===this.target)return!1;var e="TEXTAREA"===d||"INPUT"===d||"BUTTON"===d||"SELECT"===d,f=!e&&(c.isContentEditable||c.ownerDocument&&"on"===c.ownerDocument.designMode);return!e&&
!f||this.allShortcutsAreGlobal||B.has(a)?!1:f||this.modifierShortcutsAreGlobal&&(b.altKey||b.ctrlKey||b.metaKey)?!0:"INPUT"===d&&y.has(c.type)?"enter"!==a:"INPUT"===d||"BUTTON"===d?this.allowSpaceKeyOnButtons?!1:"space"===a:!0}},{key:"handleKeyDown",value:function(a){var b=r(a);if(!this.shouldIgnoreEvent(b,a)){var b=m(b,d(a)),c=this.keySequenceMap.root,e=this.currentNode,f=e.get(b),h=Date.now();e!==c&&(void 0===f||h>this.lastStrokeTime+1500)&&(this.currentNode=c,f=e.get(b));void 0!==f&&("string"===
typeof f?(this.reset(),this.handler(f)&&a.preventDefault()):(this.currentNode=f,this.lastStrokeTime=h,a.preventDefault()))}}}]);return e}(g.RefCounted);c.KeyboardShortcutHandler=x;c.getEventStrokeIdentifier=function(a){return m(r(a),d(a))};var t;(function(a){a[a.CONTROL=1]="CONTROL";a[a.ALT=2]="ALT";a[a.META=4]="META";a[a.SHIFT=8]="SHIFT"})(t||(t={}));c.getEventModifierMask=d;c.getStrokeIdentifier=m;c.getEventKeyName=r;c.parseKeyStroke=v;c.parseKeySequence=n;c.formatKeySequence=k;var z=function(){function a(b){l(this,
a);this.root=new Map;void 0!==b&&this.bindMultiple(b)}A(a,[{key:"bind",value:function(a,b){for(var c=n(a),d=this.root,e=c.length-1,f=0;f<e;++f){var h=c[f],l=d.get(h);void 0===l&&(l=new Map,d.set(h,l));if("string"===typeof l)throw Error("Error binding key sequence "+k(c)+": prefix "+k(c.slice(0,f+1))+" is already bound to action "+JSON.stringify(l));d=l}e=c[e];f=d.get(e);if(void 0!==f)throw Error("Key sequence "+k(c)+" is already bound to action "+JSON.stringify(f));d.set(e,b)}},{key:"bindMultiple",
value:function(a){for(var b=$jscomp.makeIterator(Object.keys(a)),c=b.next();!c.done;c=b.next())c=c.value,this.bind(c,a[c])}},{key:"entries",value:function(){return q(this.root)}}]);return a}();c.KeySequenceMap=z;var w=void 0,C=[],D=void 0;c.pushGlobalKeyboardHandler=f;c.popGlobalKeyboardHandler=p;t=function(c){function d(a,c){l(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.keySequenceMap=a;e.handler=c;f(a,c,e);return e}a(d,c);A(d,[{key:"disposed",value:function(){if(D===this)p();else{var a=
this,b=C.findIndex(function(b){return b[2]===a});C.splice(b,1)}h(Object.getPrototypeOf(d.prototype),"disposed",this).call(this)}}]);return d}(g.RefCounted);c.GlobalKeyboardShortcutHandler=t},function(g,c){},function(g,c){},function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),d=e(28),m=e(104);g=e(99);var r=e(60),v=e(20),n=e(138),k=e(139),q=e(144);
e(145);e=function(c){function e(a,b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var c=l(this,Object.getPrototypeOf(e).call(this));c.manager=a;c.existingLayer=b;c.statusElement=document.createElement("div");c.submitElement=document.createElement("button");c.namePromptElement=document.createElement("label");c.nameInputElement=document.createElement("input");c.sourceValid=!1;c.nameValid=!0;var f=c.content;f.classList.add("add-layer-overlay");var g=document.createElement("form");
g.className="source-form";c.registerEventListener(g,"submit",function(a){a.preventDefault();c.validateSource(!0)});var r=document.createElement("label");r.textContent="Source:";var t=c.sourceInput=c.registerDisposer(new k.AutocompleteTextInput({completer:function(a){return v.cancellableThen(d.volumeCompleter(a),function(a){return{completions:a.completions,makeElement:k.makeCompletionElementWithDescription,offset:a.offset,showSingleResult:!0}})},delay:0}));t.element.classList.add("add-layer-source");
t.inputElement.addEventListener("blur",function(a){c.validateSource(!1)});c.submitElement.disabled=!0;t.inputChanged.add(function(){v.cancelPromise(c.volumePromise);c.volumePromise=void 0;c.sourceValid=!1;c.submitElement.disabled=!0;c.statusElement.textContent=""});g.appendChild(r);g.appendChild(t.element);n.associateLabelWithElement(r,t.inputElement);r=q.makeHiddenSubmitButton();g.appendChild(r);f.appendChild(g);var z=c.statusElement,w=c.namePromptElement,C=c.nameInputElement,g=c.submitElement;z.className=
"dialog-status";r=document.createElement("form");r.className="name-form";w.textContent="Name:";C.className="add-layer-name";C.autocomplete="off";C.spellcheck=!1;C.type="text";c.registerEventListener(C,"input",function(){c.validateName()});g.type="submit";n.associateLabelWithElement(w,C);r.appendChild(w);r.appendChild(C);r.appendChild(g);f.appendChild(r);f.appendChild(z);void 0!==b?(void 0!==b.sourceUrl?(t.value=b.sourceUrl,c.validateSource()):c.sourceValid=!0,t.disabled=!0,C.value=b.name,c.validateName(),
g.textContent="Save",C.focus()):(f=c.manager.layerManager.managedLayers,0<f.length&&(f=f[f.length-1],f instanceof m.ManagedUserLayerWithSpecification&&(f=f.sourceUrl,void 0!==f&&(z=d.findSourceGroup(f),t.value=f.substring(0,z),t.inputElement.setSelectionRange(0,z)))),t.inputElement.focus(),g.textContent="Add Layer");c.registerEventListener(r,"submit",function(a){a.preventDefault();c.submit()});return c}b(e,c);a(e,[{key:"isNameValid",value:function(){var a=this.nameInputElement.value;if(""===a)return!1;
a=this.manager.layerManager.getLayerByName(a);return void 0===a||a===this.existingLayer}},{key:"submit",value:function(){this.sourceValid&&this.isNameValid()&&(this.existingLayer?(this.existingLayer.name=this.nameInputElement.value,this.manager.layerManager.layersChanged.dispatch()):this.manager.layerManager.addManagedLayer(this.manager.getLayer(this.nameInputElement.value,this.sourceInput.value)),this.dispose())}},{key:"validateName",value:function(){var a=this.nameInputElement;(this.nameValid=this.isNameValid())?
(a.classList.add("valid-input"),a.classList.remove("invalid-input")):(a.classList.remove("valid-input"),a.classList.add("invalid-input"));this.validityChanged()}},{key:"validityChanged",value:function(){this.submitElement.disabled=!(this.nameValid&&this.sourceValid)}},{key:"validateSource",value:function(){var a=this,b=0>=arguments.length||void 0===arguments[0]?!1:arguments[0],c=this.sourceInput.value;if(""!==c){try{var e=d.suggestLayerName(c),f=this.nameInputElement;if(""===this.nameInputElement.value){for(var l=
e,g=0;void 0!==this.manager.layerManager.getLayerByName(l);)l=e+ ++g;f.value=l;f.setSelectionRange(0,l.length);this.validateName()}b&&f.focus()}catch(k){this.setError(k.message);return}this.setInfo("Validating volume source...");b=new Promise(function(a){a(d.getVolume(c))});this.volumePromise=v.cancellableThen(b,function(b){a.sourceValid=!0;a.setInfo(r.VolumeType[b.volumeType].toLowerCase()+": "+b.numChannels+"-channel "+r.DataType[b.dataType].toLowerCase());a.validityChanged()});b.catch(function(b){b!==
v.CANCELLED&&a.setError(b.message)})}}},{key:"setInfo",value:function(a){this.statusElement.className="dialog-status dialog-status-info";this.statusElement.textContent=a}},{key:"setError",value:function(a){this.statusElement.className="dialog-status dialog-status-error";this.statusElement.textContent=a}}]);return e}(g.Overlay);c.LayerDialog=e},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function d(a){return q.StatusMessage.forPromise(new Promise(function(b){b(r.getVolume(a))}),{initialMessage:"Retrieving metadata for volume "+
a+".",delay:!0,errorPrefix:"Error retrieving metadata for volume "+a+": "})}var m=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),r=e(28),v=e(105);g=e(42);var n=e(118),k=e(60),q=e(4),f=e(23),p=e(8),h=e(34);c.getVolumeWithStatusMessage=d;var u=function(c){function d(a,c,e){l(this,d);a=b(this,Object.getPrototypeOf(d).call(this,
a));a.initialSpecification=c;a.manager=e;return a}a(d,c);m(d,[{key:"toJSON",value:function(){var a=this.layer;if(!a)return this.initialSpecification;a=a.toJSON();this.visible||(a.visible=!1);return a}}]);return d}(g.ManagedUserLayer);c.ManagedUserLayerWithSpecification=u;e=function(c){function e(a,c,d,f,g){l(this,e);var k=b(this,Object.getPrototypeOf(e).call(this));k.layerManager=a;k.chunkManager=c;k.worker=d;k.layerSelectedValues=f;k.voxelSize=g;k.changed=new h.Signal;k.registerSignalBinding(a.layersChanged.add(k.changed.dispatch,
k.changed));k.registerSignalBinding(a.specificationChanged.add(k.changed.dispatch,k.changed));return k}a(e,c);m(e,[{key:"reset",value:function(){this.layerManager.clear()}},{key:"restoreState",value:function(a){p.verifyObject(a);this.layerManager.clear();for(var b=$jscomp.makeIterator(Object.keys(a)),c=b.next();!c.done;c=b.next())c=c.value,this.layerManager.addManagedLayer(this.getLayer(c,a[c]))}},{key:"getLayer",value:function(a,b){var c=new u(a,b,this);"string"===typeof b&&(b={source:b});p.verifyObject(b);
var e=p.verifyObjectProperty(b,"type",p.verifyOptionalString);c.visible=p.verifyObjectProperty(b,"visible",function(a){if(void 0===a||!0===a)return!0;if(!1===a)return!1;throw Error("Expected boolean, but received: "+JSON.stringify(a)+".");});var f=c.sourceUrl=p.verifyObjectProperty(b,"source",p.verifyOptionalString);if(void 0===e){var h=this;if(void 0===f)throw Error("Either layer 'type' or 'source' URL must be specified.");d(f).then(function(a){if(-1!==h.layerManager.managedLayers.indexOf(c))switch(a.volumeType){case k.VolumeType.IMAGE:a=
new v.ImageUserLayer(h,b);c.layer=a;break;case k.VolumeType.SEGMENTATION:a=new n.SegmentationUserLayer(h,b);c.layer=a;break;default:throw Error("Unsupported source type.");}})}else if("image"===e)c.layer=new v.ImageUserLayer(this,b);else if("segmentation"===e)c.layer=new n.SegmentationUserLayer(this,b);else throw Error("Layer type not specified.");return c}},{key:"toJSON",value:function(){for(var a={},b=0,c=$jscomp.makeIterator(this.layerManager.managedLayers),d=c.next();!d.done;d=c.next())d=d.value,
a[d.name]=d.toJSON(),++b;return 0===b?void 0:a}}]);return e}(f.RefCounted);c.LayerListSpecification=e},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d=function t(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:t(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},m=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];
e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();e(106);var r=e(107),v=e(43);g=e(42);var n=e(104),k=e(99),q=e(108),f=e(65),p=e(23),h=e(7),u=e(110);e(112);e(113);e(114);e(115);e(116);e(117)(r);e=function(c){function d(a,c){l(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.opacity=f.trackableAlphaValue(.5);e.fragmentMain=q.getTrackableFragmentMain();var h=c.source;
if("string"!==typeof h)throw Error("Invalid image layer specification");e.opacity.restoreState(c.opacity);e.fragmentMain.restoreState(c.shader);e.registerSignalBinding(e.fragmentMain.changed.add(function(){e.specificationChanged.dispatch()}));e.volumePath=h;h=new q.ImageRenderLayer(a.chunkManager,n.getVolumeWithStatusMessage(h),e.opacity,e.fragmentMain);e.renderLayer=h;e.addRenderLayer(h);return e}a(d,c);m(d,[{key:"toJSON",value:function(){var a={type:"image"};a.source=this.volumePath;a.opacity=this.opacity.toJSON();
a.shader=this.fragmentMain.toJSON();return a}},{key:"makeDropdown",value:function(a){return new B(a,this)}}]);return d}(g.UserLayer);c.ImageUserLayer=e;var A=function(c){function e(a){l(this,e);var c=b(this,Object.getPrototypeOf(e).call(this));c.layer=a;c.changingValue=!1;c.debouncedValueUpdater=v(function(){c.changingValue=!0;try{c.layer.fragmentMain.value=c.textEditor.getValue()}finally{c.changingValue=!1}},500);c.textEditor=r(function(a){},{value:c.layer.fragmentMain.value,mode:"glsl",gutters:["CodeMirror-lint-markers"]});
c.textEditor.on("change",function(){c.setValidState(void 0);c.debouncedValueUpdater()});c.registerSignalBinding(c.layer.fragmentMain.changed.add(function(){c.changingValue||c.textEditor.setValue(c.layer.fragmentMain.value)}));c.registerSignalBinding(c.layer.renderLayer.shaderError.changed.add(function(){c.updateErrorState()}));c.updateErrorState();return c}a(e,c);m(e,[{key:"updateErrorState",value:function(){this.layer.renderLayer.shaderUpdated&&this.setValidState(void 0);var a=this.layer.renderLayer.shaderError.value;
void 0!==a?(this.textEditor.setOption("lint",{getAnnotations:function(){if("ShaderCompilationError"===a.name){var b=function(){var b=a.source.split("\n").indexOf(q.FRAGMENT_MAIN_START)+2;return{v:a.errorMessages.map(function(a){return{message:a.message,severity:"error",from:r.Pos(void 0===a.line?0:a.line-b)}})}}();if("object"===typeof b)return b.v}else return"ShaderLinkError"===a.name?[{message:a.log,severity:"error",from:r.Pos(0)}]:[{message:a.message,severity:"error",from:r.Pos(0)}]}}),this.setValidState(!1)):
(this.textEditor.setOption("lint",void 0),this.setValidState(!0))}},{key:"setValidState",value:function(a){var b=this.element;b.classList.remove("invalid-input");b.classList.remove("valid-input");!0===a?b.classList.add("valid-input"):!1===a&&b.classList.add("invalid-input")}},{key:"disposed",value:function(){this.debouncedValueUpdater.flush();this.debouncedValueUpdater=void 0;h.removeFromParent(this.element);this.textEditor=void 0;d(Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}},
{key:"element",get:function(){return this.textEditor.getWrapperElement()}}]);return e}(p.RefCounted),B=function(c){function d(a,c){l(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.element=a;e.layer=c;e.opacityWidget=e.registerDisposer(new u.RangeWidget(e.layer.opacity));e.codeWidget=e.registerDisposer(new A(e.layer));a.classList.add("image-dropdown");var f=e.opacityWidget,h=document.createElement("div");h.className="image-dropdown-top-row";f.promptElement.textContent="Opacity";f=document.createElement("div");
f.style.flex="1";var g=document.createElement("a"),k=document.createElement("button");k.type="button";k.textContent="?";k.className="help-link";g.appendChild(k);g.title="Documentation on image layer rendering";g.target="_blank";g.href="https://github.com/google/neuroglancer/blob/master/src/neuroglancer/sliceview/image_layer_rendering.md";k=document.createElement("button");k.innerHTML="&square;";k.className="maximize-button";k.title="Show larger editor view";e.registerEventListener(k,"click",function(){new y(e.layer)});
h.appendChild(e.opacityWidget.element);h.appendChild(f);h.appendChild(k);h.appendChild(g);a.appendChild(h);a.appendChild(e.codeWidget.element);e.codeWidget.textEditor.refresh();return e}a(d,c);m(d,[{key:"onShow",value:function(){this.codeWidget.textEditor.refresh()}}]);return d}(g.UserLayerDropdown),y=function(c){function d(a){l(this,d);var c=b(this,Object.getPrototypeOf(d).call(this));c.layer=a;c.codeWidget=c.registerDisposer(new A(c.layer));c.content.classList.add("image-layer-shader-overlay");
c.content.appendChild(c.codeWidget.element);c.codeWidget.textEditor.refresh();return c}a(d,c);return d}(k.Overlay)},function(g,c,e){(function(c){c(e(107))})(function(c){function b(a,b){function d(a){if(!e.parentNode)return c.off(document,"mousemove",d);e.style.top=Math.max(0,a.clientY-e.offsetHeight-5)+"px";e.style.left=a.clientX+5+"px"}var e=document.createElement("div");e.className="CodeMirror-lint-tooltip";e.appendChild(b.cloneNode(!0));document.body.appendChild(e);c.on(document,"mousemove",d);
d(a);null!=e.style.opacity&&(e.style.opacity=1);return e}function a(a){a.parentNode&&(null==a.style.opacity&&a.parentNode&&a.parentNode.removeChild(a),a.style.opacity=0,setTimeout(function(){a.parentNode&&a.parentNode.removeChild(a)},600))}function d(d,e,f){function g(){c.off(f,"mouseout",g);k&&(a(k),k=null)}var k=b(d,e),p=setInterval(function(){if(k)for(var a=f;;a=a.parentNode){a&&11==a.nodeType&&(a=a.host);if(a==document.body)return;if(!a){g();break}}if(!k)return clearInterval(p)},400);c.on(f,"mouseout",
g)}function e(a,b,c){this.marked=[];this.options=b;this.timeout=null;this.hasGutter=c;this.onMouseOver=function(b){var c=b.target||b.srcElement;if(/\bCodeMirror-lint-mark-/.test(c.className)){for(var c=c.getBoundingClientRect(),e=a.findMarksAt(a.coordsChar({left:(c.left+c.right)/2,top:(c.top+c.bottom)/2},"client")),c=[],f=0;f<e.length;++f){var l=e[f].__annotation;l&&c.push(l)}if(c.length){e=b.target||b.srcElement;f=document.createDocumentFragment();for(l=0;l<c.length;l++)f.appendChild(n(c[l]));d(b,
f,e)}}};this.waitingFor=0}function g(a){var b=a.state.lint;b.hasGutter&&a.clearGutter("CodeMirror-lint-markers");for(a=0;a<b.marked.length;++a)b.marked[a].clear();b.marked.length=0}function v(a,b,e,f){var g=document.createElement("div"),k=g;g.className="CodeMirror-lint-marker-"+b;e&&(k=g.appendChild(document.createElement("div")),k.className="CodeMirror-lint-marker-multiple");if(0!=f)c.on(k,"mouseover",function(b){d(b,a,k)});return g}function n(a){var b=a.severity;b||(b="error");var c=document.createElement("div");
c.className="CodeMirror-lint-message-"+b;c.appendChild(document.createTextNode(a.message));return c}function k(a,b,d){function e(){k=-1;a.off("change",e)}var g=a.state.lint,k=++g.waitingFor;a.on("change",e);b(a.getValue(),function(b,d){a.off("change",e);g.waitingFor==k&&(d&&b instanceof c&&(b=d),f(a,b))},d,a)}function q(a){var b=a.state.lint.options,d=b.options||b,e=b.getAnnotations||a.getHelper(c.Pos(0,0),"lint");e&&(b.async||e.async?k(a,e,d):f(a,e(a.getValue(),d,a)))}function f(a,b){g(a);for(var c=
a.state.lint,d=c.options,e=[],f=0;f<b.length;++f){var l=b[f],k=l.from.line;(e[k]||(e[k]=[])).push(l)}for(f=0;f<e.length;++f)if(l=e[f]){for(var k=null,p=c.hasGutter&&document.createDocumentFragment(),q=0;q<l.length;++q){var m=l[q],F=m.severity;F||(F="error");"error"!=k&&(k=F);d.formatAnnotation&&(m=d.formatAnnotation(m));c.hasGutter&&p.appendChild(n(m));m.to&&c.marked.push(a.markText(m.from,m.to,{className:"CodeMirror-lint-mark-"+F,__annotation:m}))}c.hasGutter&&a.setGutterMarker(f,"CodeMirror-lint-markers",
v(p,k,1<l.length,c.options.tooltips))}if(d.onUpdateLinting)d.onUpdateLinting(b,e,a)}function p(a){var b=a.state.lint;b&&(clearTimeout(b.timeout),b.timeout=setTimeout(function(){q(a)},b.options.delay||500))}c.defineOption("lint",!1,function(a,b,d){d&&d!=c.Init&&(g(a),!1!==a.state.lint.options.lintOnChange&&a.off("change",p),c.off(a.getWrapperElement(),"mouseover",a.state.lint.onMouseOver),clearTimeout(a.state.lint.timeout),delete a.state.lint);if(b){var f=a.getOption("gutters");d=!1;for(var k=0;k<
f.length;++k)"CodeMirror-lint-markers"==f[k]&&(d=!0);f=a.state;b instanceof Function?b={getAnnotations:b}:b&&!0!==b||(b={});d=f.lint=new e(a,b,d);if(!1!==d.options.lintOnChange)a.on("change",p);if(0!=d.options.tooltips)c.on(a.getWrapperElement(),"mouseover",d.onMouseOver);q(a)}});c.defineExtension("performLint",function(){this.state.lint&&q(this)})})},function(g,c,e){(function(c){g.exports=c()})(function(){function c(a,d){if(!(this instanceof c))return new c(a,d);this.options=d=d?Ba(d):{};Ba(wf,d,
!1);h(d);var e=d.value;"string"==typeof e&&(e=new ra(e,d.mode,null,d.lineSeparator));this.doc=e;var Ja=new c.inputStyles[d.inputStyle](this),Ja=this.display=new b(a,e,Ja);Ja.wrapper.CodeMirror=this;k(this);v(this);d.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");d.autofocus&&!Pb&&Ja.input.focus();y(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new fb,
keySeq:null,specialChars:null};var f=this;U&&11>aa&&setTimeout(function(){f.display.input.reset(!0)},20);xf(this);Rd||(yf(),Rd=!0);vb(this);this.curOp.forceUpdate=!0;Sd(this,e);d.autofocus&&!Pb||f.hasFocus()?setTimeout(Qb(dd,this),20):Rb(this);for(var g in wb)if(wb.hasOwnProperty(g))wb[g](this,d[g],Td);C(this);d.finishInit&&d.finishInit(this);for(e=0;e<ed.length;++e)ed[e](this);xb(this);ha&&d.lineWrapping&&"optimizelegibility"==getComputedStyle(Ja.lineDiv).textRendering&&(Ja.lineDiv.style.textRendering=
"auto")}function b(a,b,c){this.input=c;this.scrollbarFiller=H("div",null,"CodeMirror-scrollbar-filler");this.scrollbarFiller.setAttribute("cm-not-content","true");this.gutterFiller=H("div",null,"CodeMirror-gutter-filler");this.gutterFiller.setAttribute("cm-not-content","true");this.lineDiv=H("div",null,"CodeMirror-code");this.selectionDiv=H("div",null,null,"position: relative; z-index: 1");this.cursorDiv=H("div",null,"CodeMirror-cursors");this.measure=H("div",null,"CodeMirror-measure");this.lineMeasure=
H("div",null,"CodeMirror-measure");this.lineSpace=H("div",[this.measure,this.lineMeasure,this.selectionDiv,this.cursorDiv,this.lineDiv],null,"position: relative; outline: none");this.mover=H("div",[H("div",[this.lineSpace],"CodeMirror-lines")],null,"position: relative");this.sizer=H("div",[this.mover],"CodeMirror-sizer");this.sizerWidth=null;this.heightForcer=H("div",null,null,"position: absolute; height: "+Ud+"px; width: 1px;");this.gutters=H("div",null,"CodeMirror-gutters");this.lineGutter=null;
this.scroller=H("div",[this.sizer,this.heightForcer,this.gutters],"CodeMirror-scroll");this.scroller.setAttribute("tabIndex","-1");this.wrapper=H("div",[this.scrollbarFiller,this.gutterFiller,this.scroller],"CodeMirror");U&&8>aa&&(this.gutters.style.zIndex=-1,this.scroller.style.paddingRight=0);ha||Za&&Pb||(this.scroller.draggable=!0);a&&(a.appendChild?a.appendChild(this.wrapper):a(this.wrapper));this.reportedViewFrom=this.reportedViewTo=this.viewFrom=this.viewTo=b.first;this.view=[];this.externalMeasured=
this.renderedView=null;this.lastWrapHeight=this.lastWrapWidth=this.viewOffset=0;this.updateLineNumbers=null;this.nativeBarWidth=this.barHeight=this.barWidth=0;this.scrollbarsClipped=!1;this.lineNumWidth=this.lineNumInnerWidth=this.lineNumChars=null;this.alignWidgets=!1;this.maxLine=this.cachedCharWidth=this.cachedTextHeight=this.cachedPaddingH=null;this.maxLineLength=0;this.maxLineChanged=!1;this.wheelDX=this.wheelDY=this.wheelStartX=this.wheelStartY=null;this.shift=!1;this.activeTouch=this.selForContextMenu=
null;c.init(this)}function a(a){a.doc.mode=c.getMode(a.options,a.doc.modeOption);d(a)}function d(a){a.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null)});a.doc.frontier=a.doc.first;Sb(a,100);a.state.modeGen++;a.curOp&&oa(a)}function e(a){var b=gb(a.display),c=a.options.lineWrapping,d=c&&Math.max(5,a.display.scroller.clientWidth/Tb(a.display)-3);return function(e){if(hb(a.doc,e))return 0;var f=0;if(e.widgets)for(var h=0;h<e.widgets.length;h++)e.widgets[h].height&&(f+=
e.widgets[h].height);return c?f+(Math.ceil(e.text.length/d)||1)*b:f+b}}function g(a){var b=a.doc,c=e(a);b.iter(function(a){var b=c(a);b!=a.height&&Ka(a,b)})}function v(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-");Ub(a)}function n(a){k(a);oa(a);setTimeout(function(){w(a)},20)}function k(a){var b=a.display.gutters,c=a.options.gutters;$a(b);for(var d=0;d<c.length;++d){var e=c[d],f=b.appendChild(H("div",null,"CodeMirror-gutter "+
e));"CodeMirror-linenumbers"==e&&(a.display.lineGutter=f,f.style.width=(a.display.lineNumWidth||1)+"px")}b.style.display=d?"":"none";q(a)}function q(a){a.display.sizer.style.marginLeft=a.display.gutters.offsetWidth+"px"}function f(a){if(0==a.height)return 0;for(var b=a.text.length,c,d=a;c=ib(d,!0);)c=c.find(0,!0),d=c.from.line,b+=c.from.ch-c.to.ch;for(d=a;c=ib(d,!1);)c=c.find(0,!0),b-=d.text.length-c.from.ch,d=c.to.line,b+=d.text.length-c.to.ch;return b}function p(a){var b=a.display;a=a.doc;b.maxLine=
J(a,a.first);b.maxLineLength=f(b.maxLine);b.maxLineChanged=!0;a.iter(function(a){var c=f(a);c>b.maxLineLength&&(b.maxLineLength=c,b.maxLine=a)})}function h(a){var b=ka(a.gutters,"CodeMirror-linenumbers");-1==b&&a.lineNumbers?a.gutters=a.gutters.concat(["CodeMirror-linenumbers"]):-1<b&&!a.lineNumbers&&(a.gutters=a.gutters.slice(0),a.gutters.splice(b,1))}function u(a){var b=a.display,c=b.gutters.offsetWidth,d=Math.round(a.doc.height+fd(a.display));return{clientHeight:b.scroller.clientHeight,viewHeight:b.wrapper.clientHeight,
scrollWidth:b.scroller.scrollWidth,clientWidth:b.scroller.clientWidth,viewWidth:b.wrapper.clientWidth,barLeft:a.options.fixedGutter?c:0,docHeight:d,scrollHeight:d+La(a)+b.barHeight,nativeBarWidth:b.nativeBarWidth,gutterWidth:c}}function A(a,b,c){this.cm=c;var d=this.vert=H("div",[H("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),e=this.horiz=H("div",[H("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");a(d);a(e);K(d,"scroll",function(){d.clientHeight&&b(d.scrollTop,
"vertical")});K(e,"scroll",function(){e.clientWidth&&b(e.scrollLeft,"horizontal")});this.checkedZeroWidth=!1;U&&8>aa&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")}function B(){}function y(a){a.display.scrollbars&&(a.display.scrollbars.clear(),a.display.scrollbars.addClass&&Vb(a.display.wrapper,a.display.scrollbars.addClass));a.display.scrollbars=new c.scrollbarModel[a.options.scrollbarStyle](function(b){a.display.wrapper.insertBefore(b,a.display.scrollbarFiller);K(b,"mousedown",function(){a.state.focused&&
setTimeout(function(){a.display.input.focus()},0)});b.setAttribute("cm-not-content","true")},function(b,c){"horizontal"==c?yb(a,b):Wb(a,b)},a);a.display.scrollbars.addClass&&Xb(a.display.wrapper,a.display.scrollbars.addClass)}function x(a,b){b||(b=u(a));var c=a.display.barWidth,d=a.display.barHeight;t(a,b);for(var e=0;4>e&&c!=a.display.barWidth||d!=a.display.barHeight;e++)c!=a.display.barWidth&&a.options.lineWrapping&&P(a),t(a,u(a)),c=a.display.barWidth,d=a.display.barHeight}function t(a,b){var c=
a.display,d=c.scrollbars.update(b);c.sizer.style.paddingRight=(c.barWidth=d.right)+"px";c.sizer.style.paddingBottom=(c.barHeight=d.bottom)+"px";c.heightForcer.style.borderBottom=d.bottom+"px solid transparent";d.right&&d.bottom?(c.scrollbarFiller.style.display="block",c.scrollbarFiller.style.height=d.bottom+"px",c.scrollbarFiller.style.width=d.right+"px"):c.scrollbarFiller.style.display="";d.bottom&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?(c.gutterFiller.style.display="block",
c.gutterFiller.style.height=d.bottom+"px",c.gutterFiller.style.width=b.gutterWidth+"px"):c.gutterFiller.style.display=""}function z(a,b,c){var d=c&&null!=c.top?Math.max(0,c.top):a.scroller.scrollTop,d=Math.floor(d-a.lineSpace.offsetTop),e=c&&null!=c.bottom?c.bottom:d+a.wrapper.clientHeight,d=jb(b,d),e=jb(b,e);if(c&&c.ensure){var f=c.ensure.from.line;c=c.ensure.to.line;f<d?(d=f,e=jb(b,Ma(J(b,f))+a.wrapper.clientHeight)):Math.min(c,b.lastLine())>=e&&(d=jb(b,Ma(J(b,c))-a.wrapper.clientHeight),e=c)}return{from:d,
to:Math.max(e,d+1)}}function w(a){var b=a.display,c=b.view;if(b.alignWidgets||b.gutters.firstChild&&a.options.fixedGutter){for(var d=F(b)-b.scroller.scrollLeft+a.doc.scrollLeft,e=b.gutters.offsetWidth,f=d+"px",h=0;h<c.length;h++)if(!c[h].hidden){a.options.fixedGutter&&c[h].gutter&&(c[h].gutter.style.left=f);var g=c[h].alignable;if(g)for(var k=0;k<g.length;k++)g[k].style.left=f}a.options.fixedGutter&&(b.gutters.style.left=d+e+"px")}}function C(a){if(!a.options.lineNumbers)return!1;var b=a.doc,b=D(a.options,
b.first+b.size-1),c=a.display;if(b.length!=c.lineNumChars){var d=c.measure.appendChild(H("div",[H("div",b)],"CodeMirror-linenumber CodeMirror-gutter-elt")),e=d.firstChild.offsetWidth,d=d.offsetWidth-e;c.lineGutter.style.width="";c.lineNumInnerWidth=Math.max(e,c.lineGutter.offsetWidth-d)+1;c.lineNumWidth=c.lineNumInnerWidth+d;c.lineNumChars=c.lineNumInnerWidth?b.length:-1;c.lineGutter.style.width=c.lineNumWidth+"px";q(a);return!0}return!1}function D(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}
function F(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function G(a,b,c){var d=a.display;this.viewport=b;this.visible=z(d,a.doc,b);this.editorIsHidden=!d.wrapper.offsetWidth;this.wrapperHeight=d.wrapper.clientHeight;this.wrapperWidth=d.wrapper.clientWidth;this.oldDisplayWidth=kb(a);this.force=c;this.dims=Z(a);this.events=[]}function Q(a,b){var c=a.display,d=a.doc;if(b.editorIsHidden)return ab(a),!1;if(!b.force&&b.visible.from>=c.viewFrom&&b.visible.to<=c.viewTo&&
(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo)&&c.renderedView==c.view&&0==Vd(a))return!1;C(a)&&(ab(a),b.dims=Z(a));var e=d.first+d.size,f=Math.max(b.visible.from-a.options.viewportMargin,d.first),h=Math.min(e,b.visible.to+a.options.viewportMargin);c.viewFrom<f&&20>f-c.viewFrom&&(f=Math.max(d.first,c.viewFrom));c.viewTo>h&&20>c.viewTo-h&&(h=Math.min(e,c.viewTo));bb&&(f=gd(a.doc,f),h=Wd(a.doc,h));d=f!=c.viewFrom||h!=c.viewTo||c.lastWrapHeight!=b.wrapperHeight||c.lastWrapWidth!=b.wrapperWidth;
e=a.display;0==e.view.length||f>=e.viewTo||h<=e.viewFrom?(e.view=uc(a,f,h),e.viewFrom=f):(e.viewFrom>f?e.view=uc(a,f,e.viewFrom).concat(e.view):e.viewFrom<f&&(e.view=e.view.slice(lb(a,f))),e.viewFrom=f,e.viewTo<h?e.view=e.view.concat(uc(a,e.viewTo,h)):e.viewTo>h&&(e.view=e.view.slice(0,lb(a,h))));e.viewTo=h;c.viewOffset=Ma(J(a.doc,c.viewFrom));a.display.mover.style.top=c.viewOffset+"px";h=Vd(a);if(!d&&0==h&&!b.force&&c.renderedView==c.view&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo))return!1;
f=Na();4<h&&(c.lineDiv.style.display="none");R(a,c.updateLineNumbers,b.dims);4<h&&(c.lineDiv.style.display="");c.renderedView=c.view;f&&Na()!=f&&f.offsetHeight&&f.focus();$a(c.cursorDiv);$a(c.selectionDiv);c.gutters.style.height=c.sizer.style.minHeight=0;d&&(c.lastWrapHeight=b.wrapperHeight,c.lastWrapWidth=b.wrapperWidth,Sb(a,400));c.updateLineNumbers=null;return!0}function I(a,b){for(var c=b.viewport,d=!0;;d=!1){if(!d||!a.options.lineWrapping||b.oldDisplayWidth==kb(a))if(c&&null!=c.top&&(c={top:Math.min(a.doc.height+
fd(a.display)-hd(a),c.top)}),b.visible=z(a.display,a.doc,c),b.visible.from>=a.display.viewFrom&&b.visible.to<=a.display.viewTo)break;if(!Q(a,b))break;P(a);d=u(a);Yb(a);x(a,d);V(a,d)}b.signal(a,"update",a);if(a.display.viewFrom!=a.display.reportedViewFrom||a.display.viewTo!=a.display.reportedViewTo)b.signal(a,"viewportChange",a,a.display.viewFrom,a.display.viewTo),a.display.reportedViewFrom=a.display.viewFrom,a.display.reportedViewTo=a.display.viewTo}function O(a,b){var c=new G(a,b);if(Q(a,c)){P(a);
I(a,c);var d=u(a);Yb(a);x(a,d);V(a,d);c.finish()}}function V(a,b){a.display.sizer.style.minHeight=b.docHeight+"px";a.display.heightForcer.style.top=b.docHeight+"px";a.display.gutters.style.height=b.docHeight+a.display.barHeight+La(a)+"px"}function P(a){a=a.display;for(var b=a.lineDiv.offsetTop,c=0;c<a.view.length;c++){var d=a.view[c],e;if(!d.hidden){if(U&&8>aa){var f=d.node.offsetTop+d.node.offsetHeight;e=f-b;b=f}else e=d.node.getBoundingClientRect(),e=e.bottom-e.top;f=d.line.height-e;2>e&&(e=gb(a));
if(.001<f||-.001>f)if(Ka(d.line,e),T(d.line),d.rest)for(e=0;e<d.rest.length;e++)T(d.rest[e])}}}function T(a){if(a.widgets)for(var b=0;b<a.widgets.length;++b)a.widgets[b].height=a.widgets[b].node.parentNode.offsetHeight}function Z(a){for(var b=a.display,c={},d={},e=b.gutters.clientLeft,f=b.gutters.firstChild,h=0;f;f=f.nextSibling,++h)c[a.options.gutters[h]]=f.offsetLeft+f.clientLeft+e,d[a.options.gutters[h]]=f.clientWidth;return{fixedPos:F(b),gutterTotalWidth:b.gutters.offsetWidth,gutterLeft:c,gutterWidth:d,
wrapperWidth:b.wrapper.clientWidth}}function R(a,b,c){function d(b){var c=b.nextSibling;ha&&Ca&&a.display.currentWheelTarget==b?b.style.display="none":b.parentNode.removeChild(b);return c}for(var e=a.display,f=a.options.lineNumbers,h=e.lineDiv,g=h.firstChild,k=e.view,e=e.viewFrom,l=0;l<k.length;l++){var p=k[l];if(!p.hidden)if(p.node&&p.node.parentNode==h){for(;g!=p.node;)g=d(g);g=f&&null!=b&&b<=e&&p.lineNumber;p.changes&&(-1<ka(p.changes,"gutter")&&(g=!1),ea(a,p,e,c));g&&($a(p.lineNumber),p.lineNumber.appendChild(document.createTextNode(D(a.options,
e))));g=p.node.nextSibling}else{var q=za(a,p,e,c);h.insertBefore(q,g)}e+=p.size}for(;g;)g=d(g)}function ea(a,b,c,d){for(var e=0;e<b.changes.length;e++){var f=b.changes[e];if("text"==f){var f=b,h=f.text.className,g=Ha(a,f);f.text==f.node&&(f.node=g.pre);f.text.parentNode.replaceChild(g.pre,f.text);f.text=g.pre;g.bgClass!=f.bgClass||g.textClass!=f.textClass?(f.bgClass=g.bgClass,f.textClass=g.textClass,Xa(f)):h&&(f.text.className=h)}else if("gutter"==f)ya(a,b,c,d);else if("class"==f)Xa(b);else if("widget"==
f){f=a;h=b;g=d;h.alignable&&(h.alignable=null);for(var k=h.node.firstChild,l=void 0;k;k=l)l=k.nextSibling,"CodeMirror-linewidget"==k.className&&h.node.removeChild(k);ba(f,h,g)}}b.changes=null}function ca(a){a.node==a.text&&(a.node=H("div",null,null,"position: relative"),a.text.parentNode&&a.text.parentNode.replaceChild(a.node,a.text),a.node.appendChild(a.text),U&&8>aa&&(a.node.style.zIndex=2));return a.node}function Ha(a,b){var c=a.display.externalMeasured;return c&&c.line==b.line?(a.display.externalMeasured=
null,b.measure=c.measure,c.built):Xd(a,b)}function Xa(a){var b=a.bgClass?a.bgClass+" "+(a.line.bgClass||""):a.line.bgClass;b&&(b+=" CodeMirror-linebackground");if(a.background)b?a.background.className=b:(a.background.parentNode.removeChild(a.background),a.background=null);else if(b){var c=ca(a);a.background=c.insertBefore(H("div",null,b),c.firstChild)}a.line.wrapClass?ca(a).className=a.line.wrapClass:a.node!=a.text&&(a.node.className="");a.text.className=(a.textClass?a.textClass+" "+(a.line.textClass||
""):a.line.textClass)||""}function ya(a,b,c,d){b.gutter&&(b.node.removeChild(b.gutter),b.gutter=null);b.gutterBackground&&(b.node.removeChild(b.gutterBackground),b.gutterBackground=null);if(b.line.gutterClass){var e=ca(b);b.gutterBackground=H("div",null,"CodeMirror-gutter-background "+b.line.gutterClass,"left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px; width: "+d.gutterTotalWidth+"px");e.insertBefore(b.gutterBackground,b.text)}var f=b.line.gutterMarkers;if(a.options.lineNumbers||
f){var e=ca(b),h=b.gutter=H("div",null,"CodeMirror-gutter-wrapper","left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px");a.display.input.setUneditable(h);e.insertBefore(h,b.text);b.line.gutterClass&&(h.className+=" "+b.line.gutterClass);!a.options.lineNumbers||f&&f["CodeMirror-linenumbers"]||(b.lineNumber=h.appendChild(H("div",D(a.options,c),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+d.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+a.display.lineNumInnerWidth+"px")));
if(f)for(b=0;b<a.options.gutters.length;++b)c=a.options.gutters[b],(e=f.hasOwnProperty(c)&&f[c])&&h.appendChild(H("div",[e],"CodeMirror-gutter-elt","left: "+d.gutterLeft[c]+"px; width: "+d.gutterWidth[c]+"px"))}}function za(a,b,c,d){var e=Ha(a,b);b.text=b.node=e.pre;e.bgClass&&(b.bgClass=e.bgClass);e.textClass&&(b.textClass=e.textClass);Xa(b);ya(a,b,c,d);ba(a,b,d);return b.node}function ba(a,b,c){Mb(a,b.line,b,c,!0);if(b.rest)for(var d=0;d<b.rest.length;d++)Mb(a,b.rest[d],b,c,!1)}function Mb(a,b,
c,d,e){if(b.widgets){var f=ca(c),h=0;for(b=b.widgets;h<b.length;++h){var g=b[h],k=H("div",[g.node],"CodeMirror-linewidget");g.handleMouseEvents||k.setAttribute("cm-ignore-events","true");var l=g,p=k,q=d;if(l.noHScroll){(c.alignable||(c.alignable=[])).push(p);var n=q.wrapperWidth;p.style.left=q.fixedPos+"px";l.coverGutter||(n-=q.gutterTotalWidth,p.style.paddingLeft=q.gutterTotalWidth+"px");p.style.width=n+"px"}l.coverGutter&&(p.style.zIndex=5,p.style.position="relative",l.noHScroll||(p.style.marginLeft=
-q.gutterTotalWidth+"px"));a.display.input.setUneditable(k);e&&g.above?f.insertBefore(k,c.gutter||c.text):f.appendChild(k);sa(g,"redraw")}}}function Nb(a){return E(a.line,a.ch)}function eb(a,b){return 0>L(a,b)?b:a}function Ya(a,b){return 0>L(a,b)?a:b}function ua(a){a.state.focused||(a.display.input.focus(),dd(a))}function Ia(a,b,c,d,e){var f=a.doc;a.display.shift=!1;d||(d=f.sel);var h=a.state.pasteIncoming||"paste"==e,g=f.splitLines(b),k=null;if(h&&1<d.ranges.length)if(pa&&pa.text.join("\n")==b){if(0==
d.ranges.length%pa.text.length)for(var k=[],l=0;l<pa.text.length;l++)k.push(f.splitLines(pa.text[l]))}else g.length==d.ranges.length&&(k=vc(g,function(a){return[a]}));for(l=d.ranges.length-1;0<=l;l--){var p=d.ranges[l],q=p.from(),n=p.to();p.empty()&&(c&&0<c?q=E(q.line,q.ch-c):a.state.overwrite&&!h?n=E(n.line,Math.min(J(f,n.line).text.length,n.ch+W(g).length)):pa&&pa.lineWise&&pa.text.join("\n")==b&&(q=n=E(q.line,0)));p=a.curOp.updateInput;q={from:q,to:n,text:k?k[l%k.length]:g,origin:e||(h?"paste":
a.state.cutIncoming?"cut":"+input")};zb(a.doc,q);sa(a,"inputRead",a,q)}b&&!h&&Ob(a,b);Ab(a);a.curOp.updateInput=p;a.curOp.typing=!0;a.state.pasteIncoming=a.state.cutIncoming=!1}function sc(a,b){var c=a.clipboardData&&a.clipboardData.getData("text/plain");if(c)return a.preventDefault(),b.isReadOnly()||b.options.disableInput||va(b,function(){Ia(b,c,0,null,"paste")}),!0}function Ob(a,b){if(a.options.electricChars&&a.options.smartIndent)for(var c=a.doc.sel,d=c.ranges.length-1;0<=d;d--){var e=c.ranges[d];
if(!(100<e.head.ch||d&&c.ranges[d-1].head.line==e.head.line)){var f=a.getModeAt(e.head),h=!1;if(f.electricChars)for(var g=0;g<f.electricChars.length;g++){if(-1<b.indexOf(f.electricChars.charAt(g))){h=Zb(a,e.head.line,"smart");break}}else f.electricInput&&f.electricInput.test(J(a.doc,e.head.line).text.slice(0,e.head.ch))&&(h=Zb(a,e.head.line,"smart"));h&&sa(a,"electricInput",a,e.head.line)}}}function Nd(a){for(var b=[],c=[],d=0;d<a.doc.sel.ranges.length;d++){var e=a.doc.sel.ranges[d].head.line,e={anchor:E(e,
0),head:E(e+1,0)};c.push(e);b.push(a.getRange(e.anchor,e.head))}return{text:b,ranges:c}}function Od(a){a.setAttribute("autocorrect","off");a.setAttribute("autocapitalize","off");a.setAttribute("spellcheck","false")}function bd(a){this.cm=a;this.prevInput="";this.pollingFast=!1;this.polling=new fb;this.hasSelection=this.inaccurateSelection=!1;this.composing=null}function Pd(){var a=H("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),b=H("div",
[a],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");ha?a.style.width="1000px":a.setAttribute("wrap","off");Bb&&(a.style.border="1px solid black");Od(a);return b}function cd(a){this.cm=a;this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new fb;this.gracePeriod=!1}function Qd(a,b){var c=id(a,b.line);if(!c||c.hidden)return null;var d=J(a.doc,b.line),c=Yd(c,d,b.line),d=Da(d),e="left";d&&(e=wc(d,b.ch)%2?"right":"left");c=Zd(c.map,
b.ch,e);c.offset="right"==c.collapse?c.end:c.start;return c}function ub(a,b){b&&(a.bad=!0);return a}function tc(a,b,c){var d;if(b==a.display.lineDiv){d=a.display.lineDiv.childNodes[c];if(!d)return ub(a.clipPos(E(a.display.viewTo-1)),!0);b=null;c=0}else for(d=b;;d=d.parentNode){if(!d||d==a.display.lineDiv)return null;if(d.parentNode&&d.parentNode==a.display.lineDiv)break}for(var e=0;e<a.display.view.length;e++){var f=a.display.view[e];if(f.node==d)return uf(f,b,c)}}function uf(a,b,c){function d(b,
c,e){for(var S=-1;S<(l?l.length:0);S++)for(var f=0>S?k.map:l[S],Ta=0;Ta<f.length;Ta+=3){var Ja=f[Ta+2];if(Ja==b||Ja==c){c=X(0>S?a.line:a.rest[S]);S=f[Ta]+e;if(0>e||Ja!=b)S=f[Ta+(e?1:0)];return E(c,S)}}}var e=a.text.firstChild,f=!1;if(!b||!jd(e,b))return ub(E(X(a.line),0),!0);if(b==e&&(f=!0,b=e.childNodes[c],c=0,!b))return c=a.rest?W(a.rest):a.line,ub(E(X(c),c.text.length),f);var h=3==b.nodeType?b:null,g=b;h||1!=b.childNodes.length||3!=b.firstChild.nodeType||(h=b.firstChild,c&&(c=h.nodeValue.length));
for(;g.parentNode!=e;)g=g.parentNode;var k=a.measure,l=k.maps;if(b=d(h,g,c))return ub(b,f);e=g.nextSibling;for(h=h?h.nodeValue.length-c:0;e;e=e.nextSibling){if(b=d(e,e.firstChild,0))return ub(E(b.line,b.ch-h),f);h+=e.textContent.length}g=g.previousSibling;for(h=c;g;g=g.previousSibling){if(b=d(g,g.firstChild,-1))return ub(E(b.line,b.ch+h),f);h+=e.textContent.length}}function vf(a,b,c,d,e){function f(a){return function(b){return b.id==a}}function h(b){if(1==b.nodeType){var c=b.getAttribute("cm-text");
if(null!=c)""==c&&(c=b.textContent.replace(/\u200b/g,"")),g+=c;else{var c=b.getAttribute("cm-marker"),S;if(c)b=a.findMarks(E(d,0),E(e+1,0),f(+c)),b.length&&(S=b[0].find())&&(g+=mb(a.doc,S.from,S.to).join(l));else if("false"!=b.getAttribute("contenteditable")){for(S=0;S<b.childNodes.length;S++)h(b.childNodes[S]);/^(pre|div|p)$/i.test(b.nodeName)&&(k=!0)}}}else 3==b.nodeType&&(b=b.nodeValue)&&(k&&(g+=l,k=!1),g+=b)}for(var g="",k=!1,l=a.doc.lineSeparator();;){h(b);if(b==c)break;b=b.nextSibling}return g}
function Sa(a,b){this.ranges=a;this.primIndex=b}function Y(a,b){this.anchor=a;this.head=b}function Ea(a,b){var c=a[b];a.sort(function(a,b){return L(a.from(),b.from())});b=ka(a,c);for(c=1;c<a.length;c++){var d=a[c],e=a[c-1];if(0<=L(e.to(),d.from())){var f=Ya(e.from(),d.from()),h=eb(e.to(),d.to()),d=e.empty()?d.from()==d.head:e.from()==e.head;c<=b&&--b;a.splice(--c,2,new Y(d?h:f,d?f:h))}}return new Sa(a,b)}function Oa(a,b){return new Sa([new Y(a,b||a)],0)}function N(a,b){if(b.line<a.first)return E(a.first,
0);var c=a.first+a.size-1;if(b.line>c)return E(c,J(a,c).text.length);var c=J(a,b.line).text.length,d=b.ch,c=null==d||d>c?E(b.line,c):0>d?E(b.line,0):b;return c}function $b(a,b){return b>=a.first&&b<a.first+a.size}function $d(a,b){for(var c=[],d=0;d<b.length;d++)c[d]=N(a,b[d]);return c}function ac(a,b,c,d){return a.cm&&a.cm.display.shift||a.extend?(a=b.anchor,d&&(b=0>L(c,a),b!=0>L(d,a)?(a=c,c=d):b!=0>L(c,d)&&(c=d)),new Y(a,c)):new Y(d||c,c)}function xc(a,b,c,d){ia(a,new Sa([ac(a,a.sel.primary(),b,
c)],0),d)}function ae(a,b,c){for(var d=[],e=0;e<a.sel.ranges.length;e++)d[e]=ac(a,a.sel.ranges[e],b[e],null);b=Ea(d,a.sel.primIndex);ia(a,b,c)}function kd(a,b,c,d){var e=a.sel.ranges.slice(0);e[b]=c;ia(a,Ea(e,a.sel.primIndex),d)}function zf(a,b,c){c={ranges:b.ranges,update:function(b){this.ranges=[];for(var c=0;c<b.length;c++)this.ranges[c]=new Y(N(a,b[c].anchor),N(a,b[c].head))},origin:c&&c.origin};fa(a,"beforeSelectionChange",a,c);a.cm&&fa(a.cm,"beforeSelectionChange",a.cm,c);return c.ranges!=b.ranges?
Ea(c.ranges,c.ranges.length-1):b}function be(a,b,c){var d=a.history.done,e=W(d);e&&e.ranges?(d[d.length-1]=b,yc(a,b,c)):ia(a,b,c)}function ia(a,b,c){yc(a,b,c);b=a.sel;var d=a.cm?a.cm.curOp.id:NaN,e=a.history,f=c&&c.origin,h;if(!(h=d==e.lastSelOp)&&(h=f&&e.lastSelOrigin==f)&&!(h=e.lastModTime==e.lastSelTime&&e.lastOrigin==f)){h=W(e.done);var g=f.charAt(0);h="*"==g||"+"==g&&h.ranges.length==b.ranges.length&&h.somethingSelected()==b.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:
500)}h?e.done[e.done.length-1]=b:zc(b,e.done);e.lastSelTime=+new Date;e.lastSelOrigin=f;e.lastSelOp=d;c&&!1!==c.clearRedo&&ce(e.undone)}function yc(a,b,c){if(Aa(a,"beforeSelectionChange")||a.cm&&Aa(a.cm,"beforeSelectionChange"))b=zf(a,b,c);var d=c&&c.bias||(0>L(b.primary().head,a.sel.primary().head)?-1:1);de(a,ee(a,b,d,!0));c&&!1===c.scroll||!a.cm||Ab(a.cm)}function de(a,b){b.equals(a.sel)||(a.sel=b,a.cm&&(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=!0,fe(a.cm)),sa(a,"cursorActivity",a))}function ge(a){de(a,
ee(a,a.sel,null,!1),Pa)}function ee(a,b,c,d){for(var e,f=0;f<b.ranges.length;f++){var h=b.ranges[f],g=b.ranges.length==a.sel.ranges.length&&a.sel.ranges[f],k=ld(a,h.anchor,g&&g.anchor,c,d),g=ld(a,h.head,g&&g.head,c,d);if(e||k!=h.anchor||g!=h.head)e||(e=b.ranges.slice(0,f)),e[f]=new Y(k,g)}return e?Ea(e,b.primIndex):b}function Cb(a,b,c,d,e){var f=J(a,b.line);if(f.markedSpans)for(var h=0;h<f.markedSpans.length;++h){var g=f.markedSpans[h],k=g.marker;if((null==g.from||(k.inclusiveLeft?g.from<=b.ch:g.from<
b.ch))&&(null==g.to||(k.inclusiveRight?g.to>=b.ch:g.to>b.ch))){if(e&&(fa(k,"beforeCursorEnter"),k.explicitlyCleared))if(f.markedSpans){--h;continue}else break;if(k.atomic){if(c){var h=k.find(0>d?1:-1),l;if(0>d?k.inclusiveRight:k.inclusiveLeft)h=he(a,h,-d,h&&h.line==b.line?f:null);if(h&&h.line==b.line&&(l=L(h,c))&&(0>d?0>l:0<l))return Cb(a,h,b,d,e)}c=k.find(0>d?-1:1);if(0>d?k.inclusiveLeft:k.inclusiveRight)c=he(a,c,d,c.line==b.line?f:null);return c?Cb(a,c,b,d,e):null}}}return b}function ld(a,b,c,d,
e){d=d||1;b=Cb(a,b,c,d,e)||!e&&Cb(a,b,c,d,!0)||Cb(a,b,c,-d,e)||!e&&Cb(a,b,c,-d,!0);return b?b:(a.cantEdit=!0,E(a.first,0))}function he(a,b,c,d){return 0>c&&0==b.ch?b.line>a.first?N(a,E(b.line-1)):null:0<c&&b.ch==(d||J(a,b.line)).text.length?b.line<a.first+a.size-1?E(b.line+1,0):null:new E(b.line,b.ch+c)}function Yb(a){a.display.input.showSelection(a.display.input.prepareSelection())}function ie(a,b){for(var c=a.doc,d={},e=d.cursors=document.createDocumentFragment(),f=d.selection=document.createDocumentFragment(),
h=0;h<c.sel.ranges.length;h++)if(!1!==b||h!=c.sel.primIndex){var g=c.sel.ranges[h];if(!(g.from().line>=a.display.viewTo||g.to().line<a.display.viewFrom)){var k=g.empty();(k||a.options.showCursorWhenSelecting)&&je(a,g.head,e);k||Af(a,g,f)}}return d}function je(a,b,c){b=Ua(a,b,"div",null,null,!a.options.singleCursorHeightPerLine);var d=c.appendChild(H("div","\u00a0","CodeMirror-cursor"));d.style.left=b.left+"px";d.style.top=b.top+"px";d.style.height=Math.max(0,b.bottom-b.top)*a.options.cursorHeight+
"px";b.other&&(a=c.appendChild(H("div","\u00a0","CodeMirror-cursor CodeMirror-secondarycursor")),a.style.display="",a.style.left=b.other.left+"px",a.style.top=b.other.top+"px",a.style.height=.85*(b.other.bottom-b.other.top)+"px")}function Af(a,b,c){function d(a,b,c,e){0>b&&(b=0);b=Math.round(b);e=Math.round(e);g.appendChild(H("div",null,"CodeMirror-selected","position: absolute; left: "+a+"px; top: "+b+"px; width: "+(null==c?p-a:c)+"px; height: "+(e-b)+"px"))}function e(b,c,S){var f=J(h,b),Ta=f.text.length,
g,k;Bf(Da(f),c||0,null==S?Ta:S,function(e,h,ja){var q=Ac(a,E(b,e),"div",f,"left"),n,m;e==h?(n=q,ja=m=q.left):(n=Ac(a,E(b,h-1),"div",f,"right"),"rtl"==ja&&(ja=q,q=n,n=ja),ja=q.left,m=n.right);null==c&&0==e&&(ja=l);3<n.top-q.top&&(d(ja,q.top,null,q.bottom),ja=l,q.bottom<n.top&&d(ja,q.bottom,null,n.top));null==S&&h==Ta&&(m=p);if(!g||q.top<g.top||q.top==g.top&&q.left<g.left)g=q;if(!k||n.bottom>k.bottom||n.bottom==k.bottom&&n.right>k.right)k=n;ja<l+1&&(ja=l);d(ja,n.top,m-ja,n.bottom)});return{start:g,
end:k}}var f=a.display,h=a.doc,g=document.createDocumentFragment(),k=ke(a.display),l=k.left,p=Math.max(f.sizerWidth,kb(a)-f.sizer.offsetLeft)-k.right,f=b.from();b=b.to();if(f.line==b.line)e(f.line,f.ch,b.ch);else{var q=J(h,f.line),k=J(h,b.line),k=Qa(q)==Qa(k),f=e(f.line,f.ch,k?q.text.length+1:null).end;b=e(b.line,k?0:null,b.ch).start;k&&(f.top<b.top-2?(d(f.right,f.top,null,f.bottom),d(l,b.top,b.left,b.bottom)):d(f.right,f.top,b.left-f.right,f.bottom));f.bottom<b.top&&d(l,f.bottom,null,b.top)}c.appendChild(g)}
function md(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursorDiv.style.visibility="";0<a.options.cursorBlinkRate?b.blinker=setInterval(function(){b.cursorDiv.style.visibility=(c=!c)?"":"hidden"},a.options.cursorBlinkRate):0>a.options.cursorBlinkRate&&(b.cursorDiv.style.visibility="hidden")}}function Sb(a,b){a.doc.mode.startState&&a.doc.frontier<a.display.viewTo&&a.state.highlight.set(b,Qb(Cf,a))}function Cf(a){var b=a.doc;b.frontier<b.first&&(b.frontier=b.first);if(!(b.frontier>=
a.display.viewTo)){var c=+new Date+a.options.workTime,d=cb(b.mode,bc(a,b.frontier)),e=[];b.iter(b.frontier,Math.min(b.first+b.size,a.display.viewTo+500),function(f){if(b.frontier>=a.display.viewFrom){var h=f.styles,g=f.text.length>a.options.maxHighlightLength,k=le(a,f,g?cb(b.mode,d):d,!0);f.styles=k.styles;var l=f.styleClasses;(k=k.classes)?f.styleClasses=k:l&&(f.styleClasses=null);l=!h||h.length!=f.styles.length||l!=k&&(!l||!k||l.bgClass!=k.bgClass||l.textClass!=k.textClass);for(k=0;!l&&k<h.length;++k)l=
h[k]!=f.styles[k];l&&e.push(b.frontier);f.stateAfter=g?d:cb(b.mode,d)}else f.text.length<=a.options.maxHighlightLength&&nd(a,f.text,d),f.stateAfter=0==b.frontier%5?cb(b.mode,d):null;++b.frontier;if(+new Date>c)return Sb(a,a.options.workDelay),!0});e.length&&va(a,function(){for(var b=0;b<e.length;b++)Va(a,e[b],"text")})}}function Df(a,b,c){for(var d,e,f=a.doc,h=c?-1:b-(a.doc.mode.innerMode?1E3:100);b>h;--b){if(b<=f.first)return f.first;var g=J(f,b-1);if(g.stateAfter&&(!c||b<=f.frontier))return b;g=
Fa(g.text,null,a.options.tabSize);if(null==e||d>g)e=b-1,d=g}return e}function bc(a,b,c){var d=a.doc,e=a.display;if(!d.mode.startState)return!0;var f=Df(a,b,c),h=f>d.first&&J(d,f-1).stateAfter,h=h?cb(d.mode,h):Ef(d.mode);d.iter(f,b,function(c){nd(a,c.text,h);c.stateAfter=f==b-1||0==f%5||f>=e.viewFrom&&f<e.viewTo?cb(d.mode,h):null;++f});c&&(d.frontier=f);return h}function fd(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function ke(a){if(a.cachedPaddingH)return a.cachedPaddingH;var b=wa(a.measure,
H("pre","x")),b=window.getComputedStyle?window.getComputedStyle(b):b.currentStyle,b={left:parseInt(b.paddingLeft),right:parseInt(b.paddingRight)};isNaN(b.left)||isNaN(b.right)||(a.cachedPaddingH=b);return b}function La(a){return Ud-a.display.nativeBarWidth}function kb(a){return a.display.scroller.clientWidth-La(a)-a.display.barWidth}function hd(a){return a.display.scroller.clientHeight-La(a)-a.display.barHeight}function Yd(a,b,c){if(a.line==b)return{map:a.measure.map,cache:a.measure.cache};for(var d=
0;d<a.rest.length;d++)if(a.rest[d]==b)return{map:a.measure.maps[d],cache:a.measure.caches[d]};for(d=0;d<a.rest.length;d++)if(X(a.rest[d])>c)return{map:a.measure.maps[d],cache:a.measure.caches[d],before:!0}}function id(a,b){if(b>=a.display.viewFrom&&b<a.display.viewTo)return a.display.view[lb(a,b)];var c=a.display.externalMeasured;if(c&&b>=c.lineN&&b<c.lineN+c.size)return c}function Bc(a,b){var c=X(b),d=id(a,c);d&&!d.text?d=null:d&&d.changes&&(ea(a,d,c,Z(a)),a.curOp.forceUpdate=!0);if(!d){var e;e=
Qa(b);d=X(e);e=a.display.externalMeasured=new me(a.doc,e,d);e.lineN=d;d=e.built=Xd(a,e);e.text=d.pre;wa(a.display.lineMeasure,d.pre);d=e}c=Yd(d,b,c);return{line:b,view:d,rect:null,map:c.map,cache:c.cache,before:c.before,hasHeights:!1}}function Cc(a,b,c,d,e){b.before&&(c=-1);var f=c+(d||"");if(b.cache.hasOwnProperty(f))a=b.cache[f];else{b.rect||(b.rect=b.view.text.getBoundingClientRect());if(!b.hasHeights){var h=b.view,g=b.rect,k=a.options.lineWrapping,l=k&&kb(a);if(!h.measure.heights||k&&h.measure.width!=
l){var p=h.measure.heights=[];if(k)for(h.measure.width=l,h=h.text.firstChild.getClientRects(),k=0;k<h.length-1;k++){var l=h[k],q=h[k+1];2<Math.abs(l.bottom-q.bottom)&&p.push((l.bottom+q.top)/2-g.top)}p.push(g.bottom-g.top)}b.hasHeights=!0}p=d;h=Zd(b.map,c,p);d=h.node;g=h.start;k=h.end;c=h.collapse;var n;if(3==d.nodeType){for(var m=0;4>m;m++){for(;g&&cc(b.line.text.charAt(h.coverStart+g));)--g;for(;h.coverStart+k<h.coverEnd&&cc(b.line.text.charAt(h.coverStart+k));)++k;if(U&&9>aa&&0==g&&k==h.coverEnd-
h.coverStart)n=d.parentNode.getBoundingClientRect();else{n=Db(d,g,k).getClientRects();k=ne;if("left"==p)for(l=0;l<n.length&&(k=n[l]).left==k.right;l++);else for(l=n.length-1;0<=l&&(k=n[l]).left==k.right;l--);n=k}if(n.left||n.right||0==g)break;k=g;--g;c="right"}U&&11>aa&&((m=!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI)||(null!=od?m=od:(p=wa(a.display.measure,H("span","x")),m=p.getBoundingClientRect(),p=Db(p,0,1).getBoundingClientRect(),m=od=1<Math.abs(m.left-p.left)),
m=!m),m||(m=screen.logicalXDPI/screen.deviceXDPI,p=screen.logicalYDPI/screen.deviceYDPI,n={left:n.left*m,right:n.right*m,top:n.top*p,bottom:n.bottom*p}))}else 0<g&&(c=p="right"),n=a.options.lineWrapping&&1<(m=d.getClientRects()).length?m["right"==p?m.length-1:0]:d.getBoundingClientRect();!(U&&9>aa)||g||n&&(n.left||n.right)||(n=(n=d.parentNode.getClientRects()[0])?{left:n.left,right:n.left+Tb(a.display),top:n.top,bottom:n.bottom}:ne);d=n.top-b.rect.top;g=n.bottom-b.rect.top;p=(d+g)/2;h=b.view.measure.heights;
for(m=0;m<h.length-1&&!(p<h[m]);m++);c={left:("right"==c?n.right:n.left)-b.rect.left,right:("left"==c?n.left:n.right)-b.rect.left,top:m?h[m-1]:0,bottom:h[m]};n.left||n.right||(c.bogus=!0);a.options.singleCursorHeightPerLine||(c.rtop=d,c.rbottom=g);a=c;a.bogus||(b.cache[f]=a)}return{left:a.left,right:a.right,top:e?a.rtop:a.top,bottom:e?a.rbottom:a.bottom}}function Zd(a,b,c){for(var d,e,f,h,g=0;g<a.length;g+=3){var k=a[g],l=a[g+1];if(b<k)e=0,f=1,h="left";else if(b<l)e=b-k,f=e+1;else if(g==a.length-
3||b==l&&a[g+3]>b)f=l-k,e=f-1,b>=l&&(h="right");if(null!=e){d=a[g+2];k==l&&c==(d.insertLeft?"left":"right")&&(h=c);if("left"==c&&0==e)for(;g&&a[g-2]==a[g-3]&&a[g-1].insertLeft;)d=a[(g-=3)+2],h="left";if("right"==c&&e==l-k)for(;g<a.length-3&&a[g+3]==a[g+4]&&!a[g+5].insertLeft;)d=a[(g+=3)+2],h="right";break}}return{node:d,start:e,end:f,collapse:h,coverStart:k,coverEnd:l}}function oe(a){if(a.measure&&(a.measure.cache={},a.measure.heights=null,a.rest))for(var b=0;b<a.rest.length;b++)a.measure.caches[b]=
{}}function pe(a){a.display.externalMeasure=null;$a(a.display.lineMeasure);for(var b=0;b<a.display.view.length;b++)oe(a.display.view[b])}function Ub(a){pe(a);a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=null;a.options.lineWrapping||(a.display.maxLineChanged=!0);a.display.lineNumChars=null}function pd(a,b,c,d){if(b.widgets)for(var e=0;e<b.widgets.length;++e)if(b.widgets[e].above){var f=dc(b.widgets[e]);c.top+=f;c.bottom+=f}if("line"==d)return c;d||(d="local");b=Ma(b);
b="local"==d?b+a.display.lineSpace.offsetTop:b-a.display.viewOffset;if("page"==d||"window"==d)a=a.display.lineSpace.getBoundingClientRect(),b+=a.top+("window"==d?0:window.pageYOffset||(document.documentElement||document.body).scrollTop),d=a.left+("window"==d?0:window.pageXOffset||(document.documentElement||document.body).scrollLeft),c.left+=d,c.right+=d;c.top+=b;c.bottom+=b;return c}function qe(a,b,c){if("div"==c)return b;var d=b.left;b=b.top;"page"==c?(d-=window.pageXOffset||(document.documentElement||
document.body).scrollLeft,b-=window.pageYOffset||(document.documentElement||document.body).scrollTop):"local"!=c&&c||(c=a.display.sizer.getBoundingClientRect(),d+=c.left,b+=c.top);a=a.display.lineSpace.getBoundingClientRect();return{left:d-a.left,top:b-a.top}}function Ac(a,b,c,d,e){d||(d=J(a.doc,b.line));var f=d;b=b.ch;d=Cc(a,Bc(a,d),b,e);return pd(a,f,d,c)}function Ua(a,b,c,d,e,f){function h(b,S){var g=Cc(a,e,b,S?"right":"left",f);S?g.left=g.right:g.right=g.left;return pd(a,d,g,c)}function g(a,b){var c=
k[b],d=c.level%2;a==qd(c)&&b&&c.level<k[b-1].level?(c=k[--b],a=rd(c)-(c.level%2?0:1),d=!0):a==rd(c)&&b<k.length-1&&c.level<k[b+1].level&&(c=k[++b],a=qd(c)-c.level%2,d=!1);return d&&a==c.to&&a>c.from?h(a-1):h(a,d)}d=d||J(a.doc,b.line);e||(e=Bc(a,d));var k=Da(d);b=b.ch;if(!k)return h(b);var l=wc(k,b),l=g(b,l);null!=ec&&(l.other=g(b,ec));return l}function re(a,b){var c=0;b=N(a.doc,b);a.options.lineWrapping||(c=Tb(a.display)*b.ch);var d=J(a.doc,b.line),e=Ma(d)+a.display.lineSpace.offsetTop;return{left:c,
right:c,top:e,bottom:e+d.height}}function Dc(a,b,c,d){a=E(a,b);a.xRel=d;c&&(a.outside=!0);return a}function sd(a,b,c){var d=a.doc;c+=a.display.viewOffset;if(0>c)return Dc(d.first,0,!0,-1);var e=jb(d,c),f=d.first+d.size-1;if(e>f)return Dc(d.first+d.size-1,J(d,f).text.length,!0,1);0>b&&(b=0);for(d=J(d,e);;)if(e=Ff(a,d,e,b,c),f=(d=ib(d,!1))&&d.find(0,!0),d&&(e.ch>f.from.ch||e.ch==f.from.ch&&0<e.xRel))e=X(d=f.to.line);else return e}function Ff(a,b,c,d,e){function f(d){d=Ua(a,E(c,d),"line",b,l);g=!0;if(h>
d.bottom)return d.left-k;if(h<d.top)return d.left+k;g=!1;return d.left}var h=e-Ma(b),g=!1,k=2*a.display.wrapper.clientWidth,l=Bc(a,b);e=Da(b);var p=b.text.length,q=Ec(b),n=Fc(b),m=f(q),t=g,w=f(n),r=g;if(d>w)return Dc(c,n,r,1);for(;;){if(e?n==q||n==td(b,q,1):1>=n-q){p=d<m||d-m<=w-d?q:n;t=p==q?t:r;q=d-(p==q?m:w);r&&!e&&!/\s/.test(b.text.charAt(p))&&0<q&&p<b.text.length&&1<l.view.measure.heights.length&&(e=Cc(a,l,p,"right"),h<=e.bottom&&h>=e.top&&Math.abs(d-e.right)<q&&(t=!1,p++,q=d-e.right));for(;cc(b.text.charAt(p));)++p;
return Dc(c,p,t,-1>q?-1:1<q?1:0)}var u=Math.ceil(p/2),C=q+u;if(e)for(var C=q,z=0;z<u;++z)C=td(b,C,1);z=f(C);if(z>d){n=C;w=z;if(r=g)w+=1E3;p=u}else q=C,m=z,t=g,p-=u}}function gb(a){if(null!=a.cachedTextHeight)return a.cachedTextHeight;if(null==nb){nb=H("pre");for(var b=0;49>b;++b)nb.appendChild(document.createTextNode("x")),nb.appendChild(H("br"));nb.appendChild(document.createTextNode("x"))}wa(a.measure,nb);b=nb.offsetHeight/50;3<b&&(a.cachedTextHeight=b);$a(a.measure);return b||1}function Tb(a){if(null!=
a.cachedCharWidth)return a.cachedCharWidth;var b=H("span","xxxxxxxxxx"),c=H("pre",[b]);wa(a.measure,c);b=b.getBoundingClientRect();b=(b.right-b.left)/10;2<b&&(a.cachedCharWidth=b);return b||10}function vb(a){a.curOp={cm:a,viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Gf};Eb?Eb.ops.push(a.curOp):a.curOp.ownsGroup=
Eb={ops:[a.curOp],delayedCallbacks:[]}}function xb(a){if(a=a.curOp.ownsGroup)try{var b=a.delayedCallbacks,c=0;do{for(;c<b.length;c++)b[c].call(null);for(var d=0;d<a.ops.length;d++){var e=a.ops[d];if(e.cursorActivityHandlers)for(;e.cursorActivityCalled<e.cursorActivityHandlers.length;)e.cursorActivityHandlers[e.cursorActivityCalled++].call(null,e.cm)}}while(c<b.length)}finally{Eb=null;for(b=0;b<a.ops.length;b++)a.ops[b].cm.curOp=null;a=a.ops;for(b=0;b<a.length;b++){var e=a[b],c=e.cm,f=d=c.display;
!f.scrollbarsClipped&&f.scroller.offsetWidth&&(f.nativeBarWidth=f.scroller.offsetWidth-f.scroller.clientWidth,f.heightForcer.style.height=La(c)+"px",f.sizer.style.marginBottom=-f.nativeBarWidth+"px",f.sizer.style.borderRightWidth=La(c)+"px",f.scrollbarsClipped=!0);e.updateMaxLine&&p(c);e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<d.viewFrom||e.scrollToPos.to.line>=d.viewTo)||d.maxLineChanged&&c.options.lineWrapping;e.update=e.mustUpdate&&new G(c,
e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}for(b=0;b<a.length;b++)e=a[b],e.updatedDisplay=e.mustUpdate&&Q(e.cm,e.update);for(b=0;b<a.length;b++)if(e=a[b],c=e.cm,d=c.display,e.updatedDisplay&&P(c),e.barMeasure=u(c),d.maxLineChanged&&!c.options.lineWrapping&&(f=void 0,f=d.maxLine.text.length,f=Cc(c,Bc(c,d.maxLine),f,void 0),e.adjustWidthTo=f.left+3,c.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(d.scroller.clientWidth,d.sizer.offsetLeft+e.adjustWidthTo+
La(c)+c.display.barWidth),e.maxScrollLeft=Math.max(0,d.sizer.offsetLeft+e.adjustWidthTo-kb(c))),e.updatedDisplay||e.selectionChanged)e.preparedSelection=d.input.prepareSelection(e.focus);for(b=0;b<a.length;b++)e=a[b],c=e.cm,null!=e.adjustWidthTo&&(c.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<c.doc.scrollLeft&&yb(c,Math.min(c.display.scroller.scrollLeft,e.maxScrollLeft),!0),c.display.maxLineChanged=!1),d=e.focus&&e.focus==Na()&&(!document.hasFocus||document.hasFocus()),e.preparedSelection&&
c.display.input.showSelection(e.preparedSelection,d),(e.updatedDisplay||e.startHeight!=c.doc.height)&&x(c,e.barMeasure),e.updatedDisplay&&V(c,e.barMeasure),e.selectionChanged&&md(c),c.state.focused&&e.updateInput&&c.display.input.reset(e.typing),d&&ua(e.cm);for(b=0;b<a.length;b++){e=a[b];c=e.cm;d=c.display;f=c.doc;e.updatedDisplay&&I(c,e.update);null==d.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(d.wheelStartX=d.wheelStartY=null);null==e.scrollTop||d.scroller.scrollTop==e.scrollTop&&
!e.forceScroll||(f.scrollTop=Math.max(0,Math.min(d.scroller.scrollHeight-d.scroller.clientHeight,e.scrollTop)),d.scrollbars.setScrollTop(f.scrollTop),d.scroller.scrollTop=f.scrollTop);null==e.scrollLeft||d.scroller.scrollLeft==e.scrollLeft&&!e.forceScroll||(f.scrollLeft=Math.max(0,Math.min(d.scroller.scrollWidth-d.scroller.clientWidth,e.scrollLeft)),d.scrollbars.setScrollLeft(f.scrollLeft),d.scroller.scrollLeft=f.scrollLeft,w(c));if(e.scrollToPos){var h=void 0,g=N(f,e.scrollToPos.from),h=N(f,e.scrollToPos.to),
k=e.scrollToPos.margin;null==k&&(k=0);for(var l=0;5>l;l++){var q=!1,n=Ua(c,g),m=h&&h!=g?Ua(c,h):n,m=Gc(c,Math.min(n.left,m.left),Math.min(n.top,m.top)-k,Math.max(n.left,m.left),Math.max(n.bottom,m.bottom)+k),t=c.doc.scrollTop,r=c.doc.scrollLeft;null!=m.scrollTop&&(Wb(c,m.scrollTop),1<Math.abs(c.doc.scrollTop-t)&&(q=!0));null!=m.scrollLeft&&(yb(c,m.scrollLeft),1<Math.abs(c.doc.scrollLeft-r)&&(q=!0));if(!q)break}h=n;e.scrollToPos.isCursor&&c.state.focused&&(ga(c,"scrollCursorIntoView")||(k=c.display,
l=k.sizer.getBoundingClientRect(),g=null,0>h.top+l.top?g=!0:h.bottom+l.top>(window.innerHeight||document.documentElement.clientHeight)&&(g=!1),null==g||Hf||(h=H("div","\u200b",null,"position: absolute; top: "+(h.top-k.viewOffset-c.display.lineSpace.offsetTop)+"px; height: "+(h.bottom-h.top+La(c)+k.barHeight)+"px; left: "+h.left+"px; width: 2px;"),c.display.lineSpace.appendChild(h),h.scrollIntoView(g),c.display.lineSpace.removeChild(h))))}g=e.maybeHiddenMarkers;h=e.maybeUnhiddenMarkers;if(g)for(k=
0;k<g.length;++k)g[k].lines.length||fa(g[k],"hide");if(h)for(k=0;k<h.length;++k)h[k].lines.length&&fa(h[k],"unhide");d.wrapper.offsetHeight&&(f.scrollTop=c.display.scroller.scrollTop);e.changeObjs&&fa(c,"changes",c,e.changeObjs);e.update&&e.update.finish()}}}function va(a,b){if(a.curOp)return b();vb(a);try{return b()}finally{xb(a)}}function da(a,b){return function(){if(a.curOp)return b.apply(a,arguments);vb(a);try{return b.apply(a,arguments)}finally{xb(a)}}}function la(a){return function(){if(this.curOp)return a.apply(this,
arguments);vb(this);try{return a.apply(this,arguments)}finally{xb(this)}}}function ma(a){return function(){var b=this.cm;if(!b||b.curOp)return a.apply(this,arguments);vb(b);try{return a.apply(this,arguments)}finally{xb(b)}}}function me(a,b,c){for(var d=this.line=b,e;d=ib(d,!1);)d=d.find(1,!0).line,(e||(e=[])).push(d);this.size=(this.rest=e)?X(W(this.rest))-c+1:1;this.node=this.text=null;this.hidden=hb(a,b)}function uc(a,b,c){var d=[],e;for(e=b;e<c;)b=new me(a.doc,J(a.doc,e),e),e+=b.size,d.push(b);
return d}function oa(a,b,c,d){null==b&&(b=a.doc.first);null==c&&(c=a.doc.first+a.doc.size);d||(d=0);var e=a.display;d&&c<e.viewTo&&(null==e.updateLineNumbers||e.updateLineNumbers>b)&&(e.updateLineNumbers=b);a.curOp.viewChanged=!0;if(b>=e.viewTo)bb&&gd(a.doc,b)<e.viewTo&&ab(a);else if(c<=e.viewFrom)bb&&Wd(a.doc,c+d)>e.viewFrom?ab(a):(e.viewFrom+=d,e.viewTo+=d);else if(b<=e.viewFrom&&c>=e.viewTo)ab(a);else if(b<=e.viewFrom){var f=Hc(a,c,c+d,1);f?(e.view=e.view.slice(f.index),e.viewFrom=f.lineN,e.viewTo+=
d):ab(a)}else if(c>=e.viewTo)(f=Hc(a,b,b,-1))?(e.view=e.view.slice(0,f.index),e.viewTo=f.lineN):ab(a);else{var f=Hc(a,b,b,-1),h=Hc(a,c,c+d,1);f&&h?(e.view=e.view.slice(0,f.index).concat(uc(a,f.lineN,h.lineN)).concat(e.view.slice(h.index)),e.viewTo+=d):ab(a)}if(a=e.externalMeasured)c<a.lineN?a.lineN+=d:b<a.lineN+a.size&&(e.externalMeasured=null)}function Va(a,b,c){a.curOp.viewChanged=!0;var d=a.display,e=a.display.externalMeasured;e&&b>=e.lineN&&b<e.lineN+e.size&&(d.externalMeasured=null);b<d.viewFrom||
b>=d.viewTo||(a=d.view[lb(a,b)],null!=a.node&&(a=a.changes||(a.changes=[]),-1==ka(a,c)&&a.push(c)))}function ab(a){a.display.viewFrom=a.display.viewTo=a.doc.first;a.display.view=[];a.display.viewOffset=0}function lb(a,b){if(b>=a.display.viewTo)return null;b-=a.display.viewFrom;if(0>b)return null;for(var c=a.display.view,d=0;d<c.length;d++)if(b-=c[d].size,0>b)return d}function Hc(a,b,c,d){var e=lb(a,b),f=a.display.view;if(!bb||c==a.doc.first+a.doc.size)return{index:e,lineN:c};for(var h=0,g=a.display.viewFrom;h<
e;h++)g+=f[h].size;if(g!=b){if(0<d){if(e==f.length-1)return null;b=g+f[e].size-b;e++}else b=g-b;c+=b}for(;gd(a.doc,c)!=c;){if(e==(0>d?0:f.length-1))return null;c+=d*f[e-(0>d?1:0)].size;e+=d}return{index:e,lineN:c}}function Vd(a){a=a.display.view;for(var b=0,c=0;c<a.length;c++){var d=a[c];d.hidden||d.node&&!d.changes||++b}return b}function xf(a){function b(){d.activeTouch&&(e=setTimeout(function(){d.activeTouch=null},1E3),f=d.activeTouch,f.end=+new Date)}function c(a,b){if(null==b.left)return!0;var d=
b.left-a.left,e=b.top-a.top;return 400<d*d+e*e}var d=a.display;K(d.scroller,"mousedown",da(a,If));U&&11>aa?K(d.scroller,"dblclick",da(a,function(b){if(!ga(a,b)){var c=ob(a,b);!c||ud(a,b,"gutterClick",!0)||Wa(a.display,b)||(na(b),b=a.findWordAt(c),xc(a.doc,b.anchor,b.head))}})):K(d.scroller,"dblclick",function(b){ga(a,b)||na(b)});vd||K(d.scroller,"contextmenu",function(b){se(a,b)});var e,f={end:0};K(d.scroller,"touchstart",function(b){var c;if(c=!ga(a,b))1!=b.touches.length?c=!1:(c=b.touches[0],c=
1>=c.radiusX&&1>=c.radiusY),c=!c;c&&(clearTimeout(e),c=+new Date,d.activeTouch={start:c,moved:!1,prev:300>=c-f.end?f:null},1==b.touches.length&&(d.activeTouch.left=b.touches[0].pageX,d.activeTouch.top=b.touches[0].pageY))});K(d.scroller,"touchmove",function(){d.activeTouch&&(d.activeTouch.moved=!0)});K(d.scroller,"touchend",function(e){var f=d.activeTouch;if(f&&!Wa(d,e)&&null!=f.left&&!f.moved&&300>new Date-f.start){var h=a.coordsChar(d.activeTouch,"page"),f=!f.prev||c(f,f.prev)?new Y(h,h):!f.prev.prev||
c(f,f.prev.prev)?a.findWordAt(h):new Y(E(h.line,0),N(a.doc,E(h.line+1,0)));a.setSelection(f.anchor,f.head);a.focus();na(e)}b()});K(d.scroller,"touchcancel",b);K(d.scroller,"scroll",function(){d.scroller.clientHeight&&(Wb(a,d.scroller.scrollTop),yb(a,d.scroller.scrollLeft,!0),fa(a,"scroll",a))});K(d.scroller,"mousewheel",function(b){te(a,b)});K(d.scroller,"DOMMouseScroll",function(b){te(a,b)});K(d.wrapper,"scroll",function(){d.wrapper.scrollTop=d.wrapper.scrollLeft=0});d.dragFunctions={enter:function(b){ga(a,
b)||Ic(b)},over:function(b){if(!ga(a,b)){var c=ob(a,b);if(c){var d=document.createDocumentFragment();je(a,c,d);a.display.dragCursor||(a.display.dragCursor=H("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),a.display.lineSpace.insertBefore(a.display.dragCursor,a.display.cursorDiv));wa(a.display.dragCursor,d)}Ic(b)}},start:function(b){if(U&&(!a.state.draggingText||100>+new Date-ue))Ic(b);else if(!ga(a,b)&&!Wa(a.display,b)&&(b.dataTransfer.setData("Text",a.getSelection()),b.dataTransfer.effectAllowed=
"copyMove",b.dataTransfer.setDragImage&&!ve)){var c=H("img",null,null,"position: fixed; left: 0; top: 0;");c.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";Ga&&(c.width=c.height=1,a.display.wrapper.appendChild(c),c._top=c.offsetTop);b.dataTransfer.setDragImage(c,0,0);Ga&&c.parentNode.removeChild(c)}},drop:da(a,Jf),leave:function(b){ga(a,b)||we(a)}};var h=d.input.getField();K(h,"keyup",function(b){xe.call(a,b)});K(h,"keydown",da(a,ye));K(h,"keypress",da(a,ze));K(h,
"focus",Qb(dd,a));K(h,"blur",Qb(Rb,a))}function Kf(a){var b=a.display;if(b.lastWrapHeight!=b.wrapper.clientHeight||b.lastWrapWidth!=b.wrapper.clientWidth)b.cachedCharWidth=b.cachedTextHeight=b.cachedPaddingH=null,b.scrollbarsClipped=!1,a.setSize()}function Wa(a,b){for(var c=b.target||b.srcElement;c!=a.wrapper;c=c.parentNode)if(!c||1==c.nodeType&&"true"==c.getAttribute("cm-ignore-events")||c.parentNode==a.sizer&&c!=a.mover)return!0}function ob(a,b,c,d){var e=a.display;if(!c&&"true"==(b.target||b.srcElement).getAttribute("cm-not-content"))return null;
var f,h;c=e.lineSpace.getBoundingClientRect();try{f=b.clientX-c.left,h=b.clientY-c.top}catch(g){return null}b=sd(a,f,h);var k;d&&1==b.xRel&&(k=J(a.doc,b.line).text).length==b.ch&&(d=Fa(k,k.length,a.options.tabSize)-k.length,b=E(b.line,Math.max(0,Math.round((f-ke(a.display).left)/Tb(a.display))-d)));return b}function If(a){var b=this.display;if(!(ga(this,a)||b.activeTouch&&b.input.supportsTouch()))if(b.shift=a.shiftKey,Wa(b,a))ha||(b.scroller.draggable=!1,setTimeout(function(){b.scroller.draggable=
!0},100));else if(!ud(this,a,"gutterClick",!0)){var c=ob(this,a);window.focus();switch(Ae(a)){case 1:this.state.selectingText?this.state.selectingText(a):c?Lf(this,a,c):(a.target||a.srcElement)==b.scroller&&na(a);break;case 2:ha&&(this.state.lastMiddleDown=+new Date);c&&xc(this.doc,c);setTimeout(function(){b.input.focus()},20);na(a);break;case 3:vd?se(this,a):Mf(this)}}}function Lf(a,b,c){U?setTimeout(Qb(ua,a),0):a.curOp.focus=Na();var d=+new Date,e;Jc&&Jc.time>d-400&&0==L(Jc.pos,c)?e="triple":Kc&&
Kc.time>d-400&&0==L(Kc.pos,c)?(e="double",Jc={time:d,pos:c}):(e="single",Kc={time:d,pos:c});var d=a.doc.sel,f=Ca?b.metaKey:b.ctrlKey,h;a.options.dragDrop&&Nf&&!a.isReadOnly()&&"single"==e&&-1<(h=d.contains(c))&&(0>L((h=d.ranges[h]).from(),c)||0<c.xRel)&&(0<L(h.to(),c)||0>c.xRel)?Of(a,b,c,f):Pf(a,b,c,e,f)}function Of(a,b,c,d){var e=a.display,f=+new Date,h=da(a,function(g){ha&&(e.scroller.draggable=!1);a.state.draggingText=!1;Ra(document,"mouseup",h);Ra(e.scroller,"drop",h);10>Math.abs(b.clientX-g.clientX)+
Math.abs(b.clientY-g.clientY)&&(na(g),!d&&+new Date-200<f&&xc(a.doc,c),ha||U&&9==aa?setTimeout(function(){document.body.focus();e.input.focus()},20):e.input.focus())});ha&&(e.scroller.draggable=!0);a.state.draggingText=h;h.copy=Ca?b.altKey:b.ctrlKey;e.scroller.dragDrop&&e.scroller.dragDrop();K(document,"mouseup",h);K(e.scroller,"drop",h)}function Pf(a,b,c,d,e){function f(b){if(0!=L(w,b))if(w=b,"rect"==d){for(var e=[],S=a.options.tabSize,h=Fa(J(l,c.line).text,c.ch,S),g=Fa(J(l,b.line).text,b.ch,S),
k=Math.min(h,g),h=Math.max(h,g),g=Math.min(c.line,b.line),m=Math.min(a.lastLine(),Math.max(c.line,b.line));g<=m;g++){var ja=J(l,g).text,t=Be(ja,k,S);k==h?e.push(new Y(E(g,t),E(g,t))):ja.length>t&&e.push(new Y(E(g,t),E(g,Be(ja,h,S))))}e.length||e.push(new Y(c,c));ia(l,Ea(n.ranges.slice(0,q).concat(e),q),{origin:"*mouse",scroll:!1});a.scrollIntoView(b)}else e=p,S=e.anchor,k=b,"single"!=d&&(b="double"==d?a.findWordAt(b):new Y(E(b.line,0),N(l,E(b.line+1,0))),0<L(b.anchor,S)?(k=b.head,S=Ya(e.from(),b.anchor)):
(k=b.anchor,S=eb(e.to(),b.head))),e=n.ranges.slice(0),e[q]=new Y(N(l,S),k),ia(l,Ea(e,q),wd)}function h(b){var c=++u,e=ob(a,b,!0,"rect"==d);if(e)if(0!=L(e,w)){a.curOp.focus=Na();f(e);var S=z(k,l);(e.line>=S.to||e.line<S.from)&&setTimeout(da(a,function(){u==c&&h(b)}),150)}else{var g=b.clientY<r.top?-20:b.clientY>r.bottom?20:0;g&&setTimeout(da(a,function(){u==c&&(k.scroller.scrollTop+=g,h(b))}),50)}}function g(b){a.state.selectingText=!1;u=Infinity;na(b);k.input.focus();Ra(document,"mousemove",C);Ra(document,
"mouseup",x);l.history.lastSelOrigin=null}var k=a.display,l=a.doc;na(b);var p,q,n=l.sel,m=n.ranges;e&&!b.shiftKey?(q=l.sel.contains(c),p=-1<q?m[q]:new Y(c,c)):(p=l.sel.primary(),q=l.sel.primIndex);if(Qf?b.shiftKey&&b.metaKey:b.altKey)d="rect",e||(p=new Y(c,c)),c=ob(a,b,!0,!0),q=-1;else if("double"==d){var t=a.findWordAt(c);p=a.display.shift||l.extend?ac(l,p,t.anchor,t.head):t}else"triple"==d?(t=new Y(E(c.line,0),N(l,E(c.line+1,0))),p=a.display.shift||l.extend?ac(l,p,t.anchor,t.head):t):p=ac(l,p,c);
e?-1==q?(q=m.length,ia(l,Ea(m.concat([p]),q),{scroll:!1,origin:"*mouse"})):1<m.length&&m[q].empty()&&"single"==d&&!b.shiftKey?(ia(l,Ea(m.slice(0,q).concat(m.slice(q+1)),0),{scroll:!1,origin:"*mouse"}),n=l.sel):kd(l,q,p,wd):(q=0,ia(l,new Sa([p],0),wd),n=l.sel);var w=c,r=k.wrapper.getBoundingClientRect(),u=0,C=da(a,function(a){Ae(a)?h(a):g(a)}),x=da(a,g);a.state.selectingText=x;K(document,"mousemove",C);K(document,"mouseup",x)}function ud(a,b,c,d){try{var e=b.clientX,f=b.clientY}catch(h){return!1}if(e>=
Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;d&&na(b);d=a.display;var g=d.lineDiv.getBoundingClientRect();if(f>g.bottom||!Aa(a,c))return xd(b);f-=g.top-d.viewOffset;for(g=0;g<a.options.gutters.length;++g){var k=d.gutters.childNodes[g];if(k&&k.getBoundingClientRect().right>=e)return e=jb(a.doc,f),fa(a,c,a,e,a.options.gutters[g],b),xd(b)}}function Jf(a){var b=this;we(b);if(!ga(b,a)&&!Wa(b.display,a)){na(a);U&&(ue=+new Date);var c=ob(b,a,!0),d=a.dataTransfer.files;if(c&&!b.isReadOnly())if(d&&
d.length&&window.FileReader&&window.File){var e=d.length,f=Array(e),h=0;a=function(a,d){if(!b.options.allowDropFileTypes||-1!=ka(b.options.allowDropFileTypes,a.type)){var qa=new FileReader;qa.onload=da(b,function(){var a=qa.result;/[\x00-\x08\x0e-\x1f]{2}/.test(a)&&(a="");f[d]=a;++h==e&&(c=N(b.doc,c),a={from:c,to:c,text:b.doc.splitLines(f.join(b.doc.lineSeparator())),origin:"paste"},zb(b.doc,a),be(b.doc,Oa(c,pb(a))))});qa.readAsText(a)}};for(var g=0;g<e;++g)a(d[g],g)}else if(b.state.draggingText&&
-1<b.doc.sel.contains(c))b.state.draggingText(a),setTimeout(function(){b.display.input.focus()},20);else try{if(f=a.dataTransfer.getData("Text")){if(b.state.draggingText&&!b.state.draggingText.copy)var k=b.listSelections();yc(b.doc,Oa(c,c));if(k)for(g=0;g<k.length;++g)Fb(b.doc,"",k[g].anchor,k[g].head,"drag");b.replaceSelection(f,"around","paste");b.display.input.focus()}}catch(l){}}}function we(a){a.display.dragCursor&&(a.display.lineSpace.removeChild(a.display.dragCursor),a.display.dragCursor=null)}
function Wb(a,b){2>Math.abs(a.doc.scrollTop-b)||(a.doc.scrollTop=b,Za||O(a,{top:b}),a.display.scroller.scrollTop!=b&&(a.display.scroller.scrollTop=b),a.display.scrollbars.setScrollTop(b),Za&&O(a),Sb(a,100))}function yb(a,b,c){(c?b==a.doc.scrollLeft:2>Math.abs(a.doc.scrollLeft-b))||(b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth),a.doc.scrollLeft=b,w(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbars.setScrollLeft(b))}function te(a,
b){var c=Ce(b),d=c.x,c=c.y,e=a.display,f=e.scroller,h=f.scrollWidth>f.clientWidth,g=f.scrollHeight>f.clientHeight;if(d&&h||c&&g){if(c&&Ca&&ha){var h=b.target,k=e.view;a:for(;h!=f;h=h.parentNode)for(var l=0;l<k.length;l++)if(k[l].node==h){a.display.currentWheelTarget=h;break a}}!d||Za||Ga||null==xa?(c&&null!=xa&&(g=c*xa,h=a.doc.scrollTop,k=h+e.wrapper.clientHeight,0>g?h=Math.max(0,h+g-50):k=Math.min(a.doc.height,k+g+50),O(a,{top:h,bottom:k})),20>Lc&&(null==e.wheelStartX?(e.wheelStartX=f.scrollLeft,
e.wheelStartY=f.scrollTop,e.wheelDX=d,e.wheelDY=c,setTimeout(function(){if(null!=e.wheelStartX){var a=f.scrollLeft-e.wheelStartX,b=f.scrollTop-e.wheelStartY,a=b&&e.wheelDY&&b/e.wheelDY||a&&e.wheelDX&&a/e.wheelDX;e.wheelStartX=e.wheelStartY=null;a&&(xa=(xa*Lc+a)/(Lc+1),++Lc)}},200)):(e.wheelDX+=d,e.wheelDY+=c))):(c&&g&&Wb(a,Math.max(0,Math.min(f.scrollTop+c*xa,f.scrollHeight-f.clientHeight))),yb(a,Math.max(0,Math.min(f.scrollLeft+d*xa,f.scrollWidth-f.clientWidth))),(!c||c&&g)&&na(b),e.wheelStartX=
null)}}function Mc(a,b,c){if("string"==typeof b&&(b=Nc[b],!b))return!1;a.display.input.ensurePolled();var d=a.display.shift,e=!1;try{a.isReadOnly()&&(a.state.suppressEdits=!0),c&&(a.display.shift=!1),e=b(a)!=De}finally{a.display.shift=d,a.state.suppressEdits=!1}return e}function Rf(a,b,c){for(var d=0;d<a.state.keyMaps.length;d++){var e=fc(b,a.state.keyMaps[d],c,a);if(e)return e}return a.options.extraKeys&&fc(b,a.options.extraKeys,c,a)||fc(b,a.options.keyMap,c,a)}function Oc(a,b,c,d){var e=a.state.keySeq;
if(e){if(Sf(b))return"handled";Tf.set(50,function(){a.state.keySeq==e&&(a.state.keySeq=null,a.display.input.reset())});b=e+" "+b}d=Rf(a,b,d);"multi"==d&&(a.state.keySeq=b);"handled"==d&&sa(a,"keyHandled",a,b,c);if("handled"==d||"multi"==d)na(c),md(a);return e&&!d&&/\'$/.test(b)?(na(c),!0):!!d}function Ee(a,b){var c=Uf(b,!0);return c?b.shiftKey&&!a.state.keySeq?Oc(a,"Shift-"+c,b,function(b){return Mc(a,b,!0)})||Oc(a,c,b,function(b){if("string"==typeof b?/^go[A-Z]/.test(b):b.motion)return Mc(a,b)}):
Oc(a,c,b,function(b){return Mc(a,b)}):!1}function Vf(a,b,c){return Oc(a,"'"+c+"'",b,function(b){return Mc(a,b,!0)})}function ye(a){this.curOp.focus=Na();if(!ga(this,a)){U&&11>aa&&27==a.keyCode&&(a.returnValue=!1);var b=a.keyCode;this.display.shift=16==b||a.shiftKey;var c=Ee(this,a);Ga&&(yd=c?b:null,!c&&88==b&&!Fe&&(Ca?a.metaKey:a.ctrlKey)&&this.replaceSelection("",null,"cut"));18!=b||/\bCodeMirror-crosshair\b/.test(this.display.lineDiv.className)||Wf(this)}}function Wf(a){function b(a){18!=a.keyCode&&
a.altKey||(Vb(c,"CodeMirror-crosshair"),Ra(document,"keyup",b),Ra(document,"mouseover",b))}var c=a.display.lineDiv;Xb(c,"CodeMirror-crosshair");K(document,"keyup",b);K(document,"mouseover",b)}function xe(a){16==a.keyCode&&(this.doc.sel.shift=!1);ga(this,a)}function ze(a){if(!(Wa(this.display,a)||ga(this,a)||a.ctrlKey&&!a.altKey||Ca&&a.metaKey)){var b=a.keyCode,c=a.charCode;if(Ga&&b==yd)yd=null,na(a);else if(!Ga||a.which&&!(10>a.which)||!Ee(this,a))if(b=String.fromCharCode(null==c?b:c),!Vf(this,a,
b))this.display.input.onKeyPress(a)}}function Mf(a){a.state.delayingBlurEvent=!0;setTimeout(function(){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1,Rb(a))},100)}function dd(a){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1);"nocursor"!=a.options.readOnly&&(a.state.focused||(fa(a,"focus",a),a.state.focused=!0,Xb(a.display.wrapper,"CodeMirror-focused"),a.curOp||a.display.selForContextMenu==a.doc.sel||(a.display.input.reset(),ha&&setTimeout(function(){a.display.input.reset(!0)},
20)),a.display.input.receivedFocus()),md(a))}function Rb(a){a.state.delayingBlurEvent||(a.state.focused&&(fa(a,"blur",a),a.state.focused=!1,Vb(a.display.wrapper,"CodeMirror-focused")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||(a.display.shift=!1)},150))}function se(a,b){var c;(c=Wa(a.display,b))||(c=Aa(a,"gutterContextMenu")?ud(a,b,"gutterContextMenu",!1):!1);if(!c&&!ga(a,b,"contextmenu"))a.display.input.onContextMenu(b)}function Ge(a,b){if(0>L(a,b.from))return a;if(0>=
L(a,b.to))return pb(b);var c=a.line+b.text.length-(b.to.line-b.from.line)-1,d=a.ch;a.line==b.to.line&&(d+=pb(b).ch-b.to.ch);return E(c,d)}function zd(a,b){for(var c=[],d=0;d<a.sel.ranges.length;d++){var e=a.sel.ranges[d];c.push(new Y(Ge(e.anchor,b),Ge(e.head,b)))}return Ea(c,a.sel.primIndex)}function He(a,b,c){return a.line==b.line?E(c.line,a.ch-b.ch+c.ch):E(c.line+(a.line-b.line),a.ch)}function Ie(a,b,c){b={canceled:!1,from:b.from,to:b.to,text:b.text,origin:b.origin,cancel:function(){this.canceled=
!0}};c&&(b.update=function(b,c,d,e){b&&(this.from=N(a,b));c&&(this.to=N(a,c));d&&(this.text=d);void 0!==e&&(this.origin=e)});fa(a,"beforeChange",a,b);a.cm&&fa(a.cm,"beforeChange",a.cm,b);return b.canceled?null:{from:b.from,to:b.to,text:b.text,origin:b.origin}}function zb(a,b,c){if(a.cm){if(!a.cm.curOp)return da(a.cm,zb)(a,b,c);if(a.cm.state.suppressEdits)return}if(Aa(a,"beforeChange")||a.cm&&Aa(a.cm,"beforeChange"))if(b=Ie(a,b,!0),!b)return;if(c=Je&&!c&&Xf(a,b.from,b.to))for(var d=c.length-1;0<=d;--d)Ke(a,
{from:c[d].from,to:c[d].to,text:d?[""]:b.text});else Ke(a,b)}function Ke(a,b){if(1!=b.text.length||""!=b.text[0]||0!=L(b.from,b.to)){var c=zd(a,b);Le(a,b,c,a.cm?a.cm.curOp.id:NaN);gc(a,b,c,Ad(a,b));var d=[];qb(a,function(a,c){c||-1!=ka(d,a.history)||(Me(a.history,b),d.push(a.history));gc(a,b,null,Ad(a,b))})}}function Pc(a,b,c){if(!a.cm||!a.cm.state.suppressEdits||c){for(var d=a.history,e,f=a.sel,h="undo"==b?d.done:d.undone,g="undo"==b?d.undone:d.done,k=0;k<h.length&&(e=h[k],c?!e.ranges||e.equals(a.sel):
e.ranges);k++);if(k!=h.length){for(d.lastOrigin=d.lastSelOrigin=null;;)if(e=h.pop(),e.ranges){zc(e,g);if(c&&!e.equals(a.sel)){ia(a,e,{clearRedo:!1});return}f=e}else break;c=[];zc(f,g);g.push({changes:c,generation:d.generation});d.generation=e.generation||++d.maxGeneration;d=Aa(a,"beforeChange")||a.cm&&Aa(a.cm,"beforeChange");for(k=e.changes.length-1;0<=k;--k){var l=e.changes[k];l.origin=b;if(d&&!Ie(a,l,!1)){h.length=0;break}c.push(Bd(a,l));f=k?zd(a,l):W(h);gc(a,l,f,Ne(a,l));!k&&a.cm&&a.cm.scrollIntoView({from:l.from,
to:pb(l)});var p=[];qb(a,function(a,b){b||-1!=ka(p,a.history)||(Me(a.history,l),p.push(a.history));gc(a,l,null,Ne(a,l))})}}}}function Oe(a,b){if(0!=b&&(a.first+=b,a.sel=new Sa(vc(a.sel.ranges,function(a){return new Y(E(a.anchor.line+b,a.anchor.ch),E(a.head.line+b,a.head.ch))}),a.sel.primIndex),a.cm)){oa(a.cm,a.first,a.first-b,b);for(var c=a.cm.display,d=c.viewFrom;d<c.viewTo;d++)Va(a.cm,d,"gutter")}}function gc(a,b,c,d){if(a.cm&&!a.cm.curOp)return da(a.cm,gc)(a,b,c,d);if(b.to.line<a.first)Oe(a,b.text.length-
1-(b.to.line-b.from.line));else if(!(b.from.line>a.lastLine())){if(b.from.line<a.first){var e=b.text.length-1-(a.first-b.from.line);Oe(a,e);b={from:E(a.first,0),to:E(b.to.line+e,b.to.ch),text:[W(b.text)],origin:b.origin}}e=a.lastLine();b.to.line>e&&(b={from:b.from,to:E(e,J(a,e).text.length),text:[b.text[0]],origin:b.origin});b.removed=mb(a,b.from,b.to);c||(c=zd(a,b));a.cm?Yf(a.cm,b,d):Cd(a,b,d);yc(a,c,Pa)}}function Yf(a,b,c){var d=a.doc,h=a.display,g=b.from,k=b.to,l=!1,p=g.line;a.options.lineWrapping||
(p=X(Qa(J(d,g.line))),d.iter(p,k.line+1,function(a){if(a==h.maxLine)return l=!0}));-1<d.sel.contains(b.from,b.to)&&fe(a);Cd(d,b,c,e(a));a.options.lineWrapping||(d.iter(p,g.line+b.text.length,function(a){var b=f(a);b>h.maxLineLength&&(h.maxLine=a,h.maxLineLength=b,h.maxLineChanged=!0,l=!1)}),l&&(a.curOp.updateMaxLine=!0));d.frontier=Math.min(d.frontier,g.line);Sb(a,400);c=b.text.length-(k.line-g.line)-1;b.full?oa(a):g.line!=k.line||1!=b.text.length||Pe(a.doc,b)?oa(a,g.line,k.line+1,c):Va(a,g.line,
"text");c=Aa(a,"changes");if((d=Aa(a,"change"))||c)b={from:g,to:k,text:b.text,removed:b.removed,origin:b.origin},d&&sa(a,"change",a,b),c&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(b);a.display.selForContextMenu=null}function Fb(a,b,c,d,e){d||(d=c);if(0>L(d,c)){var f=d;d=c;c=f}"string"==typeof b&&(b=a.splitLines(b));zb(a,{from:c,to:d,text:b,origin:e})}function Gc(a,b,c,d,e){var f=a.display,h=gb(a.display);0>c&&(c=0);var g=a.curOp&&null!=a.curOp.scrollTop?a.curOp.scrollTop:f.scroller.scrollTop,
k=hd(a),l={};e-c>k&&(e=c+k);var p=a.doc.height+fd(f),q=c<h,h=e>p-h;c<g?l.scrollTop=q?0:c:e>g+k&&(c=Math.min(c,(h?p:e)-k),c!=g&&(l.scrollTop=c));g=a.curOp&&null!=a.curOp.scrollLeft?a.curOp.scrollLeft:f.scroller.scrollLeft;a=kb(a)-(a.options.fixedGutter?f.gutters.offsetWidth:0);(f=d-b>a)&&(d=b+a);10>b?l.scrollLeft=0:b<g?l.scrollLeft=Math.max(0,b-(f?0:10)):d>a+g-3&&(l.scrollLeft=d+(f?0:10)-a);return l}function Qc(a,b,c){null==b&&null==c||Rc(a);null!=b&&(a.curOp.scrollLeft=(null==a.curOp.scrollLeft?a.doc.scrollLeft:
a.curOp.scrollLeft)+b);null!=c&&(a.curOp.scrollTop=(null==a.curOp.scrollTop?a.doc.scrollTop:a.curOp.scrollTop)+c)}function Ab(a){Rc(a);var b=a.getCursor(),c=b,d=b;a.options.lineWrapping||(c=b.ch?E(b.line,b.ch-1):b,d=E(b.line,b.ch+1));a.curOp.scrollToPos={from:c,to:d,margin:a.options.cursorScrollMargin,isCursor:!0}}function Rc(a){var b=a.curOp.scrollToPos;if(b){a.curOp.scrollToPos=null;var c=re(a,b.from),d=re(a,b.to),b=Gc(a,Math.min(c.left,d.left),Math.min(c.top,d.top)-b.margin,Math.max(c.right,d.right),
Math.max(c.bottom,d.bottom)+b.margin);a.scrollTo(b.scrollLeft,b.scrollTop)}}function Zb(a,b,c,d){var e=a.doc,f;null==c&&(c="add");"smart"==c&&(e.mode.indent?f=bc(a,b):c="prev");var h=a.options.tabSize,g=J(e,b),k=Fa(g.text,null,h);g.stateAfter&&(g.stateAfter=null);var l=g.text.match(/^\s*/)[0],p;if(!d&&!/\S/.test(g.text))p=0,c="not";else if("smart"==c&&(p=e.mode.indent(f,g.text.slice(l.length),g.text),p==De||150<p)){if(!d)return;c="prev"}"prev"==c?p=b>e.first?Fa(J(e,b-1).text,null,h):0:"add"==c?p=
k+a.options.indentUnit:"subtract"==c?p=k-a.options.indentUnit:"number"==typeof c&&(p=k+c);p=Math.max(0,p);c="";d=0;if(a.options.indentWithTabs)for(a=Math.floor(p/h);a;--a)d+=h,c+="\t";d<p&&(c+=Dd(p-d));if(c!=l)return Fb(e,c,E(b,0),E(b,l.length),"+input"),g.stateAfter=null,!0;for(a=0;a<e.sel.ranges.length;a++)if(h=e.sel.ranges[a],h.head.line==b&&h.head.ch<l.length){d=E(b,l.length);kd(e,a,new Y(d,d));break}}function Sc(a,b,c,d){var e=b,f=b;"number"==typeof b?f=J(a,Math.max(a.first,Math.min(b,a.first+
a.size-1))):e=X(b);if(null==e)return null;d(f,e)&&a.cm&&Va(a.cm,e,c);return f}function Gb(a,b){for(var c=a.doc.sel.ranges,d=[],e=0;e<c.length;e++){for(var f=b(c[e]);d.length&&0>=L(f.from,W(d).to);){var h=d.pop();if(0>L(h.from,f.from)){f.from=h.from;break}}d.push(f)}va(a,function(){for(var b=d.length-1;0<=b;b--)Fb(a.doc,"",d[b].from,d[b].to,"+delete");Ab(a)})}function Ed(a,b,c,d,e){function f(b){var d=(e?td:Qe)(l,g,c,!0);if(null==d){if(b=!b)b=h+c,b<a.first||b>=a.first+a.size?b=!1:(h=b,b=l=J(a,b));
if(b)g=e?(0>c?Fc:Ec)(l):0>c?l.text.length:0;else return!1}else g=d;return!0}var h=b.line,g=b.ch,k=c,l=J(a,h);if("char"==d)f();else if("column"==d)f(!0);else if("word"==d||"group"==d){var p=null;d="group"==d;for(var q=a.cm&&a.cm.getHelper(b,"wordChars"),n=!0;!(0>c)||f(!n);n=!1){var m=l.text.charAt(g)||"\n",m=Tc(m,q)?"w":d&&"\n"==m?"n":!d||/\s/.test(m)?null:"p";!d||n||m||(m="s");if(p&&p!=m){0>c&&(c=1,f());break}m&&(p=m);if(0<c&&!f(!n))break}}k=ld(a,E(h,g),b,k,!0);L(b,k)||(k.hitSide=!0);return k}function Re(a,
b,c,d){var e=a.doc,f=b.left,h;for("page"==d?h=b.top+c*(Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight)-(0>c?1.5:.5)*gb(a.display)):"line"==d&&(h=0<c?b.bottom+3:b.top-3);;){b=sd(a,f,h);if(!b.outside)break;if(0>c?0>=h:h>=e.height){b.hitSide=!0;break}h+=5*c}return b}function M(a,b,d,e){c.defaults[a]=b;d&&(wb[a]=e?function(a,b,c){c!=Td&&d(a,b,c)}:d)}function Zf(a){var b=a.split(/-(?!$)/);a=b[b.length-1];for(var c,d,e,f,h=0;h<b.length-1;h++){var g=b[h];
if(/^(cmd|meta|m)$/i.test(g))f=!0;else if(/^a(lt)?$/i.test(g))c=!0;else if(/^(c|ctrl|control)$/i.test(g))d=!0;else if(/^s(hift)$/i.test(g))e=!0;else throw Error("Unrecognized modifier name: "+g);}c&&(a="Alt-"+a);d&&(a="Ctrl-"+a);f&&(a="Cmd-"+a);e&&(a="Shift-"+a);return a}function Uc(a){return"string"==typeof a?db[a]:a}function Hb(a,b,c,d,e){if(d&&d.shared)return $f(a,b,c,d,e);if(a.cm&&!a.cm.curOp)return da(a.cm,Hb)(a,b,c,d,e);var f=new rb(a,e);e=L(b,c);d&&Ba(d,f,!1);if(0<e||0==e&&!1!==f.clearWhenEmpty)return f;
f.replacedWith&&(f.collapsed=!0,f.widgetNode=H("span",[f.replacedWith],"CodeMirror-widget"),d.handleMouseEvents||f.widgetNode.setAttribute("cm-ignore-events","true"),d.insertLeft&&(f.widgetNode.insertLeft=!0));if(f.collapsed){if(Se(a,b.line,b,c,f)||b.line!=c.line&&Se(a,c.line,b,c,f))throw Error("Inserting collapsed marker partially overlapping an existing one");bb=!0}f.addToHistory&&Le(a,{from:b,to:c,origin:"markText"},a.sel,NaN);var h=b.line,g=a.cm,k;a.iter(h,c.line+1,function(a){g&&f.collapsed&&
!g.options.lineWrapping&&Qa(a)==g.display.maxLine&&(k=!0);f.collapsed&&h!=b.line&&Ka(a,0);var d=new Vc(f,h==b.line?b.ch:null,h==c.line?c.ch:null);a.markedSpans=a.markedSpans?a.markedSpans.concat([d]):[d];d.marker.attachLine(a);++h});f.collapsed&&a.iter(b.line,c.line+1,function(b){hb(a,b)&&Ka(b,0)});f.clearOnEnter&&K(f,"beforeCursorEnter",function(){f.clear()});f.readOnly&&(Je=!0,(a.history.done.length||a.history.undone.length)&&a.clearHistory());f.collapsed&&(f.id=++Fd,f.atomic=!0);if(g){k&&(g.curOp.updateMaxLine=
!0);if(f.collapsed)oa(g,b.line,c.line+1);else if(f.className||f.title||f.startStyle||f.endStyle||f.css)for(d=b.line;d<=c.line;d++)Va(g,d,"text");f.atomic&&ge(g.doc);sa(g,"markerAdded",g,f)}return f}function $f(a,b,c,d,e){d=Ba(d);d.shared=!1;var f=[Hb(a,b,c,d,e)],h=f[0],g=d.widgetNode;qb(a,function(a){g&&(d.widgetNode=g.cloneNode(!0));f.push(Hb(a,N(a,b),N(a,c),d,e));for(var qa=0;qa<a.linked.length;++qa)if(a.linked[qa].isParent)return;h=W(f)});return new Wc(f,h)}function Te(a){return a.findMarks(E(a.first,
0),a.clipPos(E(a.lastLine())),function(a){return a.parent})}function ag(a){for(var b=0;b<a.length;b++){var c=a[b],d=[c.primary.doc];qb(c.primary.doc,function(a){d.push(a)});for(var e=0;e<c.markers.length;e++){var f=c.markers[e];-1==ka(d,f.doc)&&(f.parent=null,c.markers.splice(e--,1))}}}function Vc(a,b,c){this.marker=a;this.from=b;this.to=c}function hc(a,b){if(a)for(var c=0;c<a.length;++c){var d=a[c];if(d.marker==b)return d}}function Ad(a,b){if(b.full)return null;var c=$b(a,b.from.line)&&J(a,b.from.line).markedSpans,
d=$b(a,b.to.line)&&J(a,b.to.line).markedSpans;if(!c&&!d)return null;var e=b.from.ch,f=b.to.ch,h=0==L(b.from,b.to);if(c)for(var g=0,k;g<c.length;++g){var l=c[g],p=l.marker;if(null==l.from||(p.inclusiveLeft?l.from<=e:l.from<e)||!(l.from!=e||"bookmark"!=p.type||h&&l.marker.insertLeft)){var q=null==l.to||(p.inclusiveRight?l.to>=e:l.to>e);(k||(k=[])).push(new Vc(p,l.from,q?null:l.to))}}c=k;if(d)for(var g=0,n;g<d.length;++g)if(k=d[g],l=k.marker,null==k.to||(l.inclusiveRight?k.to>=f:k.to>f)||k.from==f&&
"bookmark"==l.type&&(!h||k.marker.insertLeft))p=null==k.from||(l.inclusiveLeft?k.from<=f:k.from<f),(n||(n=[])).push(new Vc(l,p?null:k.from-f,null==k.to?null:k.to-f));d=n;h=1==b.text.length;n=W(b.text).length+(h?e:0);if(c)for(f=0;f<c.length;++f)if(g=c[f],null==g.to)(k=hc(d,g.marker),k)?h&&(g.to=null==k.to?null:k.to+n):g.to=e;if(d)for(f=0;f<d.length;++f)g=d[f],null!=g.to&&(g.to+=n),null==g.from?(k=hc(c,g.marker),k||(g.from=n,h&&(c||(c=[])).push(g))):(g.from+=n,h&&(c||(c=[])).push(g));c&&(c=Ue(c));d&&
d!=c&&(d=Ue(d));e=[c];if(!h){var h=b.text.length-2,m;if(0<h&&c)for(f=0;f<c.length;++f)null==c[f].to&&(m||(m=[])).push(new Vc(c[f].marker,null,null));for(f=0;f<h;++f)e.push(m);e.push(d)}return e}function Ue(a){for(var b=0;b<a.length;++b){var c=a[b];null!=c.from&&c.from==c.to&&!1!==c.marker.clearWhenEmpty&&a.splice(b--,1)}return a.length?a:null}function Ne(a,b){var c;if(c=b["spans_"+a.id]){for(var d=0,e=[];d<b.text.length;++d)e.push(bg(c[d]));c=e}else c=null;d=Ad(a,b);if(!c)return d;if(!d)return c;
for(e=0;e<c.length;++e){var f=c[e],h=d[e];if(f&&h){var g=0;a:for(;g<h.length;++g){for(var k=h[g],l=0;l<f.length;++l)if(f[l].marker==k.marker)continue a;f.push(k)}}else h&&(c[e]=h)}return c}function Xf(a,b,c){var d=null;a.iter(b.line,c.line+1,function(a){if(a.markedSpans)for(var b=0;b<a.markedSpans.length;++b){var c=a.markedSpans[b].marker;!c.readOnly||d&&-1!=ka(d,c)||(d||(d=[])).push(c)}});if(!d)return null;a=[{from:b,to:c}];for(b=0;b<d.length;++b){c=d[b];for(var e=c.find(0),f=0;f<a.length;++f){var h=
a[f];if(!(0>L(h.to,e.from)||0<L(h.from,e.to))){var g=[f,1],k=L(h.from,e.from),l=L(h.to,e.to);(0>k||!c.inclusiveLeft&&!k)&&g.push({from:h.from,to:e.from});(0<l||!c.inclusiveRight&&!l)&&g.push({from:e.to,to:h.to});a.splice.apply(a,g);f+=g.length-1}}}return a}function Ve(a){var b=a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function We(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);a.markedSpans=b}}function Xe(a,b){var c=a.lines.length-
b.lines.length;if(0!=c)return c;var c=a.find(),d=b.find(),e=L(c.from,d.from)||(a.inclusiveLeft?-1:0)-(b.inclusiveLeft?-1:0);return e?-e:(c=L(c.to,d.to)||(a.inclusiveRight?1:0)-(b.inclusiveRight?1:0))?c:b.id-a.id}function ib(a,b){var c=bb&&a.markedSpans,d;if(c)for(var e,f=0;f<c.length;++f)e=c[f],e.marker.collapsed&&null==(b?e.from:e.to)&&(!d||0>Xe(d,e.marker))&&(d=e.marker);return d}function Se(a,b,c,d,e){a=J(a,b);if(a=bb&&a.markedSpans)for(b=0;b<a.length;++b){var f=a[b];if(f.marker.collapsed){var h=
f.marker.find(0),g=L(h.from,c)||(f.marker.inclusiveLeft?-1:0)-(e.inclusiveLeft?-1:0),k=L(h.to,d)||(f.marker.inclusiveRight?1:0)-(e.inclusiveRight?1:0);if(!(0<=g&&0>=k||0>=g&&0<=k)&&(0>=g&&(f.marker.inclusiveRight&&e.inclusiveLeft?0<=L(h.to,c):0<L(h.to,c))||0<=g&&(f.marker.inclusiveRight&&e.inclusiveLeft?0>=L(h.from,d):0>L(h.from,d))))return!0}}}function Qa(a){for(var b;b=ib(a,!0);)a=b.find(-1,!0).line;return a}function gd(a,b){var c=J(a,b),d=Qa(c);return c==d?b:X(d)}function Wd(a,b){if(b>a.lastLine())return b;
var c=J(a,b),d;if(!hb(a,c))return b;for(;d=ib(c,!1);)c=d.find(1,!0).line;return X(c)+1}function hb(a,b){var c=bb&&b.markedSpans;if(c)for(var d,e=0;e<c.length;++e)if(d=c[e],d.marker.collapsed&&(null==d.from||!d.marker.widgetNode&&0==d.from&&d.marker.inclusiveLeft&&Gd(a,b,d)))return!0}function Gd(a,b,c){if(null==c.to)return b=c.marker.find(1,!0),Gd(a,b.line,hc(b.line.markedSpans,c.marker));if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var d,e=0;e<b.markedSpans.length;++e)if(d=b.markedSpans[e],
d.marker.collapsed&&!d.marker.widgetNode&&d.from==c.to&&(null==d.to||d.to!=c.from)&&(d.marker.inclusiveLeft||c.marker.inclusiveRight)&&Gd(a,b,d))return!0}function dc(a){if(null!=a.height)return a.height;var b=a.doc.cm;if(!b)return 0;if(!jd(document.body,a.node)){var c="position: relative;";a.coverGutter&&(c+="margin-left: -"+b.display.gutters.offsetWidth+"px;");a.noHScroll&&(c+="width: "+b.display.wrapper.clientWidth+"px;");wa(b.display.measure,H("div",[a.node],null,c))}return a.height=a.node.parentNode.offsetHeight}
function cg(a,b,c,d){var e=new Xc(a,c,d),f=a.cm;f&&e.noHScroll&&(f.display.alignWidgets=!0);Sc(a,b,"widget",function(b){var c=b.widgets||(b.widgets=[]);null==e.insertAt?c.push(e):c.splice(Math.min(c.length-1,Math.max(0,e.insertAt)),0,e);e.line=b;f&&!hb(a,b)&&(c=Ma(b)<a.scrollTop,Ka(b,b.height+dc(e)),c&&Qc(f,null,e.height),f.curOp.forceUpdate=!0);return!0});return e}function Ye(a,b){if(a)for(;;){var c=a.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!c)break;a=a.slice(0,c.index)+a.slice(c.index+c[0].length);
var d=c[1]?"bgClass":"textClass";null==b[d]?b[d]=c[2]:(new RegExp("(?:^|s)"+c[2]+"(?:$|s)")).test(b[d])||(b[d]+=" "+c[2])}return a}function Ze(a,b){if(a.blankLine)return a.blankLine(b);if(a.innerMode){var d=c.innerMode(a,b);if(d.mode.blankLine)return d.mode.blankLine(d.state)}}function Hd(a,b,d,e){for(var f=0;10>f;f++){e&&(e[0]=c.innerMode(a,d).mode);var h=a.token(b,d);if(b.pos>b.start)return h}throw Error("Mode "+a.name+" failed to advance stream.");}function $e(a,b,c,d){function e(a){return{start:p.start,
end:p.pos,string:p.current(),type:g||null,state:a?cb(f.mode,l):l}}var f=a.doc,h=f.mode,g;b=N(f,b);var k=J(f,b.line),l=bc(a,b.line,c),p=new Yc(k.text,a.options.tabSize),q;for(d&&(q=[]);(d||p.pos<b.ch)&&!p.eol();)p.start=p.pos,g=Hd(h,p,l),d&&q.push(e(!0));return d?q:e()}function af(a,b,c,d,e,f,h){var g=c.flattenSpans;null==g&&(g=a.options.flattenSpans);var k=0,l=null,p=new Yc(b,a.options.tabSize),q,n=a.options.addModeClass&&[null];for(""==b&&Ye(Ze(c,d),f);!p.eol();){p.pos>a.options.maxHighlightLength?
(g=!1,h&&nd(a,b,d,p.pos),p.pos=b.length,q=null):q=Ye(Hd(c,p,d,n),f);if(n){var m=n[0].name;m&&(q="m-"+(q?m+" "+q:m))}if(!g||l!=q){for(;k<p.start;)k=Math.min(p.start,k+5E4),e(k,l);l=q}p.start=p.pos}for(;k<p.pos;)a=Math.min(p.pos,k+5E4),e(a,l),k=a}function le(a,b,c,d){var e=[a.state.modeGen],f={};af(a,b.text,a.doc.mode,c,function(a,b){e.push(a,b)},f,d);for(c=0;c<a.state.overlays.length;++c){var h=a.state.overlays[c],g=1,k=0;af(a,b.text,h.mode,!0,function(a,b){for(var c=g;k<a;){var d=e[g];d>a&&e.splice(g,
1,a,e[g+1],d);g+=2;k=Math.min(a,d)}if(b)if(h.opaque)e.splice(c,g-c,a,"cm-overlay "+b),g=c+2;else for(;c<g;c+=2)d=e[c+1],e[c+1]=(d?d+" ":"")+"cm-overlay "+b},f)}return{styles:e,classes:f.bgClass||f.textClass?f:null}}function bf(a,b,c){if(!b.styles||b.styles[0]!=a.state.modeGen){var d=bc(a,X(b)),e=le(a,b,b.text.length>a.options.maxHighlightLength?cb(a.doc.mode,d):d);b.stateAfter=d;b.styles=e.styles;e.classes?b.styleClasses=e.classes:b.styleClasses&&(b.styleClasses=null);c===a.doc.frontier&&a.doc.frontier++}return b.styles}
function nd(a,b,c,d){var e=a.doc.mode;a=new Yc(b,a.options.tabSize);a.start=a.pos=d||0;for(""==b&&Ze(e,c);!a.eol();)Hd(e,a,c),a.start=a.pos}function cf(a,b){if(!a||/^\s*$/.test(a))return null;var c=b.addModeClass?dg:eg;return c[a]||(c[a]=a.replace(/\S+/g,"cm-$&"))}function Xd(a,b){var c=H("span",null,null,ha?"padding-right: .1px":null),c={pre:H("pre",[c],"CodeMirror-line"),content:c,col:0,pos:0,cm:a,trailingSpace:!1,splitSpaces:(U||ha)&&a.getOption("lineWrapping")};b.measure={};for(var d=0;d<=(b.rest?
b.rest.length:0);d++){var e=d?b.rest[d-1]:b.line,f;c.pos=0;c.addToken=fg;var h;h=a.display.measure;if(null!=Id)h=Id;else{var g=wa(h,document.createTextNode("A\u062eA")),k=Db(g,0,1).getBoundingClientRect(),g=Db(g,1,2).getBoundingClientRect();$a(h);h=k&&k.left!=k.right?Id=3>g.right-k.right:!1}h&&(f=Da(e))&&(c.addToken=gg(c.addToken,f));c.map=[];k=b!=a.display.externalMeasured&&X(e);a:{h=c;var k=bf(a,e,k),g=e.markedSpans,l=e.text,p=0;if(g)for(var q=l.length,n=0,m=1,t="",w=void 0,r=void 0,u=0,C=void 0,
z=void 0,x=void 0,y=void 0,D=void 0;;){if(u==n){for(var C=z=x=y=r="",D=null,u=Infinity,A=[],B,G=0;G<g.length;++G){var F=g[G],v=F.marker;"bookmark"==v.type&&F.from==n&&v.widgetNode?A.push(v):F.from<=n&&(null==F.to||F.to>n||v.collapsed&&F.to==n&&F.from==n)?(null!=F.to&&F.to!=n&&u>F.to&&(u=F.to,z=""),v.className&&(C+=" "+v.className),v.css&&(r=(r?r+";":"")+v.css),v.startStyle&&F.from==n&&(x+=" "+v.startStyle),v.endStyle&&F.to==u&&(B||(B=[])).push(v.endStyle,F.to),v.title&&!y&&(y=v.title),v.collapsed&&
(!D||0>Xe(D.marker,v))&&(D=F)):F.from>n&&u>F.from&&(u=F.from)}if(B)for(G=0;G<B.length;G+=2)B[G+1]==u&&(z+=" "+B[G]);if(!D||D.from==n)for(G=0;G<A.length;++G)df(h,0,A[G]);if(D&&(D.from||0)==n){df(h,(null==D.to?q+1:D.to)-n,D.marker,null==D.from);if(null==D.to)break a;D.to==n&&(D=!1)}}if(n>=q)break;for(A=Math.min(q,u);;){if(t){G=n+t.length;D||(F=G>A?t.slice(0,A-n):t,h.addToken(h,F,w?w+C:C,x,n+F.length==u?z:"",y,r));if(G>=A){t=t.slice(A-n);n=A;break}n=G;x=""}t=l.slice(p,p=k[m++]);w=cf(k[m++],h.cm.options)}}else for(var m=
1;m<k.length;m+=2)h.addToken(h,l.slice(p,p=k[m]),cf(k[m+1],h.cm.options))}e.styleClasses&&(e.styleClasses.bgClass&&(c.bgClass=Jd(e.styleClasses.bgClass,c.bgClass||"")),e.styleClasses.textClass&&(c.textClass=Jd(e.styleClasses.textClass,c.textClass||"")));0==c.map.length&&c.map.push(0,0,c.content.appendChild(hg(a.display.measure)));0==d?(b.measure.map=c.map,b.measure.cache={}):((b.measure.maps||(b.measure.maps=[])).push(c.map),(b.measure.caches||(b.measure.caches=[])).push({}))}ha&&(f=c.content.lastChild,
/\bcm-tab\b/.test(f.className)||f.querySelector&&f.querySelector(".cm-tab"))&&(c.content.className="cm-tab-wrap-hack");fa(a,"renderLine",a,b.line,c.pre);c.pre.className&&(c.textClass=Jd(c.pre.className,c.textClass||""));return c}function fg(a,b,c,d,e,f,h){if(b){var g;if(a.splitSpaces)if(g=a.trailingSpace,1<b.length&&!/  /.test(b))g=b;else{for(var k="",l=0;l<b.length;l++){var p=b.charAt(l);" "!=p||!g||l!=b.length-1&&32!=b.charCodeAt(l+1)||(p="\u00a0");k+=p;g=" "==p}g=k}else g=b;k=g;l=a.cm.state.specialChars;
p=!1;if(l.test(b)){g=document.createDocumentFragment();for(var q=0;;){l.lastIndex=q;var n=l.exec(b),m=n?n.index-q:b.length-q;if(m){var t=document.createTextNode(k.slice(q,q+m));U&&9>aa?g.appendChild(H("span",[t])):g.appendChild(t);a.map.push(a.pos,a.pos+m,t);a.col+=m;a.pos+=m}if(!n)break;q+=m+1;"\t"==n[0]?(t=a.cm.options.tabSize,n=t-a.col%t,t=g.appendChild(H("span",Dd(n),"cm-tab")),t.setAttribute("role","presentation"),t.setAttribute("cm-text","\t"),a.col+=n):("\r"==n[0]||"\n"==n[0]?(t=g.appendChild(H("span",
"\r"==n[0]?"\u240d":"\u2424","cm-invalidchar")),t.setAttribute("cm-text",n[0])):(t=a.cm.options.specialCharPlaceholder(n[0]),t.setAttribute("cm-text",n[0]),U&&9>aa?g.appendChild(H("span",[t])):g.appendChild(t)),a.col+=1);a.map.push(a.pos,a.pos+1,t);a.pos++}}else a.col+=b.length,g=document.createTextNode(k),a.map.push(a.pos,a.pos+b.length,g),U&&9>aa&&(p=!0),a.pos+=b.length;a.trailingSpace=32==k.charCodeAt(b.length-1);if(c||d||e||p||h)return b=c||"",d&&(b+=d),e&&(b+=e),d=H("span",[g],b,h),f&&(d.title=
f),a.content.appendChild(d);a.content.appendChild(g)}}function gg(a,b){return function(c,d,e,f,h,g,k){e=e?e+" cm-force-border":"cm-force-border";for(var l=c.pos,p=l+d.length;;){for(var q=0;q<b.length;q++){var n=b[q];if(n.to>l&&n.from<=l)break}if(n.to>=p)return a(c,d,e,f,h,g,k);a(c,d.slice(0,n.to-l),e,f,null,g,k);f=null;d=d.slice(n.to-l);l=n.to}}}function df(a,b,c,d){var e=!d&&c.widgetNode;e&&a.map.push(a.pos,a.pos+b,e);!d&&a.cm.display.input.needsContentAttribute&&(e||(e=a.content.appendChild(document.createElement("span"))),
e.setAttribute("cm-marker",c.id));e&&(a.cm.display.input.setUneditable(e),a.content.appendChild(e));a.pos+=b;a.trailingSpace=!1}function Pe(a,b){return 0==b.from.ch&&0==b.to.ch&&""==W(b.text)&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}function Cd(a,b,c,d){function e(a,c,f){a.text=c;a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null);null!=a.order&&(a.order=null);Ve(a);We(a,f);c=d?d(a):1;c!=a.height&&Ka(a,c);sa(a,"change",a,b)}function f(a,b){for(var e=a,qa=[];e<b;++e)qa.push(new ic(k[e],
c?c[e]:null,d));return qa}var h=b.from,g=b.to,k=b.text,l=J(a,h.line),p=J(a,g.line),q=W(k),n=c?c[k.length-1]:null,m=g.line-h.line;if(b.full)a.insert(0,f(0,k.length)),a.remove(k.length,a.size-k.length);else if(Pe(a,b)){var t=f(0,k.length-1);e(p,p.text,n);m&&a.remove(h.line,m);t.length&&a.insert(h.line,t)}else l==p?1==k.length?e(l,l.text.slice(0,h.ch)+q+l.text.slice(g.ch),n):(t=f(1,k.length-1),t.push(new ic(q+l.text.slice(g.ch),n,d)),e(l,l.text.slice(0,h.ch)+k[0],c?c[0]:null),a.insert(h.line+1,t)):1==
k.length?(e(l,l.text.slice(0,h.ch)+k[0]+p.text.slice(g.ch),c?c[0]:null),a.remove(h.line+1,m)):(e(l,l.text.slice(0,h.ch)+k[0],c?c[0]:null),e(p,q+p.text.slice(g.ch),n),t=f(1,k.length-1),1<m&&a.remove(h.line+1,m-1),a.insert(h.line+1,t));sa(a,"change",a,b)}function jc(a){this.lines=a;this.parent=null;for(var b=0,c=0;b<a.length;++b)a[b].parent=this,c+=a[b].height;this.height=c}function kc(a){this.children=a;for(var b=0,c=0,d=0;d<a.length;++d){var e=a[d],b=b+e.chunkSize(),c=c+e.height;e.parent=this}this.size=
b;this.height=c;this.parent=null}function qb(a,b,c){function d(a,e,f){if(a.linked)for(var qa=0;qa<a.linked.length;++qa){var h=a.linked[qa];if(h.doc!=e){var g=f&&h.sharedHist;if(!c||g)b(h.doc,g),d(h.doc,a,g)}}}d(a,null,!0)}function Sd(b,c){if(c.cm)throw Error("This document is already in use.");b.doc=c;c.cm=b;g(b);a(b);b.options.lineWrapping||p(b);b.options.mode=c.modeOption;oa(b)}function J(a,b){b-=a.first;if(0>b||b>=a.size)throw Error("There is no line "+(b+a.first)+" in the document.");for(var c=
a;!c.lines;)for(var d=0;;++d){var e=c.children[d],f=e.chunkSize();if(b<f){c=e;break}b-=f}return c.lines[b]}function mb(a,b,c){var d=[],e=b.line;a.iter(b.line,c.line+1,function(a){a=a.text;e==c.line&&(a=a.slice(0,c.ch));e==b.line&&(a=a.slice(b.ch));d.push(a);++e});return d}function Kd(a,b,c){var d=[];a.iter(b,c,function(a){d.push(a.text)});return d}function Ka(a,b){var c=b-a.height;if(c)for(var d=a;d;d=d.parent)d.height+=c}function X(a){if(null==a.parent)return null;var b=a.parent;a=ka(b.lines,a);
for(var c=b.parent;c;b=c,c=c.parent)for(var d=0;c.children[d]!=b;++d)a+=c.children[d].chunkSize();return a+b.first}function jb(a,b){var c=a.first;a:do{for(var d=0;d<a.children.length;++d){var e=a.children[d],f=e.height;if(b<f){a=e;continue a}b-=f;c+=e.chunkSize()}return c}while(!a.lines);for(d=0;d<a.lines.length;++d){e=a.lines[d].height;if(b<e)break;b-=e}return c+d}function Ma(a){a=Qa(a);for(var b=0,c=a.parent,d=0;d<c.lines.length;++d){var e=c.lines[d];if(e==a)break;else b+=e.height}for(a=c.parent;a;c=
a,a=c.parent)for(d=0;d<a.children.length&&(e=a.children[d],e!=c);++d)b+=e.height;return b}function Da(a){var b=a.order;null==b&&(b=a.order=ig(a.text));return b}function Zc(a){this.done=[];this.undone=[];this.undoDepth=Infinity;this.lastModTime=this.lastSelTime=0;this.lastOrigin=this.lastSelOrigin=this.lastOp=this.lastSelOp=null;this.generation=this.maxGeneration=a||1}function Bd(a,b){var c={from:Nb(b.from),to:pb(b),text:mb(a,b.from,b.to)};ef(a,c,b.from.line,b.to.line+1);qb(a,function(a){ef(a,c,b.from.line,
b.to.line+1)},!0);return c}function ce(a){for(;a.length;)if(W(a).ranges)a.pop();else break}function Le(a,b,c,d){var e=a.history;e.undone.length=0;var f=+new Date,h,g;if(g=e.lastOp==d||e.lastOrigin==b.origin&&b.origin&&("+"==b.origin.charAt(0)&&a.cm&&e.lastModTime>f-a.cm.options.historyEventDelay||"*"==b.origin.charAt(0)))e.lastOp==d?(ce(e.done),h=W(e.done)):e.done.length&&!W(e.done).ranges?h=W(e.done):1<e.done.length&&!e.done[e.done.length-2].ranges?(e.done.pop(),h=W(e.done)):h=void 0,g=h;if(g){var k=
W(h.changes);0==L(b.from,b.to)&&0==L(b.from,k.to)?k.to=pb(b):h.changes.push(Bd(a,b))}else for((h=W(e.done))&&h.ranges||zc(a.sel,e.done),h={changes:[Bd(a,b)],generation:e.generation},e.done.push(h);e.done.length>e.undoDepth;)e.done.shift(),e.done[0].ranges||e.done.shift();e.done.push(c);e.generation=++e.maxGeneration;e.lastModTime=e.lastSelTime=f;e.lastOp=e.lastSelOp=d;e.lastOrigin=e.lastSelOrigin=b.origin;k||fa(a,"historyAdded")}function zc(a,b){var c=W(b);c&&c.ranges&&c.equals(a)||b.push(a)}function ef(a,
b,c,d){var e=b["spans_"+a.id],f=0;a.iter(Math.max(a.first,c),Math.min(a.first+a.size,d),function(c){c.markedSpans&&((e||(e=b["spans_"+a.id]={}))[f]=c.markedSpans);++f})}function bg(a){if(!a)return null;for(var b=0,c;b<a.length;++b)a[b].marker.explicitlyCleared?c||(c=a.slice(0,b)):c&&c.push(a[b]);return c?c.length?c:null:a}function Ib(a,b,c){for(var d=0,e=[];d<a.length;++d){var f=a[d];if(f.ranges)e.push(c?Sa.prototype.deepCopy.call(f):f);else{var f=f.changes,h=[];e.push({changes:h});for(var g=0;g<
f.length;++g){var k=f[g],l;h.push({from:k.from,to:k.to,text:k.text});if(b)for(var p in k)(l=p.match(/^spans_(\d+)$/))&&-1<ka(b,Number(l[1]))&&(W(h)[p]=k[p],delete k[p])}}}return e}function ff(a,b,c,d){c<a.line?a.line+=d:b<a.line&&(a.line=b,a.ch=0)}function gf(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e],h=!0;if(f.ranges){f.copied||(f=a[e]=f.deepCopy(),f.copied=!0);for(var g=0;g<f.ranges.length;g++)ff(f.ranges[g].anchor,b,c,d),ff(f.ranges[g].head,b,c,d)}else{for(g=0;g<f.changes.length;++g){var k=
f.changes[g];if(c<k.from.line)k.from=E(k.from.line+d,k.from.ch),k.to=E(k.to.line+d,k.to.ch);else if(b<=k.to.line){h=!1;break}}h||(a.splice(0,e+1),e=0)}}}function Me(a,b){var c=b.from.line,d=b.to.line,e=b.text.length-(d-c)-1;gf(a.done,c,d,e);gf(a.undone,c,d,e)}function xd(a){return null!=a.defaultPrevented?a.defaultPrevented:0==a.returnValue}function Ae(a){var b=a.which;null==b&&(a.button&1?b=1:a.button&2?b=3:a.button&4&&(b=2));Ca&&a.ctrlKey&&1==b&&(b=3);return b}function $c(a,b,c){a=a._handlers&&
a._handlers[b];return c?a&&0<a.length?a.slice():hf:a||hf}function sa(a,b){function c(a){return function(){a.apply(null,e)}}var d=$c(a,b,!1);if(d.length){var e=Array.prototype.slice.call(arguments,2),f;Eb?f=Eb.delayedCallbacks:lc?f=lc:(f=lc=[],setTimeout(jg,0));for(var h=0;h<d.length;++h)f.push(c(d[h]))}}function jg(){var a=lc;lc=null;for(var b=0;b<a.length;++b)a[b]()}function ga(a,b,c){"string"==typeof b&&(b={type:b,preventDefault:function(){this.defaultPrevented=!0}});fa(a,c||b.type,a,b);return xd(b)||
b.codemirrorIgnore}function fe(a){var b=a._handlers&&a._handlers.cursorActivity;if(b){a=a.curOp.cursorActivityHandlers||(a.curOp.cursorActivityHandlers=[]);for(var c=0;c<b.length;++c)-1==ka(a,b[c])&&a.push(b[c])}}function Aa(a,b){return 0<$c(a,b).length}function Jb(a){a.prototype.on=function(a,b){K(this,a,b)};a.prototype.off=function(a,b){Ra(this,a,b)}}function fb(){this.id=null}function Dd(a){for(;ad.length<=a;)ad.push(W(ad)+" ");return ad[a]}function W(a){return a[a.length-1]}function ka(a,b){for(var c=
0;c<a.length;++c)if(a[c]==b)return c;return-1}function vc(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=b(a[d],d);return c}function mc(){}function jf(a,b){var c;Object.create?c=Object.create(a):(mc.prototype=a,c=new mc);b&&Ba(b,c);return c}function Ba(a,b,c){b||(b={});for(var d in a)!a.hasOwnProperty(d)||!1===c&&b.hasOwnProperty(d)||(b[d]=a[d]);return b}function Qb(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}}function Tc(a,b){return b?-1<b.source.indexOf("\\w")&&
kf(a)?!0:b.test(a):kf(a)}function lf(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function cc(a){return 768<=a.charCodeAt(0)&&kg.test(a)}function H(a,b,c,d){a=document.createElement(a);c&&(a.className=c);d&&(a.style.cssText=d);if("string"==typeof b)a.appendChild(document.createTextNode(b));else if(b)for(c=0;c<b.length;++c)a.appendChild(b[c]);return a}function $a(a){for(var b=a.childNodes.length;0<b;--b)a.removeChild(a.firstChild);return a}function wa(a,b){return $a(a).appendChild(b)}
function Na(){for(var a=document.activeElement;a&&a.root&&a.root.activeElement;)a=a.root.activeElement;return a}function nc(a){return new RegExp("(^|\\s)"+a+"(?:$|\\s)\\s*")}function Jd(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)c[d]&&!nc(c[d]).test(b)&&(b+=" "+c[d]);return b}function mf(a){if(document.body.getElementsByClassName)for(var b=document.body.getElementsByClassName("CodeMirror"),c=0;c<b.length;c++){var d=b[c].CodeMirror;d&&a(d)}}function yf(){var a;K(window,"resize",function(){null==
a&&(a=setTimeout(function(){a=null;mf(Kf)},100))});K(window,"blur",function(){mf(Rb)})}function hg(a){if(null==Ld){var b=H("span","\u200b");wa(a,H("span",[b,document.createTextNode("x")]));0!=a.firstChild.offsetHeight&&(Ld=1>=b.offsetWidth&&2<b.offsetHeight&&!(U&&8>aa))}a=Ld?H("span","\u200b"):H("span","\u00a0",null,"display: inline-block; width: 1px; margin-right: -1px");a.setAttribute("cm-text","");return a}function Bf(a,b,c,d){if(!a)return d(b,c,"ltr");for(var e=!1,f=0;f<a.length;++f){var h=a[f];
if(h.from<c&&h.to>b||b==c&&h.to==b)d(Math.max(h.from,b),Math.min(h.to,c),1==h.level?"rtl":"ltr"),e=!0}e||d(b,c,"ltr")}function qd(a){return a.level%2?a.to:a.from}function rd(a){return a.level%2?a.from:a.to}function Ec(a){return(a=Da(a))?qd(a[0]):0}function Fc(a){var b=Da(a);return b?rd(W(b)):a.text.length}function nf(a,b){var c=J(a.doc,b),d=Qa(c);d!=c&&(b=X(d));d=(c=Da(d))?c[0].level%2?Fc(d):Ec(d):0;return E(b,d)}function of(a,b){var c=nf(a,b.line),d=J(a.doc,c.line),e=Da(d);return e&&0!=e[0].level?
c:(d=Math.max(0,d.text.search(/\S/)),E(c.line,b.line==c.line&&b.ch<=d&&b.ch?0:d))}function wc(a,b){ec=null;for(var c=0,d;c<a.length;++c){var e=a[c];if(e.from<b&&e.to>b)return c;if(e.from==b||e.to==b)if(null==d)d=c;else{var f;f=e.level;var h=a[d].level,g=a[0].level;f=f==g?!0:h==g?!1:f<h;if(f)return e.from!=e.to&&(ec=d),c;e.from!=e.to&&(ec=c);break}}return d}function Md(a,b,c,d){if(!d)return b+c;do b+=c;while(0<b&&cc(a.text.charAt(b)));return b}function td(a,b,c,d){var e=Da(a);if(!e)return Qe(a,b,c,
d);var f=wc(e,b),h=e[f];for(b=Md(a,b,h.level%2?-c:c,d);;){if(b>h.from&&b<h.to)return b;if(b==h.from||b==h.to){if(wc(e,b)==f)return b;h=e[f+c];return 0<c==h.level%2?h.to:h.from}h=e[f+=c];if(!h)return null;b=0<c==h.level%2?Md(a,h.to,-1,d):Md(a,h.from,1,d)}}function Qe(a,b,c,d){b+=c;if(d)for(;0<b&&cc(a.text.charAt(b));)b+=c;return 0>b||b>a.text.length?null:b}var ta=navigator.userAgent,pf=navigator.platform,Za=/gecko\/\d/i.test(ta),qf=/MSIE \d/.test(ta),rf=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ta),
U=qf||rf,aa=U&&(qf?document.documentMode||6:rf[1]),ha=/WebKit\//.test(ta),lg=ha&&/Qt\/\d+\.\d+/.test(ta),mg=/Chrome\//.test(ta),Ga=/Opera\//.test(ta),ve=/Apple Computer/.test(navigator.vendor),ng=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(ta),Hf=/PhantomJS/.test(ta),Bb=/AppleWebKit/.test(ta)&&/Mobile\/\w+/.test(ta),Pb=Bb||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(ta),Ca=Bb||/Mac/.test(pf),Qf=/\bCrOS\b/.test(ta),og=/win/i.test(pf),sb=Ga&&ta.match(/Version\/(\d*\.\d*)/);sb&&(sb=Number(sb[1]));
sb&&15<=sb&&(Ga=!1,ha=!0);var sf=Ca&&(lg||Ga&&(null==sb||12.11>sb)),vd=Za||U&&9<=aa,Je=!1,bb=!1;A.prototype=Ba({update:function(a){var b=a.scrollWidth>a.clientWidth+1,c=a.scrollHeight>a.clientHeight+1,d=a.nativeBarWidth;c?(this.vert.style.display="block",this.vert.style.bottom=b?d+"px":"0",this.vert.firstChild.style.height=Math.max(0,a.scrollHeight-a.clientHeight+(a.viewHeight-(b?d:0)))+"px"):(this.vert.style.display="",this.vert.firstChild.style.height="0");b?(this.horiz.style.display="block",this.horiz.style.right=
c?d+"px":"0",this.horiz.style.left=a.barLeft+"px",this.horiz.firstChild.style.width=a.scrollWidth-a.clientWidth+(a.viewWidth-a.barLeft-(c?d:0))+"px"):(this.horiz.style.display="",this.horiz.firstChild.style.width="0");!this.checkedZeroWidth&&0<a.clientHeight&&(0==d&&this.zeroWidthHack(),this.checkedZeroWidth=!0);return{right:c?d:0,bottom:b?d:0}},setScrollLeft:function(a){this.horiz.scrollLeft!=a&&(this.horiz.scrollLeft=a);this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz)},setScrollTop:function(a){this.vert.scrollTop!=
a&&(this.vert.scrollTop=a);this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert)},zeroWidthHack:function(){this.horiz.style.height=this.vert.style.width=Ca&&!ng?"12px":"18px";this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none";this.disableHoriz=new fb;this.disableVert=new fb},enableZeroWidthBar:function(a,b){function c(){var d=a.getBoundingClientRect();document.elementFromPoint(d.left+1,d.bottom-1)!=a?a.style.pointerEvents="none":b.set(1E3,c)}a.style.pointerEvents=
"auto";b.set(1E3,c)},clear:function(){var a=this.horiz.parentNode;a.removeChild(this.horiz);a.removeChild(this.vert)}},A.prototype);B.prototype=Ba({update:function(){return{bottom:0,right:0}},setScrollLeft:function(){},setScrollTop:function(){},clear:function(){}},B.prototype);c.scrollbarModel={"native":A,"null":B};G.prototype.signal=function(a,b){Aa(a,b)&&this.events.push(arguments)};G.prototype.finish=function(){for(var a=0;a<this.events.length;a++)fa.apply(null,this.events[a])};var E=c.Pos=function(a,
b){if(!(this instanceof E))return new E(a,b);this.line=a;this.ch=b},L=c.cmpPos=function(a,b){return a.line-b.line||a.ch-b.ch},pa=null;bd.prototype=Ba({init:function(a){function b(a){if(!ga(d,a)){if(d.somethingSelected())pa={lineWise:!1,text:d.getSelections()},c.inaccurateSelection&&(c.prevInput="",c.inaccurateSelection=!1,f.value=pa.text.join("\n"),Kb(f));else if(d.options.lineWiseCopyCut){var e=Nd(d);pa={lineWise:!0,text:e.text};"cut"==a.type?d.setSelections(e.ranges,null,Pa):(c.prevInput="",f.value=
e.text.join("\n"),Kb(f))}else return;"cut"==a.type&&(d.state.cutIncoming=!0)}}var c=this,d=this.cm,e=this.wrapper=Pd(),f=this.textarea=e.firstChild;a.wrapper.insertBefore(e,a.wrapper.firstChild);Bb&&(f.style.width="0px");K(f,"input",function(){U&&9<=aa&&c.hasSelection&&(c.hasSelection=null);c.poll()});K(f,"paste",function(a){ga(d,a)||sc(a,d)||(d.state.pasteIncoming=!0,c.fastPoll())});K(f,"cut",b);K(f,"copy",b);K(a.scroller,"paste",function(b){Wa(a,b)||ga(d,b)||(d.state.pasteIncoming=!0,c.focus())});
K(a.lineSpace,"selectstart",function(b){Wa(a,b)||na(b)});K(f,"compositionstart",function(){var a=d.getCursor("from");c.composing&&c.composing.range.clear();c.composing={start:a,range:d.markText(a,d.getCursor("to"),{className:"CodeMirror-composing"})}});K(f,"compositionend",function(){c.composing&&(c.poll(),c.composing.range.clear(),c.composing=null)})},prepareSelection:function(){var a=this.cm,b=a.display,c=a.doc,d=ie(a);if(a.options.moveInputWithCursor){var a=Ua(a,c.sel.primary().head,"div"),c=b.wrapper.getBoundingClientRect(),
e=b.lineDiv.getBoundingClientRect();d.teTop=Math.max(0,Math.min(b.wrapper.clientHeight-10,a.top+e.top-c.top));d.teLeft=Math.max(0,Math.min(b.wrapper.clientWidth-10,a.left+e.left-c.left))}return d},showSelection:function(a){var b=this.cm.display;wa(b.cursorDiv,a.cursors);wa(b.selectionDiv,a.selection);null!=a.teTop&&(this.wrapper.style.top=a.teTop+"px",this.wrapper.style.left=a.teLeft+"px")},reset:function(a){if(!this.contextMenuPending){var b,c,d=this.cm,e=d.doc;d.somethingSelected()?(this.prevInput=
"",b=e.sel.primary(),c=(b=Fe&&(100<b.to().line-b.from().line||1E3<(c=d.getSelection()).length))?"-":c||d.getSelection(),this.textarea.value=c,d.state.focused&&Kb(this.textarea),U&&9<=aa&&(this.hasSelection=c)):a||(this.prevInput=this.textarea.value="",U&&9<=aa&&(this.hasSelection=null));this.inaccurateSelection=b}},getField:function(){return this.textarea},supportsTouch:function(){return!1},focus:function(){if("nocursor"!=this.cm.options.readOnly&&(!Pb||Na()!=this.textarea))try{this.textarea.focus()}catch(a){}},
blur:function(){this.textarea.blur()},resetPosition:function(){this.wrapper.style.top=this.wrapper.style.left=0},receivedFocus:function(){this.slowPoll()},slowPoll:function(){var a=this;a.pollingFast||a.polling.set(this.cm.options.pollInterval,function(){a.poll();a.cm.state.focused&&a.slowPoll()})},fastPoll:function(){function a(){c.poll()||b?(c.pollingFast=!1,c.slowPoll()):(b=!0,c.polling.set(60,a))}var b=!1,c=this;c.pollingFast=!0;c.polling.set(20,a)},poll:function(){var a=this.cm,b=this.textarea,
c=this.prevInput;if(this.contextMenuPending||!a.state.focused||pg(b)&&!c&&!this.composing||a.isReadOnly()||a.options.disableInput||a.state.keySeq)return!1;var d=b.value;if(d==c&&!a.somethingSelected())return!1;if(U&&9<=aa&&this.hasSelection===d||Ca&&/[\uf700-\uf7ff]/.test(d))return a.display.input.reset(),!1;if(a.doc.sel==a.display.selForContextMenu){var e=d.charCodeAt(0);8203!=e||c||(c="\u200b");if(8666==e)return this.reset(),this.cm.execCommand("undo")}for(var f=0,e=Math.min(c.length,d.length);f<
e&&c.charCodeAt(f)==d.charCodeAt(f);)++f;var h=this;va(a,function(){Ia(a,d.slice(f),c.length-f,null,h.composing?"*compose":null);1E3<d.length||-1<d.indexOf("\n")?b.value=h.prevInput="":h.prevInput=d;h.composing&&(h.composing.range.clear(),h.composing.range=a.markText(h.composing.start,a.getCursor("to"),{className:"CodeMirror-composing"}))});return!0},ensurePolled:function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},onKeyPress:function(){U&&9<=aa&&(this.hasSelection=null);this.fastPoll()},
onContextMenu:function(a){function b(){if(null!=h.selectionStart){var a=e.somethingSelected(),c="\u200b"+(a?h.value:"");h.value="\u21da";h.value=c;d.prevInput=a?"":"\u200b";h.selectionStart=1;h.selectionEnd=c.length;f.selForContextMenu=e.doc.sel}}function c(){d.contextMenuPending=!1;d.wrapper.style.cssText=p;h.style.cssText=l;U&&9>aa&&f.scrollbars.setScrollTop(f.scroller.scrollTop=k);if(null!=h.selectionStart){(!U||U&&9>aa)&&b();var a=0,g=function(){f.selForContextMenu==e.doc.sel&&0==h.selectionStart&&
0<h.selectionEnd&&"\u200b"==d.prevInput?da(e,Nc.selectAll)(e):10>a++?f.detectingSelectAll=setTimeout(g,500):f.input.reset()};f.detectingSelectAll=setTimeout(g,200)}}var d=this,e=d.cm,f=e.display,h=d.textarea,g=ob(e,a),k=f.scroller.scrollTop;if(g&&!Ga){e.options.resetSelectionOnContextMenu&&-1==e.doc.sel.contains(g)&&da(e,ia)(e.doc,Oa(g),Pa);var l=h.style.cssText,p=d.wrapper.style.cssText;d.wrapper.style.cssText="position: absolute";g=d.wrapper.getBoundingClientRect();h.style.cssText="position: absolute; width: 30px; height: 30px; top: "+
(a.clientY-g.top-5)+"px; left: "+(a.clientX-g.left-5)+"px; z-index: 1000; background: "+(U?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";if(ha)var q=window.scrollY;f.input.focus();ha&&window.scrollTo(null,q);f.input.reset();e.somethingSelected()||(h.value=d.prevInput=" ");d.contextMenuPending=!0;f.selForContextMenu=e.doc.sel;clearTimeout(f.detectingSelectAll);U&&9<=aa&&b();if(vd){Ic(a);var n=function(){Ra(window,
"mouseup",n);setTimeout(c,20)};K(window,"mouseup",n)}else setTimeout(c,50)}},readOnlyChanged:function(a){a||this.reset()},setUneditable:mc,needsContentAttribute:!1},bd.prototype);cd.prototype=Ba({init:function(a){function b(a){if(!ga(d,a)){if(d.somethingSelected())pa={lineWise:!1,text:d.getSelections()},"cut"==a.type&&d.replaceSelection("",null,"cut");else if(d.options.lineWiseCopyCut){var c=Nd(d);pa={lineWise:!0,text:c.text};"cut"==a.type&&d.operation(function(){d.setSelections(c.ranges,0,Pa);d.replaceSelection("",
null,"cut")})}else return;if(a.clipboardData&&!Bb)a.preventDefault(),a.clipboardData.clearData(),a.clipboardData.setData("text/plain",pa.text.join("\n"));else{var e=Pd();a=e.firstChild;d.display.lineSpace.insertBefore(e,d.display.lineSpace.firstChild);a.value=pa.text.join("\n");var f=document.activeElement;Kb(a);setTimeout(function(){d.display.lineSpace.removeChild(e);f.focus()},50)}}}var c=this,d=c.cm;a=c.div=a.lineDiv;Od(a);K(a,"paste",function(a){ga(d,a)||sc(a,d)});K(a,"compositionstart",function(a){a=
a.data;c.composing={sel:d.doc.sel,data:a,startData:a};if(a){var b=d.doc.sel.primary(),e=d.getLine(b.head.line).indexOf(a,Math.max(0,b.head.ch-a.length));-1<e&&e<=b.head.ch&&(c.composing.sel=Oa(E(b.head.line,e),E(b.head.line,e+a.length)))}});K(a,"compositionupdate",function(a){c.composing.data=a.data});K(a,"compositionend",function(a){var b=c.composing;b&&(a.data==b.startData||/\u200b/.test(a.data)||(b.data=a.data),setTimeout(function(){b.handled||c.applyComposition(b);c.composing==b&&(c.composing=
null)},50))});K(a,"touchstart",function(){c.forceCompositionEnd()});K(a,"input",function(){c.composing||!d.isReadOnly()&&c.pollContent()||va(c.cm,function(){oa(d)})});K(a,"copy",b);K(a,"cut",b)},prepareSelection:function(){var a=ie(this.cm,!1);a.focus=this.cm.state.focused;return a},showSelection:function(a,b){a&&this.cm.display.view.length&&((a.focus||b)&&this.showPrimarySelection(),this.showMultipleSelections(a))},showPrimarySelection:function(){var a=window.getSelection(),b=this.cm.doc.sel.primary(),
c=tc(this.cm,a.anchorNode,a.anchorOffset),d=tc(this.cm,a.focusNode,a.focusOffset);if(!c||c.bad||!d||d.bad||0!=L(Ya(c,d),b.from())||0!=L(eb(c,d),b.to()))if(c=Qd(this.cm,b.from()),d=Qd(this.cm,b.to()),c||d){var e=this.cm.display.view,b=a.rangeCount&&a.getRangeAt(0);c?d||(d=e[e.length-1].measure,d=d.maps?d.maps[d.maps.length-1]:d.map,d={node:d[d.length-1],offset:d[d.length-2]-d[d.length-3]}):c={node:e[0].measure.map[2],offset:0};try{var f=Db(c.node,c.offset,d.offset,d.node)}catch(h){}f&&(!Za&&this.cm.state.focused?
(a.collapse(c.node,c.offset),f.collapsed||a.addRange(f)):(a.removeAllRanges(),a.addRange(f)),b&&null==a.anchorNode?a.addRange(b):Za&&this.startGracePeriod());this.rememberSelection()}},startGracePeriod:function(){var a=this;clearTimeout(this.gracePeriod);this.gracePeriod=setTimeout(function(){a.gracePeriod=!1;a.selectionChanged()&&a.cm.operation(function(){a.cm.curOp.selectionChanged=!0})},20)},showMultipleSelections:function(a){wa(this.cm.display.cursorDiv,a.cursors);wa(this.cm.display.selectionDiv,
a.selection)},rememberSelection:function(){var a=window.getSelection();this.lastAnchorNode=a.anchorNode;this.lastAnchorOffset=a.anchorOffset;this.lastFocusNode=a.focusNode;this.lastFocusOffset=a.focusOffset},selectionInEditor:function(){var a=window.getSelection();if(!a.rangeCount)return!1;a=a.getRangeAt(0).commonAncestorContainer;return jd(this.div,a)},focus:function(){"nocursor"!=this.cm.options.readOnly&&this.div.focus()},blur:function(){this.div.blur()},getField:function(){return this.div},supportsTouch:function(){return!0},
receivedFocus:function(){function a(){b.cm.state.focused&&(b.pollSelection(),b.polling.set(b.cm.options.pollInterval,a))}var b=this;this.selectionInEditor()?this.pollSelection():va(this.cm,function(){b.cm.curOp.selectionChanged=!0});this.polling.set(this.cm.options.pollInterval,a)},selectionChanged:function(){var a=window.getSelection();return a.anchorNode!=this.lastAnchorNode||a.anchorOffset!=this.lastAnchorOffset||a.focusNode!=this.lastFocusNode||a.focusOffset!=this.lastFocusOffset},pollSelection:function(){if(!this.composing&&
!this.gracePeriod&&this.selectionChanged()){var a=window.getSelection(),b=this.cm;this.rememberSelection();var c=tc(b,a.anchorNode,a.anchorOffset),d=tc(b,a.focusNode,a.focusOffset);c&&d&&va(b,function(){ia(b.doc,Oa(c,d),Pa);if(c.bad||d.bad)b.curOp.selectionChanged=!0})}},pollContent:function(){var a=this.cm,b=a.display,c=a.doc.sel.primary(),d=c.from(),c=c.to();if(d.line<b.viewFrom||c.line>b.viewTo-1)return!1;var e;d.line==b.viewFrom||0==(e=lb(a,d.line))?(d=X(b.view[0].line),e=b.view[0].node):(d=X(b.view[e].line),
e=b.view[e-1].node.nextSibling);var f=lb(a,c.line);f==b.view.length-1?(c=b.viewTo-1,b=b.lineDiv.lastChild):(c=X(b.view[f+1].line)-1,b=b.view[f+1].node.previousSibling);b=a.doc.splitLines(vf(a,e,b,d,c));for(e=mb(a.doc,E(d,0),E(c,J(a.doc,c).text.length));1<b.length&&1<e.length;)if(W(b)==W(e))b.pop(),e.pop(),c--;else if(b[0]==e[0])b.shift(),e.shift(),d++;else break;for(var h=0,f=0,g=b[0],k=e[0],l=Math.min(g.length,k.length);h<l&&g.charCodeAt(h)==k.charCodeAt(h);)++h;g=W(b);k=W(e);for(l=Math.min(g.length-
(1==b.length?h:0),k.length-(1==e.length?h:0));f<l&&g.charCodeAt(g.length-f-1)==k.charCodeAt(k.length-f-1);)++f;b[b.length-1]=g.slice(0,g.length-f);b[0]=b[0].slice(h);d=E(d,h);c=E(c,e.length?W(e).length-f:0);if(1<b.length||b[0]||L(d,c))return Fb(a.doc,b,d,c,"+input"),!0},ensurePolled:function(){this.forceCompositionEnd()},reset:function(){this.forceCompositionEnd()},forceCompositionEnd:function(){this.composing&&!this.composing.handled&&(this.applyComposition(this.composing),this.composing.handled=
!0,this.div.blur(),this.div.focus())},applyComposition:function(a){this.cm.isReadOnly()?da(this.cm,oa)(this.cm):a.data&&a.data!=a.startData&&da(this.cm,Ia)(this.cm,a.data,0,a.sel)},setUneditable:function(a){a.contentEditable="false"},onKeyPress:function(a){a.preventDefault();this.cm.isReadOnly()||da(this.cm,Ia)(this.cm,String.fromCharCode(null==a.charCode?a.keyCode:a.charCode),0)},readOnlyChanged:function(a){this.div.contentEditable=String("nocursor"!=a)},onContextMenu:mc,resetPosition:mc,needsContentAttribute:!0},
cd.prototype);c.inputStyles={textarea:bd,contenteditable:cd};Sa.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(a){if(a==this)return!0;if(a.primIndex!=this.primIndex||a.ranges.length!=this.ranges.length)return!1;for(var b=0;b<this.ranges.length;b++){var c=this.ranges[b],d=a.ranges[b];if(0!=L(c.anchor,d.anchor)||0!=L(c.head,d.head))return!1}return!0},deepCopy:function(){for(var a=[],b=0;b<this.ranges.length;b++)a[b]=new Y(Nb(this.ranges[b].anchor),Nb(this.ranges[b].head));
return new Sa(a,this.primIndex)},somethingSelected:function(){for(var a=0;a<this.ranges.length;a++)if(!this.ranges[a].empty())return!0;return!1},contains:function(a,b){b||(b=a);for(var c=0;c<this.ranges.length;c++){var d=this.ranges[c];if(0<=L(b,d.from())&&0>=L(a,d.to()))return c}return-1}};Y.prototype={from:function(){return Ya(this.anchor,this.head)},to:function(){return eb(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var ne={left:0,
right:0,top:0,bottom:0},nb,Eb=null,Gf=0,Kc,Jc,ue=0,Lc=0,xa=null;U?xa=-.53:Za?xa=15:mg?xa=-.7:ve&&(xa=-1/3);var Ce=function(a){var b=a.wheelDeltaX,c=a.wheelDeltaY;null==b&&a.detail&&a.axis==a.HORIZONTAL_AXIS&&(b=a.detail);null==c&&a.detail&&a.axis==a.VERTICAL_AXIS?c=a.detail:null==c&&(c=a.wheelDelta);return{x:b,y:c}};c.wheelEventPixels=function(a){a=Ce(a);a.x*=xa;a.y*=xa;return a};var Tf=new fb,yd=null,pb=c.changeEnd=function(a){return a.text?E(a.from.line+a.text.length-1,W(a.text).length+(1==a.text.length?
a.from.ch:0)):a.to};c.prototype={constructor:c,focus:function(){window.focus();this.display.input.focus()},setOption:function(a,b){var c=this.options,d=c[a];if(c[a]!=b||"mode"==a)c[a]=b,wb.hasOwnProperty(a)&&da(this,wb[a])(this,b,d)},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a,b){this.state.keyMaps[b?"push":"unshift"](Uc(a))},removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(b[c]==a||b[c].name==a)return b.splice(c,
1),!0},addOverlay:la(function(a,b){var d=a.token?a:c.getMode(this.options,a);if(d.startState)throw Error("Overlays may not be stateful.");this.state.overlays.push({mode:d,modeSpec:a,opaque:b&&b.opaque});this.state.modeGen++;oa(this)}),removeOverlay:la(function(a){for(var b=this.state.overlays,c=0;c<b.length;++c){var d=b[c].modeSpec;if(d==a||"string"==typeof a&&d.name==a){b.splice(c,1);this.state.modeGen++;oa(this);break}}}),indentLine:la(function(a,b,c){"string"!=typeof b&&"number"!=typeof b&&(b=
null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract");$b(this.doc,a)&&Zb(this,a,b,c)}),indentSelection:la(function(a){for(var b=this.doc.sel.ranges,c=-1,d=0;d<b.length;d++){var e=b[d];if(e.empty())e.head.line>c&&(Zb(this,e.head.line,a,!0),c=e.head.line,d==this.doc.sel.primIndex&&Ab(this));else{for(var f=e.from(),e=e.to(),h=Math.max(c,f.line),c=Math.min(this.lastLine(),e.line-(e.ch?0:1))+1,e=h;e<c;++e)Zb(this,e,a);e=this.doc.sel.ranges;0==f.ch&&b.length==e.length&&0<e[d].from().ch&&kd(this.doc,
d,new Y(f,e[d].to()),Pa)}}}),getTokenAt:function(a,b){return $e(this,a,b)},getLineTokens:function(a,b){return $e(this,E(a),b,!0)},getTokenTypeAt:function(a){a=N(this.doc,a);var b=bf(this,J(this.doc,a.line)),c=0,d=(b.length-1)/2;a=a.ch;if(0==a)b=b[2];else for(;;){var e=c+d>>1;if((e?b[2*e-1]:0)>=a)d=e;else if(b[2*e+1]<a)c=e+1;else{b=b[2*e+2];break}}c=b?b.indexOf("cm-overlay "):-1;return 0>c?b:0==c?null:b.slice(0,c-1)},getModeAt:function(a){var b=this.doc.mode;return b.innerMode?c.innerMode(b,this.getTokenAt(a).state).mode:
b},getHelper:function(a,b){return this.getHelpers(a,b)[0]},getHelpers:function(a,b){var c=[];if(!Lb.hasOwnProperty(b))return c;var d=Lb[b],e=this.getModeAt(a);if("string"==typeof e[b])d[e[b]]&&c.push(d[e[b]]);else if(e[b])for(var f=0;f<e[b].length;f++){var h=d[e[b][f]];h&&c.push(h)}else e.helperType&&d[e.helperType]?c.push(d[e.helperType]):d[e.name]&&c.push(d[e.name]);for(f=0;f<d._global.length;f++)h=d._global[f],h.pred(e,this)&&-1==ka(c,h.val)&&c.push(h.val);return c},getStateAfter:function(a,b){var c=
this.doc;a=Math.max(c.first,Math.min(null==a?c.first+c.size-1:a,c.first+c.size-1));return bc(this,a+1,b)},cursorCoords:function(a,b){var c;c=this.doc.sel.primary();c=null==a?c.head:"object"==typeof a?N(this.doc,a):a?c.from():c.to();return Ua(this,c,b||"page")},charCoords:function(a,b){return Ac(this,N(this.doc,a),b||"page")},coordsChar:function(a,b){a=qe(this,a,b||"page");return sd(this,a.left,a.top)},lineAtHeight:function(a,b){a=qe(this,{top:a,left:0},b||"page").top;return jb(this.doc,a+this.display.viewOffset)},
heightAtLine:function(a,b){var c=!1,d;"number"==typeof a?(d=this.doc.first+this.doc.size-1,a<this.doc.first?a=this.doc.first:a>d&&(a=d,c=!0),d=J(this.doc,a)):d=a;return pd(this,d,{top:0,left:0},b||"page").top+(c?this.doc.height-Ma(d):0)},defaultTextHeight:function(){return gb(this.display)},defaultCharWidth:function(){return Tb(this.display)},setGutterMarker:la(function(a,b,c){return Sc(this.doc,a,"gutter",function(a){var d=a.gutterMarkers||(a.gutterMarkers={});d[b]=c;!c&&lf(d)&&(a.gutterMarkers=
null);return!0})}),clearGutter:la(function(a){var b=this,c=b.doc,d=c.first;c.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&(c.gutterMarkers[a]=null,Va(b,d,"gutter"),lf(c.gutterMarkers)&&(c.gutterMarkers=null));++d})}),lineInfo:function(a){if("number"==typeof a){if(!$b(this.doc,a))return null;var b=a;a=J(this.doc,a);if(!a)return null}else if(b=X(a),null==b)return null;return{line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,
widgets:a.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(a,b,c,d,e){var f=this.display;a=Ua(this,N(this.doc,a));var h=a.bottom,g=a.left;b.style.position="absolute";b.setAttribute("cm-ignore-events","true");this.display.input.setUneditable(b);f.sizer.appendChild(b);if("over"==d)h=a.top;else if("above"==d||"near"==d){var k=Math.max(f.wrapper.clientHeight,this.doc.height),l=Math.max(f.sizer.clientWidth,f.lineSpace.clientWidth);("above"==
d||a.bottom+b.offsetHeight>k)&&a.top>b.offsetHeight?h=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=k&&(h=a.bottom);g+b.offsetWidth>l&&(g=l-b.offsetWidth)}b.style.top=h+"px";b.style.left=b.style.right="";"right"==e?(g=f.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==e?g=0:"middle"==e&&(g=(f.sizer.clientWidth-b.offsetWidth)/2),b.style.left=g+"px");c&&(a=Gc(this,g,h,g+b.offsetWidth,h+b.offsetHeight),null!=a.scrollTop&&Wb(this,a.scrollTop),null!=a.scrollLeft&&yb(this,a.scrollLeft))},triggerOnKeyDown:la(ye),
triggerOnKeyPress:la(ze),triggerOnKeyUp:xe,execCommand:function(a){if(Nc.hasOwnProperty(a))return Nc[a].call(null,this)},triggerElectric:la(function(a){Ob(this,a)}),findPosH:function(a,b,c,d){var e=1;0>b&&(e=-1,b=-b);var f=0;for(a=N(this.doc,a);f<b&&(a=Ed(this.doc,a,e,c,d),!a.hitSide);++f);return a},moveH:la(function(a,b){var c=this;c.extendSelectionsBy(function(d){return c.display.shift||c.doc.extend||d.empty()?Ed(c.doc,d.head,a,b,c.options.rtlMoveVisually):0>a?d.from():d.to()},oc)}),deleteH:la(function(a,
b){var c=this.doc;this.doc.sel.somethingSelected()?c.replaceSelection("",null,"+delete"):Gb(this,function(d){var e=Ed(c,d.head,a,b,!1);return 0>a?{from:e,to:d.head}:{from:d.head,to:e}})}),findPosV:function(a,b,c,d){var e=1;0>b&&(e=-1,b=-b);var f=0;for(a=N(this.doc,a);f<b&&(a=Ua(this,a,"div"),null==d?d=a.left:a.left=d,a=Re(this,a,e,c),!a.hitSide);++f);return a},moveV:la(function(a,b){var c=this,d=this.doc,e=[],f=!c.display.shift&&!d.extend&&d.sel.somethingSelected();d.extendSelectionsBy(function(h){if(f)return 0>
a?h.from():h.to();var g=Ua(c,h.head,"div");null!=h.goalColumn&&(g.left=h.goalColumn);e.push(g.left);var k=Re(c,g,a,b);"page"==b&&h==d.sel.primary()&&Qc(c,null,Ac(c,k,"div").top-g.top);return k},oc);if(e.length)for(var h=0;h<d.sel.ranges.length;h++)d.sel.ranges[h].goalColumn=e[h]}),findWordAt:function(a){var b=J(this.doc,a.line).text,c=a.ch,d=a.ch;if(b){var e=this.getHelper(a,"wordChars");(0>a.xRel||d==b.length)&&c?--c:++d;for(var f=b.charAt(c),f=Tc(f,e)?function(a){return Tc(a,e)}:/\s/.test(f)?function(a){return/\s/.test(a)}:
function(a){return!/\s/.test(a)&&!Tc(a)};0<c&&f(b.charAt(c-1));)--c;for(;d<b.length&&f(b.charAt(d));)++d}return new Y(E(a.line,c),E(a.line,d))},toggleOverwrite:function(a){if(null==a||a!=this.state.overwrite)(this.state.overwrite=!this.state.overwrite)?Xb(this.display.cursorDiv,"CodeMirror-overwrite"):Vb(this.display.cursorDiv,"CodeMirror-overwrite"),fa(this,"overwriteToggle",this,this.state.overwrite)},hasFocus:function(){return this.display.input.getField()==Na()},isReadOnly:function(){return!(!this.options.readOnly&&
!this.doc.cantEdit)},scrollTo:la(function(a,b){null==a&&null==b||Rc(this);null!=a&&(this.curOp.scrollLeft=a);null!=b&&(this.curOp.scrollTop=b)}),getScrollInfo:function(){var a=this.display.scroller;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-La(this)-this.display.barHeight,width:a.scrollWidth-La(this)-this.display.barWidth,clientHeight:hd(this),clientWidth:kb(this)}},scrollIntoView:la(function(a,b){null==a?(a={from:this.doc.sel.primary().head,to:null},null==b&&(b=this.options.cursorScrollMargin)):
"number"==typeof a?a={from:E(a,0),to:null}:null==a.from&&(a={from:a,to:null});a.to||(a.to=a.from);a.margin=b||0;if(null!=a.from.line)Rc(this),this.curOp.scrollToPos=a;else{var c=Gc(this,Math.min(a.from.left,a.to.left),Math.min(a.from.top,a.to.top)-a.margin,Math.max(a.from.right,a.to.right),Math.max(a.from.bottom,a.to.bottom)+a.margin);this.scrollTo(c.scrollLeft,c.scrollTop)}}),setSize:la(function(a,b){function c(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a}var d=this;null!=a&&(d.display.wrapper.style.width=
c(a));null!=b&&(d.display.wrapper.style.height=c(b));d.options.lineWrapping&&pe(this);var e=d.display.viewFrom;d.doc.iter(e,d.display.viewTo,function(a){if(a.widgets)for(var b=0;b<a.widgets.length;b++)if(a.widgets[b].noHScroll){Va(d,e,"widget");break}++e});d.curOp.forceUpdate=!0;fa(d,"refresh",this)}),operation:function(a){return va(this,a)},refresh:la(function(){var a=this.display.cachedTextHeight;oa(this);this.curOp.forceUpdate=!0;Ub(this);this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop);q(this);
(null==a||.5<Math.abs(a-gb(this.display)))&&g(this);fa(this,"refresh",this)}),swapDoc:la(function(a){var b=this.doc;b.cm=null;Sd(this,a);Ub(this);this.display.input.reset();this.scrollTo(a.scrollLeft,a.scrollTop);this.curOp.forceScroll=!0;sa(this,"swapDoc",this,b);return b}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};
Jb(c);var wf=c.defaults={},wb=c.optionHandlers={},Td=c.Init={toString:function(){return"CodeMirror.Init"}};M("value","",function(a,b){a.setValue(b)},!0);M("mode",null,function(b,c){b.doc.modeOption=c;a(b)},!0);M("indentUnit",2,a,!0);M("indentWithTabs",!1);M("smartIndent",!0);M("tabSize",4,function(a){d(a);Ub(a);oa(a)},!0);M("lineSeparator",null,function(a,b){if(a.doc.lineSep=b){var c=[],d=a.doc.first;a.doc.iter(function(a){for(var e=0;;){var f=a.text.indexOf(b,e);if(-1==f)break;e=f+b.length;c.push(E(d,
f))}d++});for(var e=c.length-1;0<=e;e--)Fb(a.doc,b,c[e],E(c[e].line,c[e].ch+b.length))}});M("specialChars",/[\u0000-\u001f\u007f\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g,function(a,b,d){a.state.specialChars=new RegExp(b.source+(b.test("\t")?"":"|\t"),"g");d!=c.Init&&a.refresh()});M("specialCharPlaceholder",function(a){var b=H("span","\u2022","cm-invalidchar");b.title="\\u"+a.charCodeAt(0).toString(16);b.setAttribute("aria-label",b.title);return b},function(a){a.refresh()},!0);M("electricChars",!0);
M("inputStyle",Pb?"contenteditable":"textarea",function(){throw Error("inputStyle can not (yet) be changed in a running editor");},!0);M("rtlMoveVisually",!og);M("wholeLineUpdateBefore",!0);M("theme","default",function(a){v(a);n(a)},!0);M("keyMap","default",function(a,b,d){b=Uc(b);(d=d!=c.Init&&Uc(d))&&d.detach&&d.detach(a,b);b.attach&&b.attach(a,d||null)});M("extraKeys",null);M("lineWrapping",!1,function(a){a.options.lineWrapping?(Xb(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth=
"",a.display.sizerWidth=null):(Vb(a.display.wrapper,"CodeMirror-wrap"),p(a));g(a);oa(a);Ub(a);setTimeout(function(){x(a)},100)},!0);M("gutters",[],function(a){h(a.options);n(a)},!0);M("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?F(a.display)+"px":"0";a.refresh()},!0);M("coverGutterNextToScrollbar",!1,function(a){x(a)},!0);M("scrollbarStyle","native",function(a){y(a);x(a);a.display.scrollbars.setScrollTop(a.doc.scrollTop);a.display.scrollbars.setScrollLeft(a.doc.scrollLeft)},!0);M("lineNumbers",
!1,function(a){h(a.options);n(a)},!0);M("firstLineNumber",1,n,!0);M("lineNumberFormatter",function(a){return a},n,!0);M("showCursorWhenSelecting",!1,Yb,!0);M("resetSelectionOnContextMenu",!0);M("lineWiseCopyCut",!0);M("readOnly",!1,function(a,b){"nocursor"==b?(Rb(a),a.display.input.blur(),a.display.disabled=!0):a.display.disabled=!1;a.display.input.readOnlyChanged(b)});M("disableInput",!1,function(a,b){b||a.display.input.reset()},!0);M("dragDrop",!0,function(a,b,d){!b!=!(d&&d!=c.Init)&&(d=a.display.dragFunctions,
b=b?K:Ra,b(a.display.scroller,"dragstart",d.start),b(a.display.scroller,"dragenter",d.enter),b(a.display.scroller,"dragover",d.over),b(a.display.scroller,"dragleave",d.leave),b(a.display.scroller,"drop",d.drop))});M("allowDropFileTypes",null);M("cursorBlinkRate",530);M("cursorScrollMargin",0);M("cursorHeight",1,Yb,!0);M("singleCursorHeightPerLine",!0,Yb,!0);M("workTime",100);M("workDelay",100);M("flattenSpans",!0,d,!0);M("addModeClass",!1,d,!0);M("pollInterval",100);M("undoDepth",200,function(a,b){a.doc.history.undoDepth=
b});M("historyEventDelay",1250);M("viewportMargin",10,function(a){a.refresh()},!0);M("maxHighlightLength",1E4,d,!0);M("moveInputWithCursor",!0,function(a,b){b||a.display.input.resetPosition()});M("tabindex",null,function(a,b){a.display.input.getField().tabIndex=b||""});M("autofocus",null);var tf=c.modes={},pc=c.mimeModes={};c.defineMode=function(a,b){c.defaults.mode||"null"==a||(c.defaults.mode=a);2<arguments.length&&(b.dependencies=Array.prototype.slice.call(arguments,2));tf[a]=b};c.defineMIME=function(a,
b){pc[a]=b};c.resolveMode=function(a){if("string"==typeof a&&pc.hasOwnProperty(a))a=pc[a];else if(a&&"string"==typeof a.name&&pc.hasOwnProperty(a.name)){var b=pc[a.name];"string"==typeof b&&(b={name:b});a=jf(b,a);a.name=b.name}else if("string"==typeof a&&/^[\w\-]+\/[\w\-]+\+xml$/.test(a))return c.resolveMode("application/xml");return"string"==typeof a?{name:a}:a||{name:"null"}};c.getMode=function(a,b){b=c.resolveMode(b);var d=tf[b.name];if(!d)return c.getMode(a,"text/plain");d=d(a,b);if(qc.hasOwnProperty(b.name)){var e=
qc[b.name],f;for(f in e)e.hasOwnProperty(f)&&(d.hasOwnProperty(f)&&(d["_"+f]=d[f]),d[f]=e[f])}d.name=b.name;b.helperType&&(d.helperType=b.helperType);if(b.modeProps)for(f in b.modeProps)d[f]=b.modeProps[f];return d};c.defineMode("null",function(){return{token:function(a){a.skipToEnd()}}});c.defineMIME("text/plain","null");var qc=c.modeExtensions={};c.extendMode=function(a,b){var c=qc.hasOwnProperty(a)?qc[a]:qc[a]={};Ba(b,c)};c.defineExtension=function(a,b){c.prototype[a]=b};c.defineDocExtension=function(a,
b){ra.prototype[a]=b};c.defineOption=M;var ed=[];c.defineInitHook=function(a){ed.push(a)};var Lb=c.helpers={};c.registerHelper=function(a,b,d){Lb.hasOwnProperty(a)||(Lb[a]=c[a]={_global:[]});Lb[a][b]=d};c.registerGlobalHelper=function(a,b,d,e){c.registerHelper(a,b,e);Lb[a]._global.push({pred:d,val:e})};var cb=c.copyState=function(a,b){if(!0===b)return b;if(a.copyState)return a.copyState(b);var c={},d;for(d in b){var e=b[d];e instanceof Array&&(e=e.concat([]));c[d]=e}return c},Ef=c.startState=function(a,
b,c){return a.startState?a.startState(b,c):!0};c.innerMode=function(a,b){for(;a.innerMode;){var c=a.innerMode(b);if(!c||c.mode==a)break;b=c.state;a=c.mode}return c||{mode:a,state:b}};var Nc=c.commands={selectAll:function(a){a.setSelection(E(a.firstLine(),0),E(a.lastLine()),Pa)},singleSelection:function(a){a.setSelection(a.getCursor("anchor"),a.getCursor("head"),Pa)},killLine:function(a){Gb(a,function(b){if(b.empty()){var c=J(a.doc,b.head.line).text.length;return b.head.ch==c&&b.head.line<a.lastLine()?
{from:b.head,to:E(b.head.line+1,0)}:{from:b.head,to:E(b.head.line,c)}}return{from:b.from(),to:b.to()}})},deleteLine:function(a){Gb(a,function(b){return{from:E(b.from().line,0),to:N(a.doc,E(b.to().line+1,0))}})},delLineLeft:function(a){Gb(a,function(a){return{from:E(a.from().line,0),to:a.from()}})},delWrappedLineLeft:function(a){Gb(a,function(b){var c=a.charCoords(b.head,"div").top+5;return{from:a.coordsChar({left:0,top:c},"div"),to:b.from()}})},delWrappedLineRight:function(a){Gb(a,function(b){var c=
a.charCoords(b.head,"div").top+5,c=a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div");return{from:b.from(),to:c}})},undo:function(a){a.undo()},redo:function(a){a.redo()},undoSelection:function(a){a.undoSelection()},redoSelection:function(a){a.redoSelection()},goDocStart:function(a){a.extendSelection(E(a.firstLine(),0))},goDocEnd:function(a){a.extendSelection(E(a.lastLine()))},goLineStart:function(a){a.extendSelectionsBy(function(b){return nf(a,b.head.line)},{origin:"+move",bias:1})},
goLineStartSmart:function(a){a.extendSelectionsBy(function(b){return of(a,b.head)},{origin:"+move",bias:1})},goLineEnd:function(a){a.extendSelectionsBy(function(b){b=b.head.line;for(var c,d=J(a.doc,b);c=ib(d,!1);)d=c.find(1,!0).line,b=null;c=(c=Da(d))?c[0].level%2?Ec(d):Fc(d):d.text.length;return E(null==b?X(d):b,c)},{origin:"+move",bias:-1})},goLineRight:function(a){a.extendSelectionsBy(function(b){b=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:b},
"div")},oc)},goLineLeft:function(a){a.extendSelectionsBy(function(b){b=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:0,top:b},"div")},oc)},goLineLeftSmart:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5,c=a.coordsChar({left:0,top:c},"div");return c.ch<a.getLine(c.line).search(/\S/)?of(a,b.head):c},oc)},goLineUp:function(a){a.moveV(-1,"line")},goLineDown:function(a){a.moveV(1,"line")},goPageUp:function(a){a.moveV(-1,"page")},goPageDown:function(a){a.moveV(1,
"page")},goCharLeft:function(a){a.moveH(-1,"char")},goCharRight:function(a){a.moveH(1,"char")},goColumnLeft:function(a){a.moveH(-1,"column")},goColumnRight:function(a){a.moveH(1,"column")},goWordLeft:function(a){a.moveH(-1,"word")},goGroupRight:function(a){a.moveH(1,"group")},goGroupLeft:function(a){a.moveH(-1,"group")},goWordRight:function(a){a.moveH(1,"word")},delCharBefore:function(a){a.deleteH(-1,"char")},delCharAfter:function(a){a.deleteH(1,"char")},delWordBefore:function(a){a.deleteH(-1,"word")},
delWordAfter:function(a){a.deleteH(1,"word")},delGroupBefore:function(a){a.deleteH(-1,"group")},delGroupAfter:function(a){a.deleteH(1,"group")},indentAuto:function(a){a.indentSelection("smart")},indentMore:function(a){a.indentSelection("add")},indentLess:function(a){a.indentSelection("subtract")},insertTab:function(a){a.replaceSelection("\t")},insertSoftTab:function(a){for(var b=[],c=a.listSelections(),d=a.options.tabSize,e=0;e<c.length;e++){var f=c[e].from(),f=Fa(a.getLine(f.line),f.ch,d);b.push(Dd(d-
f%d))}a.replaceSelections(b)},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.execCommand("insertTab")},transposeChars:function(a){va(a,function(){for(var b=a.listSelections(),c=[],d=0;d<b.length;d++){var e=b[d].head,f=J(a.doc,e.line).text;if(f)if(e.ch==f.length&&(e=new E(e.line,e.ch-1)),0<e.ch)e=new E(e.line,e.ch+1),a.replaceRange(f.charAt(e.ch-1)+f.charAt(e.ch-2),E(e.line,e.ch-2),e,"+transpose");else if(e.line>a.doc.first){var h=J(a.doc,e.line-1).text;h&&a.replaceRange(f.charAt(0)+
a.doc.lineSeparator()+h.charAt(h.length-1),E(e.line-1,h.length-1),E(e.line,1),"+transpose")}c.push(new Y(e,e))}a.setSelections(c)})},newlineAndIndent:function(a){va(a,function(){for(var b=a.listSelections().length,c=0;c<b;c++){var d=a.listSelections()[c];a.replaceRange(a.doc.lineSeparator(),d.anchor,d.head,"+input");a.indentLine(d.from().line+1,null,!0)}Ab(a)})},openLine:function(a){a.replaceSelection("\n","start")},toggleOverwrite:function(a){a.toggleOverwrite()}},db=c.keyMap={};db.basic={Left:"goCharLeft",
Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"};db.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp",
"Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"};db.emacsy={"Ctrl-F":"goCharRight",
"Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"};db.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart",
"Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight",
"Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]};db["default"]=Ca?db.macDefault:db.pcDefault;c.normalizeKeyMap=function(a){var b={},c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!/^(name|fallthrough|(de|at)tach)$/.test(c)){if("..."!=d)for(var e=vc(c.split(" "),Zf),f=0;f<e.length;f++){var h,g;f==e.length-1?(g=e.join(" "),h=d):(g=e.slice(0,f+1).join(" "),h="...");var k=b[g];if(!k)b[g]=h;else if(k!=h)throw Error("Inconsistent bindings for "+
g);}delete a[c]}}for(var l in b)a[l]=b[l];return a};var fc=c.lookupKey=function(a,b,c,d){b=Uc(b);var e=b.call?b.call(a,d):b[a];if(!1===e)return"nothing";if("..."===e)return"multi";if(null!=e&&c(e))return"handled";if(b.fallthrough){if("[object Array]"!=Object.prototype.toString.call(b.fallthrough))return fc(a,b.fallthrough,c,d);for(e=0;e<b.fallthrough.length;e++){var f=fc(a,b.fallthrough[e],c,d);if(f)return f}}},Sf=c.isModifierKey=function(a){a="string"==typeof a?a:tb[a.keyCode];return"Ctrl"==a||"Alt"==
a||"Shift"==a||"Mod"==a},Uf=c.keyName=function(a,b){if(Ga&&34==a.keyCode&&a["char"])return!1;var c=tb[a.keyCode],d=c;if(null==d||a.altGraphKey)return!1;a.altKey&&"Alt"!=c&&(d="Alt-"+d);(sf?a.metaKey:a.ctrlKey)&&"Ctrl"!=c&&(d="Ctrl-"+d);(sf?a.ctrlKey:a.metaKey)&&"Cmd"!=c&&(d="Cmd-"+d);!b&&a.shiftKey&&"Shift"!=c&&(d="Shift-"+d);return d};c.fromTextArea=function(a,b){function d(){a.value=p.getValue()}b=b?Ba(b):{};b.value=a.value;!b.tabindex&&a.tabIndex&&(b.tabindex=a.tabIndex);!b.placeholder&&a.placeholder&&
(b.placeholder=a.placeholder);if(null==b.autofocus){var e=Na();b.autofocus=e==a||null!=a.getAttribute("autofocus")&&e==document.body}if(a.form&&(K(a.form,"submit",d),!b.leaveSubmitMethodAlone)){var f=a.form,h=f.submit;try{var g=f.submit=function(){d();f.submit=h;f.submit();f.submit=g}}catch(k){}}b.finishInit=function(b){b.save=d;b.getTextArea=function(){return a};b.toTextArea=function(){b.toTextArea=isNaN;d();a.parentNode.removeChild(b.getWrapperElement());a.style.display="";a.form&&(Ra(a.form,"submit",
d),"function"==typeof a.form.submit&&(a.form.submit=h))}};a.style.display="none";var p=c(function(b){a.parentNode.insertBefore(b,a.nextSibling)},b);return p};var Yc=c.StringStream=function(a,b){this.pos=this.start=0;this.string=a;this.tabSize=b||8;this.lineStart=this.lastColumnPos=this.lastColumnValue=0};Yc.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<
this.string.length)return this.string.charAt(this.pos++)},eat:function(a){var b=this.string.charAt(this.pos);if("string"==typeof a?b==a:b&&(a.test?a.test(b):a(b)))return++this.pos,b},eatWhile:function(a){for(var b=this.pos;this.eat(a););return this.pos>b},eatSpace:function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(a){a=this.string.indexOf(a,this.pos);if(-1<a)return this.pos=
a,!0},backUp:function(a){this.pos-=a},column:function(){this.lastColumnPos<this.start&&(this.lastColumnValue=Fa(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start);return this.lastColumnValue-(this.lineStart?Fa(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return Fa(this.string,null,this.tabSize)-(this.lineStart?Fa(this.string,this.lineStart,this.tabSize):0)},match:function(a,b,c){if("string"==typeof a){var d=function(a){return c?
a.toLowerCase():a},e=this.string.substr(this.pos,a.length);if(d(e)==d(a))return!1!==b&&(this.pos+=a.length),!0}else{if((a=this.string.slice(this.pos).match(a))&&0<a.index)return null;a&&!1!==b&&(this.pos+=a[0].length);return a}},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(a,b){this.lineStart+=a;try{return b()}finally{this.lineStart-=a}}};var Fd=0,rb=c.TextMarker=function(a,b){this.lines=[];this.type=b;this.doc=a;this.id=++Fd};Jb(rb);rb.prototype.clear=
function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;b&&vb(a);if(Aa(this,"clear")){var c=this.find();c&&sa(this,"clear",c.from,c.to)}for(var d=c=null,e=0;e<this.lines.length;++e){var h=this.lines[e],g=hc(h.markedSpans,this);a&&!this.collapsed?Va(a,X(h),"text"):a&&(null!=g.to&&(d=X(h)),null!=g.from&&(c=X(h)));for(var k=h,l=h.markedSpans,p=g,q=void 0,n=0;n<l.length;++n)l[n]!=p&&(q||(q=[])).push(l[n]);k.markedSpans=q;null==g.from&&this.collapsed&&!hb(this.doc,h)&&a&&Ka(h,gb(a.display))}if(a&&
this.collapsed&&!a.options.lineWrapping)for(e=0;e<this.lines.length;++e)h=Qa(this.lines[e]),g=f(h),g>a.display.maxLineLength&&(a.display.maxLine=h,a.display.maxLineLength=g,a.display.maxLineChanged=!0);null!=c&&a&&this.collapsed&&oa(a,c,d+1);this.lines.length=0;this.explicitlyCleared=!0;this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&ge(a.doc));a&&sa(a,"markerCleared",a,this);b&&xb(a);this.parent&&this.parent.clear()}};rb.prototype.find=function(a,b){null==a&&"bookmark"==this.type&&(a=1);
for(var c,d,e=0;e<this.lines.length;++e){var f=this.lines[e],h=hc(f.markedSpans,this);if(null!=h.from&&(c=E(b?f:X(f),h.from),-1==a))return c;if(null!=h.to&&(d=E(b?f:X(f),h.to),1==a))return d}return c&&{from:c,to:d}};rb.prototype.changed=function(){var a=this.find(-1,!0),b=this,c=this.doc.cm;a&&c&&va(c,function(){var d=a.line,e=X(a.line);if(e=id(c,e))oe(e),c.curOp.selectionChanged=c.curOp.forceUpdate=!0;c.curOp.updateMaxLine=!0;hb(b.doc,d)||null==b.height||(e=b.height,b.height=null,(e=dc(b)-e)&&Ka(d,
d.height+e))})};rb.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;b.maybeHiddenMarkers&&-1!=ka(b.maybeHiddenMarkers,this)||(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)};rb.prototype.detachLine=function(a){this.lines.splice(ka(this.lines,a),1);!this.lines.length&&this.doc.cm&&(a=this.doc.cm.curOp,(a.maybeHiddenMarkers||(a.maybeHiddenMarkers=[])).push(this))};var Fd=0,Wc=c.SharedTextMarker=function(a,b){this.markers=
a;this.primary=b;for(var c=0;c<a.length;++c)a[c].parent=this};Jb(Wc);Wc.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();sa(this,"clear")}};Wc.prototype.find=function(a,b){return this.primary.find(a,b)};var Xc=c.LineWidget=function(a,b,c){if(c)for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d]);this.doc=a;this.node=b};Jb(Xc);Xc.prototype.clear=function(){var a=this.doc.cm,b=this.line.widgets,c=this.line,d=
X(c);if(null!=d&&b){for(var e=0;e<b.length;++e)b[e]==this&&b.splice(e--,1);b.length||(c.widgets=null);var f=dc(this);Ka(c,Math.max(0,c.height-f));a&&va(a,function(){var b=-f;Ma(c)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&Qc(a,null,b);Va(a,d,"widget")})}};Xc.prototype.changed=function(){var a=this.height,b=this.doc.cm,c=this.line;this.height=null;var d=dc(this)-a;d&&(Ka(c,c.height+d),b&&va(b,function(){b.curOp.forceUpdate=!0;Ma(c)<(b.curOp&&b.curOp.scrollTop||b.doc.scrollTop)&&Qc(b,null,d)}))};
var ic=c.Line=function(a,b,c){this.text=a;We(this,b);this.height=c?c(this):1};Jb(ic);ic.prototype.lineNo=function(){return X(this)};var eg={},dg={};jc.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=a,d=a+b;c<d;++c){var e=this.lines[c];this.height-=e.height;var f=e;f.parent=null;Ve(f);sa(e,"delete")}this.lines.splice(a,b)},collapse:function(a){a.push.apply(a,this.lines)},insertInner:function(a,b,c){this.height+=c;this.lines=this.lines.slice(0,a).concat(b).concat(this.lines.slice(a));
for(a=0;a<b.length;++a)b[a].parent=this},iterN:function(a,b,c){for(b=a+b;a<b;++a)if(c(this.lines[a]))return!0}};kc.prototype={chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=0;c<this.children.length;++c){var d=this.children[c],e=d.chunkSize();if(a<e){var f=Math.min(b,e-a),h=d.height;d.removeInner(a,f);this.height-=h-d.height;e==f&&(this.children.splice(c--,1),d.parent=null);if(0==(b-=f))break;a=0}else a-=e}25>this.size-b&&(1<this.children.length||!(this.children[0]instanceof
jc))&&(c=[],this.collapse(c),this.children=[new jc(c)],this.children[0].parent=this)},collapse:function(a){for(var b=0;b<this.children.length;++b)this.children[b].collapse(a)},insertInner:function(a,b,c){this.size+=b.length;this.height+=c;for(var d=0;d<this.children.length;++d){var e=this.children[d],f=e.chunkSize();if(a<=f){e.insertInner(a,b,c);if(e.lines&&50<e.lines.length){for(b=a=e.lines.length%25+25;b<e.lines.length;)c=new jc(e.lines.slice(b,b+=25)),e.height-=c.height,this.children.splice(++d,
0,c),c.parent=this;e.lines=e.lines.slice(0,a);this.maybeSpill()}break}a-=f}},maybeSpill:function(){if(!(10>=this.children.length)){var a=this;do{var b=a.children.splice(a.children.length-5,5),b=new kc(b);if(a.parent){a.size-=b.size;a.height-=b.height;var c=ka(a.parent.children,a);a.parent.children.splice(c+1,0,b)}else c=new kc(a.children),c.parent=a,a.children=[c,b],a=c;b.parent=a.parent}while(10<a.children.length);a.parent.maybeSpill()}},iterN:function(a,b,c){for(var d=0;d<this.children.length;++d){var e=
this.children[d],f=e.chunkSize();if(a<f){f=Math.min(b,f-a);if(e.iterN(a,f,c))return!0;if(0==(b-=f))break;a=0}else a-=f}}};var qg=0,ra=c.Doc=function(a,b,c,d){if(!(this instanceof ra))return new ra(a,b,c,d);null==c&&(c=0);kc.call(this,[new jc([new ic("",null)])]);this.first=c;this.scrollTop=this.scrollLeft=0;this.cantEdit=!1;this.cleanGeneration=1;this.frontier=c;c=E(c,0);this.sel=Oa(c);this.history=new Zc(null);this.id=++qg;this.modeOption=b;this.lineSep=d;this.extend=!1;"string"==typeof a&&(a=this.splitLines(a));
Cd(this,{from:c,to:c,text:a});ia(this,Oa(c),Pa)};ra.prototype=jf(kc.prototype,{constructor:ra,iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):this.iterN(this.first,this.first+this.size,a)},insert:function(a,b){for(var c=0,d=0;d<b.length;++d)c+=b[d].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=Kd(this,this.first,this.first+this.size);return!1===a?b:b.join(a||this.lineSeparator())},setValue:ma(function(a){var b=E(this.first,
0),c=this.first+this.size-1;zb(this,{from:b,to:E(c,J(this,c).text.length),text:this.splitLines(a),origin:"setValue",full:!0},!0);ia(this,Oa(b))}),replaceRange:function(a,b,c,d){b=N(this,b);c=c?N(this,c):b;Fb(this,a,b,c,d)},getRange:function(a,b,c){a=mb(this,N(this,a),N(this,b));return!1===c?a:a.join(c||this.lineSeparator())},getLine:function(a){return(a=this.getLineHandle(a))&&a.text},getLineHandle:function(a){if($b(this,a))return J(this,a)},getLineNumber:function(a){return X(a)},getLineHandleVisualStart:function(a){"number"==
typeof a&&(a=J(this,a));return Qa(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(a){return N(this,a)},getCursor:function(a){var b=this.sel.primary();return null==a||"head"==a?b.head:"anchor"==a?b.anchor:"end"==a||"to"==a||!1===a?b.to():b.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:ma(function(a,b,c){a=N(this,
"number"==typeof a?E(a,b||0):a);ia(this,Oa(a,null),c)}),setSelection:ma(function(a,b,c){var d=N(this,a);a=N(this,b||a);ia(this,Oa(d,a),c)}),extendSelection:ma(function(a,b,c){xc(this,N(this,a),b&&N(this,b),c)}),extendSelections:ma(function(a,b){ae(this,$d(this,a),b)}),extendSelectionsBy:ma(function(a,b){var c=vc(this.sel.ranges,a);ae(this,$d(this,c),b)}),setSelections:ma(function(a,b,c){if(a.length){for(var d=0,e=[];d<a.length;d++)e[d]=new Y(N(this,a[d].anchor),N(this,a[d].head));null==b&&(b=Math.min(a.length-
1,this.sel.primIndex));ia(this,Ea(e,b),c)}}),addSelection:ma(function(a,b,c){var d=this.sel.ranges.slice(0);d.push(new Y(N(this,a),N(this,b||a)));ia(this,Ea(d,d.length-1),c)}),getSelection:function(a){for(var b=this.sel.ranges,c,d=0;d<b.length;d++){var e=mb(this,b[d].from(),b[d].to());c=c?c.concat(e):e}return!1===a?c:c.join(a||this.lineSeparator())},getSelections:function(a){for(var b=[],c=this.sel.ranges,d=0;d<c.length;d++){var e=mb(this,c[d].from(),c[d].to());!1!==a&&(e=e.join(a||this.lineSeparator()));
b[d]=e}return b},replaceSelection:function(a,b,c){for(var d=[],e=0;e<this.sel.ranges.length;e++)d[e]=a;this.replaceSelections(d,b,c||"+input")},replaceSelections:ma(function(a,b,c){for(var d=[],e=this.sel,f=0;f<e.ranges.length;f++){var h=e.ranges[f];d[f]={from:h.from(),to:h.to(),text:this.splitLines(a[f]),origin:c}}if(f=b&&"end"!=b){f=[];c=a=E(this.first,0);for(e=0;e<d.length;e++){var g=d[e],h=He(g.from,a,c),k=He(pb(g),a,c);a=g.to;c=k;"around"==b?(g=this.sel.ranges[e],g=0>L(g.head,g.anchor),f[e]=
new Y(g?k:h,g?h:k)):f[e]=new Y(h,h)}f=new Sa(f,this.sel.primIndex)}b=f;for(f=d.length-1;0<=f;f--)zb(this,d[f]);b?be(this,b):this.cm&&Ab(this.cm)}),undo:ma(function(){Pc(this,"undo")}),redo:ma(function(){Pc(this,"redo")}),undoSelection:ma(function(){Pc(this,"undo",!0)}),redoSelection:ma(function(){Pc(this,"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=this.history,b=0,c=0,d=0;d<a.done.length;d++)a.done[d].ranges||++b;
for(d=0;d<a.undone.length;d++)a.undone[d].ranges||++c;return{undo:b,redo:c}},clearHistory:function(){this.history=new Zc(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(a){a&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null);return this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:Ib(this.history.done),undone:Ib(this.history.undone)}},
setHistory:function(a){var b=this.history=new Zc(this.history.maxGeneration);b.done=Ib(a.done.slice(0),null,!0);b.undone=Ib(a.undone.slice(0),null,!0)},addLineClass:ma(function(a,b,c){return Sc(this,a,"gutter"==b?"gutter":"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass";if(a[d]){if(nc(c).test(a[d]))return!1;a[d]+=" "+c}else a[d]=c;return!0})}),removeLineClass:ma(function(a,b,c){return Sc(this,a,"gutter"==b?"gutter":"class",function(a){var d=
"text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass",e=a[d];if(e)if(null==c)a[d]=null;else{var f=e.match(nc(c));if(!f)return!1;var h=f.index+f[0].length;a[d]=e.slice(0,f.index)+(f.index&&h!=e.length?" ":"")+e.slice(h)||null}else return!1;return!0})}),addLineWidget:ma(function(a,b,c){return cg(this,a,b,c)}),removeLineWidget:function(a){a.clear()},markText:function(a,b,c){return Hb(this,N(this,a),N(this,b),c,c&&c.type||"range")},setBookmark:function(a,b){var c={replacedWith:b&&
(null==b.nodeType?b.widget:b),insertLeft:b&&b.insertLeft,clearWhenEmpty:!1,shared:b&&b.shared,handleMouseEvents:b&&b.handleMouseEvents};a=N(this,a);return Hb(this,a,a,c,"bookmark")},findMarksAt:function(a){a=N(this,a);var b=[],c=J(this,a.line).markedSpans;if(c)for(var d=0;d<c.length;++d){var e=c[d];(null==e.from||e.from<=a.ch)&&(null==e.to||e.to>=a.ch)&&b.push(e.marker.parent||e.marker)}return b},findMarks:function(a,b,c){a=N(this,a);b=N(this,b);var d=[],e=a.line;this.iter(a.line,b.line+1,function(f){if(f=
f.markedSpans)for(var h=0;h<f.length;h++){var g=f[h];null!=g.to&&e==a.line&&a.ch>=g.to||null==g.from&&e!=a.line||null!=g.from&&e==b.line&&g.from>=b.ch||c&&!c(g.marker)||d.push(g.marker.parent||g.marker)}++e});return d},getAllMarks:function(){var a=[];this.iter(function(b){if(b=b.markedSpans)for(var c=0;c<b.length;++c)null!=b[c].from&&a.push(b[c].marker)});return a},posFromIndex:function(a){var b,c=this.first,d=this.lineSeparator().length;this.iter(function(e){e=e.text.length+d;if(e>a)return b=a,!0;
a-=e;++c});return N(this,E(c,b))},indexFromPos:function(a){a=N(this,a);var b=a.ch;if(a.line<this.first||0>a.ch)return 0;var c=this.lineSeparator().length;this.iter(this.first,a.line,function(a){b+=a.text.length+c});return b},copy:function(a){var b=new ra(Kd(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep);b.scrollTop=this.scrollTop;b.scrollLeft=this.scrollLeft;b.sel=this.sel;b.extend=!1;a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory()));return b},
linkedDoc:function(a){a||(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&(b=a.from);null!=a.to&&a.to<c&&(c=a.to);b=new ra(Kd(this,b,c),a.mode||this.modeOption,b,this.lineSep);a.sharedHist&&(b.history=this.history);(this.linked||(this.linked=[])).push({doc:b,sharedHist:a.sharedHist});b.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}];a=Te(this);for(c=0;c<a.length;c++){var d=a[c],e=d.find(),f=b.clipPos(e.from),e=b.clipPos(e.to);L(f,e)&&(f=Hb(b,f,e,d.primary,d.primary.type),
d.markers.push(f),f.parent=d)}return b},unlinkDoc:function(a){a instanceof c&&(a=a.doc);if(this.linked)for(var b=0;b<this.linked.length;++b)if(this.linked[b].doc==a){this.linked.splice(b,1);a.unlinkDoc(this);ag(Te(this));break}if(a.history==this.history){var d=[a.id];qb(a,function(a){d.push(a.id)},!0);a.history=new Zc(null);a.history.done=Ib(this.history.done,d);a.history.undone=Ib(this.history.undone,d)}},iterLinkedDocs:function(a){qb(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm},
splitLines:function(a){return this.lineSep?a.split(this.lineSep):rg(a)},lineSeparator:function(){return this.lineSep||"\n"}});ra.prototype.eachLine=ra.prototype.iter;var sg="iter insert remove copy getEditor constructor".split(" "),rc;for(rc in ra.prototype)ra.prototype.hasOwnProperty(rc)&&0>ka(sg,rc)&&(c.prototype[rc]=function(a){return function(){return a.apply(this.doc,arguments)}}(ra.prototype[rc]));Jb(ra);var na=c.e_preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=
!1},tg=c.e_stopPropagation=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},Ic=c.e_stop=function(a){na(a);tg(a)},K=c.on=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):(a=a._handlers||(a._handlers={}),(a[b]||(a[b]=[])).push(c))},hf=[],Ra=c.off=function(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else for(a=$c(a,b,!1),b=0;b<a.length;++b)if(a[b]==c){a.splice(b,1);break}},
fa=c.signal=function(a,b){var c=$c(a,b,!0);if(c.length)for(var d=Array.prototype.slice.call(arguments,2),e=0;e<c.length;++e)c[e].apply(null,d)},lc=null,Ud=30,De=c.Pass={toString:function(){return"CodeMirror.Pass"}},Pa={scroll:!1},wd={origin:"*mouse"},oc={origin:"+move"};fb.prototype.set=function(a,b){clearTimeout(this.id);this.id=setTimeout(b,a)};var Fa=c.countColumn=function(a,b,c,d,e){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));d=d||0;for(e=e||0;;){var f=a.indexOf("\t",d);if(0>f||f>=
b)return e+(b-d);e+=f-d;e+=c-e%c;d=f+1}},Be=c.findColumn=function(a,b,c){for(var d=0,e=0;;){var f=a.indexOf("\t",d);-1==f&&(f=a.length);var h=f-d;if(f==a.length||e+h>=b)return d+Math.min(h,b-e);e+=f-d;e+=c-e%c;d=f+1;if(e>=b)return d}},ad=[""],Kb=function(a){a.select()};Bb?Kb=function(a){a.selectionStart=0;a.selectionEnd=a.value.length}:U&&(Kb=function(a){try{a.select()}catch(b){}});var ug=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,kf=
c.isWordChar=function(a){return/\w/.test(a)||"\u0080"<a&&(a.toUpperCase()!=a.toLowerCase()||ug.test(a))},kg=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,
Db;Db=document.createRange?function(a,b,c,d){var e=document.createRange();e.setEnd(d||a,c);e.setStart(a,b);return e}:function(a,b,c){var d=document.body.createTextRange();try{d.moveToElementText(a.parentNode)}catch(e){return d}d.collapse(!0);d.moveEnd("character",c);d.moveStart("character",b);return d};var jd=c.contains=function(a,b){3==b.nodeType&&(b=b.parentNode);if(a.contains)return a.contains(b);do if(11==b.nodeType&&(b=b.host),b==a)return!0;while(b=b.parentNode)};U&&11>aa&&(Na=function(){try{return document.activeElement}catch(a){return document.body}});
var Vb=c.rmClass=function(a,b){var c=a.className,d=nc(b).exec(c);if(d){var e=c.slice(d.index+d[0].length);a.className=c.slice(0,d.index)+(e?d[1]+e:"")}},Xb=c.addClass=function(a,b){var c=a.className;nc(b).test(c)||(a.className+=(c?" ":"")+b)},Rd=!1,Nf=function(){if(U&&9>aa)return!1;var a=H("div");return"draggable"in a||"dragDrop"in a}(),Ld,Id,rg=c.splitLines=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;b<=d;){var e=a.indexOf("\n",b);-1==e&&(e=a.length);var f=a.slice(b,"\r"==
a.charAt(e-1)?e-1:e),h=f.indexOf("\r");-1!=h?(c.push(f.slice(0,h)),b+=h+1):(c.push(f),b=e+1)}return c}:function(a){return a.split(/\r\n?|\n/)},pg=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(b){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(c){}return b&&b.parentElement()==a?0!=b.compareEndPoints("StartToEnd",b):!1},Fe=function(){var a=H("div");if("oncopy"in a)return!0;a.setAttribute("oncopy","return;");return"function"==typeof a.oncopy}(),
od=null,tb=c.keyNames={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",
63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};(function(){for(var a=0;10>a;a++)tb[a+48]=tb[a+96]=String(a);for(a=65;90>=a;a++)tb[a]=String.fromCharCode(a);for(a=1;12>=a;a++)tb[a+111]=tb[a+63235]="F"+a})();var ec,ig=function(){function a(b){return 247>=b?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(b):
1424<=b&&1524>=b?"R":1536<=b&&1773>=b?"rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm".charAt(b-1536):1774<=b&&2220>=b?"r":8192<=b&&8203>=b?"w":8204==b?"b":"L"}function b(a,c,d){this.level=a;this.from=c;this.to=d}var c=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,d=/[stwN]/,e=/[LRr]/,f=/[Lb1n]/,h=/[1n]/;return function(g){if(!c.test(g))return!1;
for(var k=g.length,l=[],p=0,q;p<k;++p)l.push(a(g.charCodeAt(p)));for(var p=0,n="L";p<k;++p)q=l[p],"m"==q?l[p]=n:n=q;p=0;for(n="L";p<k;++p)q=l[p],"1"==q&&"r"==n?l[p]="n":e.test(q)&&(n=q,"r"==q&&(l[p]="R"));p=1;for(n=l[0];p<k-1;++p)q=l[p],"+"==q&&"1"==n&&"1"==l[p+1]?l[p]="1":","!=q||n!=l[p+1]||"1"!=n&&"n"!=n||(l[p]=n),n=q;for(p=0;p<k;++p)if(q=l[p],","==q)l[p]="N";else if("%"==q){for(n=p+1;n<k&&"%"==l[n];++n);var m=p&&"!"==l[p-1]||n<k&&"1"==l[n]?"1":"N";for(q=p;q<n;++q)l[q]=m;p=n-1}p=0;for(n="L";p<k;++p)q=
l[p],"L"==n&&"1"==q?l[p]="L":e.test(q)&&(n=q);for(p=0;p<k;++p)if(d.test(l[p])){for(n=p+1;n<k&&d.test(l[n]);++n);q="L"==(n<k?l[n]:"L");m="L"==(p?l[p-1]:"L")||q?"L":"R";for(q=p;q<n;++q)l[q]=m;p=n-1}for(var n=[],t,p=0;p<k;)if(f.test(l[p])){q=p;for(++p;p<k&&f.test(l[p]);++p);n.push(new b(0,q,p))}else{var w=p,m=n.length;for(++p;p<k&&"L"!=l[p];++p);for(q=w;q<p;)if(h.test(l[q])){w<q&&n.splice(m,0,new b(1,w,q));w=q;for(++q;q<p&&h.test(l[q]);++q);n.splice(m,0,new b(2,w,q));w=q}else++q;w<p&&n.splice(m,0,new b(1,
w,p))}1==n[0].level&&(t=g.match(/^\s+/))&&(n[0].from=t[0].length,n.unshift(new b(0,0,t[0].length)));1==W(n).level&&(t=g.match(/\s+$/))&&(W(n).to-=t[0].length,n.push(new b(0,k-t[0].length,k)));2==n[0].level&&n.unshift(new b(1,n[0].to,n[0].to));n[0].level!=W(n).level&&n.push(new b(n[0].level,k,k));return n}}();c.version="5.17.0";return c})},function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==
typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(){return new v.TrackableValue(0>=arguments.length||void 0===arguments[0]?"void main() {\n  emitGrayscale(toNormalized(getDataValue()));\n}\n":arguments[0],n.verifyString)}
var d=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),m=function f(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:f(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},r=e(65),v=
e(66),n=e(8);c.FRAGMENT_MAIN_START="//NEUROGLANCER_IMAGE_RENDERLAYER_FRAGMENT_MAIN_START";var k=e(109);c.getTrackableFragmentMain=a;g=function(e){function g(b,c){var d=2>=arguments.length||void 0===arguments[2]?r.trackableAlphaValue(.5):arguments[2],e=3>=arguments.length||void 0===arguments[3]?a():arguments[3];if(!(this instanceof g))throw new TypeError("Cannot call a class as a function");var f=l(this,Object.getPrototypeOf(g).call(this,b,c));f.opacity=d;f.fragmentMain=e;f.registerSignalBinding(d.changed.add(function(){f.redrawNeeded.dispatch()}));
f.registerSignalBinding(e.changed.add(function(){f.shaderUpdated=!0;f.redrawNeeded.dispatch()}));return f}b(g,e);d(g,[{key:"getShaderKey",value:function(){return"sliceview.ImageRenderLayer:"+JSON.stringify(this.fragmentMain.value)}},{key:"defineShader",value:function(a){m(Object.getPrototypeOf(g.prototype),"defineShader",this).call(this,a);a.addUniform("highp float","uOpacity");a.addFragmentCode("\nvoid emitRGBA(vec4 rgba) {\n  emit(vec4(rgba.rgb, rgba.a * uOpacity));\n}\nvoid emitRGB(vec3 rgb) {\n  emit(vec4(rgb, uOpacity));\n}\nvoid emitGrayscale(float value) {\n  emit(vec4(value, value, value, uOpacity));\n}\nvoid emitTransparent() {\n  emit(vec4(0.0, 0.0, 0.0, 0.0));\n}\n");
a.addFragmentCode(k);a.setFragmentMainFunction(c.FRAGMENT_MAIN_START+"\n"+this.fragmentMain.value)}},{key:"beginSlice",value:function(a){a=m(Object.getPrototypeOf(g.prototype),"beginSlice",this).call(this,a);this.gl.uniform1f(a.uniform("uOpacity"),this.opacity.value);return a}}]);return g}(r.RenderLayer);c.ImageRenderLayer=g},function(g,c){g.exports='/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvec3 colormapJet(float x) {\n  vec3 result;\n  result.r = x < 0.89 ? ((x - 0.35) / 0.31) : (1.0 - (x - 0.89) / 0.11 * 0.5);\n  result.g = x < 0.64 ? ((x - 0.125) * 4.0) : (1.0 - (x - 0.64) / 0.27);\n  result.b = x < 0.34 ? (0.5 + x * 0.5 / 0.11) : (1.0 - (x - 0.34) / 0.31);\n  return clamp(result, 0.0, 1.0);\n}\n'},
function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=
function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),d=function v(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:v(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)};g=e(23);var m=e(7);
e(111);e=function(c){function e(a){var b=1>=arguments.length||void 0===arguments[1]?{}:arguments[1],c=b.min,c=void 0===c?0:c,d=b.max,d=void 0===d?1:d,b=b.step,b=void 0===b?.01:b;if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var h=l(this,Object.getPrototypeOf(e).call(this));h.value=a;h.element=document.createElement("label");h.promptElement=document.createElement("span");h.inputElement=document.createElement("input");var g=h.element,m=h.promptElement,B=h.inputElement;
g.className="range-slider";m.className="range-prompt";B.type="range";B.min=""+c;B.max=""+d;B.step=""+b;B.valueAsNumber=h.value.value;g.appendChild(m);g.appendChild(B);var y=function(){h.value.value=h.inputElement.valueAsNumber};h.registerEventListener(B,"change",y);h.registerEventListener(B,"input",y);h.registerEventListener(B,"wheel",function(a){a=a.deltaY;0<a?(h.inputElement.stepUp(),y()):0>a&&(h.inputElement.stepDown(),y())});a.changed.add(function(){h.inputElement.valueAsNumber=h.value.value});
return h}b(e,c);a(e,[{key:"disposed",value:function(){m.removeFromParent(this.element);d(Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}}]);return e}(g.RefCounted);c.RangeWidget=e},function(g,c){},function(g,c){},function(g,c){},function(g,c){},function(g,c){},function(g,c){},function(g,c){g.exports=function(c){function g(a){var b={};a=a.split(" ");for(var c=0;c<a.length;++c)b[a[c]]=!0;return b}c.defineMode("glsl",function(c,e){function r(a,b){var c=a.next();if(y[c]){var d=y[c](a,
b);if(!1!==d)return d}if('"'==c||"'"==c)return b.tokenize=v(c),b.tokenize(a,b);if(/[\[\]{}\(\),;\:\.]/.test(c))return z=c,"bracket";if(/\d/.test(c))return a.eatWhile(/[\w\.]/),"number";if("/"==c){if(a.eat("*"))return b.tokenize=n,n(a,b);if(a.eat("/"))return a.skipToEnd(),"comment"}if("#"==c)return a.eatWhile(/[\S]+/),a.eatWhile(/[\s]+/),a.eatWhile(/[\S]+/),a.eatWhile(/[\s]+/),"comment";if(t.test(c))return a.eatWhile(t),"operator";a.eatWhile(/[\w\$_]/);c=a.current();return h.propertyIsEnumerable(c)?
(A.propertyIsEnumerable(c)&&(z="newstatement"),"keyword"):u.propertyIsEnumerable(c)?"builtin":B.propertyIsEnumerable(c)?"atom":"word"}function v(a){return function(b,c){for(var d=!1,e,f=!1;null!=(e=b.next());){if(e==a&&!d){f=!0;break}d=!d&&"\\"==e}if(f||!d&&!x)c.tokenize=r;return"string"}}function n(a,b){for(var c=!1,d;d=a.next();){if("/"==d&&c){b.tokenize=r;break}c="*"==d}return"comment"}function k(a,b,c,d,e){this.indented=a;this.column=b;this.type=c;this.align=d;this.prev=e}function q(a,b,c){return a.context=
new k(a.indented,b,c,null,a.context)}function f(a){var b=a.context.type;if(")"==b||"]"==b||"}"==b)a.indented=a.context.indented;return a.context=a.context.prev}var p=c.indentUnit,h=e.keywords||g(b),u=e.builtins||g(a),A=e.blockKeywords||g("case do else for if switch while struct"),B=e.atoms||g("null"),y=e.hooks||{},x=e.multiLineStrings,t=/[+\-*&%=<>!?|\/]/,z;return{startState:function(a){return{tokenize:null,context:new k((a||0)-p,0,"top",!1),indented:0,startOfLine:!0}},token:function(a,b){var c=b.context;
a.sol()&&(null==c.align&&(c.align=!1),b.indented=a.indentation(),b.startOfLine=!0);if(a.eatSpace())return null;z=null;var d=(b.tokenize||r)(a,b);if("comment"==d||"meta"==d)return d;null==c.align&&(c.align=!0);if(";"!=z&&":"!=z||"statement"!=c.type)if("{"==z)q(b,a.column(),"}");else if("["==z)q(b,a.column(),"]");else if("("==z)q(b,a.column(),")");else if("}"==z){for(;"statement"==c.type;)c=f(b);for("}"==c.type&&(c=f(b));"statement"==c.type;)c=f(b)}else z==c.type?f(b):("}"==c.type||"top"==c.type||"statement"==
c.type&&"newstatement"==z)&&q(b,a.column(),"statement");else f(b);b.startOfLine=!1;return d},indent:function(a,b){if(a.tokenize!=r&&null!=a.tokenize)return 0;var c=b&&b.charAt(0),d=a.context,e=c==d.type;return"statement"==d.type?d.indented+("{"==c?0:p):d.align?d.column+(e?0:1):d.indented+(e?0:p)},electricChars:"{}"}});var b="attribute const uniform varying break continue do for while if else in out inout float int void bool true false lowp mediump highp precision invariant discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler2D samplerCube struct gl_FragCoord gl_FragColor",
a="radians degrees sin cos tan asin acos atan pow exp log exp2 log2 sqrt inversesqrt abs sign floor ceil fract mod min max clamp mix step smoothstep length distance dot cross normalize faceforward reflect refract matrixCompMult lessThan lessThanEqual greaterThan greaterThanEqual equal notEqual any all not dFdx dFdy fwidth texture2D texture2DProj texture2DLod texture2DProjLod textureCube textureCubeLod require export";c.defineMIME("text/x-glsl",{name:"glsl",keywords:g(b),builtins:g(a),blockKeywords:g("case do else for if switch while struct"),
atoms:g("null"),hooks:{"#":function(a,b){if(!b.startOfLine)return!1;a.skipToEnd();return"meta"}}})}},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),m=function D(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,
b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:D(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},r=e(28);g=e(42);var v=e(104),n=e(30),k=e(119),q=e(74),f=e(124),p=e(126),h=e(65),u=e(131),A=e(132),B=e(8),y=e(52),x=e(110),t=e(133),z=e(135);e(137);e=function(c){function e(a,c){l(this,e);var d=b(this,Object.getPrototypeOf(e).call(this,[]));d.manager=a;d.segmentColorHash=k.SegmentColorHash.getDefault();d.segmentSelectionState=new q.SegmentSelectionState;
d.selectedAlpha=h.trackableAlphaValue(.5);d.notSelectedAlpha=h.trackableAlphaValue(0);d.visibleSegments=A.Uint64Set.makeWithCounterpart(d.manager.worker);d.segmentEquivalences=f.SharedDisjointUint64Sets.makeWithCounterpart(d.manager.worker);d.wasDisposed=!1;d.visibleSegments.changed.add(function(){d.specificationChanged.dispatch()});d.segmentEquivalences.changed.add(function(){d.specificationChanged.dispatch()});d.segmentSelectionState.bindTo(a.layerSelectedValues,d);d.selectedAlpha.changed.add(function(){d.specificationChanged.dispatch()});
d.notSelectedAlpha.changed.add(function(){d.specificationChanged.dispatch()});d.selectedAlpha.restoreState(c.selectedAlpha);d.notSelectedAlpha.restoreState(c.notSelectedAlpha);var g=d.volumePath=B.verifyOptionalString(c.source),n=d.meshPath=B.verifyOptionalString(c.mesh),m=d.skeletonsPath=B.verifyOptionalString(c.skeletons);void 0!==g&&(g=v.getVolumeWithStatusMessage(g),g.then(function(a){d.wasDisposed||d.meshLayer||(a=a.getMeshSource(d.manager.chunkManager),null!=a&&d.addMesh(a))}),d.addRenderLayer(new u.SegmentationRenderLayer(a.chunkManager,
g,d,d.selectedAlpha,d.notSelectedAlpha)));void 0!==n&&(g=c.meshLod,"number"!==typeof g&&(g=void 0),d.meshLod=g,d.addMesh(r.getMeshSource(a.chunkManager,n,g)));void 0!==m&&(n=new p.SkeletonLayer(a.chunkManager,r.getSkeletonSource(a.chunkManager,m),a.voxelSize,d),d.addRenderLayer(new p.PerspectiveViewSkeletonLayer(n)),d.addRenderLayer(new p.SliceViewPanelSkeletonLayer(n)));B.verifyObjectProperty(c,"equivalences",function(a){d.segmentEquivalences.restoreState(a)});B.verifyObjectProperty(c,"segments",
function(a){void 0!==a&&function(){var b=d.visibleSegments,c=d.segmentEquivalences;B.parseArray(a,function(a){a=y.Uint64.parseString(String(a),10);b.add(c.get(a))})}()});return d}a(e,c);d(e,[{key:"disposed",value:function(){m(Object.getPrototypeOf(e.prototype),"disposed",this).call(this);this.wasDisposed=!0}},{key:"addMesh",value:function(a){this.meshLayer=new n.MeshLayer(this.manager.chunkManager,a,this);this.addRenderLayer(this.meshLayer)}},{key:"toJSON",value:function(){var a={type:"segmentation"};
a.source=this.volumePath;a.mesh=this.meshPath;a.meshLod=this.meshLod;a.skeletons=this.skeletonsPath;a.selectedAlpha=this.selectedAlpha.toJSON();a.notSelectedAlpha=this.notSelectedAlpha.toJSON();var b=this.visibleSegments;0<b.size&&(a.segments=b.toJSON());b=this.segmentEquivalences;0<b.size&&(a.equivalences=b.toJSON());return a}},{key:"transformPickedValue",value:function(a){if(null==a)return a;var b=this.segmentEquivalences;if(0===b.size)return a;"number"===typeof a&&(a=new y.Uint64(a,0));b=b.get(a);
return y.Uint64.equal(b,a)?a:new q.Uint64MapEntry(a,b)}},{key:"makeDropdown",value:function(a){return new w(a,this)}},{key:"handleAction",value:function(a){switch(a){case "recolor":this.segmentColorHash.randomize();break;case "clear-segments":this.visibleSegments.clear();break;case "select":if(a=this.segmentSelectionState,a.hasSelectedSegment){a=a.selectedSegment;var b=this.visibleSegments;b.has(a)?b.delete(a):b.add(a)}}}}]);return e}(g.UserLayer);c.SegmentationUserLayer=e;var w=function(c){function d(a,
c){l(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.element=a;e.layer=c;e.visibleSegmentWidget=e.registerDisposer(new t.SegmentSetWidget(e.layer));e.addSegmentWidget=e.registerDisposer(new z.Uint64EntryWidget);e.selectedAlphaWidget=e.registerDisposer(new x.RangeWidget(e.layer.selectedAlpha));e.notSelectedAlphaWidget=e.registerDisposer(new x.RangeWidget(e.layer.notSelectedAlpha));a.classList.add("segmentation-dropdown");var f=e.notSelectedAlphaWidget;e.selectedAlphaWidget.promptElement.textContent=
"Opacity (on)";f.promptElement.textContent="Opacity (off)";a.appendChild(e.selectedAlphaWidget.element);a.appendChild(e.notSelectedAlphaWidget.element);e.addSegmentWidget.element.classList.add("add-segment");e.addSegmentWidget.element.title="Add segment ID";a.appendChild(e.registerDisposer(e.addSegmentWidget).element);e.registerSignalBinding(e.addSegmentWidget.valueEntered.add(function(a){e.layer.visibleSegments.add(a)}));a.appendChild(e.registerDisposer(e.visibleSegmentWidget).element);return e}
a(d,c);return d}(g.UserLayerDropdown)},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a){return a-Math.floor(a)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),d=e(120),m=e(121),r=e(123),v=e(71),n=e(34);g=function(){function b(a){l(this,
b);this.prefix=a;this.aName=this.prefix+"_a";this.bName=this.prefix+"_b"}a(b,[{key:"defineShader",value:function(a){var b=this.aName,c=this.bName;a.addUniform("highp vec4",b,4);a.addUniform("highp float",c,4);a.addFragmentCode(v.glsl_uint64);a.addFragmentCode(m.glsl_hashFunction);a.addFragmentCode(v.glsl_hsvToRgb);for(var e="\nvec3 "+this.prefix+"(uint64_t x) {\n  vec2 v;\n  float primeModulus = float("+d.PRIME_MODULUS+");\n",f=0;2>f;++f)var g=2*f,k=2*f,e=e+("\n  v["+f+"] = computeHash(x, "+b+"["+
k+"], "+b+"["+(k+1)+"], "+c+"["+g+"], "+c+"["+(g+1)+"], primeModulus, 1.0 / 256.0);\n");a.addFragmentCode(e+"\n  vec3 hsv = vec3(v.x, 0.5 + v.y * 0.5, 1.0);\n  return hsvToRgb(hsv);\n}\n")}},{key:"enable",value:function(a,b,c){a.uniform4fv(b.uniform(this.aName),c.a_);a.uniform1fv(b.uniform(this.bName),c.b_)}}]);return b}();c.SegmentColorShaderManager=g;var k=new Float32Array(2),q=new Float32Array(3);g=function(){function c(a){l(this,c);this.a_=new Float32Array(16);this.b_=new Float32Array(4);this.changed=
new n.Signal;null==a?(this.hashFunctions=Array(2),this.randomize_()):this.hashFunctions=a;this.computeGPUCoefficients_()}a(c,[{key:"compute",value:function(a,c){for(var d=c.low,e=c.high,f=this.hashFunctions,g=0;2>g;++g)k[g]=b(f[g].compute(d,e)/256);r.hsvToRgb(a,k[0],.5+.5*k[1],1);return a}},{key:"computeCssColor",value:function(a){this.compute(q,a);return"rgb("+100*q[0]+"%,"+100*q[1]+"%,"+100*q[2]+"%)"}},{key:"debugCompute",value:function(a,c){for(var e=c.low,f=c.high,g=this.b_,k=d.PRIME_MODULUS,
l=0;2>l;++l){for(var q=2*l,n=2*l,m=new Float32Array(2),r=0;4>r;++r)m[0]+=this.a_[4*n+r]*(e>>8*r&255),m[1]+=this.a_[4*(n+1)+r]*(f>>8*r&255);var n=(m[0]+m[1])%k,r=n*n%k,D=r*g[q+1]%k,v=(g[q]+n+D)%k;console.log("b = "+g[q]+", sums="+m[0]+" "+m[1]+", dotResult="+n+", prod = "+n*n+" dotResult2="+r+", y="+D+", modResult="+v);a[l]=b(1/256*v)}return a}},{key:"randomize_",value:function(){for(var a=0;2>a;++a)this.hashFunctions[a]=d.HashFunction.generate()}},{key:"randomize",value:function(){this.randomize_();
this.computeGPUCoefficients_();this.changed.dispatch()}},{key:"toString",value:function(){return"new SegmentColorHash(["+this.hashFunctions+"])"}},{key:"computeGPUCoefficients_",value:function(){for(var a=this.hashFunctions,b=this.a_,c=this.b_,d=0;2>d;++d){var e=a[d],f=2*d,g=8*d;c[f]=1*e.b;c[f+1]=1*e.c;for(f=0;4>f;++f)b[g+f]=1*e.a0[f],b[g+4+f]=1*e.a1[f]}}}],[{key:"getDefault",value:function(){return new c([new d.HashFunction(Float32Array.of(609,2364,3749,2289),Float32Array.of(2840,1186,3660,1833),
1718,1109),new d.HashFunction(Float32Array.of(3466,3835,3345,2040),Float32Array.of(3382,901,18,3444),1534,1432)])}}]);return c}();c.SegmentColorHash=g},function(g,c){var e=function(){function b(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,c,e){c&&b(a.prototype,c);e&&b(a,e);return a}}();c.PRIME_MODULUS=4093;var l=function(){function b(a,c,e,g){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");
this.a0=a;this.a1=c;this.b=e;this.c=g}e(b,[{key:"computeDotProduct",value:function(a,b){var c=this.a0,e=this.a1;return c[0]*(a&255)+c[1]*(a>>8&255)+c[2]*(a>>16&255)+c[3]*(a>>24&255)+(e[0]*(b&255)+e[1]*(b>>8&255)+e[2]*(b>>16&255)+e[3]*(b>>24&255))}},{key:"compute",value:function(a,b){var e=this.b,g=this.c,l=this.computeDotProduct(a,b);return(l+l*l%c.PRIME_MODULUS*g+e)%c.PRIME_MODULUS}},{key:"toString",value:function(){return"new HashFunction(Float32Array.of("+this.a0+"), Float32Array.of("+this.a1+
"), "+this.b+", "+this.c+")"}}],[{key:"generate",value:function(){function a(){return Math.floor(Math.random()*c.PRIME_MODULUS)}return new b(Float32Array.of(a(),a(),a(),a()),Float32Array.of(a(),a(),a(),a()),a(),a())}}]);return b}();c.HashFunction=l},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==
typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,
e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),m=function f(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:f(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},r=e(120),v=e(122);g=e(23);var n=e(71),k=e(68);c.glsl_hashFunction=[n.glsl_uint64,n.glsl_exactDot,n.glsl_imod,"\nfloat computeHash(uint64_t x, vec4 a0, vec4 a1, float b, float c, float modulus, float scalar) {\n  x.low *= 255.0;\n  x.high *= 255.0;\n  float dotResult = imod(exactDot(a0, x.low) + exactDot(a1, x.high), modulus);\n  float dotResult2 = imod(dotResult * dotResult, modulus);\n  float y = imod(dotResult2 * c, modulus);\n  float modResult = imod(dotResult + y + b, modulus);\n  return fract(modResult * scalar);\n}\n"];
e=function(c){function e(a,c){l(this,e);var d=b(this,Object.getPrototypeOf(e).call(this));d.gl=a;d.hashTable=c;d.hashFunctions=null;d.generation=-1;d.texture=null;var f=c.hashFunctions.length;d.a=new Float32Array(16*f);d.b=new Float32Array(4*f+5);d.texture=a.createTexture();return d}a(e,c);d(e,[{key:"computeCoefficients",value:function(){var a=this.hashTable,b=a.hashFunctions;if(this.hashFunctions!==b){this.hashFunctions=b;for(var c=this.a,d=this.b,e=b.length,f=a.width,g=[1/f,1/a.height],k=0;2>k;++k)d[4*
e+k]=r.PRIME_MODULUS,d[4*e+3+k]=g[k];d[4*e+2]=1/(a.entryStride*f);for(f=0;f<e;++f)for(g=b[f],k=0;2>k;++k){var l=g[k],p=4*f+2*k,n=4*(4*f+2*k);d[p]=l.b+(0===k?.5/a.entryStride:.5);d[p+1]=l.c;for(p=0;4>p;++p)c[n+p]=l.a0[p],c[n+4+p]=l.a1[p]}}}},{key:"copyToGPU",value:function(){this.computeCoefficients();var a=this.hashTable,b=a.generation;if(this.generation!==b){this.generation=b;var c=a.width,d=a.height,e=this.gl,b=this.texture;e.activeTexture(e.TEXTURE0+e.tempTextureUnit);e.bindTexture(e.TEXTURE_2D,
b);e.pixelStorei(e.UNPACK_ALIGNMENT,1);k.setRawTextureParameters(e);var f=e.RGBA;a.tableWithMungedEmptyKey(function(b){e.texImage2D(e.TEXTURE_2D,0,f,c*a.entryStride,d,0,f,e.UNSIGNED_BYTE,new Uint8Array(b.buffer))});e.bindTexture(e.TEXTURE_2D,null)}}},{key:"disposed",value:function(){this.gl.deleteTexture(this.texture);this.texture=null;this.hashTable=this.gl=void 0;this.hashFunctions=null;m(Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}}],[{key:"get",value:function(a,b){var c=this;
return a.memoize.get(b,function(){return new c(a,b)})}}]);return e}(g.RefCounted);c.GPUHashTable=e;e=function(){function a(b){var c=1>=arguments.length||void 0===arguments[1]?v.NUM_ALTERNATIVES:arguments[1];l(this,a);this.prefix=b;this.numAlternatives=c;$jscomp.initSymbol();this.textureUnitSymbol=Symbol.for("gpuhashtable:"+this.prefix);this.aName=this.prefix+"_a";this.bName=this.prefix+"_b";this.samplerName=this.prefix+"_sampler"}d(a,[{key:"defineShader",value:function(a){var b=this.aName,d=this.bName,
e=this.samplerName,f=this.numAlternatives;a.addUniform("highp vec4",b,4*f);a.addUniform("highp float",d,4*f+5);a.addTextureSampler2D(e,this.textureUnitSymbol);a.addFragmentCode(c.glsl_hashFunction);for(var g="",k=0;k<f;++k){for(var l=0;2>l;++l)var n=4*k+2*l,m=4*k+2*l,g=g+("\nfloat "+this.prefix+"_computeHash_"+k+"_"+l+"(uint64_t x) {\n  float primeModulus = "+d+"["+(4*f+l)+"];\n  float scalar = "+d+"["+(4*f+3+l)+"];\n  return computeHash(x, "+b+"["+m+"], "+b+"["+(m+1)+"], "+d+"["+n+"], "+d+"["+(n+
1)+"], primeModulus, scalar);\n}\n");g+="\nvec2 "+this.prefix+"_computeHash_"+k+"(uint64_t x) {\n  vec2 v;\n  v[0] = "+this.prefix+"_computeHash_"+k+"_0(x);\n  v[1] = "+this.prefix+"_computeHash_"+k+"_1(x);\n  return v;\n}\n"}g+="\nbool "+this.hasFunctionName+"(uint64_t x) {\n  float highOffset = "+d+"["+(4*f+2)+"];\n";for(b=0;b<f;++b)g+="\n  {\n    vec2 v = "+this.prefix+"_computeHash_"+b+"(x);\n    vec4 lowResult = texture2D("+e+", v);\n    vec4 highResult = texture2D("+e+", vec2(v.x + highOffset, v.y));\n    if (lowResult == x.low && highResult == x.high) {\n      return true;\n    }\n  }\n";
a.addFragmentCode(g+"\n  return false;\n}\n")}},{key:"enable",value:function(a,b,c){c.copyToGPU();var d=b.textureUnit(this.textureUnitSymbol);a.activeTexture(a.TEXTURE0+d);a.bindTexture(a.TEXTURE_2D,c.texture);a.uniform4fv(b.uniform(this.aName),c.a);a.uniform1fv(b.uniform(this.bName),c.b)}},{key:"disable",value:function(a,b){var c=b.textureUnit(this.textureUnitSymbol);a.activeTexture(a.TEXTURE0+c);a.bindTexture(a.TEXTURE_2D,null)}},{key:"hasFunctionName",get:function(){return this.prefix+"_has"}}]);
return a}();c.HashSetShaderManager=e;e=function(c){function e(){l(this,e);return b(this,Object.getPrototypeOf(e).apply(this,arguments))}a(e,c);d(e,[{key:"defineShader",value:function(a){m(Object.getPrototypeOf(e.prototype),"defineShader",this).call(this,a);for(var b=this.samplerName,c=this.numAlternatives,d="\nbool "+this.getFunctionName+"(uint64_t x, out uint64_t value) {\n  float highOffset = "+this.bName+"["+(4*c+2)+"];\n",f=0;f<c;++f)d+="\n  {\n    vec2 v = "+this.prefix+"_computeHash_"+f+"(x);\n    vec4 lowResult = texture2D("+
b+", v);\n    vec4 highResult = texture2D("+b+", vec2(v.x + highOffset, v.y));\n    if (lowResult == x.low && highResult == x.high) {\n      value.low = texture2D("+b+", vec2(v.x + 2.0 * highOffset, v.y));\n      value.high = texture2D("+b+", vec2(v.x + 3.0 * highOffset, v.y));\n      return true;\n    }\n  }\n";a.addFragmentCode(d+"\n  return false;\n}\n")}},{key:"getFunctionName",get:function(){return this.prefix+"_get"}}]);return e}(e);c.HashMapShaderManager=e},function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var d=function(){return function(a,
b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done)&&(c.push(h.value),!b||c.length!==b);d=!0);}catch(k){e=!0,f=k}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),m=function x(a,b,c){null===a&&
(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:x(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},r=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),v=e(120),n=e(52);c.NUM_ALTERNATIVES=3;var k=
0,q=0,f=0,p=0;g=function(){function b(){var d=0>=arguments.length||void 0===arguments[0]?b.generateHashFunctions(c.NUM_ALTERNATIVES):arguments[0];a(this,b);this.loadFactor=.9;this.size=0;this.growFactor=1.2;this.maxHeight=8192;this.emptyHigh=this.emptyLow=4294967295;this.maxAttempts=this.maxRehashAttempts=5;this.maxWidth=4096/this.entryStride;this.generation=0;this.mungedEmptyKey=-1;this.hashFunctions=d;this.allocate(4,1)}r(b,[{key:"updateHashFunctions",value:function(a){this.hashFunctions=b.generateHashFunctions(a);
this.mungedEmptyKey=-1}},{key:"tableWithMungedEmptyKey",value:function(a){for(var b=this.hashFunctions.length,c=Array(b),d=0;d<b;++d)c[d]=this.getHash(d,this.emptyLow,this.emptyHigh);d=this.mungedEmptyKey;if(-1===d)a:for(;;){for(var d=16777216*Math.random()>>>0,e=0;e<b;++e)for(var f=this.getHash(e,d,d),g=0;g<b;++g)if(c[g]===f)continue a;this.mungedEmptyKey=d;break}for(var e=this.table,f=this.emptyLow,g=this.emptyHigh,h=0;h<b;++h){var k=c[h];e[k]===f&&e[k+1]===g&&(e[k]=d,e[k+1]=d)}try{a(e)}finally{for(a=
0;a<b;++a)h=c[a],e[h]===d&&e[h+1]===d&&(e[h]=f,e[h+1]=g)}}},{key:"getHash",value:function(a,b,c){a=this.hashFunctions[a];var d=this.width,e=this.height,d=a[0].compute(b,c)%d;b=a[1].compute(b,c)%e;return this.entryStride*(b*this.width+d)}},{key:"keys",value:function(){function a(t,r){for(;;)switch(b){case 0:p=0>=m.length||void 0===m[0]?new n.Uint64:m[0],l=q.emptyLow,k=q.emptyHigh,h=q.entryStride,g=q.table,f=0,e=g.length;case 1:if(!(f<e)){b=3;break}d=g[f];c=g[f+1];if(d===l&&c===k){b=4;break}p.low=d;
p.high=c;b=5;return{value:p,done:!1};case 5:if(void 0===r){b=6;break}b=-1;throw r;case 6:case 4:case 2:f+=h;b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,c,d,e,f,g,h,k,l,p,q=this,m=arguments,r={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();r[Symbol.iterator]=function(){return this};return r}},{key:"indexOfPair",value:function(a,b){var c=this.table,d=this.emptyHigh;
if(a===this.emptyLow&&b===d)return-1;for(var d=0,e=this.hashFunctions.length;d<e;++d){var f=this.getHash(d,a,b);if(c[f]===a&&c[f+1]===b)return f}return-1}},{key:"indexOf",value:function(a){return this.indexOfPair(a.low,a.high)}},{key:"chooseAnotherEmptyKey",value:function(){for(var a=this.emptyLow,b=this.emptyHigh,c=this.table,d=this.entryStride,e=void 0,f=void 0;e=4294967296*Math.random()>>>0,f=4294967296*Math.random()>>>0,e===a&&f===b||this.hasPair(e,f););this.emptyLow=e;this.emptyHigh=f;for(var g=
0,h=c.length;g<h;g+=d)c[g]===a&&c[g+1]===b&&(c[g]=e,c[g+1]=f)}},{key:"has",value:function(a){return-1!==this.indexOf(a)}},{key:"hasPair",value:function(a,b){return-1!==this.indexOfPair(a,b)}},{key:"delete",value:function(a){a=this.indexOf(a);if(-1!==a){var b=this.table;b[a]=this.emptyLow;b[a+1]=this.emptyHigh;++this.generation;this.size--;return!0}return!1}},{key:"clearTable",value:function(){for(var a=this.table,b=this.entryStride,c=this.emptyLow,d=this.emptyHigh,e=a.length,f=0;f<e;f+=b)a[f]=c,a[f+
1]=d}},{key:"clear",value:function(){if(0===this.size)return!1;this.size=0;++this.generation;this.clearTable();return!0}},{key:"swapPending",value:function(a,b){var c=k,d=q;this.storePending(a,b);a[b]=c;a[b+1]=d}},{key:"storePending",value:function(a,b){k=a[b];q=a[b+1]}},{key:"backupPending",value:function(){f=k;p=q}},{key:"restorePending",value:function(){k=f;q=p}},{key:"tryToInsert",value:function(){for(var a=0,b=this.emptyLow,c=this.emptyHigh,d=this.maxAttempts,e=this.table,f=this.hashFunctions.length,
g=Math.floor(Math.random()*f);;){var h=this.getHash(g,k,q);this.swapPending(e,h);if(k===b&&q===c)return!0;if(++a===d)break;g=(g+Math.floor(Math.random()*(f-1))+1)%f}return!1}},{key:"allocate",value:function(a,b){var c=a*b;this.width=a;this.height=b;this.table=new Uint32Array(c*this.entryStride);this.maxAttempts=c;this.clearTable();this.capacity=c*this.loadFactor;this.mungedEmptyKey=-1}},{key:"rehash",value:function(a,b,c){this.allocate(b,c);this.updateHashFunctions(this.hashFunctions.length);b=this.emptyLow;
c=this.emptyHigh;for(var d=this.entryStride,e=0,f=a.length;e<f;e+=d){var g=a[e+1];if(a[e]!==b||g!==c)if(this.storePending(a,e),!this.tryToInsert())return!1}return!0}},{key:"grow",value:function(a){for(var b=this.table,c=this.width,d=this.height,e=this.maxWidth,f=this.maxHeight;;){var g=c*d,c=Math.min(e,Math.ceil(a/this.height));c*d<a&&(d=Math.min(f,Math.ceil(a/c)));var h=c*d;if(h<a&&h===g)throw Error("Maximum table size exceeded");for(g=0;g<this.maxRehashAttempts;++g)if(this.rehash(b,c,d))return;
a=Math.ceil(this.growFactor*a)}}},{key:"insertInternal",value:function(){++this.generation;k===this.emptyLow&&q===this.emptyHigh&&this.chooseAnotherEmptyKey();++this.size>this.capacity&&(this.backupPending(),this.grow(Math.ceil(this.growFactor*this.width*this.height)),this.restorePending());for(;!this.tryToInsert();)this.backupPending(),this.grow(this.width*this.height),this.restorePending()}}],[{key:"generateHashFunctions",value:function(){for(var a=0>=arguments.length||void 0===arguments[0]?c.NUM_ALTERNATIVES:
arguments[0],b=[],d=0;d<a;++d){var e=[v.HashFunction.generate(),v.HashFunction.generate()];b.push(e)}return b}}]);return b}();c.HashTableBase=g;e=function(c){function d(){a(this,d);return l(this,Object.getPrototypeOf(d).apply(this,arguments))}b(d,c);$jscomp.initSymbol();$jscomp.initSymbolIterator();r(d,[{key:"add",value:function(a){var b=a.low;a=a.high;if(this.hasPair(b,a))return!1;k=b;q=a;this.insertInternal();return!0}},{key:Symbol.iterator,value:function(){return this.keys()}}]);return d}(g);c.HashSetUint64=
e;e.prototype.entryStride=2;var h=0,u=0,A=0,B=0;g=function(c){function e(){a(this,e);return l(this,Object.getPrototypeOf(e).apply(this,arguments))}b(e,c);$jscomp.initSymbol();$jscomp.initSymbolIterator();r(e,[{key:"set",value:function(a,b){var c=a.low,d=a.high;if(this.hasPair(c,d))return!1;k=c;q=d;h=b.low;u=b.high;this.insertInternal();return!0}},{key:"get",value:function(a,b){var c=this.indexOf(a);if(-1===c)return!1;var d=this.table;b.low=d[c+2];b.high=d[c+3];return!0}},{key:"swapPending",value:function(a,
b){var c=h,d=u;m(Object.getPrototypeOf(e.prototype),"swapPending",this).call(this,a,b);a[b+2]=c;a[b+3]=d}},{key:"storePending",value:function(a,b){m(Object.getPrototypeOf(e.prototype),"storePending",this).call(this,a,b);h=a[b+2];u=a[b+3]}},{key:"backupPending",value:function(){m(Object.getPrototypeOf(e.prototype),"backupPending",this).call(this);A=h;B=u}},{key:"restorePending",value:function(){m(Object.getPrototypeOf(e.prototype),"restorePending",this).call(this);h=A;u=B}},{key:Symbol.iterator,value:function(){return this.entries()}},
{key:"entries",value:function(){function a(z,B){for(;;)switch(b){case 0:r=0>=x.length||void 0===x[0]?[new n.Uint64,new n.Uint64]:x[0],t=u.emptyLow,m=u.emptyHigh,q=u.entryStride,p=u.table,l=d(r,2),k=l[0],h=l[1],g=0,f=p.length;case 1:if(!(g<f)){b=3;break}e=p[g];c=p[g+1];if(e===t&&c===m){b=4;break}k.low=e;k.high=c;h.low=p[g+2];h.high=p[g+3];b=5;return{value:r,done:!1};case 5:if(void 0===B){b=6;break}b=-1;throw B;case 6:case 4:case 2:g+=q;b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=
0,c,e,f,g,h,k,l,p,q,m,t,r,u=this,x=arguments,B={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();B[Symbol.iterator]=function(){return this};return B}}]);return e}(g);c.HashMapUint64=g;g.prototype.entryStride=4},function(g,c){c.hsvToRgb=function(c,g,b,a){g*=6;var d=Math.floor(g),m=g-d;g=a*(1-b);var r=a*(1-b*m);b=a*(1-b*(1-m));switch(d%6){case 0:c[0]=a;c[1]=b;c[2]=g;break;case 1:c[0]=r;c[1]=
a;c[2]=g;break;case 2:c[0]=g;c[1]=a;c[2]=b;break;case 3:c[0]=g;c[1]=r;c[2]=a;break;case 4:c[0]=b;c[1]=g;c[2]=a;break;case 5:c[0]=a,c[1]=g,c[2]=r}return c}},function(g,c,e){function l(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var b=function(){function a(b,
c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),a=function p(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:p(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)};g=this&&this.__decorate||function(a,b,c,
d){var e=arguments.length,g=3>e?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d,k;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var l=a.length-1;0<=l;l--)if(k=a[l])g=(3>e?k(g):3<e?k(b,c,g):k(b,c))||g;return 3<e&&g&&Object.defineProperty(b,c,g),g};var d=e(125),m=e(8),r=e(52),v=e(22),n=e(34);e=function(c){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");for(var a=arguments.length,b=Array(a),c=
0;c<a;c++)b[c]=arguments[c];var g,a=(g=Object.getPrototypeOf(e)).call.apply(g,[].concat([this],$jscomp.arrayFromIterable(b)));if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");g=!a||"object"!==typeof a&&"function"!==typeof a?this:a;g.disjointSets=new d.DisjointUint64Sets;g.changed=new n.Signal;return g}l(e,c);b(e,[{key:"disposed",value:function(){this.changed=this.disjointSets=void 0;a(Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}},{key:"link",
value:function(a,b){if(this.disjointSets.link(a,b)){var c=this.rpc;c&&c.invoke("DisjointUint64Sets.add",{id:this.rpcId,al:a.low,ah:a.high,bl:b.low,bh:b.high});this.changed.dispatch()}}},{key:"get",value:function(a){return this.disjointSets.get(a)}},{key:"clear",value:function(){if(this.disjointSets.clear()){var a=this.rpc;a&&a.invoke("DisjointUint64Sets.clear",{id:this.rpcId});this.changed.dispatch()}}},{key:"setElements",value:function(a){return this.disjointSets.setElements(a)}},{key:"toJSON",value:function(){return this.disjointSets.toJSON()}},
{key:"restoreState",value:function(a){var b=this;this.clear();void 0!==a&&function(){var c=[new r.Uint64,new r.Uint64];m.parseArray(a,function(a){m.parseArray(a,function(a,d){c[d%2].parseString(String(a),10);0!==d&&b.link(c[0],c[1])})})}()}},{key:"size",get:function(){return this.disjointSets.size}}],[{key:"makeWithCounterpart",value:function(a){var b=new this;b.initializeCounterpart(a);return b}}]);return e}(v.SharedObjectCounterpart);e=g([v.registerSharedObject("DisjointUint64Sets")],e);c.SharedDisjointUint64Sets=
e;var k=new r.Uint64,q=new r.Uint64;v.registerRPC("DisjointUint64Sets.add",function(a){var b=this.get(a.id);k.low=a.al;k.high=a.ah;q.low=a.bl;q.high=a.bh;b.disjointSets.link(k,q)&&b.changed.dispatch()});v.registerRPC("DisjointUint64Sets.clear",function(a){a=this.get(a.id);a.disjointSets.clear()&&a.changed.dispatch()})},function(g,c,e){function l(a){for(var b=a,c=a[r];c!==a;)a=c,c=a[r];for(a=b[r];c!==a;)b[r]=c,b=a,a=b[r];return c}function b(a){function b(f,g){for(;;)switch(c){case 0:e=!0,d=a;case 1:if(!e&&
d===a){c=3;break}c=4;return{value:d,done:!1};case 4:if(void 0===g){c=5;break}c=-1;throw g;case 5:d=d[v];case 2:e=!1;c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,d,e,g={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||
!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),d=e(52);$jscomp.initSymbol();var m=Symbol("disjoint_sets:rank");$jscomp.initSymbol();var r=Symbol("disjoint_sets:parent");$jscomp.initSymbol();var v=Symbol("disjoint_sets:next");$jscomp.initSymbol();var n=Symbol("disjoint_sets:prev");$jscomp.initSymbol();var k=Symbol("disjoint_sets:min");g=function(){function c(){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");
this.map=new Map;this.generation=0}$jscomp.initSymbol();$jscomp.initSymbolIterator();a(c,[{key:"get",value:function(a){var b=this.map.get(a.toString());return void 0===b?a:l(b)[k]}},{key:"isMinElement",value:function(a){var b=this.get(a);return b===a||d.Uint64.equal(b,a)}},{key:"makeSet",value:function(a){var b=a.toString(),c=this.map,d=c.get(b);return void 0===d?(a=d=a.clone(),a[r]=a,a[m]=0,a[v]=a[n]=a,d[k]=d,c.set(b,d),d):l(d)}},{key:"link",value:function(a,b){a=this.makeSet(a);b=this.makeSet(b);
if(a===b)return!1;this.generation++;var c;c=a;var e=b,g=c[m],l=e[m];g>l?e[r]=c:(c[r]=e,g===l&&(e[m]=l+1),c=e);var e=a,g=b,l=e[n],q=g[n];g[n]=l;l[v]=g;e[n]=q;q[v]=e;e=a[k];g=b[k];c[k]=d.Uint64.less(e,g)?e:g;return!0}},{key:"setElements",value:function(a){function c(p,q){for(;;)switch(d){case 0:l=a.toString();k=n.map.get(l);if(void 0!==k){d=1;break}d=3;return{value:a,done:!1};case 3:if(void 0===q){d=4;break}d=-1;throw q;case 4:d=2;break;case 1:g=$jscomp.makeIterator(b(k));case 5:if((e=g.next(p)).done){d=
6;break}d=7;return{value:e.value,done:!1};case 7:if(void 0===q){d=8;break}d=-1;throw q;case 8:d=5;break;case 6:case 2:d=-1;default:return{value:void 0,done:!0}}}var d=0,e,g,k,l,n=this,q={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();q[Symbol.iterator]=function(){return this};return q}},{key:"clear",value:function(){var a=this.map;if(0===a.size)return!1;++this.generation;a.clear();return!0}},
{key:"mappings",value:function(){function a(f,m){for(;;)switch(b){case 0:g=0>=q.length||void 0===q[0]?Array(2):q[0],e=$jscomp.makeIterator(n.map.values()),d=e.next();case 1:if(d.done){b=3;break}c=d.value;g[0]=c;g[1]=l(c)[k];b=4;return{value:g,done:!1};case 4:if(void 0===m){b=5;break}b=-1;throw m;case 5:case 2:d=e.next();b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,c,d,e,g,n=this,q=arguments,m={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");
}};$jscomp.initSymbolIterator();m[Symbol.iterator]=function(){return this};return m}},{key:Symbol.iterator,value:function(){return this.mappings()}},{key:"toJSON",value:function(){for(var a=[],c=$jscomp.makeIterator(this.map.values()),e=c.next();!e.done;e=c.next()){var g=e.value;if(g[r]===g){for(var e=[],g=$jscomp.makeIterator(b(g)),k=g.next();!k.done;k=g.next())e.push(k.value);e.sort(d.Uint64.compare);a.push(e)}}a.sort(function(a,b){return d.Uint64.compare(a[0],b[0])});return a.map(function(a){return a.map(function(a){return a.toString()})})}},
{key:"size",get:function(){return this.map.size}}]);return c}();c.DisjointUint64Sets=g},function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});
b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var d=function C(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:C(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},m=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||
!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),r=e(31);g=e(32);var v=e(36),n=e(74),k=e(127),q=e(128),f=e(23),p=e(9),h=e(8),u=e(38),A=e(41),B=e(71),y=e(34),x=function(){function b(){a(this,b);this.tempMat=p.mat4.create();this.tempPickID=new Float32Array(4)}m(b,[{key:"defineShader",value:function(a){a.addAttribute("highp vec3","aVertexPosition");a.addUniform("highp vec3","uColor");a.addUniform("highp mat4",
"uProjection");a.addUniform("highp vec4","uPickID");a.setVertexMain("gl_Position = uProjection * vec4(aVertexPosition, 1.0);");a.setFragmentMain("emit(vec4(uColor, 1.0), uPickID);")}},{key:"beginLayer",value:function(a,b,c,d){c=p.mat4.multiply(this.tempMat,c.dataToDevice,d);a.uniformMatrix4fv(b.uniform("uProjection"),!1,c)}},{key:"getShader",value:function(a,b,c){var d=this;return a.memoize.get(b,function(){var b=new A.ShaderBuilder(a);b.require(c);d.defineShader(b);return b.build()})}},{key:"setColor",
value:function(a,b,c){a.uniform3fv(b.uniform("uColor"),c)}},{key:"drawSkeleton",value:function(a,b,c,d){a.uniform4fv(b.uniform("uPickID"),B.setVec4FromUint32(this.tempPickID,d));c.vertexBuffer.bindToVertexAttrib(b.attribute("aVertexPosition"),3);c.indexBuffer.bind();a.drawElements(a.LINES,c.numIndices,a.UNSIGNED_INT,0)}},{key:"endLayer",value:function(a,b){a.disableVertexAttribArray(b.attribute("aVertexPosition"))}}]);return b}();e=function(c){function d(b){a(this,d);var c=l(this,Object.getPrototypeOf(d).call(this));
c.base=b;c.shader=c.base.skeletonShaderManager.getShader(c.gl,"skeleton/SkeletonShaderManager:PerspectivePanel",v.perspectivePanelEmit);c.registerDisposer(b);c.registerSignalBinding(b.redrawNeeded.add(function(){c.redrawNeeded.dispatch()}));c.setReady(!0);return c}b(d,c);m(d,[{key:"draw",value:function(a){this.base.draw(a,this,this.shader,1>=arguments.length||void 0===arguments[1]?!1:arguments[1])}},{key:"drawPicking",value:function(a){this.base.draw(a,this,this.shader,!0)}},{key:"gl",get:function(){return this.base.gl}}]);
return d}(v.PerspectiveViewRenderLayer);c.PerspectiveViewSkeletonLayer=e;e=function(c){function d(b){a(this,d);var c=l(this,Object.getPrototypeOf(d).call(this));c.base=b;c.shader=c.base.skeletonShaderManager.getShader(c.gl,"skeleton/SkeletonShaderManager:SliceViewPanel",q.sliceViewPanelEmit);c.registerDisposer(b);c.registerSignalBinding(b.redrawNeeded.add(function(){c.redrawNeeded.dispatch()}));c.setReady(!0);return c}b(d,c);m(d,[{key:"draw",value:function(a){this.base.draw(a,this,this.shader,!1,
10)}},{key:"gl",get:function(){return this.base.gl}}]);return d}(q.SliceViewPanelRenderLayer);c.SliceViewPanelSkeletonLayer=e;f=function(c){function d(b,c,e,f){a(this,d);var g=l(this,Object.getPrototypeOf(d).call(this));g.chunkManager=b;g.source=c;g.voxelSizeObject=e;g.displayState=f;g.tempMat=p.mat4.create();g.skeletonShaderManager=new x;g.redrawNeeded=new y.Signal;n.registerRedrawWhenSegmentationDisplayStateChanged(f,g);b=g.registerDisposer(new n.SegmentationLayerSharedObject(b,f));b.RPC_TYPE_ID=
k.SKELETON_LAYER_RPC_ID;b.initializeCounterpartWithChunkManager({source:c.addCounterpartRef()});return g}b(d,c);m(d,[{key:"draw",value:function(a,b,c){var d=3>=arguments.length||void 0===arguments[3]?!1:arguments[3],e=arguments[4];void 0===e&&(e=d?5:1);var f=this.gl,g=this.skeletonShaderManager;c.bind();var h=this.tempMat;p.mat4.identity(h);p.mat4.scale(h,h,this.voxelSizeObject.size);g.beginLayer(f,c,a,h);var h=this.source.chunks,k=a.pickIDs,l=this.displayState;f.lineWidth(e);n.forEachSegmentToDraw(l,
h,function(a,e,h){h.state===r.ChunkState.GPU_MEMORY&&(d||g.setColor(f,c,n.getObjectColor(l,a)),g.drawSkeleton(f,c,h,k.register(b,e)))});g.endLayer(f,c)}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}]);return d}(f.RefCounted);c.SkeletonLayer=f;var t=function(c){function e(b,c){a(this,e);var d=l(this,Object.getPrototypeOf(e).call(this,b));d.data=c.data;return d}b(e,c);m(e,[{key:"copyToGPU",value:function(a){d(Object.getPrototypeOf(e.prototype),"copyToGPU",this).call(this,
a);var b=this.data,c=(new DataView(b.buffer)).getInt32(0,!0),f=new Float32Array(b.buffer,4,3*c),b=new Uint32Array(b.buffer,12*c+4);this.vertexBuffer=u.Buffer.fromData(a,f,a.ARRAY_BUFFER,a.STATIC_DRAW);this.indexBuffer=u.Buffer.fromData(a,b,a.ELEMENT_ARRAY_BUFFER,a.STATIC_DRAW);this.numIndices=b.length}},{key:"freeGPUMemory",value:function(a){d(Object.getPrototypeOf(e.prototype),"freeGPUMemory",this).call(this,a);this.vertexBuffer.dispose();this.indexBuffer.dispose()}}]);return e}(g.Chunk);c.SkeletonChunk=
t;g=function(c){function d(){a(this,d);return l(this,Object.getPrototypeOf(d).apply(this,arguments))}b(d,c);m(d,[{key:"getChunk",value:function(a){return new t(this,a)}}]);return d}(g.ChunkSource);c.SkeletonSource=g;var z=function(c){function e(b,c){a(this,e);var d=l(this,Object.getPrototypeOf(e).call(this,b));d.parameters=c;return d}b(e,c);m(e,[{key:"initializeCounterpart",value:function(a,b){b.parameters=this.parameters;d(Object.getPrototypeOf(e.prototype),"initializeCounterpart",this).call(this,
a,b)}}]);return e}(g);c.ParameterizedSkeletonSource=z;c.parameterizedSkeletonSource=function(c){var d=function(d){function e(){a(this,e);return l(this,Object.getPrototypeOf(e).apply(this,arguments))}b(e,d);m(e,[{key:"toString",value:function(){return c.stringify(this.parameters)}}],[{key:"get",value:function(a,b){var c=this;return a.getChunkSource(this,h.stableStringify(b),function(){return new c(a,b)})}}]);return e}(z);d.prototype.RPC_TYPE_ID=c.RPC_ID;return d}},function(g,c){c.SKELETON_LAYER_RPC_ID=
"skeleton/SkeletonLayer"},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,
enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function d(a){a.addFragmentExtension("GL_EXT_draw_buffers");a.addFragmentCode("\nvoid emit(vec4 color, vec4 pickId) {\n  gl_FragData["+y.COLOR+"] = color;\n  gl_FragData["+y.PICK+"] = pickId;\n}\n")}var m=function z(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:z(a,b,c);if("value"in d)return d.value;
b=d.get;return void 0===b?void 0:b.call(c)},r=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),v=e(37),n=e(42),k=e(53);g=e(54);var q=e(59),f=e(69),p=e(9),h=e(70),u=e(67),A=e(129),B=e(34);(function(a){a[a.COLOR=0]="COLOR";a[a.PICK=1]="PICK";a[a.NUM_TEXTURES=2]="NUM_TEXTURES"})(c.OffscreenTextures||(c.OffscreenTextures=
{}));var y=c.OffscreenTextures;c.sliceViewPanelEmit=d;var x=function(c){function d(){l(this,d);for(var a=arguments.length,c=Array(a),e=0;e<a;e++)c[e]=arguments[e];var f,a=b(this,(f=Object.getPrototypeOf(d)).call.apply(f,[].concat([this],$jscomp.arrayFromIterable(c))));a.redrawNeeded=new B.Signal;return a}a(d,c);r(d,[{key:"draw",value:function(a){}}]);return d}(n.RenderLayer);c.SliceViewPanelRenderLayer=x;e=function(c){function e(a,c,g,h){l(this,e);var m=b(this,Object.getPrototypeOf(e).call(this,a,
c,h));m.sliceView=g;m.axesLineHelper=v.AxesLineHelper.get(m.gl);m.sliceViewRenderHelper=q.SliceViewRenderHelper.get(m.gl,"SliceViewRenderHelper",d);m.colorFactor=p.vec4.fromValues(1,1,1,1);m.backgroundColor=p.vec4.fromValues(.5,.5,.5,1);m.pickIDs=new k.PickIDManager;m.visibleLayerTracker=m.registerDisposer(new n.VisibleRenderLayerTracker(m.viewer.layerManager,x,function(a){a.redrawNeeded.add(m.scheduleRedraw,m);m.scheduleRedraw()},function(a){a.redrawNeeded.remove(m.scheduleRedraw,m);m.scheduleRedraw()}));
m.offscreenFramebuffer=new u.OffscreenFramebuffer(m.gl,{numDataBuffers:y.NUM_TEXTURES});m.offscreenCopyHelper=u.OffscreenCopyHelper.get(m.gl);m.scaleBarWidget=m.registerDisposer(new A.ScaleBarWidget);m.registerDisposer(g);m.registerSignalBinding(g.viewChanged.add(a.scheduleRedraw,a));m.registerSignalBinding(h.showAxisLines.changed.add(function(){m.scheduleRedraw()}));a=m.scaleBarWidget.element;m.registerDisposer(new f.ElementVisibilityFromTrackableBoolean(h.showScaleBar,a));m.element.appendChild(a);
return m}a(e,c);r(e,[{key:"draw",value:function(){var a=this.sliceView;if(a.hasValidViewport){a.updateRendering();var b=this.gl,c=a.width,d=a.height,e=a.dataToDevice;this.offscreenFramebuffer.bind(c,d);b.disable(b.SCISSOR_TEST);this.gl.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT);var f=p.mat4.create();this.sliceViewRenderHelper.draw(a.offscreenFramebuffer.dataTextures[0],p.identityMat4,this.colorFactor,this.backgroundColor,0,0,1,1);var g=this.visibleLayerTracker.getVisibleLayers(),h=this.pickIDs;
h.clear();for(var h={dataToDevice:a.dataToDevice,pickIDs:h},g=$jscomp.makeIterator(g),k=g.next();!k.done;k=g.next())k.value.draw(h);if(this.viewer.showAxisLines.value){p.mat4.copy(f,e);for(e=0;3>e;++e)f[12+e]=0;for(e=0;4>e;++e)f[2+4*e]=0;d=Math.min(c,d)/4*1.5;e=a.pixelSize;for(h=0;12>h;++h)f[h]=f[h]*d*e;b.WEBGL_draw_buffers.drawBuffersWEBGL([b.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL]);this.axesLineHelper.draw(f)}this.offscreenFramebuffer.unbind();this.setGLViewport();this.offscreenCopyHelper.draw(this.offscreenFramebuffer.dataTextures[y.COLOR]);
b=this.scaleBarWidget;f=b.dimensions;f.targetLengthInPixels=Math.min(c/4,100);f.nanometersPerPixel=a.pixelSize;b.update()}}},{key:"onResize",value:function(){this.sliceView.setViewportSize(this.element.clientWidth,this.element.clientHeight)}},{key:"updateMouseState",value:function(a){a.pickedRenderLayer=null;var b=this.sliceView;if(!b.hasValidViewport)return!1;var c=b.width,d=b.height,e=this.offscreenFramebuffer;if(!e.hasSize(c,d))return!1;var f=a.position,g=this.mouseX,h=this.mouseY;p.vec3.set(f,
g-c/2,h-d/2,0);p.vec3.transformMat4(f,f,b.viewportToData);this.pickIDs.setMouseState(a,e.readPixelAsUint32(y.PICK,g,d-h));return!0}},{key:"onMousedown",value:function(a){var b=this;a.target===this.element&&(m(Object.getPrototypeOf(e.prototype),"onMousedown",this).call(this,a),this.sliceView.hasValidViewport&&0===a.button&&this.viewer.mouseState.updateUnconditionally()&&function(){var c=p.vec3.clone(b.viewer.mouseState.position);h.startRelativeMouseDrag(a,function(a,d,e){var f=b.viewer.navigationState.position;
a.shiftKey?(f=b.sliceView.viewportAxes,b.viewer.navigationState.pose.rotateAbsolute(f[1],d/4*Math.PI/180,c),b.viewer.navigationState.pose.rotateAbsolute(f[0],e/4*Math.PI/180,c)):(a=f.spatialCoordinates,p.vec3.set(a,d,e,0),p.vec3.transformMat4(a,a,b.sliceView.viewportToData),f.changed.dispatch())})}())}},{key:"zoomByMouse",value:function(a){var b=this.navigationState;if(b.valid){var c=this.sliceView,d=c.height,e=this.mouseX,f=this.mouseY,e=e-c.width/2,f=f-d/2,d=this.navigationState.zoomFactor.value;
b.zoomBy(a);a=b.zoomFactor.value;var g=b.position.spatialCoordinates;p.vec3.scaleAndAdd(g,g,c.viewportAxes[0],e*(d-a));p.vec3.scaleAndAdd(g,g,c.viewportAxes[1],f*(d-a));b.position.changed.dispatch()}}},{key:"navigationState",get:function(){return this.sliceView.navigationState}}]);return e}(g.RenderedDataPanel);c.SliceViewPanel=e},function(g,c,e){function l(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=
Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();
g=e(23);var d=e(7);e(130);var m=[1.5,2,3,5,7.5,10],r=[{unit:"km",lengthInNanometers:1E12},{unit:"m",lengthInNanometers:1E9},{unit:"mm",lengthInNanometers:1E6},{unit:"\u00b5m",lengthInNanometers:1E3},{unit:"nm",lengthInNanometers:1},{unit:"pm",lengthInNanometers:.001}],v=function(){function c(){b(this,c);this.allowedSignificands=m;this.prevTargetLengthInPixels=this.prevNanometersPerPixel=0}a(c,[{key:"update",value:function(){var a=this.nanometersPerPixel,b=this.targetLengthInPixels;if(this.prevNanometersPerPixel===
a&&this.prevTargetLengthInPixels===b)return!1;this.prevNanometersPerPixel=a;this.prevTargetLengthInPixels=b;for(var c=b*a,b=Math.pow(10,Math.floor(Math.log(c)/Math.LN10)),c=c/b,d=1,e=$jscomp.makeIterator(this.allowedSignificands),g=e.next();!g.done;g=e.next())if(g=g.value,Math.abs(g-c)<Math.abs(d-c))d=g;else break;b*=d;c=r.length;d=r[c-1];for(e=0;e<c;++e)if(g=r[e],b>=g.lengthInNanometers){d=g;break}this.lengthInPixels=Math.round(b/a);this.physicalUnit=d.unit;this.physicalLength=b/d.lengthInNanometers;
return!0}}]);return c}();c.ScaleBarDimensions=v;e=function(c){function e(){var a=0>=arguments.length||void 0===arguments[0]?new v:arguments[0];b(this,e);var c;c=Object.getPrototypeOf(e).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c.dimensions=a;c.element=document.createElement("div");c.textNode=document.createTextNode("");c.barElement=document.createElement("div");var a=c.element,
d=c.textNode,g=c.barElement;a.className="scale-bar-container";a.appendChild(d);a.appendChild(g);g.className="scale-bar";return c}l(e,c);a(e,[{key:"update",value:function(){var a=this.dimensions;a.update()&&(this.textNode.textContent=a.physicalLength+" "+a.physicalUnit,this.barElement.style.width=a.lengthInPixels+"px")}},{key:"disposed",value:function(){d.removeFromParent(this.element)}}]);return e}(g.RefCounted);c.ScaleBarWidget=e},function(g,c){},function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var d=function A(a,b,c){null===a&&
(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:A(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},m=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done)&&(c.push(h.value),
!b||c.length!==b);d=!0);}catch(k){e=!0,f=k}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),r=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),v=e(122),n=e(121),k=e(119),q=e(74),f=e(65),p=new Float32Array(8),
h=function(){function b(c){a(this,b);this.disjointSets=c;this.generation=Number.NaN;this.hashMap=new v.HashMapUint64}r(b,[{key:"update",value:function(){var a=this.disjointSets,b=a.generation;if(this.generation!==b){this.generation=b;b=this.hashMap;b.clear();for(var a=$jscomp.makeIterator(a.mappings()),c=a.next();!c.done;c=a.next())c=m(c.value,2),b.set(c[0],c[1])}}}]);return b}();c.EquivalencesHashMap=h;g=function(c){function e(b,c,d){var g=3>=arguments.length||void 0===arguments[3]?f.trackableAlphaValue(.5):
arguments[3],p=4>=arguments.length||void 0===arguments[4]?f.trackableAlphaValue(0):arguments[4];a(this,e);var m=l(this,Object.getPrototypeOf(e).call(this,b,c));m.displayState=d;m.selectedAlpha=g;m.notSelectedAlpha=p;m.segmentColorShaderManager=new k.SegmentColorShaderManager("segmentColorHash");m.hashTableManager=new n.HashSetShaderManager("visibleSegments");m.gpuHashTable=n.GPUHashTable.get(m.gl,m.displayState.visibleSegments.hashTable);m.equivalencesShaderManager=new n.HashMapShaderManager("equivalences");
m.equivalencesHashMap=new h(m.displayState.segmentEquivalences.disjointSets);m.gpuEquivalencesHashTable=n.GPUHashTable.get(m.gl,m.equivalencesHashMap.hashMap);q.registerRedrawWhenSegmentationDisplayStateChanged(d,m);m.registerSignalBinding(g.changed.add(function(){m.redrawNeeded.dispatch()}));m.hasEquivalences=0!==m.displayState.segmentEquivalences.size;d.segmentEquivalences.changed.add(function(){var a=0!==m.displayState.segmentEquivalences.size;a!==m.hasEquivalences&&(m.hasEquivalences=a,m.shaderUpdated=
!0)});m.registerSignalBinding(p.changed.add(function(){m.redrawNeeded.dispatch()}));return m}b(e,c);r(e,[{key:"getShaderKey",value:function(){return"sliceview.SegmentationRenderLayer/"+this.hasEquivalences}},{key:"defineShader",value:function(a){d(Object.getPrototypeOf(e.prototype),"defineShader",this).call(this,a);this.hashTableManager.defineShader(a);a.addFragmentCode("\nuint64_t getUint64DataValue() {\n  return toUint64(getDataValue());\n}\n");this.hasEquivalences?(this.equivalencesShaderManager.defineShader(a),
a.addFragmentCode("\nuint64_t getMappedObjectId() {\n  uint64_t value = getUint64DataValue();\n  uint64_t mappedValue;\n  if ("+this.equivalencesShaderManager.getFunctionName+"(value, mappedValue)) {\n    return mappedValue;\n  }\n  return value;\n}\n")):a.addFragmentCode("\nuint64_t getMappedObjectId() {\n  return getUint64DataValue();\n}\n");this.segmentColorShaderManager.defineShader(a);a.addUniform("highp vec4","uSelectedSegment",2);a.addUniform("highp float","uShowAllSegments");a.addUniform("highp float",
"uSelectedAlpha");a.addUniform("highp float","uNotSelectedAlpha");a.setFragmentMain("\n  uint64_t value = getMappedObjectId();\n  \n  float alpha = uSelectedAlpha;\n  float saturation = 1.0;\n  if (value.low == vec4(0,0,0,0) && value.high == vec4(0,0,0,0)) {\n    emit(vec4(vec4(0, 0, 0, 0)));\n    return;\n  }\n  bool has = uShowAllSegments > 0.0 ? true : "+this.hashTableManager.hasFunctionName+"(value);\n  if (uSelectedSegment[0] == value.low && uSelectedSegment[1] == value.high) {\n    saturation = has ? 0.5 : 0.75;\n  } else if (!has) {\n    alpha = uNotSelectedAlpha;\n  }\n  vec3 rgb = segmentColorHash(value);\n  emit(vec4(mix(vec3(1.0,1.0,1.0), rgb, saturation), alpha));\n")}},
{key:"beginSlice",value:function(a){a=d(Object.getPrototypeOf(e.prototype),"beginSlice",this).call(this,a);var b=this.gl,c=this.displayState,f=this.displayState,g=f.segmentSelectionState,f=f.visibleSegments;if(g.hasSelectedSegment)for(var h=g.selectedSegment,g=h.low,h=h.high,k=0;4>k;++k)p[k]=(g>>8*k&255)/255,p[4+k]=(h>>8*k&255)/255;else p.fill(0);b.uniform1f(a.uniform("uSelectedAlpha"),this.selectedAlpha.value);b.uniform1f(a.uniform("uNotSelectedAlpha"),this.notSelectedAlpha.value);b.uniform4fv(a.uniform("uSelectedSegment"),
p);b.uniform1f(a.uniform("uShowAllSegments"),f.hashTable.size?0:1);this.hashTableManager.enable(b,a,this.gpuHashTable);this.hasEquivalences&&(this.equivalencesHashMap.update(),this.equivalencesShaderManager.enable(b,a,this.gpuEquivalencesHashTable));this.segmentColorShaderManager.enable(b,a,c.segmentColorHash);return a}},{key:"endSlice",value:function(a){this.hashTableManager.disable(this.gl,a);d(Object.getPrototypeOf(e.prototype),"endSlice",this).call(this,a)}}]);return e}(f.RenderLayer);c.SegmentationRenderLayer=
g},function(g,c,e){function l(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var b=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,
e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),a=function k(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:k(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)};g=this&&this.__decorate||function(a,b,c,d){var e=arguments.length,g=3>e?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d,l;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)g=
Reflect.decorate(a,b,c,d);else for(var m=a.length-1;0<=m;m--)if(l=a[m])g=(3>e?l(g):3<e?l(b,c,g):l(b,c))||g;return 3<e&&g&&Object.defineProperty(b,c,g),g};var d=e(122),m=e(22),r=e(34),v=function(c){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];var g,a=(g=Object.getPrototypeOf(e)).call.apply(g,[].concat([this],$jscomp.arrayFromIterable(b)));if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
g=!a||"object"!==typeof a&&"function"!==typeof a?this:a;g.hashTable=new d.HashSetUint64;g.changed=new r.Signal;return g}l(e,c);$jscomp.initSymbol();$jscomp.initSymbolIterator();b(e,[{key:"disposed",value:function(){a(Object.getPrototypeOf(e.prototype),"disposed",this).call(this);this.changed=this.hashTable=void 0}},{key:"add_",value:function(a){return this.hashTable.add(a)}},{key:"add",value:function(a){if(this.add_(a)){var b=this.rpc;b&&b.invoke("Uint64Set.add",{id:this.rpcId,value:a});this.changed.dispatch(a,
!0)}}},{key:"has",value:function(a){return this.hashTable.has(a)}},{key:Symbol.iterator,value:function(){return this.hashTable.keys()}},{key:"delete_",value:function(a){return this.hashTable.delete(a)}},{key:"delete",value:function(a){if(this.delete_(a)){var b=this.rpc;b&&b.invoke("Uint64Set.delete",{id:this.rpcId,value:a});this.changed.dispatch(a,!1)}}},{key:"clear",value:function(){if(this.hashTable.clear()){var a=this.rpc;a&&a.invoke("Uint64Set.clear",{id:this.rpcId});this.changed.dispatch(null,
!1)}}},{key:"toJSON",value:function(){for(var a=[],b=$jscomp.makeIterator(this),c=b.next();!c.done;c=b.next())a.push(c.value.toString());return a}},{key:"size",get:function(){return this.hashTable.size}}],[{key:"makeWithCounterpart",value:function(a){var b=new v;b.initializeCounterpart(a);return b}}]);return e}(m.SharedObjectCounterpart);e=v;e=v=g([m.registerSharedObject("Uint64Set")],e);c.Uint64Set=e;m.registerRPC("Uint64Set.add",function(a){var b=this.get(a.id);b.add_(a.value)&&b.changed.dispatch()});
m.registerRPC("Uint64Set.delete",function(a){var b=this.get(a.id);b.delete_(a.value)&&b.changed.dispatch()});m.registerRPC("Uint64Set.clear",function(a){a=this.get(a.id);a.hashTable.clear()&&a.changed.dispatch()})},function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),d=function n(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,
b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:n(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)};g=e(23);var m=e(52);e(72);e(134);var r=new m.Uint64;e=function(c){function e(a){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var b=l(this,Object.getPrototypeOf(e).call(this));b.displayState=a;b.element=document.createElement("div");b.clearButton=document.createElement("button");b.itemContainer=document.createElement("span");
b.items=new Map;var c=b.element,d=b.clearButton,g=b.itemContainer;c.className="segment-set-widget noselect";d.className="clear-button";d.title="Remove all segment IDs";b.registerEventListener(d,"click",function(){b.visibleSegments.clear()});g.className="item-container";c.appendChild(g);g.appendChild(d);b.registerSignalBinding(a.visibleSegments.changed.add(b.handleSetChanged,b));b.registerSignalBinding(a.segmentColorHash.changed.add(b.handleColorChanged,b));a=$jscomp.makeIterator(a.visibleSegments);
for(c=a.next();!c.done;c=a.next())b.addElement(c.value.toString());b.updateClearButtonVisibility();return b}b(e,c);a(e,[{key:"updateClearButtonVisibility",value:function(){this.clearButton.style.display=0<this.displayState.visibleSegments.size?"":"none"}},{key:"handleSetChanged",value:function(a,b){this.updateClearButtonVisibility();var c=this.items;if(null===a){for(var d=this.itemContainer,e=this.clearButton;;){var g=d.lastElementChild;if(g===e)break;d.removeChild(g)}c.clear()}else b?this.addElement(a.toString()):
(d=a.toString(),e=c.get(d),e.parentElement.removeChild(e),c.delete(d))}},{key:"addElement",value:function(a){var b=document.createElement("button");b.className="segment-button";b.textContent=a;b.title="Remove segment ID "+a;var c=this;b.addEventListener("click",function(){r.tryParseString(this.textContent);c.visibleSegments.delete(r)});b.addEventListener("mouseenter",function(){r.tryParseString(this.textContent);c.segmentSelectionState.set(r)});b.addEventListener("mouseleave",function(){r.tryParseString(this.textContent);
c.segmentSelectionState.set(null)});this.setItemColor(b);this.itemContainer.appendChild(b);this.items.set(a,b)}},{key:"setItemColor",value:function(a){r.tryParseString(a.textContent);a.style.backgroundColor=this.segmentColorHash.computeCssColor(r)}},{key:"handleColorChanged",value:function(){var a=this;this.items.forEach(function(b){a.setItemColor(b)})}},{key:"disposed",value:function(){var a=this.element,b=a.parentElement;b&&b.removeChild(a);d(Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}},
{key:"visibleSegments",get:function(){return this.displayState.visibleSegments}},{key:"segmentColorHash",get:function(){return this.displayState.segmentColorHash}},{key:"segmentSelectionState",get:function(){return this.displayState.segmentSelectionState}}]);return e}(g.RefCounted);c.SegmentSetWidget=e},function(g,c){},function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}
function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,
c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),d=function k(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:k(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)};g=e(23);var m=e(7),r=e(52),v=e(34);e(72);e(136);e=function(c){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var a=l(this,Object.getPrototypeOf(e).call(this));a.element=
document.createElement("form");a.label=document.createElement("label");a.input=document.createElement("input");a.value=new r.Uint64;a.valueEntered=new v.Signal;var b=a.element,c=a.label,d=a.input;b.className="uint64-entry noselect";b.appendChild(c);c.appendChild(d);a.registerEventListener(b,"submit",function(b){b.preventDefault();a.validateInput()&&(a.input.value="",a.input.classList.remove("valid-input","invalid-input"),a.valueEntered.dispatch(a.value))});a.registerEventListener(b,"input",function(){""===
a.input.value?a.input.classList.remove("valid-input","invalid-input"):a.validateInput()?a.input.classList.remove("invalid-input"):a.input.classList.add("invalid-input")});return a}b(e,c);a(e,[{key:"validateInput",value:function(){return this.value.tryParseString(this.input.value)}},{key:"disposed",value:function(){m.removeFromParent(this.element);d(Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}}]);return e}(g.RefCounted);c.Uint64EntryWidget=e},function(g,c){},function(g,c){},function(g,
c){var e=0;c.associateLabelWithElement=function(c,b){""===b.id&&(b.id="unique-id-for-association-"+e++);c.setAttribute("for",b.id)}},function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,
enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){var b=document.createElement("div");b.textContent=a.value;return b}var d=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),m=function t(a,b,c){null===a&&(a=Function.prototype);var d=
Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:t(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},r=e(43);g=e(23);var v=e(7),n=e(140),k=e(100),q=e(141),f=e(20),p=e(142),h=e(138),u=e(34);e(143);$jscomp.initSymbol();var A=Symbol("autocompleteIndex");c.makeDefaultCompletionElement=a;c.makeCompletionElementWithDescription=function(a){var b=document.createElement("div");b.className="autocomplete-completion-with-description";
b.textContent=a.value;var c=document.createElement("div");c.className="autocomplete-completion-description";c.textContent=a.description||"";b.appendChild(c);return b};var B=new k.KeySequenceMap({arrowdown:"cycle-next-active-completion",arrowup:"cycle-prev-active-completion",tab:"choose-active-completion-or-prefix",enter:"choose-active-completion"}),y=new Map([["cycle-next-active-completion",function(){this.cycleActiveCompletion(1);return!0}],["cycle-prev-active-completion",function(){this.cycleActiveCompletion(-1);
return!0}],["choose-active-completion-or-prefix",function(){return this.selectActiveCompletion(!0)}],["choose-active-completion",function(){return this.selectActiveCompletion(!1)}]]);e=function(c){function e(a){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var b=l(this,Object.getPrototypeOf(e).call(this));b.inputChanged=new u.Signal;b.prevInputValue="";b.completionsVisible=!1;b.activeCompletionPromise=null;b.hasFocus=!1;b.completionResult=null;b.dropdownContentsStale=
!0;b.updateHintScrollPositionTimer=null;b.completionElements=null;b.hasResultForDropdown=!1;b.commonPrefix="";b.activeIndex=-1;b.dropdownStyleStale=!0;b.completer=a.completer;a=a.delay;var c=b.scheduleUpdateCompletions=r(function(){var a=b.activeCompletionPromise=b.completer(b.value);null!==a&&a.then(function(c){b.activeCompletionPromise===a&&(b.setCompletions(c),b.activeCompletionPromise=null)})},void 0===a?200:a);b.registerDisposer(function(){c.cancel()});a=b.element=document.createElement("div");
a.className="autocomplete";var d=document.createElement("div");d.className="autocomplete-dropdown-wrapper";var f=b.dropdownElement=document.createElement("div");f.className="autocomplete-dropdown";var g=b.promptElement=document.createElement("label");g.className="autocomplete-prompt";var m=b.inputWrapperElement=document.createElement("div");m.className="autocomplete-input-wrapper";a.appendChild(g);var n=b.inputElement=document.createElement("input");n.type="text";n.autocomplete="off";n.spellcheck=
!1;n.className="autocomplete-input";h.associateLabelWithElement(g,n);g=b.hintElement=document.createElement("input");g.type="text";g.spellcheck=!1;g.className="autocomplete-hint";g.disabled=!0;m.appendChild(g);m.appendChild(n);d.appendChild(m);d.appendChild(f);a.appendChild(d);b.registerInputHandler();b.handleInputChanged("");b.registerEventListener(b.inputElement,"focus",function(){b.hasFocus||(b.hasFocus=!0,b.dropdownStyleStale=!0,b.updateDropdown())});b.registerEventListener(b.inputElement,"blur",
function(){b.hasFocus&&(b.hasFocus=!1,b.updateDropdown())});b.registerEventListener(a.ownerDocument.defaultView,"resize",function(){b.dropdownStyleStale=!0});b.registerEventListener(a.ownerDocument.defaultView,"scroll",function(){b.dropdownStyleStale=!0});b.registerEventListener(b.dropdownElement,"mousedown",b.handleDropdownMousedown.bind(b));b.registerEventListener(b.inputElement,"keydown",function(){b.hintScrollPositionMayBeStale()});b.registerEventListener(b.inputElement,"mousemove",function(a){0!==
a.buttons&&b.hintScrollPositionMayBeStale()});(b.keyboardHandler=b.registerDisposer(new k.KeyboardShortcutHandler(n,B,b.handleKeyCommand.bind(b)))).allShortcutsAreGlobal=!0;return b}b(e,c);d(e,[{key:"hintScrollPositionMayBeStale",value:function(){""!==this.hintElement.value&&this.scheduleUpdateHintScrollPosition()}},{key:"handleDropdownMousedown",value:function(a){this.inputElement.focus();for(var b=this.dropdownElement,c=a.target;c instanceof HTMLElement;c=c.parentElement){var d=c[A];if(void 0!==
d){this.selectCompletion(d);break}if(c===b)break}a.preventDefault()}},{key:"cycleActiveCompletion",value:function(a){if(null!==this.completionResult){var b=this.activeIndex,c=this.completionResult.completions.length;this.setActiveIndex(-1===b?0<a?0:c-1:(b+a+c)%c)}}},{key:"handleKeyCommand",value:function(a){return y.get(a).call(this)}},{key:"registerInputHandler",value:function(){for(var a=this,b=function(b){b=a.inputElement.value;b!==a.prevInputValue&&(a.prevInputValue=b,a.handleInputChanged(b))},
c=$jscomp.makeIterator(["input"]),d=c.next();!d.done;d=c.next())this.registerEventListener(this.inputElement,d.value,b,!1)}},{key:"shouldShowDropdown",value:function(){return null!==this.completionResult&&this.hasFocus?this.hasResultForDropdown:!1}},{key:"updateDropdownStyle",value:function(){n.positionDropdown(this.dropdownElement,this.inputElement,{horizontal:!1});this.dropdownStyleStale=!1}},{key:"updateDropdown",value:function(){var b=this;this.shouldShowDropdown()?function(){var c=b.dropdownElement,
d=b.activeIndex;b.dropdownContentsStale&&function(){var e=b.completionResult,f=e.makeElement,g=void 0===f?a:f;b.completionElements=e.completions.map(function(a,b){var f=g.call(e,a);f[A]=b;f.classList.add("autocomplete-completion");d===b&&f.classList.add("autocomplete-completion-active");c.appendChild(f);return f});b.dropdownContentsStale=!1}();b.dropdownStyleStale&&b.updateDropdownStyle();b.completionsVisible||(c.style.display="block",b.completionsVisible=!0);-1!==d&&p.scrollIntoViewIfNeeded(b.completionElements[d])}():
this.completionsVisible&&(this.dropdownElement.style.display="none",this.completionsVisible=!1)}},{key:"setCompletions",value:function(a){this.clearCompletions();var b=a.completions;0!==b.length&&(this.completionResult=a,1===b.length?(b=b[0],a.showSingleResult?this.hasResultForDropdown=!0:b.value.startsWith(this.prevInputValue)?this.hasResultForDropdown=!1:this.hasResultForDropdown=!0,this.setActiveIndex(0)):(this.hasResultForDropdown=!0,b=q.longestCommonPrefix(function(){function b(g,h){for(;;)switch(c){case 0:f=
$jscomp.makeIterator(a.completions),e=f.next();case 1:if(e.done){c=3;break}d=e.value;c=4;return{value:d.value,done:!1};case 4:if(void 0===h){c=5;break}c=-1;throw h;case 5:case 2:e=f.next();c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,d,e,f,g={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}()),b=this.getCompletedValue(b),
b.startsWith(this.prevInputValue)&&(this.commonPrefix=b,this.setHintValue(b))),this.updateDropdown())}},{key:"scheduleUpdateHintScrollPosition",value:function(){if(null===this.updateHintScrollPositionTimer){var a=this;this.updateHintScrollPositionTimer=setTimeout(function(){a.updateHintScrollPosition()},0)}}},{key:"setHintValue",value:function(a){var b=this.prevInputValue;a!==b&&a.startsWith(b)||(a="");this.hintElement.value=a;this.scheduleUpdateHintScrollPosition()}},{key:"setActiveIndex",value:function(a){if(!this.dropdownContentsStale){var b=
this.activeIndex;-1!==b&&this.completionElements[b].classList.remove("autocomplete-completion-active");-1!==a&&(b=this.completionElements[a],b.classList.add("autocomplete-completion-active"),p.scrollIntoViewIfNeeded(b))}-1!==a&&this.setHintValue(this.getCompletedValueByIndex(a));this.activeIndex=a}},{key:"getCompletedValueByIndex",value:function(a){return this.getCompletedValue(this.completionResult.completions[a].value)}},{key:"getCompletedValue",value:function(a){return this.prevInputValue.substring(0,
this.completionResult.offset)+a}},{key:"selectActiveCompletion",value:function(a){var b=this.activeIndex;if(-1===b){if(!a)return!1;a=this.commonPrefix;return a.length>this.value.length?(this.value=a,!0):!1}a=this.getCompletedValueByIndex(b);if(this.value===a)return!1;this.value=a;return!0}},{key:"selectCompletion",value:function(a){this.value=this.getCompletedValueByIndex(a)}},{key:"updateHintScrollPosition",value:function(){this.updateHintScrollPositionTimer=null;this.hintElement.scrollLeft=this.inputElement.scrollLeft}},
{key:"cancelActiveCompletion",value:function(){f.cancelPromise(this.activeCompletionPromise);this.activeCompletionPromise=null}},{key:"handleInputChanged",value:function(a){this.cancelActiveCompletion();this.hintElement.value="";this.clearCompletions();this.inputChanged.dispatch(a);this.scheduleUpdateCompletions()}},{key:"clearCompletions",value:function(){null!==this.completionResult&&(this.activeIndex=-1,this.completionElements=this.completionResult=null,this.dropdownStyleStale=this.dropdownContentsStale=
!0,this.commonPrefix="",v.removeChildren(this.dropdownElement),this.updateDropdown())}},{key:"disposed",value:function(){v.removeFromParent(this.element);this.cancelActiveCompletion();null!==this.updateHintScrollPositionTimer&&(clearTimeout(this.updateHintScrollPositionTimer),this.updateHintScrollPositionTimer=null);m(Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}},{key:"disabled",get:function(){return this.inputElement.disabled},set:function(a){this.inputElement.disabled=a}},{key:"value",
get:function(){return this.prevInputValue},set:function(a){a!==this.prevInputValue&&(this.prevInputValue=this.inputElement.value=a,this.handleInputChanged(a))}}]);return e}(g.RefCounted);c.AutocompleteTextInput=e},function(g,c){c.positionDropdown=function(c,g){var b=2>=arguments.length||void 0===arguments[2]?{}:arguments[2],a=b.horizontal,d=void 0===a?!1:a,a=b.vertical,a=void 0===a?!0:a,m=b.topMargin,m=void 0===m?6:m,r=b.bottomMargin,r=void 0===r?6:r,v=b.leftMargin,v=void 0===v?6:v,n=b.rightMargin,
k=void 0===n?6:n,n=b.maxHeight,n=void 0===n?!0:n,b=b.maxWidth,q=void 0===b?!0:b,b=g.getBoundingClientRect();if(d){var d=b.right,f=c.ownerDocument.documentElement.clientHeight-b.left;d>f?(c.style.left="",c.style.right="0",q&&(c.style.maxWidth=d-v+"px")):(c.style.right="",c.style.left="0",q&&(c.style.maxWidth=f-k+"px"))}a&&(a=b.top-m,d=c.ownerDocument.documentElement.clientHeight-b.bottom-r,a>3*d?(c.style.top="",c.style.bottom="100%",n&&(c.style.maxHeight=a+"px")):(c.style.top="100%",c.style.bottom=
"",n&&(c.style.maxHeight=d+"px")))}},function(g,c){c.longestCommonPrefix=function(c){$jscomp.initSymbol();$jscomp.initSymbolIterator();c=c[Symbol.iterator]();var g=c.next(),b=g.value;if(g.done)return"";for(g=b.length;0<g;){var a=c.next(),d=a.value;if(a.done)break;for(a=0;a<g&&b.charCodeAt(a)===d.charCodeAt(a);++a);g=a}return b.substring(0,g)}},function(g,c){c.scrollIntoViewIfNeeded=function(c){var g=c.parentElement,b=c.offsetLeft-g.clientLeft,a=c.offsetTop-g.clientTop,d=g.scrollLeft,m=g.scrollTop,
a=Math.max(0,a+c.offsetHeight-(m+g.clientHeight))||Math.min(0,a-m);g.scrollLeft+=Math.max(0,b+c.offsetWidth-(d+g.clientWidth))||Math.min(0,b-d);g.scrollTop+=a}},function(g,c){},function(g,c){c.makeHiddenSubmitButton=function(){var c=document.createElement("button");c.type="submit";c.className="hidden-submit-button";c.style.margin="0";c.style.border="0";c.style.padding="0";c.style.width="0";c.style.height="0";c.style.overflow="hidden";c.tabIndex=-1;return c}},function(g,c){},function(g,c,e){function l(a,
b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)}var d=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var g=a[Symbol.iterator](),k;!(d=(k=g.next()).done)&&(c.push(k.value),!b||c.length!==b);d=!0);}catch(l){e=!0,f=l}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");
}}(),m=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),r=function u(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:u(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},v=e(103),
n=e(104);g=e(23);var k=e(7),q=e(140),f=e(147);e(72);e(148);var p=function(c){function d(a,c){l(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.layer=a;e.panel=c;var f=e.element=document.createElement("span");f.className="layer-item-parent noselect";var g=e.widgetElement=document.createElement("span");g.className="layer-item noselect";f.appendChild(g);var k=e.labelElement=document.createElement("span");k.className="layer-item-label";var m=e.layerNumberElement=document.createElement("span");
m.className="layer-item-number";var p=e.valueElement=document.createElement("span");p.className="layer-item-value";var q=document.createElement("span");q.title="Delete layer";q.className="layer-item-close";e.registerEventListener(q,"click",function(a){e.panel.layerManager.removeManagedLayer(e.layer)});g.appendChild(m);g.appendChild(k);g.appendChild(p);g.appendChild(q);e.registerEventListener(g,"click",function(b){a.setVisible(!a.visible)});e.registerEventListener(f,"mousedown",function(a){0===a.button&&
e.panel.setDragging(!0)});e.registerEventListener(f,"mouseup",function(a){0===a.button&&e.panel.setDragging(!1)});e.registerEventListener(g,"dblclick",function(b){a instanceof n.ManagedUserLayerWithSpecification&&new v.LayerDialog(e.panel.manager,a)});g=e.dropdownElement=document.createElement("div");e.registerEventListener(g,"mousedown",function(a){a.stopPropagation()});e.setupDropdownElement();e.handleLayerChanged();e.registerSignalBinding(a.layerChanged.add(e.handleLayerChanged,e));f.appendChild(g);
e.registerEventListener(f,"mouseenter",function(){e.hovering=!0;e.updateDropdownState()});e.registerEventListener(f,"mouseleave",function(a){e.hovering=!1;e.updateDropdownState()});return e}a(d,c);m(d,[{key:"updateDropdownState",value:function(){var a=this.dropdownElement.style;if(this.hovering&&!this.panel.dragging&&0<this.dropdownElement.childElementCount){if("flex"!==a.display&&(a.display="flex",this.dropdown))this.dropdown.onShow();q.positionDropdown(this.dropdownElement,this.widgetElement)}else if("none"!==
a.display&&(this.dropdownElement.style.display="none",this.dropdown))this.dropdown.onHide()}},{key:"setupDropdownElement",value:function(){this.dropdownElement.className="layer-dropdown"}},{key:"update",value:function(){var a=this.layer;this.labelElement.textContent=a.name;this.widgetElement.setAttribute("layer-visible",a.visible.toString())}},{key:"handleLayerChanged",value:function(){var a=this.layer.layer;a!==this.userLayer&&(this.dropdown&&(this.dropdown.dispose(),k.removeChildren(this.dropdownElement),
this.setupDropdownElement()),this.dropdown=(this.userLayer=a)?a.makeDropdown(this.dropdownElement):void 0)}},{key:"disposed",value:function(){this.dropdown&&this.dropdown.dispose();this.element.parentElement.removeChild(this.element);r(Object.getPrototypeOf(d.prototype),"disposed",this).call(this)}}]);return d}(g.RefCounted);e=function(c){function e(a,c){l(this,e);var d=b(this,Object.getPrototypeOf(e).call(this));d.element=a;d.manager=c;d.layerWidgets=new Map;d.layerUpdateNeeded=!0;d.valueUpdateNeeded=
!1;d.dragging=!1;a.className="layer-panel";d.registerSignalBinding(c.layerSelectedValues.changed.add(d.handleLayerValuesChanged,d));d.registerSignalBinding(c.layerManager.layersChanged.add(d.handleLayersChanged,d));var g=d.addButton=document.createElement("button");g.className="layer-add-button";g.title="Add layer";d.registerEventListener(g,"click",function(){d.addLayerMenu()});a.appendChild(g);d.update();var k=new f(d.element,{draggable:".layer-item-parent",onStart:function(a){d.setDragging(!0);
d.element.classList.add("sorting-in-progress")},onEnd:function(a){d.setDragging(!1);d.element.classList.remove("sorting-in-progress");d.layerManager.reorderManagedLayer(a.oldIndex,a.newIndex)},onMove:function(a){return a.related!==d.addButton}});d.registerDisposer(function(){k.destroy()});return d}a(e,c);m(e,[{key:"setDragging",value:function(a){this.dragging=a;a=$jscomp.makeIterator(this.layerWidgets.values());for(var b=a.next();!b.done;b=a.next())b.value.updateDropdownState()}},{key:"disposed",
value:function(){this.layerWidgets.forEach(function(a){return a.dispose()});this.layerWidgets=void 0;r(Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}},{key:"handleLayersChanged",value:function(){this.layerUpdateNeeded=!0;this.handleLayerValuesChanged()}},{key:"handleLayerValuesChanged",value:function(){this.valueUpdateNeeded||(this.valueUpdateNeeded=!0,requestAnimationFrame(this.update.bind(this)))}},{key:"update",value:function(){this.valueUpdateNeeded=!1;this.updateLayers();for(var a=
this.manager.layerSelectedValues,b=$jscomp.makeIterator(this.layerWidgets),c=b.next();!c.done;c=b.next()){var e=d(c.value,2),c=e[1],f=e[0].layer,e="";null!==f&&(f=a.get(f),void 0!==f&&(e=""+f));c.valueElement.textContent=e}}},{key:"updateLayers",value:function(){var a=this;if(this.layerUpdateNeeded){this.layerUpdateNeeded=!1;var b=this.element,c=new Set,e=b.firstElementChild;this.manager.layerManager.managedLayers.forEach(function(d,f){c.add(d);var g=a.layerWidgets.get(d);void 0===g&&(g=new p(d,a),
a.layerWidgets.set(d,g));g.layerNumberElement.textContent=""+(1+f);g.update();g.element!==e&&b.insertBefore(g.element,a.addButton)});for(var f=$jscomp.makeIterator(this.layerWidgets),g=f.next();!g.done;g=f.next()){var k=d(g.value,2),g=k[0],k=k[1];c.has(g)||(this.layerWidgets.delete(g),k.dispose())}}}},{key:"addLayerMenu",value:function(){new v.LayerDialog(this.manager)}},{key:"layerManager",get:function(){return this.manager.layerManager}}]);return e}(g.RefCounted);c.LayerPanel=e},function(g,c,e){var l,
b;(function(a){!(l=a,b="function"===typeof l?l.call(c,e,c,g):l,void 0!==b&&(g.exports=b))})(function(){function a(a,b){if(!a||!a.nodeType||1!==a.nodeType)throw"Sortable: `el` must be HTMLElement, and not "+{}.toString.call(a);this.el=a;this.options=b=x({},b);a[ya]=this;var c={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(a.nodeName)?"li":">*",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",ignore:"a, img",
filter:null,animation:0,setData:function(a,b){a.setData("Text",b.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1},d;for(d in c)d in b||(b[d]=c[d]);Ob(b);for(var f in this)"_"===f.charAt(0)&&(this[f]=this[f].bind(this));this.nativeDraggable=b.forceFallback?!1:Nb;e(a,"mousedown",this._onTapStart);e(a,"touchstart",this._onTapStart);this.nativeDraggable&&(e(a,"dragover",this),e(a,"dragenter",this));Ia.push(this._onDragOver);
b.store&&this.sort(b.store.get(this))}function b(a){C&&C.state!==a&&(k(C,"display",a?"none":""),!a&&C.state&&D.insertBefore(C,t),C.state=a)}function c(a,b,d){if(a){d=d||ba;b=b.split(".");var e=b.shift().toUpperCase(),f=new RegExp("\\s("+b.join("|")+")(?=\\s)","g");do if(">*"===e&&a.parentNode===d||!(""!==e&&a.nodeName.toUpperCase()!=e||b.length&&((" "+a.className+" ").match(f)||[]).length!=b.length))return a;while(a!==d&&(a=a.parentNode))}return null}function e(a,b,c){a.addEventListener(b,c,!1)}function g(a,
b,c){a.removeEventListener(b,c,!1)}function l(a,b,c){if(a)if(a.classList)a.classList[c?"add":"remove"](b);else{var d=(" "+a.className+" ").replace(Xa," ").replace(" "+b+" "," ");a.className=(d+(c?" "+b:"")).replace(Xa," ")}}function k(a,b,c){var d=a&&a.style;if(d){if(void 0===c)return ba.defaultView&&ba.defaultView.getComputedStyle?c=ba.defaultView.getComputedStyle(a,""):a.currentStyle&&(c=a.currentStyle),void 0===b?c:c[b];b in d||(b="-webkit-"+b);d[b]=c+("string"===typeof c?"":"px")}}function q(a,
b,c){if(a){a=a.getElementsByTagName(b);b=0;var d=a.length;if(c)for(;b<d;b++)c(a[b],b);return a}return[]}function f(a,b,c,d,e,f,g){var h=ba.createEvent("Event"),k=(a||b[ya]).options,l="on"+c.charAt(0).toUpperCase()+c.substr(1);h.initEvent(c,!0,!0);h.to=b;h.from=e||b;h.item=d||b;h.clone=C;h.oldIndex=f;h.newIndex=g;b.dispatchEvent(h);k[l]&&k[l].call(a,h)}function p(a,b,c,d,e,f){var g,h=a[ya],k=h.options.onMove,l;g=ba.createEvent("Event");g.initEvent("move",!0,!0);g.to=b;g.from=a;g.dragged=c;g.draggedRect=
d;g.related=e||b;g.relatedRect=f||b.getBoundingClientRect();a.dispatchEvent(g);k&&(l=k.call(h,g));return l}function h(a){a.draggable=!1}function u(){Ya=!1}function A(a){a=a.tagName+a.className+a.src+a.href+a.textContent;for(var b=a.length,c=0;b--;)c+=a.charCodeAt(b);return c.toString(36)}function B(a){var b=0;if(!a||!a.parentNode)return-1;for(;a&&(a=a.previousElementSibling);)"TEMPLATE"!==a.nodeName.toUpperCase()&&b++;return b}function y(a,b){var c,d;return function(){void 0===c&&(c=arguments,d=this,
setTimeout(function(){1===c.length?a.call(d,c[0]):a.apply(d,c);c=void 0},b))}}function x(a,b){if(a&&b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}var t,z,w,C,D,F,G,Q,I,O,V,P,T,Z,R={},ea,ca,Ha,Xa=/\s+/g,ya="Sortable"+(new Date).getTime(),za=window,ba=za.document,Mb=za.parseInt,Nb=!!("draggable"in ba.createElement("div")),eb=function(a){a=ba.createElement("x");a.style.cssText="pointer-events:auto";return"auto"===a.style.pointerEvents}(),Ya=!1,ua=Math.abs,Ia=[],sc=y(function(a,b,c){if(c&&
b.scroll){var d,e=b.scrollSensitivity,f=b.scrollSpeed,g=a.clientX;a=a.clientY;var h=window.innerWidth,k=window.innerHeight,l,m;if(Q!==c&&(G=b.scroll,Q=c,!0===G)){G=c;do if(G.offsetWidth<G.scrollWidth||G.offsetHeight<G.scrollHeight)break;while(G=G.parentNode)}G&&(d=G,b=G.getBoundingClientRect(),l=(ua(b.right-g)<=e)-(ua(b.left-g)<=e),m=(ua(b.bottom-a)<=e)-(ua(b.top-a)<=e));l||m||(l=(h-g<=e)-(g<=e),m=(k-a<=e)-(a<=e),(l||m)&&(d=za));if(R.vx!==l||R.vy!==m||R.el!==d)R.el=d,R.vx=l,R.vy=m,clearInterval(R.pid),
d&&(R.pid=setInterval(function(){d===za?za.scrollTo(za.pageXOffset+l*f,za.pageYOffset+m*f):(m&&(d.scrollTop+=m*f),l&&(d.scrollLeft+=l*f))},24))}},30),Ob=function(a){var b=a.group;b&&"object"==typeof b||(b=a.group={name:b});["pull","put"].forEach(function(a){a in b||(b[a]=!0)});a.groups=" "+b.name+(b.put.join?" "+b.put.join(" "):"")+" "};a.prototype={constructor:a,_onTapStart:function(a){var b=this,d=this.el,e=this.options,g=a.touches&&a.touches[0],h=(g||a).target,k=h,l=e.filter;if(!("mousedown"===
a.type&&0!==a.button||e.disabled)&&(h=c(h,e.draggable,d))){P=B(h);if("function"===typeof l){if(l.call(this,a,h,this)){f(b,k,"filter",h,d,P);a.preventDefault();return}}else if(l&&(l=l.split(",").some(function(a){if(a=c(k,a.trim(),d))return f(b,a,"filter",h,d,P),!0}))){a.preventDefault();return}e.handle&&!c(k,e.handle,d)||this._prepareDragStart(a,g,h)}},_prepareDragStart:function(a,b,c){var d=this,f=d.el,g=d.options,k=f.ownerDocument;c&&!t&&c.parentNode===f&&(ea=a,D=f,t=c,z=t.parentNode,F=t.nextSibling,
Z=g.group,a=function(){d._disableDelayedDrag();t.draggable=!0;l(t,d.options.chosenClass,!0);d._triggerDragStart(b)},g.ignore.split(",").forEach(function(a){q(t,a.trim(),h)}),e(k,"mouseup",d._onDrop),e(k,"touchend",d._onDrop),e(k,"touchcancel",d._onDrop),g.delay?(e(k,"mouseup",d._disableDelayedDrag),e(k,"touchend",d._disableDelayedDrag),e(k,"touchcancel",d._disableDelayedDrag),e(k,"mousemove",d._disableDelayedDrag),e(k,"touchmove",d._disableDelayedDrag),d._dragStartTimer=setTimeout(a,g.delay)):a())},
_disableDelayedDrag:function(){var a=this.el.ownerDocument;clearTimeout(this._dragStartTimer);g(a,"mouseup",this._disableDelayedDrag);g(a,"touchend",this._disableDelayedDrag);g(a,"touchcancel",this._disableDelayedDrag);g(a,"mousemove",this._disableDelayedDrag);g(a,"touchmove",this._disableDelayedDrag)},_triggerDragStart:function(a){a?(ea={target:t,clientX:a.clientX,clientY:a.clientY},this._onDragStart(ea,"touch")):this.nativeDraggable?(e(t,"dragend",this),e(D,"dragstart",this._onDragStart)):this._onDragStart(ea,
!0);try{ba.selection?ba.selection.empty():window.getSelection().removeAllRanges()}catch(b){}},_dragStarted:function(){D&&t&&(l(t,this.options.ghostClass,!0),a.active=this,f(this,D,"start",t,D,P))},_emulateDragOver:function(){if(ca&&(this._lastX!==ca.clientX||this._lastY!==ca.clientY)){this._lastX=ca.clientX;this._lastY=ca.clientY;eb||k(w,"display","none");var a=ba.elementFromPoint(ca.clientX,ca.clientY),b=a,c=" "+this.options.group.name+"",d=Ia.length;if(b){do{if(b[ya]&&-1<b[ya].options.groups.indexOf(c)){for(;d--;)Ia[d]({clientX:ca.clientX,
clientY:ca.clientY,target:a,rootEl:b});break}a=b}while(b=b.parentNode)}eb||k(w,"display","")}},_onTouchMove:function(b){if(ea){a.active||this._dragStarted();this._appendGhost();var c=b.touches?b.touches[0]:b,d=c.clientX-ea.clientX,e=c.clientY-ea.clientY,d=b.touches?"translate3d("+d+"px,"+e+"px,0)":"translate("+d+"px,"+e+"px)";Ha=!0;ca=c;k(w,"webkitTransform",d);k(w,"mozTransform",d);k(w,"msTransform",d);k(w,"transform",d);b.preventDefault()}},_appendGhost:function(){if(!w){var a=t.getBoundingClientRect(),
b=k(t),c=this.options;w=t.cloneNode(!0);l(w,c.ghostClass,!1);l(w,c.fallbackClass,!0);k(w,"top",a.top-Mb(b.marginTop,10));k(w,"left",a.left-Mb(b.marginLeft,10));k(w,"width",a.width);k(w,"height",a.height);k(w,"opacity","0.8");k(w,"position","fixed");k(w,"zIndex","100000");k(w,"pointerEvents","none");c.fallbackOnBody&&ba.body.appendChild(w)||D.appendChild(w);b=w.getBoundingClientRect();k(w,"width",2*a.width-b.width);k(w,"height",2*a.height-b.height)}},_onDragStart:function(a,b){var c=a.dataTransfer,
d=this.options;this._offUpEvents();"clone"==Z.pull&&(C=t.cloneNode(!0),k(C,"display","none"),D.insertBefore(C,t));b?("touch"===b?(e(ba,"touchmove",this._onTouchMove),e(ba,"touchend",this._onDrop),e(ba,"touchcancel",this._onDrop)):(e(ba,"mousemove",this._onTouchMove),e(ba,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,50)):(c&&(c.effectAllowed="move",d.setData&&d.setData.call(this,c,t)),e(ba,"drop",this),setTimeout(this._dragStarted,0))},_onDragOver:function(a){var e=this.el,
f,g,h;g=this.options;f=g.group;var l=f.put,n=Z===f,q=g.sort;void 0!==a.preventDefault&&(a.preventDefault(),!g.dragoverBubble&&a.stopPropagation());Ha=!0;if(Z&&!g.disabled&&(n?q||(h=!D.contains(t)):Z.pull&&l&&(Z.name===f.name||l.indexOf&&~l.indexOf(Z.name)))&&(void 0===a.rootEl||a.rootEl===this.el)&&(sc(a,g,this.el),!Ya))if(f=c(a.target,g.draggable,e),g=t.getBoundingClientRect(),h)b(!0),C||F?D.insertBefore(t,C||F):q||D.appendChild(t);else if(!(h=0===e.children.length||e.children[0]===w)&&(h=e===a.target)&&
(f=e.lastElementChild,h=f.getBoundingClientRect(),h=f=(5<a.clientY-(h.top+h.height)||5<a.clientX-(h.right+h.width))&&f),h){if(f){if(f.animated)return;r=f.getBoundingClientRect()}b(n);!1!==p(D,e,t,g,f,r)&&(t.contains(e)||(e.appendChild(t),z=e),this._animate(g,t),f&&this._animate(r,f))}else if(f&&!f.animated&&f!==t&&void 0!==f.parentNode[ya]){I!==f&&(I=f,O=k(f),V=k(f.parentNode));var r=f.getBoundingClientRect(),x=r.right-r.left,v=r.bottom-r.top,q=/left|right|inline/.test(O.cssFloat+O.display)||"flex"==
V.display&&0===V["flex-direction"].indexOf("row");h=f.offsetWidth>t.offsetWidth;l=f.offsetHeight>t.offsetHeight;x=.5<(q?(a.clientX-r.left)/x:(a.clientY-r.top)/v);a=f.nextElementSibling;v=p(D,e,t,g,f,r);!1!==v&&(Ya=!0,setTimeout(u,30),b(n),1===v||-1===v?n=1===v:q?(n=t.offsetTop,q=f.offsetTop,n=n===q?f.previousElementSibling===t&&!h||x&&h:q>n):n=a!==t&&!l||x&&l,t.contains(e)||(n&&!a?e.appendChild(t):f.parentNode.insertBefore(t,n?a:f)),z=t.parentNode,this._animate(g,t),this._animate(r,f))}},_animate:function(a,
b){var c=this.options.animation;if(c){var d=b.getBoundingClientRect();k(b,"transition","none");k(b,"transform","translate3d("+(a.left-d.left)+"px,"+(a.top-d.top)+"px,0)");b.offsetWidth;k(b,"transition","all "+c+"ms");k(b,"transform","translate3d(0,0,0)");clearTimeout(b.animated);b.animated=setTimeout(function(){k(b,"transition","");k(b,"transform","");b.animated=!1},c)}},_offUpEvents:function(){var a=this.el.ownerDocument;g(ba,"touchmove",this._onTouchMove);g(a,"mouseup",this._onDrop);g(a,"touchend",
this._onDrop);g(a,"touchcancel",this._onDrop)},_onDrop:function(b){var c=this.el,d=this.options;clearInterval(this._loopId);clearInterval(R.pid);clearTimeout(this._dragStartTimer);g(ba,"mousemove",this._onTouchMove);this.nativeDraggable&&(g(ba,"drop",this),g(c,"dragstart",this._onDragStart));this._offUpEvents();if(b){Ha&&(b.preventDefault(),!d.dropBubble&&b.stopPropagation());w&&w.parentNode.removeChild(w);if(t&&(this.nativeDraggable&&g(t,"dragend",this),h(t),l(t,this.options.ghostClass,!1),l(t,this.options.chosenClass,
!1),D!==z?(T=B(t),0<=T&&(f(null,z,"sort",t,D,P,T),f(this,D,"sort",t,D,P,T),f(null,z,"add",t,D,P,T),f(this,D,"remove",t,D,P,T))):(C&&C.parentNode.removeChild(C),t.nextSibling!==F&&(T=B(t),0<=T&&(f(this,D,"update",t,D,P,T),f(this,D,"sort",t,D,P,T)))),a.active)){if(null===T||-1===T)T=P;f(this,D,"end",t,D,P,T);this.save()}D=t=z=w=F=C=G=Q=ea=ca=Ha=T=I=O=Z=a.active=null}},handleEvent:function(a){var b=a.type;"dragover"===b||"dragenter"===b?t&&(this._onDragOver(a),a.dataTransfer&&(a.dataTransfer.dropEffect=
"move"),a.preventDefault()):"drop"!==b&&"dragend"!==b||this._onDrop(a)},toArray:function(){for(var a=[],b,d=this.el.children,e=0,f=d.length,g=this.options;e<f;e++)b=d[e],c(b,g.draggable,this.el)&&a.push(b.getAttribute(g.dataIdAttr)||A(b));return a},sort:function(a){var b={},d=this.el;this.toArray().forEach(function(a,e){var f=d.children[e];c(f,this.options.draggable,d)&&(b[a]=f)},this);a.forEach(function(a){b[a]&&(d.removeChild(b[a]),d.appendChild(b[a]))})},save:function(){var a=this.options.store;
a&&a.set(this)},closest:function(a,b){return c(a,b||this.options.draggable,this.el)},option:function(a,b){var c=this.options;if(void 0===b)return c[a];c[a]=b;"group"===a&&Ob(c)},destroy:function(){var a=this.el;a[ya]=null;g(a,"mousedown",this._onTapStart);g(a,"touchstart",this._onTapStart);this.nativeDraggable&&(g(a,"dragover",this),g(a,"dragenter",this));Array.prototype.forEach.call(a.querySelectorAll("[draggable]"),function(a){a.removeAttribute("draggable")});Ia.splice(Ia.indexOf(this._onDragOver),
1);this._onDrop();this.el=a=null}};a.utils={on:e,off:g,css:k,find:q,is:function(a,b){return!!c(a,b,a)},extend:x,throttle:y,closest:c,toggleClass:l,index:B};a.create=function(b,c){return new a(b,c)};a.version="1.4.2";return a})},function(g,c){},function(g,c){c.withFlex=function(c,g){return function(b){b.style.flex=c;g(b)}};c.withStyle=function(c,g){return function(b){Object.assign(b.style,c);g(b)}};c.withAttributes=function(c,g){return function(b){Object.assign(b,c);g(b)}};c.box=function(c,g){return function(b){b.style.display=
"flex";b.style.flexDirection=c;for(var a=$jscomp.makeIterator(g),d=a.next();!d.done;d=a.next()){var d=d.value,m=b.ownerDocument.createElement("div");b.appendChild(m);d(m)}}}},function(g,c,e){function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d=function y(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:y(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},m=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];
e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(23);var r=e(9),v=e(8),n=e(34),k=function(c){function d(a){l(this,d);var c=b(this,Object.getPrototypeOf(d).call(this));c.changed=new n.Signal;var e=!0;null==a&&(a=r.vec3.create(),e=!1);c.size=a;c.valid=e;return c}a(d,c);m(d,[{key:"reset",value:function(){this.valid=!1;this.changed.dispatch()}},{key:"setValid",value:function(){this.valid||
(this.valid=!0,this.changed.dispatch())}},{key:"toJSON",value:function(){return this.valid?Array.prototype.slice.call(this.size):void 0}},{key:"restoreState",value:function(a){try{v.parseFiniteVec(this.size,a),this.valid=!0,this.changed.dispatch()}catch(b){this.valid=!1,this.changed.dispatch()}}},{key:"toString",value:function(){return this.valid?this.size.toString():null}},{key:"voxelFromSpatial",value:function(a,b){r.vec3.divide(a,b,this.size)}},{key:"spatialFromVoxel",value:function(a,b){r.vec3.multiply(a,
b,this.size)}}]);return d}(g.RefCounted);c.VoxelSize=k;var q=r.vec3.create(),f=r.quat.create(),p=function(c){function d(a,c){l(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.voxelCoordinates=null;e.changed=new n.Signal;null==a&&(a=new k);e.voxelSize=a;var f=!0;null==c&&(c=r.vec3.create(),f=!1);e.spatialCoordinates=c;e.spatialCoordinatesValid=f;e.registerDisposer(a);e.registerSignalBinding(a.changed.add(e.handleVoxelSizeChanged,e));return e}a(d,c);m(d,[{key:"reset",value:function(){this.spatialCoordinatesValid=
!1;this.voxelCoordinates=null;this.voxelSize.reset();this.changed.dispatch()}},{key:"getVoxelCoordinates",value:function(a){var b=this.voxelCoordinates;if(b)r.vec3.copy(a,b);else if(this.valid)this.voxelSize.voxelFromSpatial(a,this.spatialCoordinates);else return!1;return!0}},{key:"setVoxelCoordinates",value:function(a){var b=this.voxelSize;b.valid?(b.spatialFromVoxel(this.spatialCoordinates,a),this.markSpatialCoordinatesChanged()):(b=this.voxelCoordinates)?r.vec3.copy(b,a):this.voxelCoordinates=
r.vec3.clone(a);this.changed.dispatch()}},{key:"markSpatialCoordinatesChanged",value:function(){this.spatialCoordinatesValid=!0;this.voxelCoordinates=null;this.changed.dispatch()}},{key:"handleVoxelSizeChanged",value:function(){null==this.voxelCoordinates||this.spatialCoordinatesValid||(this.voxelSize.spatialFromVoxel(this.spatialCoordinates,this.voxelCoordinates),this.spatialCoordinatesValid=!0);this.voxelCoordinates=null;this.changed.dispatch()}},{key:"toJSON",value:function(){var a=!0,b=this.voxelSize.toJSON(),
c={};void 0!==b&&(a=!1,c.voxelSize=b);this.voxelCoordinatesValid?(this.getVoxelCoordinates(q),c.voxelCoordinates=Array.prototype.slice.call(q),a=!1):this.spatialCoordinatesValid&&(c.spatialCoordinates=Array.prototype.slice.call(this.spatialCoordinates),a=!1);return a?void 0:c}},{key:"restoreState",value:function(a){var b=this;v.verifyObject(a);v.verifyObjectProperty(a,"voxelSize",function(a){void 0!==a&&b.voxelSize.restoreState(a)});this.spatialCoordinatesValid=!1;v.verifyObjectProperty(a,"voxelCoordinates",
function(a){void 0!==a&&b.setVoxelCoordinates(v.parseFiniteVec(r.vec3.create(),a))});v.verifyObjectProperty(a,"spatialCoordinates",function(a){void 0!==a&&(v.parseFiniteVec(b.spatialCoordinates,a),b.markSpatialCoordinatesChanged())})}},{key:"snapToVoxel",value:function(){if(this.valid){for(var a=this.spatialCoordinates,b=this.voxelSize.size,c=0;3>c;++c){var d=b[c];a[c]=Math.round(a[c]/d)*d}this.changed.dispatch()}else if(a=this.voxelCoordinates,null!=a){for(b=0;3>b;++b)a[b]=Math.round(a[b]);this.changed.dispatch()}}},
{key:"valid",get:function(){return this.spatialCoordinatesValid&&this.voxelSize.valid}},{key:"voxelCoordinatesValid",get:function(){return this.valid||null!=this.voxelCoordinates}}]);return d}(g.RefCounted);c.SpatialPosition=p;var h=function(c){function d(a){l(this,d);var c=b(this,Object.getPrototypeOf(d).call(this));c.changed=new n.Signal;null==a&&(a=r.quat.create());c.orientation=a;return c}a(d,c);m(d,[{key:"toJSON",value:function(){var a=this.orientation;return 0===a[0]&&0===a[1]&&0===a[2]&&1===
a[3]?void 0:Array.prototype.slice.call(this.orientation)}},{key:"restoreState",value:function(a){try{v.parseFiniteVec(this.orientation,a),r.quat.normalize(this.orientation,this.orientation)}catch(b){r.quat.identity(this.orientation)}this.changed.dispatch()}},{key:"reset",value:function(){r.quat.identity(this.orientation);this.changed.dispatch()}},{key:"snap",value:function(){var a=r.mat3.create();r.mat3.fromQuat(a,this.orientation);for(var b=[!1,!1,!1],c=0;3>c;++c){for(var d=0,e=0,f=0;3>f;++f){var g=
a[3*c+f];a[3*c+f]=0;!b[f]&&Math.abs(g)>Math.abs(d)&&(d=g,e=f)}a[3*c+e]=Math.sign(d);b[e]=!0}r.quat.fromMat3(this.orientation,a);this.changed.dispatch()}}],[{key:"makeRelative",value:function(a,b){var c=new d(r.quat.multiply(r.quat.create(),a.orientation,b)),e=!1;c.registerSignalBinding(a.changed.add(function(){e||(f=!0,r.quat.multiply(c.orientation,a.orientation,b),c.changed.dispatch(),f=!1)}));var f=!1,g=r.quat.invert(r.quat.create(),b);c.registerSignalBinding(c.changed.add(function(){f||(e=!0,r.quat.multiply(a.orientation,
c.orientation,g),a.changed.dispatch(),e=!1)}));return c}}]);return d}(g.RefCounted);c.OrientationState=h;var u=function(c){function e(a,c){l(this,e);var d=b(this,Object.getPrototypeOf(e).call(this));d.changed=new n.Signal;null==a&&(a=new p);d.position=a;null==c&&(c=new h);d.orientation=c;d.registerDisposer(d.position);d.registerDisposer(d.orientation);d.registerSignalBinding(d.position.changed.add(d.changed.dispatch,d.changed));d.registerSignalBinding(d.orientation.changed.add(d.changed.dispatch,
d.changed));return d}a(e,c);m(e,[{key:"reset",value:function(){this.position.reset();this.orientation.reset()}},{key:"disposed",value:function(){this.position.changed.remove(this.changed.dispatch,this.changed);d(Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}},{key:"toMat4",value:function(a){r.mat4.fromRotationTranslation(a,this.orientation.orientation,this.position.spatialCoordinates)}},{key:"toJSON",value:function(){var a=this.position.toJSON(),b=this.orientation.toJSON();return void 0===
a&&void 0===b?void 0:{position:a,orientation:b}}},{key:"restoreState",value:function(a){var b=this;v.verifyObject(a);v.verifyObjectProperty(a,"position",function(a){void 0!==a&&b.position.restoreState(a)});v.verifyObjectProperty(a,"orientation",function(a){void 0!==a&&b.orientation.restoreState(a)})}},{key:"snap",value:function(){this.orientation.snap();this.position.snapToVoxel();this.changed.dispatch()}},{key:"translateAbsolute",value:function(a){r.vec3.add(this.position.spatialCoordinates,this.position.spatialCoordinates,
a);this.position.changed.dispatch()}},{key:"translateRelative",value:function(a){if(this.valid){var b=r.vec3.create();r.vec3.transformQuat(b,a,this.orientation.orientation);r.vec3.add(this.position.spatialCoordinates,this.position.spatialCoordinates,b);this.position.changed.dispatch()}}},{key:"translateVoxelsRelative",value:function(a){if(this.valid){var b=r.vec3.create();r.vec3.transformQuat(b,a,this.orientation.orientation);r.vec3.multiply(b,b,this.position.voxelSize.size);r.vec3.add(this.position.spatialCoordinates,
this.position.spatialCoordinates,b);this.position.changed.dispatch()}}},{key:"rotateRelative",value:function(a,b){var c=r.quat.create();r.quat.setAxisAngle(c,a,b);var d=this.orientation.orientation;r.quat.multiply(d,d,c);this.orientation.changed.dispatch()}},{key:"rotateAbsolute",value:function(a,b,c){var d=r.quat.create();r.quat.setAxisAngle(d,a,b);a=this.orientation.orientation;if(void 0!==c){b=this.position.spatialCoordinates;var e=r.vec3.subtract(q,c,b),g=r.quat.invert(f,a);r.vec3.transformQuat(e,
e,g);r.quat.multiply(a,d,a);r.vec3.transformQuat(b,e,a);r.vec3.subtract(b,c,b);this.position.changed.dispatch()}else r.quat.multiply(a,d,a);this.orientation.changed.dispatch()}},{key:"valid",get:function(){return this.position.valid}}]);return e}(g.RefCounted);c.Pose=u;var A=function(){function a(){var b=0>=arguments.length||void 0===arguments[0]?Number.NaN:arguments[0],c=1>=arguments.length||void 0===arguments[1]?b:arguments[1];l(this,a);this.value_=b;this.defaultValue=c;this.changed=new n.Signal}
m(a,[{key:"toJSON",value:function(){var a=this.value_,b=this.defaultValue;return Number.isNaN(a)&&Number.isNaN(b)||a===b?void 0:a}},{key:"restoreState",value:function(a){"number"===typeof a&&Number.isFinite(a)&&0<a?this.value=a:this.value=this.defaultValue}},{key:"reset",value:function(){this.value=this.defaultValue}},{key:"zoomBy",value:function(a){var b=this.value_;Number.isNaN(b)||(this.value=b*a)}},{key:"value",get:function(){return this.value_},set:function(a){a!==this.value_&&(this.value_=a,
this.changed.dispatch())}}]);return a}();c.TrackableZoomState=A;e=function(c){function d(){var a=0>=arguments.length||void 0===arguments[0]?new u:arguments[0],c=1>=arguments.length||void 0===arguments[1]?Number.NaN:arguments[1];l(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.pose=a;e.changed=new n.Signal;e.zoomFactor="number"===typeof c?new A(c):c;e.registerDisposer(a);e.registerSignalBinding(e.pose.changed.add(function(){e.changed.dispatch()}));e.registerSignalBinding(e.zoomFactor.changed.add(function(){e.changed.dispatch()}));
e.registerSignalBinding(e.voxelSize.changed.add(function(){e.handleVoxelSizeChanged()}));e.handleVoxelSizeChanged();return e}a(d,c);m(d,[{key:"reset",value:function(){this.pose.reset();this.zoomFactor.reset()}},{key:"setZoomFactorFromVoxelSize",value:function(){this.voxelSize.valid&&(this.zoomFactor.value=Math.min.apply(null,this.voxelSize.size))}},{key:"handleVoxelSizeChanged",value:function(){Number.isNaN(this.zoomFactor.value)&&this.setZoomFactorFromVoxelSize()}},{key:"toMat4",value:function(a){this.pose.toMat4(a);
var b=this.zoomFactor.value;r.mat4.scale(a,a,r.vec3.fromValues(b,b,b))}},{key:"toJSON",value:function(){var a=this.pose.toJSON(),b=this.zoomFactor.toJSON();return void 0===a&&void 0===b?void 0:{pose:a,zoomFactor:b}}},{key:"restoreState",value:function(a){try{var b=this;v.verifyObject(a);v.verifyObjectProperty(a,"pose",function(a){void 0!==a&&b.pose.restoreState(a)});v.verifyObjectProperty(a,"zoomFactor",function(a){void 0!==a&&b.zoomFactor.restoreState(a)});this.handleVoxelSizeChanged();this.changed.dispatch()}catch(c){this.reset()}}},
{key:"zoomBy",value:function(a){this.zoomFactor.zoomBy(a)}},{key:"voxelSize",get:function(){return this.pose.position.voxelSize}},{key:"position",get:function(){return this.pose.position}},{key:"valid",get:function(){return this.pose.valid}}]);return d}(g.RefCounted);c.NavigationState=e},function(g,c,e){function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==
typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,
c);d&&a(b,d);return b}}(),d=function v(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:v(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)};g=e(23);var m=e(9);e(152);e=function(c){function e(a,b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var c=l(this,Object.getPrototypeOf(e).call(this));c.element=a;c.viewer=b;c.positionElements=[];
c.needsUpdate=null;c.tempPosition=m.vec3.create();a.setAttribute("class","position-status-panel");for(var d=c.positionElements,g=function(b){var e=a.ownerDocument.createElement("label");e.className="position-status-coord";var g=a.ownerDocument.createElement("input");g.type="number";g.className="position-status-coord";e.textContent=m.AXES_NAMES[b];e.appendChild(g);a.appendChild(e);d.push(g);var h=!1;c.registerEventListener(g,"change",function(a){c.handleCoordinateChange()});c.registerEventListener(g,
"input",function(a){h&&(c.handleCoordinateChange(),h=!1);return!0});c.registerEventListener(g,"wheel",function(a){h=!0;g.focus();return!0});c.registerEventListener(g,"keydown",function(a){h=!1;return!0});c.registerEventListener(g,"mousedown",function(a){return h=!0});c.registerEventListener(g,"click",function(a){return!0});c.registerEventListener(g,"blur",function(a){h=!1;return!0})},u=0;3>u;++u)g(u);g=c.mouseElement=document.createElement("span");g.className="position-status-mouse";a.appendChild(g);
g=b.mouseState;c.registerSignalBinding(b.navigationState.pose.changed.add(c.handleChange,c));c.registerSignalBinding(g.changed.add(c.handleChange,c));c.handleChange();return c}b(e,c);a(e,[{key:"handleChange",value:function(){null==this.needsUpdate&&(this.needsUpdate=requestAnimationFrame(this.update.bind(this)))}},{key:"handleCoordinateChange",value:function(){var a=this.positionElements,b=this.viewer.navigationState.pose.position,c=this.tempPosition;if(b.voxelCoordinatesValid){b.getVoxelCoordinates(c);
for(var d=0;3>d;++d){var e=parseFloat(a[d].value);Number.isNaN(e)||(c[d]=e)}b.setVoxelCoordinates(c)}}},{key:"update",value:function(){this.needsUpdate=null;var a=this.viewer,b=a.mouseState,c=this.tempPosition,a=a.navigationState.pose.position;if(a.getVoxelCoordinates(c))for(var d=this.positionElements,e=0;3>e;++e)d[e].value=""+Math.floor(c[e]);a=a.voxelSize;d="";b.active&&(a.voxelFromSpatial(c,b.position),d="x "+Math.round(c[0])+"  y "+Math.round(c[1])+"  z "+Math.round(c[2]));this.mouseElement.textContent=
d}},{key:"disposed",value:function(){for(var a=$jscomp.makeIterator(this.positionElements),b=a.next();!b.done;b=a.next())this.element.removeChild(b.value);this.element=this.positionElements=void 0;d(Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}}]);return e}(g.RefCounted);c.PositionStatusPanel=e},function(g,c){},function(g,c,e){function l(){try{var a=location.href.replace(/^[^#]+/,"");if(""===a||"#"===a||"#!"===a)a="#!{}";if(a.startsWith("#!+")){var a=a.slice(3),a=decodeURI(a),c=
r.urlSafeParse(a);"object"===typeof c&&b(c)}else if(a.startsWith("#!")){if(a=a.slice(2),a=decodeURI(a),a!==p){p=a;for(var d=$jscomp.makeIterator(v.values()),e=d.next();!e.done;e=d.next())e.value.reset();var f=r.urlSafeParse(a);"object"===typeof f&&b(f)}}else p=null}catch(g){console.log(g)}}function b(a){k=a;a=$jscomp.makeIterator(Object.keys(k));for(var b=a.next();!b.done;b=a.next()){var c=b.value,b=v.get(c);if(void 0!==b)try{q=b,b.restoreState(k[c])}catch(d){console.log("Failed to restore "+c+" state: "+
d)}finally{q=null}}}function a(){null!=h&&clearTimeout(h);h=setTimeout(d,500)}function d(){h=null;for(var a=!1,b=$jscomp.makeIterator(f),c=b.next();!c.done;c=b.next()){var c=c.value,d=n.get(c);void 0===d?k.hasOwnProperty(d)&&(a=!0):(a=!0,k[d]=c.toJSON())}f.clear();a&&(a=r.urlSafeStringify(k),a!==p&&(p=a,"{}"===p?history.replaceState(null,void 0,"#"):history.replaceState(null,void 0,"#!"+p)))}function m(){q!==this&&(f.add(this),a())}var r=e(8),v=new Map,n=new Map,k={},q=null,f=new Set,p=null,h=null;
c.delayHashUpdate=function(){null!=h&&a()};addEventListener("hashchange",l);c.registerTrackable=function(a,b){if(v.has(a))throw Error("Key "+JSON.stringify(a)+" already registered.");if(n.has(b))throw Error("Object already registered.");v.set(a,b);n.set(b,a);k.hasOwnProperty(a)&&b.restoreState(k[a]);b.changed.add(m,b);m.call(b)};c.unregisterTrackable=function(a){var b=v.get(a),c=void 0;if(void 0!==b)c=a;else{c=n.get(a);if(void 0===c)throw Error("Key or object not registered.");b=a}v.delete(c);n.delete(b);
b.changed.remove(m,b);m.call(b)};l()},function(g,c){}]);
